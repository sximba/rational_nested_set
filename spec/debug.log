# Logfile created on 2015-06-05 22:56:40 +0200 by logger.rb/47272
D, [2015-06-05T22:56:40.230203 #97702] DEBUG -- :   [1m[36m (0.3ms)[0m  [1mCREATE TABLE "default_scoped_models" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-05T22:56:40.230720 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "categories" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-05T22:56:40.231041 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "departments" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar) [0m
D, [2015-06-05T22:56:40.231430 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "notes" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "notable_id" integer, "notable_type" varchar, "user_id" integer) 
D, [2015-06-05T22:56:40.231816 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "renamed_columns" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "mother_id" integer, "red" integer, "black" integer, "pitch" integer) [0m
D, [2015-06-05T22:56:40.232198 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "things" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "children_count" integer) 
D, [2015-06-05T22:56:40.232549 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "brokens" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-05T22:56:40.232907 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "orders" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) 
D, [2015-06-05T22:56:40.233287 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "positions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "position" integer) [0m
D, [2015-06-05T22:56:40.233633 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "no_depths" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) 
D, [2015-06-05T22:56:40.234023 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "single_table_inheritance" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "type" varchar, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) [0m
D, [2015-06-05T22:56:40.234403 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uuid" varchar, "name" varchar, "parent_uuid" varchar, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-05T22:56:40.247616 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL) [0m
D, [2015-06-05T22:56:40.248239 #97702] DEBUG -- :   [1m[35m (0.5ms)[0m  select sqlite_version(*)
D, [2015-06-05T22:56:40.248694 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
D, [2015-06-05T22:56:40.248841 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT version FROM "schema_migrations"
D, [2015-06-05T22:56:40.248986 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('0')[0m
D, [2015-06-05T22:56:40.675237 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T22:56:40.677705 #97702] DEBUG -- :   [1m[36mFixture Delete (0.0ms)[0m  [1mDELETE FROM "categories"[0m
D, [2015-06-05T22:56:40.679087 #97702] DEBUG -- :   [1m[35mFixture Insert (0.1ms)[0m  INSERT INTO "categories" ("id", "name", "lft", "rgt") VALUES (1, 'Top Level', 1, 10)
D, [2015-06-05T22:56:40.679230 #97702] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (2, 'Child 1', 1, 2, 3)[0m
D, [2015-06-05T22:56:40.679348 #97702] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (3, 'Child 2', 1, 4, 7)
D, [2015-06-05T22:56:40.679486 #97702] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (4, 'Child 2.1', 3, 5, 6)[0m
D, [2015-06-05T22:56:40.679597 #97702] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (5, 'Child 3', 1, 8, 9)
D, [2015-06-05T22:56:40.679701 #97702] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "categories" ("id", "name", "lft", "rgt") VALUES (6, 'Top Level 2', 11, 12)[0m
D, [2015-06-05T22:56:40.679788 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  commit transaction
D, [2015-06-05T22:56:40.679913 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:40.680687 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:40.686749 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:40.693646 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 11) AND ("categories"."lft" < 12)  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:40.694431 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.694849 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.697714 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:40.698213 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:40.698639 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:40.699297 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 11) AND ("categories"."lft" < 12)  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:40.699553 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.699914 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.700224 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:40.700609 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:40.701165 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 11) AND ("categories"."lft" < 12)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:40.701363 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:40.701621 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:40.701950 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:40.702247 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:40.702637 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:40.703243 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 11) AND ("categories"."lft" < 12)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:40.703470 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:40.703756 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:40.704053 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:40.704437 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:40.704989 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 11) AND ("categories"."lft" < 12)  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:40.705941 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.706249 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.706670 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:40.707001 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:40.707393 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:40.708011 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 11) AND ("categories"."lft" < 12)  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:40.708322 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.714255 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T22:56:40.714404 #97702] DEBUG -- :   [1m[36mFixture Delete (0.0ms)[0m  [1mDELETE FROM "departments"[0m
D, [2015-06-05T22:56:40.714631 #97702] DEBUG -- :   [1m[35mFixture Insert (0.1ms)[0m  INSERT INTO "departments" ("id", "name") VALUES (1, 'Top')
D, [2015-06-05T22:56:40.715271 #97702] DEBUG -- :   [1m[36mFixture Delete (0.0ms)[0m  [1mDELETE FROM "notes"[0m
D, [2015-06-05T22:56:40.715413 #97702] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "notes" ("id", "body", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (1, 'Top Level', 1, 10, 1, 'Category', 1)
D, [2015-06-05T22:56:40.715540 #97702] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "notes" ("id", "body", "parent_id", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (2, 'Child 1', 1, 2, 3, 1, 'Category', 1)[0m
D, [2015-06-05T22:56:40.715660 #97702] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "notes" ("id", "body", "parent_id", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (3, 'Child 2', 1, 4, 7, 1, 'Category', 1)
D, [2015-06-05T22:56:40.715841 #97702] DEBUG -- :   [1m[36mFixture Insert (0.1ms)[0m  [1mINSERT INTO "notes" ("id", "body", "parent_id", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (4, 'Child 3', 1, 8, 9, 1, 'Category', 1)[0m
D, [2015-06-05T22:56:40.715953 #97702] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "notes" ("id", "body", "lft", "rgt", "notable_id", "notable_type") VALUES (5, 'Top Level 2', 1, 2, 1, 'Departments')
D, [2015-06-05T22:56:40.716448 #97702] DEBUG -- :   [1m[36mFixture Delete (0.0ms)[0m  [1mDELETE FROM "things"[0m
D, [2015-06-05T22:56:40.716574 #97702] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "things" ("id", "body", "lft", "rgt", "children_count") VALUES (1, 'Top Level', 1, 10, 2)
D, [2015-06-05T22:56:40.716689 #97702] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "things" ("id", "body", "parent_id", "lft", "rgt", "children_count") VALUES (2, 'Child 1', 1, 2, 3, 0)[0m
D, [2015-06-05T22:56:40.716818 #97702] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "things" ("id", "body", "parent_id", "lft", "rgt", "children_count") VALUES (3, 'Child 2', 1, 4, 7, 0)
D, [2015-06-05T22:56:40.716928 #97702] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "things" ("id", "body", "parent_id", "lft", "rgt", "children_count") VALUES (4, 'Child 2.1', 3, 8, 9, 0)[0m
D, [2015-06-05T22:56:40.717355 #97702] DEBUG -- :   [1m[35mFixture Delete (0.0ms)[0m  DELETE FROM "brokens"
D, [2015-06-05T22:56:40.717463 #97702] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "brokens" ("id", "name") VALUES (1, 'One')[0m
D, [2015-06-05T22:56:40.717951 #97702] DEBUG -- :   [1m[35mFixture Delete (0.0ms)[0m  DELETE FROM "users"
D, [2015-06-05T22:56:40.718096 #97702] DEBUG -- :   [1m[36mFixture Insert (0.1ms)[0m  [1mINSERT INTO "users" ("id", "uuid", "name", "lft", "rgt") VALUES (1, 'abcd', 'Top Level', 1, 10)[0m
D, [2015-06-05T22:56:40.718232 #97702] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (2, 'efgh', 'Child 1', 'abcd', 2, 3)
D, [2015-06-05T22:56:40.718347 #97702] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (3, 'ijkh', 'Child 2', 'abcd', 4, 7)[0m
D, [2015-06-05T22:56:40.718457 #97702] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (4, 'lmno', 'Child 2.1', 'ijkh', 5, 6)
D, [2015-06-05T22:56:40.718591 #97702] DEBUG -- :   [1m[36mFixture Insert (0.1ms)[0m  [1mINSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (5, 'pqrs', 'Child 3', 'abcd', 8, 9)[0m
D, [2015-06-05T22:56:40.718698 #97702] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "users" ("id", "uuid", "name", "lft", "rgt") VALUES (6, 'tuvw', 'Top Level 2', 11, 12)
D, [2015-06-05T22:56:40.719153 #97702] DEBUG -- :   [1m[36mFixture Delete (0.0ms)[0m  [1mDELETE FROM "default_scoped_models"[0m
D, [2015-06-05T22:56:40.719275 #97702] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "default_scoped_models" ("id", "name", "lft", "rgt") VALUES (1, 'Top Level', 1, 4)
D, [2015-06-05T22:56:40.719388 #97702] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "default_scoped_models" ("id", "name", "parent_id", "lft", "rgt") VALUES (2, 'Child 1', 1, 2, 3)[0m
D, [2015-06-05T22:56:40.719491 #97702] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "default_scoped_models" ("id", "name", "lft", "rgt") VALUES (6, 'Top Level 2', 5, 6)
D, [2015-06-05T22:56:40.719594 #97702] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "default_scoped_models" ("id", "name", "lft", "rgt") VALUES (7, 'Top Level 3', 7, 8)[0m
D, [2015-06-05T22:56:40.719707 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  commit transaction
D, [2015-06-05T22:56:40.719825 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:40.723565 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.725575 #97702] DEBUG -- :   [1m[36mRenamedColumns Load (0.1ms)[0m  [1mSELECT  "renamed_columns".* FROM "renamed_columns"  ORDER BY "renamed_columns"."black" desc LIMIT 1[0m
D, [2015-06-05T22:56:40.725966 #97702] DEBUG -- :   [1m[35mRenamedColumns Load (0.1ms)[0m  SELECT  "renamed_columns".* FROM "renamed_columns"  ORDER BY "renamed_columns"."black" desc LIMIT 1
D, [2015-06-05T22:56:40.726417 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "renamed_columns" ("red", "black") VALUES (?, ?)[0m  [["red", 1], ["black", 2]]
D, [2015-06-05T22:56:40.727010 #97702] DEBUG -- :   [1m[35mRenamedColumns Load (0.1ms)[0m  SELECT  "renamed_columns".* FROM "renamed_columns" WHERE "renamed_columns"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:40.727675 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "renamed_columns" SET "pitch" = 0 WHERE "renamed_columns"."id" IN (SELECT "renamed_columns"."id" FROM "renamed_columns" WHERE "renamed_columns"."id" = 1  ORDER BY "renamed_columns"."red")[0m
D, [2015-06-05T22:56:40.727889 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.728357 #97702] DEBUG -- :   [1m[36m (0.3ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.728912 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T22:56:40.731893 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.732732 #97702] DEBUG -- :   [1m[35mBroken Load (0.1ms)[0m  SELECT  "brokens".* FROM "brokens"  ORDER BY "brokens"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:40.733637 #97702] DEBUG -- :   [1m[36mBroken Load (0.1ms)[0m  [1mSELECT  "brokens".* FROM "brokens" WHERE "brokens"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T22:56:40.734206 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "brokens" ("lft", "rgt") VALUES (?, ?)  [["lft", 1], ["rgt", 2]]
D, [2015-06-05T22:56:40.734798 #97702] DEBUG -- :   [1m[36mBroken Load (0.1ms)[0m  [1mSELECT  "brokens".* FROM "brokens" WHERE "brokens"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:40.735344 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "brokens" SET "depth" = 0 WHERE "brokens"."id" IN (SELECT "brokens"."id" FROM "brokens" WHERE "brokens"."id" = 2  ORDER BY "brokens"."lft")
D, [2015-06-05T22:56:40.735543 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.735702 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:40.736148 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:40.736541 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:40.743696 #97702] DEBUG -- :   [1m[36mCategory Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1[0m  [["parent_id", 4]]
D, [2015-06-05T22:56:40.744161 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:40.744943 #97702] DEBUG -- :   [1m[36mCategory Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1[0m  [["parent_id", 3]]
D, [2015-06-05T22:56:40.745236 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:40.745896 #97702] DEBUG -- :   [1m[36mCategory Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1[0m  [["parent_id", 1]]
D, [2015-06-05T22:56:40.746079 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:40.746462 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:40.746820 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:40.747131 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:40.747475 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:40.747761 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:40.748092 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:40.748629 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:40.749401 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)
D, [2015-06-05T22:56:40.749568 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.749929 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.750292 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.751005 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:40.751499 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:40.752073 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "lawyers"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:40.752668 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:40.753283 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.753556 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.753750 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.754247 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:40.754599 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:40.755026 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "United States"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:40.755446 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:40.755895 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.756141 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.756268 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.756529 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:40.756857 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:40.758554 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 8 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 16 OR "categories"."rgt" BETWEEN 14 AND 16)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.758686 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.759111 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:40.759356 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.759628 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:40.760633 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)[0m
D, [2015-06-05T22:56:40.761022 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.761175 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.761466 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:40.761703 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.762229 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:40.762572 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:40.763040 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Patent Law"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T22:56:40.763497 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:40.764071 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.764325 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.764460 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.764769 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:40.765123 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:40.765950 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 15 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 15 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 15 AND 18 OR "categories"."rgt" BETWEEN 15 AND 18)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.771830 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.772313 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:40.772643 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.772887 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:40.773558 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 15) AND ("categories"."rgt" >= 16) AND ("categories"."id" != 9)
D, [2015-06-05T22:56:40.773956 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.774083 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.774435 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:40.774716 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:40.775453 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 7]]
D, [2015-06-05T22:56:40.776007 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?  [["parent_id", 8]]
D, [2015-06-05T22:56:40.776593 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" >= 13) AND ("categories"."lft" < 18) AND ("categories"."id" != 7)[0m
D, [2015-06-05T22:56:40.776747 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:40.777220 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:40.777575 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:40.777877 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:40.778225 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:40.778506 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:40.778745 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:40.779293 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10) AND ("categories"."id" != 1)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:40.779525 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:40.779804 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:40.780150 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:40.781372 #97702] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft"[0m  [["parent_id", 1]]
D, [2015-06-05T22:56:40.781799 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:40.782154 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:40.782609 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:40.783255 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3) AND ("categories"."lft" < 4)  ORDER BY "categories"."lft" DESC LIMIT 1[0m
D, [2015-06-05T22:56:40.783437 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.783739 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:40.784068 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:40.784896 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 7 - 3 WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 7 - 3 WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 3 THEN 1 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 2 AND 7 OR "categories"."rgt" BETWEEN 2 AND 7)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.784981 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.785273 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T22:56:40.785460 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.785713 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:40.786299 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 2) AND ("categories"."rgt" >= 5) AND ("categories"."id" != 3)
D, [2015-06-05T22:56:40.786660 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.787127 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = "depth" + 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" >= 2) AND ("categories"."lft" < 5) AND ("categories"."id" != 3)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.787246 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.787507 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:40.787797 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:40.788441 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft"  [["parent_id", 1]]
D, [2015-06-05T22:56:40.788828 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:40.789245 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:40.789531 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.789909 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.790202 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:40.790506 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:40.790839 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:40.791162 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:40.791411 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.791774 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.792073 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:40.792357 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:40.792659 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:40.792945 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:40.793142 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.793460 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T22:56:40.794043 #97702] DEBUG -- :   [1m[36mScopedCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:40.797771 #97702] DEBUG -- :   [1m[35mScopedCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft" LIMIT 1  [["parent_id", 1]]
D, [2015-06-05T22:56:40.798368 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.799426 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "organization_id" = ? WHERE "categories"."id" = ?  [["organization_id", 999999999], ["id", 2]]
D, [2015-06-05T22:56:40.800191 #97702] DEBUG -- :   [1m[36mScopedCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:40.800960 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE "categories"."organization_id" = ? AND ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 2)  [["organization_id", 999999999]]
D, [2015-06-05T22:56:40.801514 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."organization_id" = ? AND "categories"."id" = 2  ORDER BY "categories"."lft")[0m  [["organization_id", 999999999]]
D, [2015-06-05T22:56:40.801798 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.802005 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.802415 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.802826 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:40.803165 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:40.803522 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:40.803793 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:40.804050 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.804342 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.804651 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:40.804961 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:40.805273 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:40.805575 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:40.805769 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.806048 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.806524 #97702] DEBUG -- :   [1m[36mScopedCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:40.807198 #97702] DEBUG -- :   [1m[35mScopedCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft" LIMIT 1  [["parent_id", 1]]
D, [2015-06-05T22:56:40.807509 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.808084 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "organization_id" = ? WHERE "categories"."id" = ?  [["organization_id", 999999999], ["id", 2]]
D, [2015-06-05T22:56:40.808505 #97702] DEBUG -- :   [1m[36mScopedCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:40.809104 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "categories" WHERE "categories"."organization_id" = ? AND ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 2)  [["organization_id", 999999999]]
D, [2015-06-05T22:56:40.809584 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."organization_id" = ? AND "categories"."id" = 2  ORDER BY "categories"."lft")[0m  [["organization_id", 999999999]]
D, [2015-06-05T22:56:40.809883 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.810068 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.810455 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.810944 #97702] DEBUG -- :   [1m[36mScopedCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:40.811576 #97702] DEBUG -- :   [1m[35mScopedCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft" LIMIT 1  [["parent_id", 1]]
D, [2015-06-05T22:56:40.811854 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.812592 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "organization_id" = ? WHERE "categories"."id" = ?  [["organization_id", 999999999], ["id", 2]]
D, [2015-06-05T22:56:40.813676 #97702] DEBUG -- :   [1m[36mScopedCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:40.814503 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "categories" WHERE "categories"."organization_id" = ? AND ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 2)  [["organization_id", 999999999]]
D, [2015-06-05T22:56:40.814963 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."organization_id" = ? AND "categories"."id" = 2  ORDER BY "categories"."lft")[0m  [["organization_id", 999999999]]
D, [2015-06-05T22:56:40.815205 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.815388 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.815830 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.816226 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:40.816565 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:40.817117 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3) AND ("categories"."lft" < 4)  ORDER BY "categories"."lft" DESC LIMIT 1[0m
D, [2015-06-05T22:56:40.817421 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:40.817902 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 5) AND ("categories"."lft" < 8)  ORDER BY "categories"."lft" DESC LIMIT 1[0m
D, [2015-06-05T22:56:40.818066 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:40.818348 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:40.818652 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:40.819122 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL AND ("categories"."id" != 1) AND ("categories"."lft" < 1)  ORDER BY "categories"."lft" DESC LIMIT 1[0m
D, [2015-06-05T22:56:40.819261 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:40.819543 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:40.819824 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:40.820303 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 3 AND ("categories"."id" != 4) AND ("categories"."lft" < 5)  ORDER BY "categories"."lft" DESC LIMIT 1[0m
D, [2015-06-05T22:56:40.820470 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-05T22:56:40.820729 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:40.821035 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:40.821532 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 2) AND ("categories"."lft" < 2)  ORDER BY "categories"."lft" DESC LIMIT 1[0m
D, [2015-06-05T22:56:40.821687 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:40.821970 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:40.822257 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:40.822546 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:40.823023 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3) AND ("categories"."lft" >= 4)  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T22:56:40.823333 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:40.823776 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 2) AND ("categories"."lft" >= 2)  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T22:56:40.823931 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.824237 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.824534 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:40.824790 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:40.825268 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL AND ("categories"."id" != 1) AND ("categories"."lft" >= 1)  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:40.825754 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL AND ("categories"."id" != 6) AND ("categories"."lft" >= 11)  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T22:56:40.825890 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.826158 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.826472 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:40.826940 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 3 AND ("categories"."id" != 4) AND ("categories"."lft" >= 5)  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T22:56:40.827074 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.827366 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.827641 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:40.828140 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 5) AND ("categories"."lft" >= 8)  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T22:56:40.828275 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.828533 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.828846 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:40.829355 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3) AND ("categories"."lft" < 4)  ORDER BY "categories"."lft" DESC LIMIT 1
D, [2015-06-05T22:56:40.829515 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.829803 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:40.830134 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:40.830962 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 7 - 3 WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 7 - 3 WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 3 THEN 1 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 2 AND 7 OR "categories"."rgt" BETWEEN 2 AND 7)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.831047 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.831349 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:40.831544 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.831801 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:40.832440 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 2) AND ("categories"."rgt" >= 5) AND ("categories"."id" != 3)[0m
D, [2015-06-05T22:56:40.832810 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.833286 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = "depth" + 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" >= 2) AND ("categories"."lft" < 5) AND ("categories"."id" != 3)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.833368 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.833656 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:40.834137 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3) AND ("categories"."lft" < 2)  ORDER BY "categories"."lft" DESC LIMIT 1
D, [2015-06-05T22:56:40.834425 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:40.834856 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3) AND ("categories"."lft" >= 2)  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T22:56:40.836404 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:40.837311 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:40.837684 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:40.837994 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:40.838273 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.838611 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.838979 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:40.839489 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3) AND ("categories"."lft" >= 4)  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T22:56:40.839656 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.839916 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:40.840233 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:40.841072 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 9 - 7 WHEN "lft" BETWEEN 8 AND 9 THEN "lft" + 4 - 8 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 9 - 7 WHEN "rgt" BETWEEN 8 AND 9 THEN "rgt" + 4 - 8 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 3 THEN 1 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 4 AND 9 OR "categories"."rgt" BETWEEN 4 AND 9)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.841157 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.841508 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 5]]
D, [2015-06-05T22:56:40.841707 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.841983 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:40.842666 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 6) AND ("categories"."rgt" >= 9) AND ("categories"."id" != 3)[0m
D, [2015-06-05T22:56:40.843046 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.843517 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = "depth" + 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" >= 6) AND ("categories"."lft" < 9) AND ("categories"."id" != 3)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.843599 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.843903 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:40.844416 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3) AND ("categories"."lft" >= 6)  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T22:56:40.844721 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:40.845203 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3) AND ("categories"."lft" < 6)  ORDER BY "categories"."lft" DESC LIMIT 1
D, [2015-06-05T22:56:40.846008 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:40.846384 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:40.846731 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:40.847006 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:40.847220 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.847570 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.847880 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:40.848153 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:40.848303 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.848544 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:40.848854 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 5]]
D, [2015-06-05T22:56:40.849636 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 7 THEN "lft" + 9 - 7 WHEN "lft" BETWEEN 8 AND 9 THEN "lft" + 2 - 8 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 7 THEN "rgt" + 9 - 7 WHEN "rgt" BETWEEN 8 AND 9 THEN "rgt" + 2 - 8 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 5 THEN 1 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 2 AND 9 OR "categories"."rgt" BETWEEN 2 AND 9)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.849721 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.849982 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:40.850219 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.850520 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:40.851214 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 5)[0m
D, [2015-06-05T22:56:40.851620 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 5  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.851761 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.852106 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 5]]
D, [2015-06-05T22:56:40.852600 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 5) AND ("categories"."lft" < 2)  ORDER BY "categories"."lft" DESC LIMIT 1[0m
D, [2015-06-05T22:56:40.853040 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 5) AND ("categories"."lft" >= 2)  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T22:56:40.853836 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:40.854211 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:40.854520 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:40.854794 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:40.855014 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.855362 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.855691 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:40.855999 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:40.856176 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.856400 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:40.856730 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T22:56:40.857535 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 9 - 3 WHEN "lft" BETWEEN 4 AND 9 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 9 - 3 WHEN "rgt" BETWEEN 4 AND 9 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 2 THEN 1 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 2 AND 9 OR "categories"."rgt" BETWEEN 2 AND 9)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.857637 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.857930 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 5]]
D, [2015-06-05T22:56:40.858148 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.858393 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:40.859046 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 8) AND ("categories"."rgt" >= 9) AND ("categories"."id" != 2)[0m
D, [2015-06-05T22:56:40.859421 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 2  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.859552 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.859841 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:40.860302 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 2) AND ("categories"."lft" >= 8)  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:40.860754 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 2) AND ("categories"."lft" < 8)  ORDER BY "categories"."lft" DESC LIMIT 1
D, [2015-06-05T22:56:40.861530 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:40.861901 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:40.862221 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:40.862517 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:40.862735 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.863084 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.863417 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:40.863592 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.863868 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:40.864641 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:40.865331 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT "categories"."rgt" FROM "categories"  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:40.866221 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 12 - 7 WHEN "lft" BETWEEN 8 AND 12 THEN "lft" + 4 - 8 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 12 - 7 WHEN "rgt" BETWEEN 8 AND 12 THEN "rgt" + 4 - 8 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 3 THEN NULL ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 4 AND 12 OR "categories"."rgt" BETWEEN 4 AND 12)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.866314 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.866685 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:40.866930 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.867167 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:40.867693 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.867826 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.868103 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:40.868473 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:40.869012 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 10) AND ("categories"."rgt" >= 11) AND ("categories"."id" != 4)[0m
D, [2015-06-05T22:56:40.869776 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:40.870153 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:40.870466 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:40.870756 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:40.870990 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:40.871340 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:40.871709 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:40.872004 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:40.872173 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.872438 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:40.872742 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:40.873598 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 8 - 3 WHEN "lft" BETWEEN 4 AND 8 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 8 - 3 WHEN "rgt" BETWEEN 4 AND 8 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 2 THEN 5 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 2 AND 8 OR "categories"."rgt" BETWEEN 2 AND 8)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.873682 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.873977 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 5]]
D, [2015-06-05T22:56:40.874170 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.874434 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:40.875110 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 2)
D, [2015-06-05T22:56:40.875534 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 2  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.875670 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.875939 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T22:56:40.876789 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:40.877169 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:40.877504 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:40.877796 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:40.878012 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:40.878356 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:40.878575 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.879102 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:40.879438 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T22:56:40.879876 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "New Child"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:40.880274 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:40.880733 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.880957 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.881214 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:40.881386 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.881637 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:40.881959 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:40.882757 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 10 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 10 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 10 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 10 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 1 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 10 AND 14 OR "categories"."rgt" BETWEEN 10 AND 14)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.882840 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.883142 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T22:56:40.883336 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.883610 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:40.884263 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 10) AND ("categories"."rgt" >= 11) AND ("categories"."id" != 7)
D, [2015-06-05T22:56:40.884640 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.884758 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.885055 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:40.885775 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft" DESC LIMIT 1  [["parent_id", 1]]
D, [2015-06-05T22:56:40.886041 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.886416 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.886763 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:40.887119 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:40.887304 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.887572 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:40.887909 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:40.888730 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 3 THEN "lft" + 7 - 3 WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 3 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 3 THEN "rgt" + 7 - 3 WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 3 - 4 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 3 THEN 2 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 3 AND 7 OR "categories"."rgt" BETWEEN 3 AND 7)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.888814 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.889079 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:40.889290 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.889540 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:40.890173 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 3) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 3)[0m
D, [2015-06-05T22:56:40.890609 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.891102 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = "depth" + 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" >= 3) AND ("categories"."lft" < 6) AND ("categories"."id" != 3)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.891206 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.891527 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:40.892317 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:40.892702 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:40.893038 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:40.893294 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:40.893622 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:40.893949 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:40.894316 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:40.894613 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.895133 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:40.895481 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:40.895912 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "New Top"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:40.896366 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:40.897386 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.897698 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.897886 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.898265 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:40.898640 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T22:56:40.899547 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 13 - 12 WHEN "lft" BETWEEN 13 AND 13 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 13 - 12 WHEN "rgt" BETWEEN 13 AND 13 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 6 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 11 AND 13 OR "categories"."rgt" BETWEEN 11 AND 13)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.899612 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.899894 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:40.900092 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.900358 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:40.900996 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 12) AND ("categories"."rgt" >= 13) AND ("categories"."id" != 6)
D, [2015-06-05T22:56:40.901361 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 6  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.901536 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.901810 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:40.902632 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:40.903017 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:40.903328 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:40.903631 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:40.903942 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-05T22:56:40.904334 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:40.904683 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:40.905018 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:40.905261 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.905746 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:40.906031 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T22:56:40.906450 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "New Top"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:40.906844 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:40.907302 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.907499 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.907661 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.907906 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:40.908245 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T22:56:40.909085 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 1 AND 10 THEN "lft" + 13 - 10 WHEN "lft" BETWEEN 11 AND 13 THEN "lft" + 1 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 1 AND 10 THEN "rgt" + 13 - 10 WHEN "rgt" BETWEEN 11 AND 13 THEN "rgt" + 1 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 1 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 1 AND 13 OR "categories"."rgt" BETWEEN 1 AND 13)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.909187 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.909496 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:40.909683 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.909920 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:40.910613 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 4) AND ("categories"."rgt" >= 13) AND ("categories"."id" != 1)[0m
D, [2015-06-05T22:56:40.910993 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 1  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.911492 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = "depth" + 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" >= 4) AND ("categories"."lft" < 13) AND ("categories"."id" != 1)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.911576 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.911902 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T22:56:40.912214 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:40.913001 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:40.913370 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:40.913701 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:40.913992 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:40.914301 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.914695 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.914941 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.915461 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:40.915805 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:40.916244 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Root1"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:40.916646 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:40.917135 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.917341 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.917547 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.917987 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:40.918404 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:40.918860 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Root2"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:40.919256 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:40.919760 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.919986 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.920186 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.920656 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:40.920979 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:40.921369 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Root3"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T22:56:40.921757 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:40.922190 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.922401 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.922530 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.922805 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:40.923161 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:40.923985 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 8 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 16 OR "categories"."rgt" BETWEEN 14 AND 16)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.924071 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.924397 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:40.924673 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.924954 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:40.925658 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)
D, [2015-06-05T22:56:40.926043 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.926185 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.926493 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:40.926676 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.926943 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:40.927289 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:40.928194 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 16 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 16 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 16 AND 18 OR "categories"."rgt" BETWEEN 16 AND 18)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.928286 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.928656 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:40.928912 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.929279 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:40.930554 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)
D, [2015-06-05T22:56:40.931052 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.931209 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.931577 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:40.932005 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" DESC LIMIT 1
D, [2015-06-05T22:56:40.932419 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 13) AND ("categories"."lft" < 18)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:40.933031 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)
D, [2015-06-05T22:56:40.933507 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)[0m
D, [2015-06-05T22:56:40.933726 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET lft = null, rgt = null
D, [2015-06-05T22:56:40.934479 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:40.934753 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" IS NULL)  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T22:56:40.935153 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 1 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:40.935491 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 2 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T22:56:40.935636 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.936262 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 2], ["rgt", 3], ["id", 2]]
D, [2015-06-05T22:56:40.936644 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:40.937190 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 2)
D, [2015-06-05T22:56:40.937572 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 2  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.937785 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.938115 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 3 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:40.938445 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 4 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T22:56:40.938577 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.939094 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 5], ["rgt", 6], ["id", 4]]
D, [2015-06-05T22:56:40.939452 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:40.939979 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 4)
D, [2015-06-05T22:56:40.940363 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 4  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.940599 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.940751 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.941269 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 4], ["rgt", 7], ["id", 3]]
D, [2015-06-05T22:56:40.941635 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:40.942213 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 4) AND ("categories"."rgt" >= 7) AND ("categories"."id" != 3)
D, [2015-06-05T22:56:40.942613 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.942829 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.943138 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 5 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:40.943283 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.943774 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 8], ["rgt", 9], ["id", 5]]
D, [2015-06-05T22:56:40.944125 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:40.944645 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 8) AND ("categories"."rgt" >= 9) AND ("categories"."id" != 5)[0m
D, [2015-06-05T22:56:40.945008 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 5  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.945221 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.945355 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.945840 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 1], ["rgt", 10], ["id", 1]]
D, [2015-06-05T22:56:40.946187 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:40.946644 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 1  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.946846 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.947185 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 6 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:40.947328 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.947851 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 11], ["rgt", 12], ["id", 6]]
D, [2015-06-05T22:56:40.948208 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:40.948656 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 6  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.948892 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.949223 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 7 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:40.949521 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 8 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T22:56:40.949663 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.950167 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 14], ["rgt", 15], ["id", 8]]
D, [2015-06-05T22:56:40.950524 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:40.951059 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)
D, [2015-06-05T22:56:40.951432 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.951637 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.951955 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 9 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:40.952094 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.952622 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 16], ["rgt", 17], ["id", 9]]
D, [2015-06-05T22:56:40.952979 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:40.953543 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)[0m
D, [2015-06-05T22:56:40.953923 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.954148 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.954285 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.954787 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 13], ["rgt", 18], ["id", 7]]
D, [2015-06-05T22:56:40.955142 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:40.955611 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.955813 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.956160 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" DESC LIMIT 1[0m
D, [2015-06-05T22:56:40.956539 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 13) AND ("categories"."lft" < 18)  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:40.957109 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)[0m
D, [2015-06-05T22:56:40.957591 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)
D, [2015-06-05T22:56:40.957807 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:40.958545 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:40.958785 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.959315 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:40.959666 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:40.960094 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Node-1"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:40.960486 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:40.960933 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.961147 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.961341 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.961793 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:40.962120 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:40.962515 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Node-2"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:40.962897 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:40.963339 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.963540 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.963725 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.964178 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:40.964490 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:40.964899 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Node-3"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T22:56:40.965302 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:40.965757 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.965979 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.966110 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.966378 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:40.966724 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:40.967558 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 8 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 16 OR "categories"."rgt" BETWEEN 14 AND 16)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.967643 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.967938 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:40.968156 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.968412 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:40.969073 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)
D, [2015-06-05T22:56:40.969418 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.969551 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.969859 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:40.970027 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.970305 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:40.970629 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:40.971450 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 16 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 16 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 16 AND 18 OR "categories"."rgt" BETWEEN 16 AND 18)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.971536 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.971838 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:40.972041 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.972297 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:40.972976 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)
D, [2015-06-05T22:56:40.973368 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.973514 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.973833 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:40.974226 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" DESC LIMIT 1
D, [2015-06-05T22:56:40.974617 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 13) AND ("categories"."lft" < 18)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:40.975177 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)
D, [2015-06-05T22:56:40.975640 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)[0m
D, [2015-06-05T22:56:40.975854 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET lft = null, rgt = null
D, [2015-06-05T22:56:40.976604 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:40.976885 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" IS NULL)  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T22:56:40.977281 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 1 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:40.977617 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 2 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T22:56:40.977770 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.978321 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 2], ["rgt", 3], ["id", 2]]
D, [2015-06-05T22:56:40.978681 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:40.979209 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 2)
D, [2015-06-05T22:56:40.979577 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 2  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.979793 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.980104 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 3 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:40.980423 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 4 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T22:56:40.980555 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.981037 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 5], ["rgt", 6], ["id", 4]]
D, [2015-06-05T22:56:40.981379 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:40.981896 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 4)
D, [2015-06-05T22:56:40.982258 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 4  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.982462 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.982601 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.983077 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 4], ["rgt", 7], ["id", 3]]
D, [2015-06-05T22:56:40.983415 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:40.983919 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 4) AND ("categories"."rgt" >= 7) AND ("categories"."id" != 3)
D, [2015-06-05T22:56:40.984271 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.984470 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.984773 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 5 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:40.984904 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.985376 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 8], ["rgt", 9], ["id", 5]]
D, [2015-06-05T22:56:40.985709 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:40.986209 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 8) AND ("categories"."rgt" >= 9) AND ("categories"."id" != 5)[0m
D, [2015-06-05T22:56:40.986560 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 5  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.986759 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.986895 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.987364 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 1], ["rgt", 10], ["id", 1]]
D, [2015-06-05T22:56:40.987692 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:40.988118 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 1  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.988322 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.988633 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 6 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:40.988763 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.989227 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 11], ["rgt", 12], ["id", 6]]
D, [2015-06-05T22:56:40.989559 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:40.989965 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 6  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.990167 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.990478 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 7 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:40.990783 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 8 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T22:56:40.990918 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.991381 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 14], ["rgt", 15], ["id", 8]]
D, [2015-06-05T22:56:40.991727 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:40.992233 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)
D, [2015-06-05T22:56:40.992581 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:40.992787 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.993121 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 9 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:40.993273 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.993854 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 16], ["rgt", 17], ["id", 9]]
D, [2015-06-05T22:56:40.994218 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:40.994779 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)[0m
D, [2015-06-05T22:56:40.995161 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:40.995404 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:40.995543 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:40.996058 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 13], ["rgt", 18], ["id", 7]]
D, [2015-06-05T22:56:40.996473 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.000832 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.001108 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.001515 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" DESC LIMIT 1[0m
D, [2015-06-05T22:56:41.001893 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 13) AND ("categories"."lft" < 18)  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.002482 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)[0m
D, [2015-06-05T22:56:41.002923 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)
D, [2015-06-05T22:56:41.003107 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.003836 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.004057 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.004538 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.004893 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.005294 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Node-1"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:41.005670 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.006124 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.006325 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.006502 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.006956 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.007278 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.007683 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Node-2"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:41.008076 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.008566 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.008786 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.008960 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.009396 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.009694 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.010099 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Node-3"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T22:56:41.010488 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.010936 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.011126 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.011662 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft"  [["parent_id", 7]]
D, [2015-06-05T22:56:41.011827 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.012080 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.012405 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.013192 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 8 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 16 OR "categories"."rgt" BETWEEN 14 AND 16)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.013276 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.013568 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.013750 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.013999 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.014623 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)[0m
D, [2015-06-05T22:56:41.014995 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.015167 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.015434 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.016131 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 7]]
D, [2015-06-05T22:56:41.017410 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.017849 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 7]]
D, [2015-06-05T22:56:41.018088 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft"  [["parent_id", 7]]
D, [2015-06-05T22:56:41.018326 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.018604 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.018956 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:41.019814 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 16 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 16 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 16 AND 18 OR "categories"."rgt" BETWEEN 16 AND 18)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.019903 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.020204 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.020422 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.020658 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:41.021375 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)[0m
D, [2015-06-05T22:56:41.021750 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.021895 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.022195 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:41.022850 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 7]]
D, [2015-06-05T22:56:41.022980 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.023262 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.023601 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:41.023803 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.024059 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.024289 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.024520 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:41.025119 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)[0m
D, [2015-06-05T22:56:41.025495 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.025617 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.025901 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:41.026220 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.026578 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?  [["parent_id", 7]]
D, [2015-06-05T22:56:41.026939 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft"[0m  [["parent_id", 7]]
D, [2015-06-05T22:56:41.027282 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.027556 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.027862 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:41.028058 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.028311 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.028513 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.028766 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:41.029334 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)[0m
D, [2015-06-05T22:56:41.029715 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.029834 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.030119 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:41.030746 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 7]]
D, [2015-06-05T22:56:41.031089 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft"  [["parent_id", 7]]
D, [2015-06-05T22:56:41.031295 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.031575 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.031898 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:41.032677 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 15 THEN "lft" + 17 - 15 WHEN "lft" BETWEEN 16 AND 17 THEN "lft" + 14 - 16 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 15 THEN "rgt" + 17 - 15 WHEN "rgt" BETWEEN 16 AND 17 THEN "rgt" + 14 - 16 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 17 OR "categories"."rgt" BETWEEN 14 AND 17)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.032802 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.033080 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.033297 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.033532 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:41.034156 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 9)[0m
D, [2015-06-05T22:56:41.034535 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.034656 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.034957 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:41.035270 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.035592 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.036215 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 7]]
D, [2015-06-05T22:56:41.037158 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft"  [["parent_id", 7]]
D, [2015-06-05T22:56:41.037538 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.038094 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.038356 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.039023 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.039447 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.039898 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Root1"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:41.040319 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.040805 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.041049 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.041250 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.041727 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.042080 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.042447 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Root2"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:41.042822 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.043253 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.043470 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.043640 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.044102 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.044394 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.044777 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Root3"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T22:56:41.045161 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.045612 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.045813 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.045984 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.046245 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.046626 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.048112 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 8 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 16 OR "categories"."rgt" BETWEEN 14 AND 16)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.048228 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.048630 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.048882 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.049155 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.049840 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)
D, [2015-06-05T22:56:41.050241 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.050381 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.050654 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.050895 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.051138 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.051461 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:41.052236 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 16 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 16 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 16 AND 18 OR "categories"."rgt" BETWEEN 16 AND 18)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.052319 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.052615 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.052833 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.053066 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.053669 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)
D, [2015-06-05T22:56:41.054036 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.054165 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.054461 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:41.054637 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.055107 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "name" = ? WHERE "categories"."id" = ?[0m  [["name", nil], ["id", 8]]
D, [2015-06-05T22:56:41.055456 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.055957 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)[0m
D, [2015-06-05T22:56:41.056325 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.056525 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.056875 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" DESC LIMIT 1
D, [2015-06-05T22:56:41.057254 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 13) AND ("categories"."lft" < 18)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:41.057788 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)
D, [2015-06-05T22:56:41.058241 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)[0m
D, [2015-06-05T22:56:41.058463 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET lft = null, rgt = null
D, [2015-06-05T22:56:41.059186 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.059454 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" IS NULL)  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T22:56:41.059828 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 1 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:41.060148 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 2 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T22:56:41.060288 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.060778 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 2], ["rgt", 3], ["id", 2]]
D, [2015-06-05T22:56:41.061124 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.061661 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 2)
D, [2015-06-05T22:56:41.062043 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 2  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.062256 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.062576 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 3 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:41.062897 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 4 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T22:56:41.063027 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.063486 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 5], ["rgt", 6], ["id", 4]]
D, [2015-06-05T22:56:41.063869 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.064393 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 4)
D, [2015-06-05T22:56:41.064758 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 4  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.064967 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.065131 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.065563 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 4], ["rgt", 7], ["id", 3]]
D, [2015-06-05T22:56:41.065884 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.066411 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 4) AND ("categories"."rgt" >= 7) AND ("categories"."id" != 3)
D, [2015-06-05T22:56:41.066774 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.066970 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.067259 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 5 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:41.067404 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.067837 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 8], ["rgt", 9], ["id", 5]]
D, [2015-06-05T22:56:41.068174 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.068673 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 8) AND ("categories"."rgt" >= 9) AND ("categories"."id" != 5)[0m
D, [2015-06-05T22:56:41.069026 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 5  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.069222 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.069350 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.069775 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 1], ["rgt", 10], ["id", 1]]
D, [2015-06-05T22:56:41.070118 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.070531 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 1  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.070728 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.071036 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 6 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:41.071195 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.071614 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 11], ["rgt", 12], ["id", 6]]
D, [2015-06-05T22:56:41.071974 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:41.072388 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 6  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.072584 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.072883 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 7 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:41.073214 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 8 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T22:56:41.073352 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.073872 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 14], ["rgt", 15], ["id", 8]]
D, [2015-06-05T22:56:41.074285 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.074857 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)
D, [2015-06-05T22:56:41.075229 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.075458 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.075768 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 9 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:41.075899 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.076361 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 16], ["rgt", 17], ["id", 9]]
D, [2015-06-05T22:56:41.076695 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:41.077203 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)[0m
D, [2015-06-05T22:56:41.077564 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.077799 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.077929 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.078349 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 13], ["rgt", 18], ["id", 7]]
D, [2015-06-05T22:56:41.078685 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.079135 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.079326 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.079704 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" DESC LIMIT 1[0m
D, [2015-06-05T22:56:41.080407 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 13) AND ("categories"."lft" < 18)  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.081439 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)[0m
D, [2015-06-05T22:56:41.081940 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)
D, [2015-06-05T22:56:41.082163 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.082897 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.083745 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.084180 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.084495 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.084772 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.085069 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET lft = null[0m
D, [2015-06-05T22:56:41.085672 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:41.085821 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.086132 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.086782 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.087150 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.087496 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.087749 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.088027 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET rgt = null[0m
D, [2015-06-05T22:56:41.088624 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:41.088764 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.089064 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.089742 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.090088 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.090417 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.090682 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.091115 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.091441 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  DELETE FROM "categories" WHERE "categories"."id" = ?  [["id", 3]]
D, [2015-06-05T22:56:41.092115 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.092478 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.092783 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.093057 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.093284 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.093605 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.094329 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.094680 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.095007 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.095281 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.095651 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:41.095860 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.096398 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = ? WHERE "categories"."id" = ?[0m  [["lft", 0], ["id", 6]]
D, [2015-06-05T22:56:41.096744 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:41.097179 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 6  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.097390 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.098056 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.098416 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.098722 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.098987 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.099199 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.099573 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.100297 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.100663 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.100995 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.101278 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.101670 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:41.102042 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.102619 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 2)[0m
D, [2015-06-05T22:56:41.103057 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 4) AND ("categories"."rgt" >= 7) AND ("categories"."id" != 3)
D, [2015-06-05T22:56:41.103491 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 4)[0m
D, [2015-06-05T22:56:41.103945 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 8) AND ("categories"."rgt" >= 9) AND ("categories"."id" != 5)
D, [2015-06-05T22:56:41.104141 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET lft = null, rgt = null[0m
D, [2015-06-05T22:56:41.104822 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:41.105080 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" IS NULL)  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:41.105449 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 1 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T22:56:41.105753 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 2 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:41.105901 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.106445 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 2], ["rgt", 3], ["id", 2]]
D, [2015-06-05T22:56:41.106774 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.107346 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 2)[0m
D, [2015-06-05T22:56:41.107720 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 2  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.107930 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.108241 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 3 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T22:56:41.108532 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 4 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T22:56:41.108683 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.109170 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 5], ["rgt", 6], ["id", 4]]
D, [2015-06-05T22:56:41.109508 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:41.110011 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 4)[0m
D, [2015-06-05T22:56:41.110375 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 4  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.110573 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.110704 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.111178 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 4], ["rgt", 7], ["id", 3]]
D, [2015-06-05T22:56:41.111527 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.112027 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 4) AND ("categories"."rgt" >= 7) AND ("categories"."id" != 3)[0m
D, [2015-06-05T22:56:41.112405 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.112603 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.112891 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 5 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T22:56:41.113038 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.113512 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 8], ["rgt", 9], ["id", 5]]
D, [2015-06-05T22:56:41.113847 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:41.114346 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 8) AND ("categories"."rgt" >= 9) AND ("categories"."id" != 5)
D, [2015-06-05T22:56:41.114716 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 5  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.114963 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.115095 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.115579 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 1], ["rgt", 10], ["id", 1]]
D, [2015-06-05T22:56:41.115921 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.116341 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 1  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.116539 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.116846 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 6 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T22:56:41.116975 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.117485 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 11], ["rgt", 12], ["id", 6]]
D, [2015-06-05T22:56:41.117906 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:41.118401 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 6  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.118629 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.119408 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:41.119785 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.120093 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.120366 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:41.120762 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T22:56:41.121128 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:41.121738 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 2)
D, [2015-06-05T22:56:41.122228 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 4) AND ("categories"."rgt" >= 7) AND ("categories"."id" != 3)[0m
D, [2015-06-05T22:56:41.122675 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 4)
D, [2015-06-05T22:56:41.123109 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 8) AND ("categories"."rgt" >= 9) AND ("categories"."id" != 5)[0m
D, [2015-06-05T22:56:41.123289 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.123875 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.124259 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.124557 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.124788 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.125052 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.125331 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.125484 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.125718 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.126021 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.126482 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10) AND ("categories"."id" != 1)  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.126865 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.127129 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.127436 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.127718 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.128032 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.128333 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:41.128635 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:41.128931 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:41.129096 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.129346 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.130223 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.130885 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.131408 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.132055 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ? WHERE "categories"."id" = ?  [["lft", nil], ["id", 3]]
D, [2015-06-05T22:56:41.132467 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.133085 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= NULL) AND ("categories"."rgt" >= 7) AND ("categories"."id" != 3)
D, [2015-06-05T22:56:41.133481 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.133696 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.134447 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.134611 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.134980 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.135674 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:41.135990 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.136196 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.136673 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "rgt" = ? WHERE "categories"."id" = ?[0m  [["rgt", nil], ["id", 3]]
D, [2015-06-05T22:56:41.137024 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.137565 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 4) AND ("categories"."rgt" >= NULL) AND ("categories"."id" != 3)[0m
D, [2015-06-05T22:56:41.137936 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.138166 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.138862 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:41.139013 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.139395 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.140076 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.140394 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:41.140601 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.141088 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ? WHERE "categories"."id" = ?  [["lft", 12], ["id", 6]]
D, [2015-06-05T22:56:41.141472 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:41.141935 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 6  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.142173 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.142821 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:41.142971 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.143332 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.144001 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.144315 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.144604 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.144821 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.145243 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ? WHERE "categories"."id" = ?[0m  [["lft", 1], ["id", 3]]
D, [2015-06-05T22:56:41.145588 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.146125 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 1) AND ("categories"."rgt" >= 7) AND ("categories"."id" != 3)[0m
D, [2015-06-05T22:56:41.146494 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.146720 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.147436 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:41.147592 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.147961 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.148654 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.148961 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.149239 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.149442 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.149895 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "rgt" = ? WHERE "categories"."id" = ?[0m  [["rgt", 10], ["id", 3]]
D, [2015-06-05T22:56:41.150247 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.150821 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 4) AND ("categories"."rgt" >= 10) AND ("categories"."id" != 3)[0m
D, [2015-06-05T22:56:41.151219 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.151441 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.152195 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:41.152358 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.152724 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.152945 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.153453 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.153826 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.154242 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Test 1"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:41.154624 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.155071 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.155294 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.155469 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.155909 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.156215 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.156604 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Test 2"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:41.156980 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.157420 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.157629 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.157797 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.158230 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.158577 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.159023 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Test 3"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T22:56:41.159461 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.159938 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.160139 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.160337 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.160792 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.161101 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:41.161492 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Test 4"], ["lft", 19], ["rgt", 20]]
D, [2015-06-05T22:56:41.161873 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T22:56:41.162356 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.162570 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.162702 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.162992 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.163369 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.164981 #97702] DEBUG -- :   [1m[35mSQL (0.3ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 8 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 16 OR "categories"."rgt" BETWEEN 14 AND 16)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.165103 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.165559 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.165821 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.166094 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.166807 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)[0m
D, [2015-06-05T22:56:41.167210 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.167357 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.167652 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.168425 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.168793 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.169130 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.169407 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.169699 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.169985 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.170302 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:41.171098 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 16 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 16 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 16 AND 18 OR "categories"."rgt" BETWEEN 16 AND 18)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.171202 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.171494 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.171698 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.171963 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:41.172629 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)[0m
D, [2015-06-05T22:56:41.172993 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.173134 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.173428 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:41.174191 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.174622 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.174982 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.175254 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.175539 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.175833 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.176165 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 10]]
D, [2015-06-05T22:56:41.176968 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 15 AND 18 THEN "lft" + 20 - 18 WHEN "lft" BETWEEN 19 AND 20 THEN "lft" + 15 - 19 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 15 AND 18 THEN "rgt" + 20 - 18 WHEN "rgt" BETWEEN 19 AND 20 THEN "rgt" + 15 - 19 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 10 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 15 AND 20 OR "categories"."rgt" BETWEEN 15 AND 20)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.177055 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.177372 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.177569 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.177831 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T22:56:41.178462 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 15) AND ("categories"."rgt" >= 16) AND ("categories"."id" != 10)[0m
D, [2015-06-05T22:56:41.178828 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.178969 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.179270 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 10]]
D, [2015-06-05T22:56:41.180025 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.180387 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.180713 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.180984 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.181234 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.181778 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.182371 #97702] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT  "notable_id", "notable_type", "notes"."lft", COUNT("notes"."lft") as _count FROM "notes" GROUP BY "notable_id", "notable_type", "notes"."lft", "notes"."id" HAVING COUNT("notes"."lft") > 1  ORDER BY "notes"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.182711 #97702] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT  "notable_id", "notable_type", "notes"."rgt", COUNT("notes"."rgt") as _count FROM "notes" GROUP BY "notable_id", "notable_type", "notes"."rgt", "notes"."id" HAVING COUNT("notes"."rgt") > 1  ORDER BY "notes"."id" LIMIT 1
D, [2015-06-05T22:56:41.182866 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.183149 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.183618 #97702] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT "notes".* FROM "notes" WHERE "notes"."parent_id" IS NULL  ORDER BY "notes"."lft"[0m
D, [2015-06-05T22:56:41.187094 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.187425 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.187780 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.188721 #97702] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ?  ORDER BY "notes"."rgt" desc LIMIT 1[0m  [["notable_id", 2], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.189207 #97702] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ?  ORDER BY "notes"."rgt" desc LIMIT 1  [["notable_id", 2], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.189647 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "notes" ("body", "notable_id", "notable_type", "lft", "rgt") VALUES (?, ?, ?, ?, ?)[0m  [["body", "A"], ["notable_id", 2], ["notable_type", "Category"], ["lft", 1], ["rgt", 2]]
D, [2015-06-05T22:56:41.190227 #97702] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:41.190925 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 6  ORDER BY "notes"."lft")[0m  [["notable_id", 2], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.191141 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.191361 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.191912 #97702] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ?  ORDER BY "notes"."rgt" desc LIMIT 1  [["notable_id", 2], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.192286 #97702] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.192721 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "notes" ("body", "notable_id", "notable_type", "lft", "rgt") VALUES (?, ?, ?, ?, ?)  [["body", "B"], ["notable_id", 2], ["notable_type", "Category"], ["lft", 3], ["rgt", 4]]
D, [2015-06-05T22:56:41.193184 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.193742 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 7  ORDER BY "notes"."lft")  [["notable_id", 2], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.193946 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.194151 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.194668 #97702] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ?  ORDER BY "notes"."rgt" desc LIMIT 1[0m  [["notable_id", 2], ["notable_type", "Default"]]
D, [2015-06-05T22:56:41.195051 #97702] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ?  ORDER BY "notes"."rgt" desc LIMIT 1  [["notable_id", 2], ["notable_type", "Default"]]
D, [2015-06-05T22:56:41.195427 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "notes" ("body", "notable_id", "notable_type", "lft", "rgt") VALUES (?, ?, ?, ?, ?)[0m  [["body", "C"], ["notable_id", 2], ["notable_type", "Default"], ["lft", 1], ["rgt", 2]]
D, [2015-06-05T22:56:41.195864 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.196432 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 8  ORDER BY "notes"."lft")[0m  [["notable_id", 2], ["notable_type", "Default"]]
D, [2015-06-05T22:56:41.196669 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.197122 #97702] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."parent_id" IS NULL  ORDER BY "notes"."lft"[0m  [["notable_id", 2], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.197551 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."parent_id" IS NULL  ORDER BY "notes"."lft"  [["notable_id", 2], ["notable_type", "Default"]]
D, [2015-06-05T22:56:41.197736 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.198194 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.198448 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.199019 #97702] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ?  ORDER BY "notes"."rgt" desc LIMIT 1  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.199425 #97702] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ?  ORDER BY "notes"."rgt" desc LIMIT 1[0m  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.199790 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "notes" ("body", "notable_id", "notable_type", "lft", "rgt") VALUES (?, ?, ?, ?, ?)  [["body", "A"], ["notable_id", 3], ["notable_type", "Category"], ["lft", 1], ["rgt", 2]]
D, [2015-06-05T22:56:41.200240 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:41.200755 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 6  ORDER BY "notes"."lft")  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.200967 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.201180 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.201689 #97702] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ?  ORDER BY "notes"."rgt" desc LIMIT 1[0m  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.201988 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T22:56:41.202419 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "notes" ("body", "notable_id", "notable_type", "lft", "rgt") VALUES (?, ?, ?, ?, ?)[0m  [["body", "B"], ["notable_id", 3], ["notable_type", "Category"], ["lft", 3], ["rgt", 4]]
D, [2015-06-05T22:56:41.202855 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.203376 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 7  ORDER BY "notes"."lft")[0m  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.203588 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.203792 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.204301 #97702] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ?  ORDER BY "notes"."rgt" desc LIMIT 1  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.204636 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.205057 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "notes" ("body", "notable_id", "notable_type", "lft", "rgt") VALUES (?, ?, ?, ?, ?)  [["body", "C"], ["notable_id", 3], ["notable_type", "Category"], ["lft", 5], ["rgt", 6]]
D, [2015-06-05T22:56:41.205501 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.206038 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 8  ORDER BY "notes"."lft")  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.206260 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.206374 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.206657 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:41.206996 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.208305 #97702] DEBUG -- :   [1m[36mSQL (0.3ms)[0m  [1mUPDATE "notes" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 6 ELSE "parent_id" END WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" BETWEEN 2 AND 4 OR "notes"."rgt" BETWEEN 2 AND 4)  ORDER BY "notes"."lft")[0m  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.208413 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.208788 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.209073 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.209334 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.210787 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" <= 2) AND ("notes"."rgt" >= 3) AND ("notes"."id" != 7)  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.211347 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "depth" = 1 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 7  ORDER BY "notes"."lft")[0m  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.211500 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.211814 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.211994 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.212257 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:41.212575 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.213533 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "notes" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 8 THEN 6 ELSE "parent_id" END WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" BETWEEN 4 AND 6 OR "notes"."rgt" BETWEEN 4 AND 6)  ORDER BY "notes"."lft")[0m  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.213618 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.213892 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.214150 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.214382 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.215153 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" <= 4) AND ("notes"."rgt" >= 5) AND ("notes"."id" != 8)  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.215604 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "depth" = 1 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 8  ORDER BY "notes"."lft")[0m  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.215739 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.216008 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.216236 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET lft = null, rgt = null
D, [2015-06-05T22:56:41.217066 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "notes"."id") FROM "notes" LEFT OUTER JOIN "notes" "parent" ON "parent"."id" = "notes"."parent_id" WHERE ((("notes"."lft" IS NULL OR "notes"."rgt" IS NULL) OR "notes"."lft" >= "notes"."rgt") OR "notes"."parent_id" IS NOT NULL AND ("notes"."lft" <= "parent"."lft" OR "notes"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.220838 #97702] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE ("notes"."parent_id" IS NULL)  ORDER BY "notes"."lft", "notes"."rgt", id
D, [2015-06-05T22:56:41.221483 #97702] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT "notes".* FROM "notes" WHERE ("notes"."parent_id" = 1 AND "notable_id" = 1 AND "notable_type" = 'Category' )  ORDER BY "notes"."lft", "notes"."rgt", id[0m
D, [2015-06-05T22:56:41.221910 #97702] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE ("notes"."parent_id" = 2 AND "notable_id" = 1 AND "notable_type" = 'Category' )  ORDER BY "notes"."lft", "notes"."rgt", id
D, [2015-06-05T22:56:41.222090 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.222715 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "lft" = ?, "rgt" = ? WHERE "notes"."id" = ?  [["lft", 2], ["rgt", 3], ["id", 2]]
D, [2015-06-05T22:56:41.223125 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.223872 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" <= 2) AND ("notes"."rgt" >= 3) AND ("notes"."id" != 2)  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.224415 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 2  ORDER BY "notes"."lft")[0m  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.224633 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.225013 #97702] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT "notes".* FROM "notes" WHERE ("notes"."parent_id" = 3 AND "notable_id" = 1 AND "notable_type" = 'Category' )  ORDER BY "notes"."lft", "notes"."rgt", id[0m
D, [2015-06-05T22:56:41.225195 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.225675 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "notes" SET "lft" = ?, "rgt" = ? WHERE "notes"."id" = ?[0m  [["lft", 4], ["rgt", 5], ["id", 3]]
D, [2015-06-05T22:56:41.226065 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.226714 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" <= 4) AND ("notes"."rgt" >= 5) AND ("notes"."id" != 3)[0m  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.227214 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 3  ORDER BY "notes"."lft")  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.227424 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.227785 #97702] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE ("notes"."parent_id" = 4 AND "notable_id" = 1 AND "notable_type" = 'Category' )  ORDER BY "notes"."lft", "notes"."rgt", id
D, [2015-06-05T22:56:41.227942 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.228414 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "notes" SET "lft" = ?, "rgt" = ? WHERE "notes"."id" = ?  [["lft", 6], ["rgt", 7], ["id", 4]]
D, [2015-06-05T22:56:41.228815 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.229443 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" <= 6) AND ("notes"."rgt" >= 7) AND ("notes"."id" != 4)  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.229976 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 4  ORDER BY "notes"."lft")[0m  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.230231 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.230545 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.231531 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "lft" = ?, "rgt" = ? WHERE "notes"."id" = ?  [["lft", 1], ["rgt", 8], ["id", 1]]
D, [2015-06-05T22:56:41.232035 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.232674 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 1  ORDER BY "notes"."lft")  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.232934 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.233357 #97702] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE ("notes"."parent_id" = 5 AND "notable_id" = 1 AND "notable_type" = 'Departments' )  ORDER BY "notes"."lft", "notes"."rgt", id
D, [2015-06-05T22:56:41.233517 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.234022 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "notes" SET "lft" = ?, "rgt" = ? WHERE "notes"."id" = ?  [["lft", 1], ["rgt", 2], ["id", 5]]
D, [2015-06-05T22:56:41.234417 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:41.234971 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 5  ORDER BY "notes"."lft")  [["notable_id", 1], ["notable_type", "Departments"]]
D, [2015-06-05T22:56:41.235179 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.235571 #97702] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE ("notes"."parent_id" = 6 AND "notable_id" = 3 AND "notable_type" = 'Category' )  ORDER BY "notes"."lft", "notes"."rgt", id
D, [2015-06-05T22:56:41.235944 #97702] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT "notes".* FROM "notes" WHERE ("notes"."parent_id" = 7 AND "notable_id" = 3 AND "notable_type" = 'Category' )  ORDER BY "notes"."lft", "notes"."rgt", id[0m
D, [2015-06-05T22:56:41.236096 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.236569 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "notes" SET "lft" = ?, "rgt" = ? WHERE "notes"."id" = ?[0m  [["lft", 2], ["rgt", 3], ["id", 7]]
D, [2015-06-05T22:56:41.236955 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.237598 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" <= 2) AND ("notes"."rgt" >= 3) AND ("notes"."id" != 7)[0m  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.238045 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 7  ORDER BY "notes"."lft")  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.238261 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.238637 #97702] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE ("notes"."parent_id" = 8 AND "notable_id" = 3 AND "notable_type" = 'Category' )  ORDER BY "notes"."lft", "notes"."rgt", id
D, [2015-06-05T22:56:41.238793 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.239274 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "notes" SET "lft" = ?, "rgt" = ? WHERE "notes"."id" = ?  [["lft", 4], ["rgt", 5], ["id", 8]]
D, [2015-06-05T22:56:41.239676 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.240304 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" <= 4) AND ("notes"."rgt" >= 5) AND ("notes"."id" != 8)  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.240740 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 8  ORDER BY "notes"."lft")[0m  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.240985 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.241148 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.241639 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "notes" SET "lft" = ?, "rgt" = ? WHERE "notes"."id" = ?  [["lft", 1], ["rgt", 6], ["id", 6]]
D, [2015-06-05T22:56:41.242030 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:41.242543 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 6  ORDER BY "notes"."lft")  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.242744 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.243391 #97702] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."parent_id" IS NULL AND "notes"."body" = ?  ORDER BY "notes"."lft" LIMIT 1  [["body", "A"]]
D, [2015-06-05T22:56:41.243863 #97702] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."parent_id" IS NULL AND "notes"."body" = ?  ORDER BY "notes"."lft" LIMIT 1[0m  [["body", "A"]]
D, [2015-06-05T22:56:41.244871 #97702] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."parent_id" = ?  ORDER BY "lft"  [["parent_id", 6]]
D, [2015-06-05T22:56:41.245167 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.245831 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.246250 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.246565 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.246916 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:41.247098 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.247398 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.247576 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.247810 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.248110 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.248422 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.248584 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.248827 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.249106 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.249400 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:41.249554 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.249822 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.250166 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.250388 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.250765 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:41.251337 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mDELETE FROM "categories" WHERE ("categories"."lft" >= 4) AND ("categories"."lft" < 7) AND ("categories"."id" != 3)[0m
D, [2015-06-05T22:56:41.251726 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = ("lft" - 4) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" > 7)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.252049 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "rgt" = ("rgt" - 4) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."rgt" > 7)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.252317 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.252596 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T22:56:41.252700 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.253484 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.253879 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.254211 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.254486 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.254707 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.255103 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.255433 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.255566 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.255895 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:41.256404 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 4) AND ("categories"."lft" < 7) AND ("categories"."id" != 3)  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.256663 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 4]]
D, [2015-06-05T22:56:41.257049 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = ("lft" - 4) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" > 7)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.257394 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "rgt" = ("rgt" - 4) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."rgt" > 7)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.257730 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.257967 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T22:56:41.258058 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.258755 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.259127 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.259463 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.259718 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.259960 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.260369 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.260705 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.260841 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.261181 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:41.261701 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 4) AND ("categories"."lft" < 7) AND ("categories"."id" != 3)  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.261978 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 4]]
D, [2015-06-05T22:56:41.262366 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = ("lft" - 4) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" > 7)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.262720 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "rgt" = ("rgt" - 4) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."rgt" > 7)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.263012 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.263263 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T22:56:41.263353 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.263450 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.263554 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.264247 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.264621 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.264926 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.265218 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.265434 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.265864 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.266197 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.266474 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.266971 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.267294 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T22:56:41.267734 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "categories" ("name", "parent_id", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Child"], ["parent_id", 3], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:41.268163 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."lft" LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.268492 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.269330 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 7 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 7 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 3 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 7 AND 14 OR "categories"."rgt" BETWEEN 7 AND 14)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.269637 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:41.270001 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.270662 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 7)[0m
D, [2015-06-05T22:56:41.271002 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.271346 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.271704 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.272203 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 7)[0m
D, [2015-06-05T22:56:41.272538 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.272755 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.273067 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.273918 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.274299 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.274608 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.274883 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.275104 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.275487 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.275791 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.276089 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.276673 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.276981 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T22:56:41.277393 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "parent_id", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Child"], ["parent_id", 3], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:41.277753 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."lft" LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.278073 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.278885 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 7 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 7 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 3 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 7 AND 14 OR "categories"."rgt" BETWEEN 7 AND 14)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.279212 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:41.279572 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.280206 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 7)[0m
D, [2015-06-05T22:56:41.280622 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.281048 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.281441 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.281968 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 7)[0m
D, [2015-06-05T22:56:41.282337 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.282542 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.282844 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.283712 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.284063 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.284393 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.284664 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.284887 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.285275 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.285497 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.285995 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.286355 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.286756 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "New Root"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:41.287147 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.287587 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.287802 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.289217 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:41.289606 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.289944 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.290234 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:41.290487 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.290915 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.291270 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:41.291555 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:41.291737 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.292296 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?[0m  [["parent_id", 5], ["id", 4]]
D, [2015-06-05T22:56:41.292639 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."lft" LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.292959 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 4]]
D, [2015-06-05T22:56:41.293756 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 5 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 5 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 4 THEN 5 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 5 AND 8 OR "categories"."rgt" BETWEEN 5 AND 8)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.294068 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 5]]
D, [2015-06-05T22:56:41.294454 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:41.295069 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 4)[0m
D, [2015-06-05T22:56:41.295436 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 4  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.295785 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 4]]
D, [2015-06-05T22:56:41.296167 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:41.297138 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 4)[0m
D, [2015-06-05T22:56:41.297767 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 4  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.298003 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.298325 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:41.298668 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:41.299029 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.299863 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.300238 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.300558 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.300826 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.301063 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.301482 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.301829 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.302099 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.302321 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.302882 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?  [["parent_id", 5], ["id", 4]]
D, [2015-06-05T22:56:41.303231 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."lft" LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:41.303558 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T22:56:41.304358 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 5 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 5 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 4 THEN 5 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 5 AND 8 OR "categories"."rgt" BETWEEN 5 AND 8)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.304656 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 5]]
D, [2015-06-05T22:56:41.305026 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.305668 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 4)
D, [2015-06-05T22:56:41.306030 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 4  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.306351 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T22:56:41.306712 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.307203 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 4)
D, [2015-06-05T22:56:41.307546 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 4  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.307738 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.308011 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.308329 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.308667 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:41.309435 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:41.309807 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.310153 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.310406 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:41.310639 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.311054 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.311389 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:41.311575 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.312100 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?  [["parent_id", nil], ["id", 4]]
D, [2015-06-05T22:56:41.312411 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.312717 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T22:56:41.313020 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT "categories"."rgt" FROM "categories"  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:41.313754 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 12 - 6 WHEN "lft" BETWEEN 7 AND 12 THEN "lft" + 5 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 12 - 6 WHEN "rgt" BETWEEN 7 AND 12 THEN "rgt" + 5 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 4 THEN NULL ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 5 AND 12 OR "categories"."rgt" BETWEEN 5 AND 12)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.314041 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 4]]
D, [2015-06-05T22:56:41.314388 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:41.314873 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 4  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.315200 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T22:56:41.315542 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.315926 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 4  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.316116 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.316869 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:41.317265 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.317584 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.317839 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:41.318104 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.318506 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.318827 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.319281 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.320208 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.320614 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.321066 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "parent_id", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Child"], ["parent_id", 3], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:41.321438 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."lft" LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.321758 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.322600 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 7 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 7 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 3 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 7 AND 14 OR "categories"."rgt" BETWEEN 7 AND 14)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.322882 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:41.323251 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.323897 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 7)
D, [2015-06-05T22:56:41.324262 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.324578 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.324940 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.325423 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 7)
D, [2015-06-05T22:56:41.325791 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.326021 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.326865 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.327235 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.327562 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.327813 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.328066 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.328433 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.328801 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:41.329206 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.330229 #97702] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."name" = ? LIMIT 1[0m  [["name", "Child 1"]]
D, [2015-06-05T22:56:41.330902 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.331558 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.331946 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T22:56:41.332363 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Child 1.1"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:41.332752 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.333205 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.333430 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.333534 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.333984 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.334316 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.334677 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Child 1.1.1"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:41.335042 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.335466 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.335680 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.335778 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.336216 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.336505 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.336879 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Child 1.1.1.1"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T22:56:41.337251 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:41.337669 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.337867 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.337977 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.338443 #97702] DEBUG -- :   [1m[35mCategory Load (0.2ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.338732 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:41.339110 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Child 1.2"], ["lft", 19], ["rgt", 20]]
D, [2015-06-05T22:56:41.339474 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 10]]
D, [2015-06-05T22:56:41.339896 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.340105 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.340228 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.340502 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.340839 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.341726 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 3 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 3 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 2 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 3 AND 14 OR "categories"."rgt" BETWEEN 3 AND 14)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.341829 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.342147 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T22:56:41.342342 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.342597 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.343249 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 3) AND ("categories"."rgt" >= 4) AND ("categories"."id" != 7)
D, [2015-06-05T22:56:41.343602 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.343761 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.344032 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.344213 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.344450 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.344757 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.345546 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 4 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 4 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 8 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 4 AND 16 OR "categories"."rgt" BETWEEN 4 AND 16)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.345630 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.345918 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.346135 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.346368 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.346964 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 4) AND ("categories"."rgt" >= 5) AND ("categories"."id" != 8)
D, [2015-06-05T22:56:41.347321 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 3 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.347454 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.347745 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.347901 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.348184 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.348500 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:41.349280 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 5 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 5 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 5 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 5 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 5 AND 18 OR "categories"."rgt" BETWEEN 5 AND 18)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.349362 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.349663 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.349860 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.350119 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.350715 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 9)
D, [2015-06-05T22:56:41.351101 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 4 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.351251 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.351526 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:41.351711 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.351953 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.352264 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 10]]
D, [2015-06-05T22:56:41.353035 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 9 AND 18 THEN "lft" + 20 - 18 WHEN "lft" BETWEEN 19 AND 20 THEN "lft" + 9 - 19 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 9 AND 18 THEN "rgt" + 20 - 18 WHEN "rgt" BETWEEN 19 AND 20 THEN "rgt" + 9 - 19 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 10 THEN 2 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 9 AND 20 OR "categories"."rgt" BETWEEN 9 AND 20)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.353151 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.353427 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T22:56:41.353629 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.353859 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 10]]
D, [2015-06-05T22:56:41.354460 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 9) AND ("categories"."rgt" >= 10) AND ("categories"."id" != 10)
D, [2015-06-05T22:56:41.354837 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.354968 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.355262 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 10]]
D, [2015-06-05T22:56:41.355614 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T22:56:41.356000 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 18)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:41.356397 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.356977 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.357113 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.357376 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.357489 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.357705 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.357831 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.358048 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.358157 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.358397 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.358511 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.358734 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.361466 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.361738 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.361974 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.362208 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.362368 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.362619 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.362803 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.363064 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.366225 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.366697 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.366910 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.367149 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.367337 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.367563 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.367730 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.367966 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.368130 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.368447 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.368721 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.368957 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.369129 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.369361 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.369524 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.369836 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.369954 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.370258 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.370664 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL
D, [2015-06-05T22:56:41.371017 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:41.371251 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.371521 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.371920 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T22:56:41.372285 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.372445 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.372717 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.373015 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.373490 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE ("categories"."lft" <= 8) AND ("categories"."rgt" >= 9) AND "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:41.373796 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.373956 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.374294 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T22:56:41.374473 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.374715 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.375011 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."id" DESC LIMIT 1[0m
D, [2015-06-05T22:56:41.375461 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."lft" LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:41.375899 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE ("categories"."lft" <= 11) AND ("categories"."rgt" >= 12) AND "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:41.376300 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE ("categories"."lft" <= 11) AND ("categories"."rgt" >= 12) AND "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T22:56:41.376478 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.376765 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T22:56:41.377070 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.377388 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:41.377555 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.377805 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.378052 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE (rgt - lft = 1)[0m
D, [2015-06-05T22:56:41.378374 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."rgt" - "categories"."lft" = 1)  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.378822 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."rgt" - "categories"."lft" = 1)[0m
D, [2015-06-05T22:56:41.379159 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.379406 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."rgt" - "categories"."lft" = 1)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:41.379820 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:41.380211 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."rgt" - "categories"."lft" = 1)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:41.381078 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.381379 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."rgt" - "categories"."lft" = 1)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:41.381834 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:41.382092 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."rgt" - "categories"."lft" = 1)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:41.382309 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.382653 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.382958 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.383275 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.383556 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.383832 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:41.384117 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.384410 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.384615 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.384891 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.385183 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:41.385556 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.385857 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.386038 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.386297 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.386590 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.386862 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.387119 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.387517 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6)  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.387703 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.387976 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.388274 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.388531 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.388803 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.389231 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 4)  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.389395 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.389674 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.389965 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.390234 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.390505 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:41.390843 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = 1  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.391461 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.391849 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:41.392249 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:41.392473 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.392914 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.393264 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.393601 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.393997 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.394470 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:41.394669 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.395059 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.395356 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.395647 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.395923 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.396200 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.396719 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10) AND ("categories"."id" != 1) AND ("categories"."rgt" - "categories"."lft" = 1)  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.396917 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.397486 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T22:56:41.398058 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.398452 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.399088 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 2)[0m
D, [2015-06-05T22:56:41.399414 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:41.399985 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 4)[0m
D, [2015-06-05T22:56:41.400150 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.400610 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.400945 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.401338 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.401556 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.401971 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.404342 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.405105 #97702] DEBUG -- :   [1m[36mNoDepth Load (0.1ms)[0m  [1mSELECT  "no_depths".* FROM "no_depths"  ORDER BY "no_depths"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.405452 #97702] DEBUG -- :   [1m[35mNoDepth Load (0.1ms)[0m  SELECT  "no_depths".* FROM "no_depths"  ORDER BY "no_depths"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.405884 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "no_depths" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "shallow"], ["lft", 1], ["rgt", 2]]
D, [2015-06-05T22:56:41.406267 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.406666 #97702] DEBUG -- :   [1m[36mNoDepth Load (0.1ms)[0m  [1mSELECT  "no_depths".* FROM "no_depths"  ORDER BY "no_depths"."id" ASC LIMIT 1[0m
D, [2015-06-05T22:56:41.406833 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.407248 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.408141 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "no_depths"."id") FROM "no_depths" LEFT OUTER JOIN "no_depths" "parent" ON "parent"."id" = "no_depths"."parent_id" WHERE ((("no_depths"."lft" IS NULL OR "no_depths"."rgt" IS NULL) OR "no_depths"."lft" >= "no_depths"."rgt") OR "no_depths"."parent_id" IS NOT NULL AND ("no_depths"."lft" <= "parent"."lft" OR "no_depths"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:41.408557 #97702] DEBUG -- :   [1m[36mNoDepth Load (0.1ms)[0m  [1mSELECT  "no_depths"."lft", COUNT("no_depths"."lft") as _count FROM "no_depths" GROUP BY "no_depths"."lft", "no_depths"."id" HAVING COUNT("no_depths"."lft") > 1  ORDER BY "no_depths"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.408879 #97702] DEBUG -- :   [1m[35mNoDepth Load (0.1ms)[0m  SELECT  "no_depths"."rgt", COUNT("no_depths"."rgt") as _count FROM "no_depths" GROUP BY "no_depths"."rgt", "no_depths"."id" HAVING COUNT("no_depths"."rgt") > 1  ORDER BY "no_depths"."id" LIMIT 1
D, [2015-06-05T22:56:41.409213 #97702] DEBUG -- :   [1m[36mNoDepth Load (0.1ms)[0m  [1mSELECT "no_depths".* FROM "no_depths" WHERE "no_depths"."parent_id" IS NULL  ORDER BY "no_depths"."lft"[0m
D, [2015-06-05T22:56:41.409548 #97702] DEBUG -- :   [1m[35mNoDepth Load (0.0ms)[0m  SELECT  "no_depths".* FROM "no_depths"  ORDER BY "no_depths"."id" ASC LIMIT 1
D, [2015-06-05T22:56:41.409799 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.410337 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.410647 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.411209 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.411599 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.412066 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "United States"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:41.412473 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.412926 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.413145 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.413339 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.414003 #97702] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.414589 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.415097 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "lawyers"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:41.415544 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.416067 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.416286 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.416422 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.416694 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.417038 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.417895 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 15 - 14 WHEN "lft" BETWEEN 15 AND 15 THEN "lft" + 13 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 15 - 14 WHEN "rgt" BETWEEN 15 AND 15 THEN "rgt" + 13 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 13 AND 15 OR "categories"."rgt" BETWEEN 13 AND 15)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.417982 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.418291 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.418500 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.418750 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.419479 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 7)[0m
D, [2015-06-05T22:56:41.419888 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.420032 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.420340 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.420584 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.421063 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.421382 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.421788 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "New York"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T22:56:41.422179 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.422653 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.422852 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.422996 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.423277 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.423642 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:41.424514 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 15 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 15 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 15 AND 18 OR "categories"."rgt" BETWEEN 15 AND 18)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.424615 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.424930 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.425149 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.425413 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.426081 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 15) AND ("categories"."rgt" >= 16) AND ("categories"."id" != 9)
D, [2015-06-05T22:56:41.426447 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.426591 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.426886 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:41.427122 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.427594 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.427903 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.428316 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Patent Law"], ["lft", 19], ["rgt", 20]]
D, [2015-06-05T22:56:41.428714 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T22:56:41.429177 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.429374 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.429530 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.429803 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:41.430137 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 10]]
D, [2015-06-05T22:56:41.430965 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 18 THEN "lft" + 20 - 18 WHEN "lft" BETWEEN 19 AND 20 THEN "lft" + 16 - 19 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 18 THEN "rgt" + 20 - 18 WHEN "rgt" BETWEEN 19 AND 20 THEN "rgt" + 16 - 19 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 10 THEN 9 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 16 AND 20 OR "categories"."rgt" BETWEEN 16 AND 20)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.431063 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.431378 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:41.431589 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.431857 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T22:56:41.432536 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 10)[0m
D, [2015-06-05T22:56:41.432924 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 3 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.433052 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.433362 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 10]]
D, [2015-06-05T22:56:41.433595 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.434057 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.434380 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.434794 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Switzerland"], ["lft", 21], ["rgt", 22]]
D, [2015-06-05T22:56:41.435274 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T22:56:41.435814 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 11  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.436049 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.436187 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.436509 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.436864 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 11]]
D, [2015-06-05T22:56:41.437729 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 20 AND 20 THEN "lft" + 22 - 20 WHEN "lft" BETWEEN 21 AND 22 THEN "lft" + 20 - 21 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 20 AND 20 THEN "rgt" + 22 - 20 WHEN "rgt" BETWEEN 21 AND 22 THEN "rgt" + 20 - 21 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 11 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 20 AND 22 OR "categories"."rgt" BETWEEN 20 AND 22)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.437821 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.438137 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.438339 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.438579 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T22:56:41.439172 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 20) AND ("categories"."rgt" >= 21) AND ("categories"."id" != 11)
D, [2015-06-05T22:56:41.439524 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 11  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.439649 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.443509 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 11]]
D, [2015-06-05T22:56:41.443838 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.444455 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.444822 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.445240 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Bern"], ["lft", 23], ["rgt", 24]]
D, [2015-06-05T22:56:41.445635 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T22:56:41.446090 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 12  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.446312 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.446437 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.446762 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 11]]
D, [2015-06-05T22:56:41.447418 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 12]]
D, [2015-06-05T22:56:41.448507 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 21 AND 22 THEN "lft" + 24 - 22 WHEN "lft" BETWEEN 23 AND 24 THEN "lft" + 21 - 23 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 21 AND 22 THEN "rgt" + 24 - 22 WHEN "rgt" BETWEEN 23 AND 24 THEN "rgt" + 21 - 23 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 12 THEN 11 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 21 AND 24 OR "categories"."rgt" BETWEEN 21 AND 24)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.448634 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.449012 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 11]]
D, [2015-06-05T22:56:41.449265 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.449504 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T22:56:41.450154 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 21) AND ("categories"."rgt" >= 22) AND ("categories"."id" != 12)[0m
D, [2015-06-05T22:56:41.450530 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 12  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.450658 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.450951 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 12]]
D, [2015-06-05T22:56:41.451267 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.451546 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.451835 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.452129 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T22:56:41.452416 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T22:56:41.452676 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T22:56:41.452933 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.453508 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.453741 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.454260 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.454613 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.455038 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "United States"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:41.455439 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.455884 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.456083 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.456250 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.456711 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.457029 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.457396 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "lawyers"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:41.457777 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.458207 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.458530 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.458670 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.458942 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.459284 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.460111 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 15 - 14 WHEN "lft" BETWEEN 15 AND 15 THEN "lft" + 13 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 15 - 14 WHEN "rgt" BETWEEN 15 AND 15 THEN "rgt" + 13 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 13 AND 15 OR "categories"."rgt" BETWEEN 13 AND 15)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.460199 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.460508 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.460732 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.460972 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.461608 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 7)[0m
D, [2015-06-05T22:56:41.461975 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.462112 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.462406 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.462615 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.463106 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.463425 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.463808 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "New York"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T22:56:41.464210 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.464641 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.464842 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.464986 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.465241 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.465570 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:41.466374 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 15 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 15 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 15 AND 18 OR "categories"."rgt" BETWEEN 15 AND 18)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.466481 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.466761 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.466973 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.467225 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.467836 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 15) AND ("categories"."rgt" >= 16) AND ("categories"."id" != 9)
D, [2015-06-05T22:56:41.468207 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.468328 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.468629 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:41.468834 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.469314 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.469628 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.470059 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Patent Law"], ["lft", 19], ["rgt", 20]]
D, [2015-06-05T22:56:41.470450 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T22:56:41.470890 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.471106 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.471231 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.471524 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:41.471874 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 10]]
D, [2015-06-05T22:56:41.472693 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 18 THEN "lft" + 20 - 18 WHEN "lft" BETWEEN 19 AND 20 THEN "lft" + 16 - 19 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 18 THEN "rgt" + 20 - 18 WHEN "rgt" BETWEEN 19 AND 20 THEN "rgt" + 16 - 19 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 10 THEN 9 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 16 AND 20 OR "categories"."rgt" BETWEEN 16 AND 20)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.472778 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.473087 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:41.473277 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.473553 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T22:56:41.474184 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 10)[0m
D, [2015-06-05T22:56:41.474561 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 3 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.474685 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.474954 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 10]]
D, [2015-06-05T22:56:41.475184 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.475622 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.475934 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.476335 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Switzerland"], ["lft", 21], ["rgt", 22]]
D, [2015-06-05T22:56:41.476712 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T22:56:41.477137 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 11  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.477333 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.477453 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.477733 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.478062 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 11]]
D, [2015-06-05T22:56:41.478892 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 20 AND 20 THEN "lft" + 22 - 20 WHEN "lft" BETWEEN 21 AND 22 THEN "lft" + 20 - 21 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 20 AND 20 THEN "rgt" + 22 - 20 WHEN "rgt" BETWEEN 21 AND 22 THEN "rgt" + 20 - 21 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 11 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 20 AND 22 OR "categories"."rgt" BETWEEN 20 AND 22)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.478976 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.479275 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.479467 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.479722 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T22:56:41.480324 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 20) AND ("categories"."rgt" >= 21) AND ("categories"."id" != 11)
D, [2015-06-05T22:56:41.480699 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 11  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.480841 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.481107 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 11]]
D, [2015-06-05T22:56:41.481339 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.481777 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.482078 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.482469 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Bern"], ["lft", 23], ["rgt", 24]]
D, [2015-06-05T22:56:41.482846 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T22:56:41.483287 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 12  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.483481 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.483645 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.483896 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 11]]
D, [2015-06-05T22:56:41.484228 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 12]]
D, [2015-06-05T22:56:41.485016 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 21 AND 22 THEN "lft" + 24 - 22 WHEN "lft" BETWEEN 23 AND 24 THEN "lft" + 21 - 23 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 21 AND 22 THEN "rgt" + 24 - 22 WHEN "rgt" BETWEEN 23 AND 24 THEN "rgt" + 21 - 23 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 12 THEN 11 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 21 AND 24 OR "categories"."rgt" BETWEEN 21 AND 24)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.485146 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.485422 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 11]]
D, [2015-06-05T22:56:41.485633 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.485888 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T22:56:41.486503 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 21) AND ("categories"."rgt" >= 22) AND ("categories"."id" != 12)[0m
D, [2015-06-05T22:56:41.486880 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 12  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.487018 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.487286 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 12]]
D, [2015-06-05T22:56:41.487593 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.487896 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.488215 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.488565 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T22:56:41.488845 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T22:56:41.489150 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T22:56:41.489366 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.489601 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.489944 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.490805 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 19 THEN "lft" + 24 - 19 WHEN "lft" BETWEEN 20 AND 24 THEN "lft" + 14 - 20 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 19 THEN "rgt" + 24 - 19 WHEN "rgt" BETWEEN 20 AND 24 THEN "rgt" + 14 - 20 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN NULL ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 24 OR "categories"."rgt" BETWEEN 14 AND 24)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.490894 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.491194 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.491426 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.491664 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.492189 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.492670 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = "depth" - 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" >= 19) AND ("categories"."lft" < 24) AND ("categories"."id" != 7)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.492752 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.493043 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.493358 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.493627 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.493921 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.494204 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T22:56:41.494490 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T22:56:41.494782 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T22:56:41.495014 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.495576 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.495800 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.496305 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.496655 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.497116 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "United States"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:41.497720 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.498434 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.498696 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.498891 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.499438 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.499816 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.500234 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "lawyers"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:41.500641 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.501090 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.501284 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.501408 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.501674 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.502001 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.502803 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 15 - 14 WHEN "lft" BETWEEN 15 AND 15 THEN "lft" + 13 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 15 - 14 WHEN "rgt" BETWEEN 15 AND 15 THEN "rgt" + 13 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 13 AND 15 OR "categories"."rgt" BETWEEN 13 AND 15)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.502889 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.503158 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.503369 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.503623 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.504233 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 7)[0m
D, [2015-06-05T22:56:41.504605 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.504738 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.505030 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.505234 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.505702 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.506015 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.506400 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "New York"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T22:56:41.506777 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.507199 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.507410 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.507542 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.507887 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.508224 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:41.509037 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 15 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 15 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 15 AND 18 OR "categories"."rgt" BETWEEN 15 AND 18)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.509122 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.509422 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.509609 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.509863 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.510474 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 15) AND ("categories"."rgt" >= 16) AND ("categories"."id" != 9)
D, [2015-06-05T22:56:41.510843 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.510965 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.511231 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:41.511453 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.511940 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.512226 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.512623 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Patent Law"], ["lft", 19], ["rgt", 20]]
D, [2015-06-05T22:56:41.513003 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T22:56:41.513429 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.513624 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.513767 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.514020 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:41.514363 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 10]]
D, [2015-06-05T22:56:41.515137 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 18 THEN "lft" + 20 - 18 WHEN "lft" BETWEEN 19 AND 20 THEN "lft" + 16 - 19 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 18 THEN "rgt" + 20 - 18 WHEN "rgt" BETWEEN 19 AND 20 THEN "rgt" + 16 - 19 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 10 THEN 9 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 16 AND 20 OR "categories"."rgt" BETWEEN 16 AND 20)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.515223 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.515513 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:41.515723 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.515952 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T22:56:41.516568 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 10)[0m
D, [2015-06-05T22:56:41.516931 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 3 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.517050 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.517335 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 10]]
D, [2015-06-05T22:56:41.517537 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.517996 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.518298 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.518704 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Switzerland"], ["lft", 21], ["rgt", 22]]
D, [2015-06-05T22:56:41.519084 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T22:56:41.519511 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 11  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.519707 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.519827 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.520091 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.520412 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 11]]
D, [2015-06-05T22:56:41.521197 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 20 AND 20 THEN "lft" + 22 - 20 WHEN "lft" BETWEEN 21 AND 22 THEN "lft" + 20 - 21 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 20 AND 20 THEN "rgt" + 22 - 20 WHEN "rgt" BETWEEN 21 AND 22 THEN "rgt" + 20 - 21 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 11 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 20 AND 22 OR "categories"."rgt" BETWEEN 20 AND 22)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.521295 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.521606 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.521804 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.522052 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T22:56:41.522684 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 20) AND ("categories"."rgt" >= 21) AND ("categories"."id" != 11)
D, [2015-06-05T22:56:41.523046 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 11  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.523165 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.523456 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 11]]
D, [2015-06-05T22:56:41.523658 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.524111 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.524409 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.524804 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Bern"], ["lft", 23], ["rgt", 24]]
D, [2015-06-05T22:56:41.525170 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T22:56:41.525606 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 12  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.525814 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.525936 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.526205 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 11]]
D, [2015-06-05T22:56:41.526536 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 12]]
D, [2015-06-05T22:56:41.527331 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 21 AND 22 THEN "lft" + 24 - 22 WHEN "lft" BETWEEN 23 AND 24 THEN "lft" + 21 - 23 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 21 AND 22 THEN "rgt" + 24 - 22 WHEN "rgt" BETWEEN 23 AND 24 THEN "rgt" + 21 - 23 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 12 THEN 11 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 21 AND 24 OR "categories"."rgt" BETWEEN 21 AND 24)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.527417 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.527725 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 11]]
D, [2015-06-05T22:56:41.527933 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.528185 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T22:56:41.528792 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 21) AND ("categories"."rgt" >= 22) AND ("categories"."id" != 12)[0m
D, [2015-06-05T22:56:41.529160 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 12  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.529282 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.529562 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 12]]
D, [2015-06-05T22:56:41.529883 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.530441 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.530815 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.531144 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T22:56:41.531441 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T22:56:41.531722 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T22:56:41.531905 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.532157 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 11]]
D, [2015-06-05T22:56:41.532459 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.533347 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 19 THEN "lft" + 23 - 19 WHEN "lft" BETWEEN 20 AND 23 THEN "lft" + 14 - 20 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 19 THEN "rgt" + 23 - 19 WHEN "rgt" BETWEEN 20 AND 23 THEN "rgt" + 14 - 20 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 23 OR "categories"."rgt" BETWEEN 14 AND 23)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.533434 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.533729 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 11]]
D, [2015-06-05T22:56:41.533942 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.534230 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.534982 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 18) AND ("categories"."rgt" >= 23) AND ("categories"."id" != 7)[0m
D, [2015-06-05T22:56:41.535435 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.535603 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.535946 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.536325 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.536642 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.536985 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.537323 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T22:56:41.537665 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T22:56:41.538013 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T22:56:41.538284 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.538989 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T22:56:41.539275 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.539846 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.540305 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.540845 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "United States"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:41.541285 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.541782 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.542002 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.542210 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.542678 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.543033 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.543463 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "lawyers"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:41.543858 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.544331 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.544566 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.544711 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.544955 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.545279 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.546065 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 15 - 14 WHEN "lft" BETWEEN 15 AND 15 THEN "lft" + 13 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 15 - 14 WHEN "rgt" BETWEEN 15 AND 15 THEN "rgt" + 13 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 13 AND 15 OR "categories"."rgt" BETWEEN 13 AND 15)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.546150 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.546441 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.546628 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.546890 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.547691 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 7)[0m
D, [2015-06-05T22:56:41.548272 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.548451 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.548829 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.549074 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.549582 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.549914 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.550364 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "New York"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T22:56:41.550730 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.551206 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.551405 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.551528 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.551804 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.552171 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:41.552974 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 15 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 15 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 15 AND 18 OR "categories"."rgt" BETWEEN 15 AND 18)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.553059 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.553354 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.553541 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.553793 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.554427 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 15) AND ("categories"."rgt" >= 16) AND ("categories"."id" != 9)
D, [2015-06-05T22:56:41.554794 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.554913 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.555201 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:41.555411 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.555866 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.556184 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.556557 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Patent Law"], ["lft", 19], ["rgt", 20]]
D, [2015-06-05T22:56:41.556931 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T22:56:41.557380 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.557575 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.557696 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.557971 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:41.558295 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 10]]
D, [2015-06-05T22:56:41.559084 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 18 THEN "lft" + 20 - 18 WHEN "lft" BETWEEN 19 AND 20 THEN "lft" + 16 - 19 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 18 THEN "rgt" + 20 - 18 WHEN "rgt" BETWEEN 19 AND 20 THEN "rgt" + 16 - 19 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 10 THEN 9 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 16 AND 20 OR "categories"."rgt" BETWEEN 16 AND 20)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.559182 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.559483 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:41.559675 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.559929 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T22:56:41.560558 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 10)[0m
D, [2015-06-05T22:56:41.560927 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 3 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.561048 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.561330 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 10]]
D, [2015-06-05T22:56:41.561535 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.561994 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.562303 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.562695 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Switzerland"], ["lft", 21], ["rgt", 22]]
D, [2015-06-05T22:56:41.563070 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T22:56:41.563492 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 11  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.563686 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.563806 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.564081 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.564402 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 11]]
D, [2015-06-05T22:56:41.565174 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 20 AND 20 THEN "lft" + 22 - 20 WHEN "lft" BETWEEN 21 AND 22 THEN "lft" + 20 - 21 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 20 AND 20 THEN "rgt" + 22 - 20 WHEN "rgt" BETWEEN 21 AND 22 THEN "rgt" + 20 - 21 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 11 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 20 AND 22 OR "categories"."rgt" BETWEEN 20 AND 22)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.565257 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.565545 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.565752 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.565999 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T22:56:41.566597 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 20) AND ("categories"."rgt" >= 21) AND ("categories"."id" != 11)
D, [2015-06-05T22:56:41.566959 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 11  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.567095 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.567364 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 11]]
D, [2015-06-05T22:56:41.567595 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.568024 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.568330 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.568725 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Bern"], ["lft", 23], ["rgt", 24]]
D, [2015-06-05T22:56:41.569096 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T22:56:41.569511 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 12  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.569706 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.569847 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.570108 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 11]]
D, [2015-06-05T22:56:41.570433 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 12]]
D, [2015-06-05T22:56:41.571201 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 21 AND 22 THEN "lft" + 24 - 22 WHEN "lft" BETWEEN 23 AND 24 THEN "lft" + 21 - 23 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 21 AND 22 THEN "rgt" + 24 - 22 WHEN "rgt" BETWEEN 23 AND 24 THEN "rgt" + 21 - 23 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 12 THEN 11 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 21 AND 24 OR "categories"."rgt" BETWEEN 21 AND 24)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.571285 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.571577 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 11]]
D, [2015-06-05T22:56:41.571761 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.572013 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T22:56:41.572646 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 21) AND ("categories"."rgt" >= 22) AND ("categories"."id" != 12)[0m
D, [2015-06-05T22:56:41.573010 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 12  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.573134 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.573430 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 12]]
D, [2015-06-05T22:56:41.573763 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.574049 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.574350 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.574644 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T22:56:41.574932 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T22:56:41.575215 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T22:56:41.575389 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.575617 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T22:56:41.575934 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.576774 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 19 THEN "lft" + 21 - 19 WHEN "lft" BETWEEN 20 AND 21 THEN "lft" + 14 - 20 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 19 THEN "rgt" + 21 - 19 WHEN "rgt" BETWEEN 20 AND 21 THEN "rgt" + 14 - 20 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 12 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 21 OR "categories"."rgt" BETWEEN 14 AND 21)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.576901 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.577178 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 12]]
D, [2015-06-05T22:56:41.577410 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.577682 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.578301 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 21) AND ("categories"."id" != 7)[0m
D, [2015-06-05T22:56:41.578680 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 3 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.579154 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = "depth" + 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" >= 16) AND ("categories"."lft" < 21) AND ("categories"."id" != 7)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.579280 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.579586 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.579895 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.580274 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.580707 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:41.581149 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 10]]
D, [2015-06-05T22:56:41.581495 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 11]]
D, [2015-06-05T22:56:41.581815 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 12]]
D, [2015-06-05T22:56:41.582075 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.582796 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.583110 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.583433 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:41.584190 #97702] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 5]]
D, [2015-06-05T22:56:41.584321 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.584595 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.584939 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T22:56:41.585793 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 8 - 3 WHEN "lft" BETWEEN 4 AND 8 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 8 - 3 WHEN "rgt" BETWEEN 4 AND 8 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 2 THEN 5 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 2 AND 8 OR "categories"."rgt" BETWEEN 2 AND 8)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.585879 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.586178 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 5]]
D, [2015-06-05T22:56:41.586364 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.586613 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.587257 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 2)[0m
D, [2015-06-05T22:56:41.587658 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 2  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.587800 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.588099 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:41.588964 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.589387 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T22:56:41.589726 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.590013 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.590231 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.590616 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.590970 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.591276 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.591914 #97702] DEBUG -- :   [1m[36mCategory Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1[0m  [["parent_id", 3]]
D, [2015-06-05T22:56:41.592307 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?  [["parent_id", 3]]
D, [2015-06-05T22:56:41.592661 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft"[0m  [["parent_id", 3]]
D, [2015-06-05T22:56:41.592978 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.593244 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.593553 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:41.594405 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 4 - 3 WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 4 - 3 WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 2 THEN 3 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 2 AND 4 OR "categories"."rgt" BETWEEN 2 AND 4)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.594506 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.594788 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 4]]
D, [2015-06-05T22:56:41.594985 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.595227 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.595851 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 3) AND ("categories"."rgt" >= 4) AND ("categories"."id" != 2)
D, [2015-06-05T22:56:41.596229 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 2  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.596358 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.596645 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T22:56:41.596970 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:41.597298 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.597507 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.597816 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.598108 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.598385 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.599020 #97702] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 3]]
D, [2015-06-05T22:56:41.599369 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 3]]
D, [2015-06-05T22:56:41.599697 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft" DESC LIMIT 1  [["parent_id", 3]]
D, [2015-06-05T22:56:41.599892 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.600166 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:41.600511 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T22:56:41.601313 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 6 - 3 WHEN "lft" BETWEEN 4 AND 6 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 6 - 3 WHEN "rgt" BETWEEN 4 AND 6 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 2 THEN 3 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 2 AND 6 OR "categories"."rgt" BETWEEN 2 AND 6)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.601398 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.601677 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T22:56:41.601890 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.602136 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.602753 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 2)[0m
D, [2015-06-05T22:56:41.603134 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 2  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.603262 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.603545 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:41.603890 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.604204 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.604402 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.604726 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.605005 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.605286 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.605925 #97702] DEBUG -- :   [1m[36mCategory Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1[0m  [["parent_id", 1]]
D, [2015-06-05T22:56:41.606277 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?  [["parent_id", 1]]
D, [2015-06-05T22:56:41.606605 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft"[0m  [["parent_id", 1]]
D, [2015-06-05T22:56:41.606970 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.607244 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.607555 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:41.608382 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 7 - 3 WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 7 - 3 WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 2 THEN 1 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 2 AND 7 OR "categories"."rgt" BETWEEN 2 AND 7)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.608467 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.608764 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:41.608960 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.609213 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.609844 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 6) AND ("categories"."rgt" >= 7) AND ("categories"."id" != 2)
D, [2015-06-05T22:56:41.610221 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 2  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.610368 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.610635 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T22:56:41.610979 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.611281 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.611484 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.611811 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.612094 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.612363 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.612990 #97702] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 1]]
D, [2015-06-05T22:56:41.613364 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-05T22:56:41.613699 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft"  [["parent_id", 1]]
D, [2015-06-05T22:56:41.613976 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.614360 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.614671 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.620126 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.620609 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.620991 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:41.621328 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT "categories"."rgt" FROM "categories"  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:41.622177 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 12 - 7 WHEN "lft" BETWEEN 8 AND 12 THEN "lft" + 4 - 8 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 12 - 7 WHEN "rgt" BETWEEN 8 AND 12 THEN "rgt" + 4 - 8 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 3 THEN NULL ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 4 AND 12 OR "categories"."rgt" BETWEEN 4 AND 12)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.622292 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.622634 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:41.622826 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.623078 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.623599 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.623798 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.624104 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:41.624343 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.624695 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.625034 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.625276 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.625549 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.625855 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:41.626073 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.626639 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?[0m  [["parent_id", nil], ["id", 5]]
D, [2015-06-05T22:56:41.627025 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.627494 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 5  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.627709 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.627858 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.628322 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.628787 #97702] DEBUG -- :   [1m[36mThing Load (0.1ms)[0m  [1mSELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.632919 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?  [["parent_id", 1]]
D, [2015-06-05T22:56:41.633139 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.633494 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.633904 #97702] DEBUG -- :   [1m[36mThing Load (0.0ms)[0m  [1mSELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.634582 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?  [["parent_id", 1]]
D, [2015-06-05T22:56:41.634760 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.636166 #97702] DEBUG -- :   [1m[35mThing Load (0.1ms)[0m  SELECT  "things".* FROM "things"  ORDER BY "things"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.636581 #97702] DEBUG -- :   [1m[36mThing Load (0.1ms)[0m  [1mSELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T22:56:41.637093 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "things" ("body", "parent_id", "lft", "rgt") VALUES (?, ?, ?, ?)  [["body", "Child 3"], ["parent_id", 1], ["lft", 11], ["rgt", 12]]
D, [2015-06-05T22:56:41.637476 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "things" SET "children_count" = COALESCE("children_count", 0) + 1 WHERE "things"."id" = ?[0m  [["id", 1]]
D, [2015-06-05T22:56:41.637881 #97702] DEBUG -- :   [1m[35mThing Load (0.1ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ?  ORDER BY "things"."lft" LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.638223 #97702] DEBUG -- :   [1m[36mThing Load (0.0ms)[0m  [1mSELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1 [0m  [["id", 5]]
D, [2015-06-05T22:56:41.639281 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "things" SET "lft" = CASE WHEN "lft" BETWEEN 10 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 10 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 10 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 10 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 5 THEN 1 ELSE "parent_id" END WHERE "things"."id" IN (SELECT "things"."id" FROM "things" WHERE ("things"."lft" BETWEEN 10 AND 12 OR "things"."rgt" BETWEEN 10 AND 12)  ORDER BY "things"."lft")
D, [2015-06-05T22:56:41.639589 #97702] DEBUG -- :   [1m[36mThing Load (0.0ms)[0m  [1mSELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T22:56:41.640070 #97702] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.640871 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "things" WHERE ("things"."lft" <= 10) AND ("things"."rgt" >= 11) AND ("things"."id" != 5)[0m
D, [2015-06-05T22:56:41.641332 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "things" SET "depth" = 1 WHERE "things"."id" IN (SELECT "things"."id" FROM "things" WHERE "things"."id" = 5  ORDER BY "things"."lft")
D, [2015-06-05T22:56:41.641692 #97702] DEBUG -- :   [1m[36mThing Load (0.0ms)[0m  [1mSELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1 [0m  [["id", 5]]
D, [2015-06-05T22:56:41.642069 #97702] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.642602 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "things" WHERE ("things"."lft" <= 10) AND ("things"."rgt" >= 11) AND ("things"."id" != 5)[0m
D, [2015-06-05T22:56:41.642990 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "things" SET "depth" = 1 WHERE "things"."id" IN (SELECT "things"."id" FROM "things" WHERE "things"."id" = 5  ORDER BY "things"."lft")
D, [2015-06-05T22:56:41.643228 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.643638 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?  [["parent_id", 1]]
D, [2015-06-05T22:56:41.643948 #97702] DEBUG -- :   [1m[36mThing Load (0.0ms)[0m  [1mSELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.644169 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.644572 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.644894 #97702] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.645572 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-05T22:56:41.645997 #97702] DEBUG -- :   [1m[35mThing Load (0.1ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."parent_id" = ?  ORDER BY "lft" DESC LIMIT 1  [["parent_id", 1]]
D, [2015-06-05T22:56:41.646199 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.646609 #97702] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:41.647156 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mDELETE FROM "things" WHERE ("things"."lft" >= 4) AND ("things"."lft" < 7) AND ("things"."id" != 3)[0m
D, [2015-06-05T22:56:41.647538 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "things" SET "lft" = ("lft" - 4) WHERE "things"."id" IN (SELECT "things"."id" FROM "things" WHERE ("things"."lft" > 7)  ORDER BY "things"."lft")
D, [2015-06-05T22:56:41.647894 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "things" SET "rgt" = ("rgt" - 4) WHERE "things"."id" IN (SELECT "things"."id" FROM "things" WHERE ("things"."rgt" > 7)  ORDER BY "things"."lft")[0m
D, [2015-06-05T22:56:41.648166 #97702] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.648475 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mDELETE FROM "things" WHERE "things"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T22:56:41.648980 #97702] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.649301 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "things" SET "children_count" = COALESCE("children_count", 0) - 1 WHERE "things"."id" = ?[0m  [["id", 1]]
D, [2015-06-05T22:56:41.649405 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.653326 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-05T22:56:41.653748 #97702] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.653995 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.654555 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.657237 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.657978 #97702] DEBUG -- :   [1m[35mDefaultWithCallbacks Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.658388 #97702] DEBUG -- :   [1m[36mDefaultWithCallbacks Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.658852 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "categories" ("lft", "rgt") VALUES (?, ?)  [["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:41.659379 #97702] DEBUG -- :   [1m[36mDefaultWithCallbacks Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.660043 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.660279 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.661724 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.662290 #97702] DEBUG -- :   [1m[36mDefaultWithCallbacks Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.662643 #97702] DEBUG -- :   [1m[35mDefaultWithCallbacks Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.663099 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "categories" ("parent_id", "lft", "rgt") VALUES (?, ?, ?)[0m  [["parent_id", 7], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:41.663748 #97702] DEBUG -- :   [1m[35mDefaultWithCallbacks Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."lft" LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.664306 #97702] DEBUG -- :   [1m[36mDefaultWithCallbacks Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.665553 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 8 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 16 OR "categories"."rgt" BETWEEN 14 AND 16)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.665963 #97702] DEBUG -- :   [1m[36mDefaultWithCallbacks Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.666365 #97702] DEBUG -- :   [1m[35mDefaultWithCallbacks Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.667173 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)[0m
D, [2015-06-05T22:56:41.667556 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.667881 #97702] DEBUG -- :   [1m[36mDefaultWithCallbacks Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.668248 #97702] DEBUG -- :   [1m[35mDefaultWithCallbacks Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.668753 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)[0m
D, [2015-06-05T22:56:41.669086 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.669306 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.669481 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.669975 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "parent_id" = NULL WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."parent_id" = ? AND "categories"."id" = 8  ORDER BY "lft")[0m  [["parent_id", 7]]
D, [2015-06-05T22:56:41.670105 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.670262 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.670811 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.672282 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "positions"."id") FROM "positions" LEFT OUTER JOIN "positions" "parent" ON "parent"."id" = "positions"."parent_id" WHERE ((("positions"."lft" IS NULL OR "positions"."rgt" IS NULL) OR "positions"."lft" >= "positions"."rgt") OR "positions"."parent_id" IS NOT NULL AND ("positions"."lft" <= "parent"."lft" OR "positions"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.672724 #97702] DEBUG -- :   [1m[35mPosition Load (0.1ms)[0m  SELECT  "positions"."lft", COUNT("positions"."lft") as _count FROM "positions" GROUP BY "positions"."lft", "positions"."id" HAVING COUNT("positions"."lft") > 1  ORDER BY "positions"."id" LIMIT 1
D, [2015-06-05T22:56:41.673083 #97702] DEBUG -- :   [1m[36mPosition Load (0.1ms)[0m  [1mSELECT  "positions"."rgt", COUNT("positions"."rgt") as _count FROM "positions" GROUP BY "positions"."rgt", "positions"."id" HAVING COUNT("positions"."rgt") > 1  ORDER BY "positions"."id" LIMIT 1[0m
D, [2015-06-05T22:56:41.673467 #97702] DEBUG -- :   [1m[35mPosition Load (0.1ms)[0m  SELECT "positions".* FROM "positions" WHERE "positions"."parent_id" IS NULL  ORDER BY "positions"."lft"
D, [2015-06-05T22:56:41.673614 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.674066 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.676955 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.677647 #97702] DEBUG -- :   [1m[35mOrder Load (0.1ms)[0m  SELECT  "orders".* FROM "orders"  ORDER BY "orders"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.677988 #97702] DEBUG -- :   [1m[36mOrder Load (0.1ms)[0m  [1mSELECT  "orders".* FROM "orders"  ORDER BY "orders"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.678425 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "orders" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Alpha"], ["lft", 1], ["rgt", 2]]
D, [2015-06-05T22:56:41.678998 #97702] DEBUG -- :   [1m[36mOrder Load (0.1ms)[0m  [1mSELECT  "orders".* FROM "orders" WHERE "orders"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.679582 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "orders" SET "depth" = 0 WHERE "orders"."id" IN (SELECT "orders"."id" FROM "orders" WHERE "orders"."id" = 1  ORDER BY "orders"."lft")
D, [2015-06-05T22:56:41.679779 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.680085 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.680520 #97702] DEBUG -- :   [1m[36mOrder Load (0.1ms)[0m  [1mSELECT  "orders".* FROM "orders"  ORDER BY "orders"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.680897 #97702] DEBUG -- :   [1m[35mOrder Load (0.1ms)[0m  SELECT  "orders".* FROM "orders" WHERE "orders"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T22:56:41.681269 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "orders" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Gamma"], ["lft", 3], ["rgt", 4]]
D, [2015-06-05T22:56:41.681643 #97702] DEBUG -- :   [1m[35mOrder Load (0.0ms)[0m  SELECT  "orders".* FROM "orders" WHERE "orders"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.682106 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "orders" SET "depth" = 0 WHERE "orders"."id" IN (SELECT "orders"."id" FROM "orders" WHERE "orders"."id" = 2  ORDER BY "orders"."lft")[0m
D, [2015-06-05T22:56:41.682289 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.682540 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.682960 #97702] DEBUG -- :   [1m[35mOrder Load (0.1ms)[0m  SELECT  "orders".* FROM "orders"  ORDER BY "orders"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.683266 #97702] DEBUG -- :   [1m[36mOrder Load (0.0ms)[0m  [1mSELECT  "orders".* FROM "orders" WHERE "orders"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T22:56:41.683647 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "orders" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Omega"], ["lft", 5], ["rgt", 6]]
D, [2015-06-05T22:56:41.683993 #97702] DEBUG -- :   [1m[36mOrder Load (0.0ms)[0m  [1mSELECT  "orders".* FROM "orders" WHERE "orders"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.684443 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "orders" SET "depth" = 0 WHERE "orders"."id" IN (SELECT "orders"."id" FROM "orders" WHERE "orders"."id" = 3  ORDER BY "orders"."lft")
D, [2015-06-05T22:56:41.684645 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.684840 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.685514 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.685654 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.685897 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.686046 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.686336 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.686847 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T22:56:41.687335 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:41.687695 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.687990 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.688349 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T22:56:41.688742 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T22:56:41.689350 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.689726 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.694562 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.695359 #97702] DEBUG -- :   [1m[36mSuperclass Load (0.1ms)[0m  [1mSELECT  "single_table_inheritance".* FROM "single_table_inheritance"  ORDER BY "single_table_inheritance"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:41.695723 #97702] DEBUG -- :   [1m[35mSuperclass Load (0.1ms)[0m  SELECT  "single_table_inheritance".* FROM "single_table_inheritance"  ORDER BY "single_table_inheritance"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.696263 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "single_table_inheritance" ("type", "name", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["type", "Subclass1"], ["name", "Subclass1"], ["lft", 1], ["rgt", 2]]
D, [2015-06-05T22:56:41.696654 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.699117 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.699680 #97702] DEBUG -- :   [1m[35mSuperclass Load (0.1ms)[0m  SELECT  "single_table_inheritance".* FROM "single_table_inheritance"  ORDER BY "single_table_inheritance"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.700289 #97702] DEBUG -- :   [1m[36mSubclass1 Load (0.1ms)[0m  [1mSELECT  "single_table_inheritance".* FROM "single_table_inheritance" WHERE "single_table_inheritance"."type" IN ('Subclass1') AND "single_table_inheritance"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T22:56:41.700905 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "single_table_inheritance" ("type", "name", "parent_id", "lft", "rgt") VALUES (?, ?, ?, ?, ?)  [["type", "Subclass2"], ["name", "Subclass2"], ["parent_id", 1], ["lft", 3], ["rgt", 4]]
D, [2015-06-05T22:56:41.701350 #97702] DEBUG -- :   [1m[36mSuperclass Load (0.1ms)[0m  [1mSELECT  "single_table_inheritance".* FROM "single_table_inheritance" WHERE "single_table_inheritance"."id" = ?  ORDER BY "single_table_inheritance"."lft" LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.701886 #97702] DEBUG -- :   [1m[35mSubclass2 Load (0.1ms)[0m  SELECT  "single_table_inheritance".* FROM "single_table_inheritance" WHERE "single_table_inheritance"."type" IN ('Subclass2') AND "single_table_inheritance"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:41.703084 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "single_table_inheritance" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 2 THEN 1 ELSE "parent_id" END WHERE "single_table_inheritance"."id" IN (SELECT "single_table_inheritance"."id" FROM "single_table_inheritance" WHERE ("single_table_inheritance"."lft" BETWEEN 2 AND 4 OR "single_table_inheritance"."rgt" BETWEEN 2 AND 4)  ORDER BY "single_table_inheritance"."lft")[0m
D, [2015-06-05T22:56:41.703569 #97702] DEBUG -- :   [1m[35mSubclass1 Load (0.1ms)[0m  SELECT  "single_table_inheritance".* FROM "single_table_inheritance" WHERE "single_table_inheritance"."type" IN ('Subclass1') AND "single_table_inheritance"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T22:56:41.704111 #97702] DEBUG -- :   [1m[36mSubclass2 Load (0.1ms)[0m  [1mSELECT  "single_table_inheritance".* FROM "single_table_inheritance" WHERE "single_table_inheritance"."type" IN ('Subclass2') AND "single_table_inheritance"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T22:56:41.704419 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.704584 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.705179 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T22:56:41.705752 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:41.705956 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.706425 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T22:56:41.707012 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10) AND ("categories"."id" != 1)  ORDER BY "categories"."lft"
D, [2015-06-05T22:56:41.707346 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 2]]
D, [2015-06-05T22:56:41.707623 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  DELETE FROM "categories" WHERE "categories"."id" = ?  [["id", 3]]
D, [2015-06-05T22:56:41.707829 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 4]]
D, [2015-06-05T22:56:41.708082 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  DELETE FROM "categories" WHERE "categories"."id" = ?  [["id", 5]]
D, [2015-06-05T22:56:41.708506 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = ("lft" - 10) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" > 10)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.708839 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "rgt" = ("rgt" - 10) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."rgt" > 10)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.709123 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.709369 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  DELETE FROM "categories" WHERE "categories"."id" = ?  [["id", 1]]
D, [2015-06-05T22:56:41.709462 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.709964 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE "categories"."id" = ?  [["id", 1]]
D, [2015-06-05T22:56:41.710326 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-05T22:56:41.710465 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.710986 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.711454 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."id" ASC LIMIT 1
D, [2015-06-05T22:56:41.712465 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT "notes".id FROM "notes" WHERE "notes"."user_id" = ?[0m  [["user_id", 1]]
D, [2015-06-05T22:56:41.712990 #97702] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 1]]
D, [2015-06-05T22:56:41.713606 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.714308 #97702] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T22:56:41.715299 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" >= 1) AND ("notes"."lft" < 10) AND ("notes"."id" != 1)[0m  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.715845 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "lft" = ("lft" - 10) WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" > 10)  ORDER BY "notes"."lft")  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.716339 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "rgt" = ("rgt" - 10) WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."rgt" > 10)  ORDER BY "notes"."lft")[0m  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T22:56:41.716600 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.716917 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 1]]
D, [2015-06-05T22:56:41.717282 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:41.717508 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 2]]
D, [2015-06-05T22:56:41.717812 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:41.718037 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T22:56:41.718333 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T22:56:41.718535 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 4]]
D, [2015-06-05T22:56:41.718721 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.719256 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "notes" WHERE "notes"."user_id" = ? AND "notes"."id" IN (1, 2, 3, 4)[0m  [["user_id", 1]]
D, [2015-06-05T22:56:41.719450 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.719980 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.720439 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T22:56:41.720662 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.721083 #97702] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T22:56:41.721594 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mDELETE FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10) AND ("categories"."id" != 1)[0m
D, [2015-06-05T22:56:41.721970 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = ("lft" - 10) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" > 10)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.722318 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "rgt" = ("rgt" - 10) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."rgt" > 10)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.722564 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.722823 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 1]]
D, [2015-06-05T22:56:41.722922 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.723299 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 1]]
D, [2015-06-05T22:56:41.723636 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?  [["parent_id", 1]]
D, [2015-06-05T22:56:41.723768 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.724264 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.724668 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:41.724834 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.725188 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T22:56:41.725436 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.725782 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.726080 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.726412 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."id" DESC LIMIT 1[0m
D, [2015-06-05T22:56:41.726548 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.726907 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.727414 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = ("lft" - 2) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" > 12)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.727756 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "rgt" = ("rgt" - 2) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."rgt" > 12)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.728013 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:41.728246 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 6]]
D, [2015-06-05T22:56:41.728355 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.728530 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.728968 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.729554 #97702] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:41.729811 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.730252 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T22:56:41.750374 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.750807 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.751282 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T22:56:41.751837 #97702] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."id" DESC LIMIT 1[0m
D, [2015-06-05T22:56:41.752072 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.752626 #97702] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.753286 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = ("lft" - 2) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" > 12)  ORDER BY "categories"."lft")
D, [2015-06-05T22:56:41.753638 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "rgt" = ("rgt" - 2) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."rgt" > 12)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T22:56:41.753918 #97702] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:41.754223 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 6]]
D, [2015-06-05T22:56:41.754333 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.754490 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.755010 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.755501 #97702] DEBUG -- :   [1m[36mDefaultScopedModel Load (0.1ms)[0m  [1mSELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:41.758482 #97702] DEBUG -- :   [1m[35mDefaultScopedModel Load (0.0ms)[0m  SELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:41.759555 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.759957 #97702] DEBUG -- :   [1m[35mDefaultScopedModel Load (0.0ms)[0m  SELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:41.760540 #97702] DEBUG -- :   [1m[36mDefaultScopedModel Load (0.0ms)[0m  [1mSELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:41.761867 #97702] DEBUG -- :   [1m[35mDefaultScopedModel Load (0.2ms)[0m  SELECT  "default_scoped_models".* FROM "default_scoped_models"  ORDER BY "default_scoped_models"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.762218 #97702] DEBUG -- :   [1m[36mDefaultScopedModel Load (0.1ms)[0m  [1mSELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.762741 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "default_scoped_models" ("name", "parent_id", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Helloworld"], ["parent_id", 6], ["lft", 9], ["rgt", 10]]
D, [2015-06-05T22:56:41.763156 #97702] DEBUG -- :   [1m[36mDefaultScopedModel Load (0.1ms)[0m  [1mSELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ?  ORDER BY "default_scoped_models"."lft" LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:41.763471 #97702] DEBUG -- :   [1m[35mDefaultScopedModel Load (0.0ms)[0m  SELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.763876 #97702] DEBUG -- :   [1m[36mDefaultScopedModel Load (0.0ms)[0m  [1mSELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:41.765000 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "default_scoped_models" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 6 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 6 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 8 THEN 6 ELSE "parent_id" END WHERE "default_scoped_models"."id" IN (SELECT "default_scoped_models"."id" FROM "default_scoped_models" WHERE ("default_scoped_models"."lft" BETWEEN 6 AND 10 OR "default_scoped_models"."rgt" BETWEEN 6 AND 10)  ORDER BY "default_scoped_models"."lft")
D, [2015-06-05T22:56:41.765290 #97702] DEBUG -- :   [1m[36mDefaultScopedModel Load (0.0ms)[0m  [1mSELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.765730 #97702] DEBUG -- :   [1m[35mDefaultScopedModel Load (0.0ms)[0m  SELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.766445 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "default_scoped_models" WHERE ("default_scoped_models"."lft" <= 6) AND ("default_scoped_models"."rgt" >= 7) AND ("default_scoped_models"."id" != 8)[0m
D, [2015-06-05T22:56:41.766907 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "default_scoped_models" SET "depth" = 1 WHERE "default_scoped_models"."id" IN (SELECT "default_scoped_models"."id" FROM "default_scoped_models" WHERE "default_scoped_models"."id" = 8  ORDER BY "default_scoped_models"."lft")
D, [2015-06-05T22:56:41.767248 #97702] DEBUG -- :   [1m[36mDefaultScopedModel Load (0.0ms)[0m  [1mSELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.767599 #97702] DEBUG -- :   [1m[35mDefaultScopedModel Load (0.0ms)[0m  SELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.768096 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "default_scoped_models" WHERE ("default_scoped_models"."lft" <= 6) AND ("default_scoped_models"."rgt" >= 7) AND ("default_scoped_models"."id" != 8)[0m
D, [2015-06-05T22:56:41.768472 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "default_scoped_models" SET "depth" = 1 WHERE "default_scoped_models"."id" IN (SELECT "default_scoped_models"."id" FROM "default_scoped_models" WHERE "default_scoped_models"."id" = 8  ORDER BY "default_scoped_models"."lft")
D, [2015-06-05T22:56:41.768717 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.769016 #97702] DEBUG -- :   [1m[35mDefaultScopedModel Load (0.0ms)[0m  SELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:41.769300 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.769955 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.770422 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.772460 #97702] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1  [["parent_uuid", "lmno"]]
D, [2015-06-05T22:56:41.772823 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.773519 #97702] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1  [["parent_uuid", "ijkh"]]
D, [2015-06-05T22:56:41.773784 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.774337 #97702] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1  [["parent_uuid", "abcd"]]
D, [2015-06-05T22:56:41.774480 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.774836 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.775130 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.775436 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.775712 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.775991 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:41.776263 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:41.776916 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10)  ORDER BY "users"."lft"
D, [2015-06-05T22:56:41.777515 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10)[0m
D, [2015-06-05T22:56:41.777672 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.778001 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.778327 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.778978 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '41f3a969cab0dc2e4186e3ff9a26ed34' LIMIT 1[0m
D, [2015-06-05T22:56:41.779471 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.779872 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.780396 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "lawyers"], ["uuid", "41f3a969cab0dc2e4186e3ff9a26ed34"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:41.780909 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.781464 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '41f3a969cab0dc2e4186e3ff9a26ed34'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.781684 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.781911 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.782380 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'd473edf82b7e9bbe17bfaf958983f524' LIMIT 1[0m
D, [2015-06-05T22:56:41.782814 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.783166 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.783591 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "United States"], ["uuid", "d473edf82b7e9bbe17bfaf958983f524"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:41.783974 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.784431 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'd473edf82b7e9bbe17bfaf958983f524'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.784636 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.784765 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.785046 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.785382 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.786754 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'd473edf82b7e9bbe17bfaf958983f524' THEN '41f3a969cab0dc2e4186e3ff9a26ed34' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 14 AND 16 OR "users"."rgt" BETWEEN 14 AND 16)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.786866 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.787260 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.787511 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.787778 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.788869 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != 'd473edf82b7e9bbe17bfaf958983f524')
D, [2015-06-05T22:56:41.789350 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'd473edf82b7e9bbe17bfaf958983f524'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.789504 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.789867 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.790203 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.790725 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '78783b5008719f3e359cb57354ed2f20' LIMIT 1[0m
D, [2015-06-05T22:56:41.791265 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.791716 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.792249 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Patent Law"], ["uuid", "78783b5008719f3e359cb57354ed2f20"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T22:56:41.792709 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.793258 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '78783b5008719f3e359cb57354ed2f20'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.793506 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.793650 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.793979 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.794376 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:41.795351 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 15 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 15 - 17 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '78783b5008719f3e359cb57354ed2f20' THEN 'd473edf82b7e9bbe17bfaf958983f524' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 15 AND 18 OR "users"."rgt" BETWEEN 15 AND 18)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.795445 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.795775 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.795992 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.796272 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.797230 #97702] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 15) AND ("users"."rgt" >= 16) AND ("users"."uuid" != '78783b5008719f3e359cb57354ed2f20')
D, [2015-06-05T22:56:41.798120 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '78783b5008719f3e359cb57354ed2f20'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.798306 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.798714 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:41.799094 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.799857 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?[0m  [["parent_uuid", "41f3a969cab0dc2e4186e3ff9a26ed34"]]
D, [2015-06-05T22:56:41.800430 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?  [["parent_uuid", "d473edf82b7e9bbe17bfaf958983f524"]]
D, [2015-06-05T22:56:41.801056 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" >= 13) AND ("users"."lft" < 18) AND ("users"."uuid" != '41f3a969cab0dc2e4186e3ff9a26ed34')[0m
D, [2015-06-05T22:56:41.801215 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.801726 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.802073 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.802404 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.802672 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.802964 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.803255 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.803746 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10) AND ("users"."uuid" != 'abcd')  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:41.804004 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.804293 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.804594 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.805217 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft"[0m  [["parent_uuid", "abcd"]]
D, [2015-06-05T22:56:41.805523 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.805800 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.806113 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.806775 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh') AND ("users"."lft" < 4)  ORDER BY "users"."lft" DESC LIMIT 1[0m
D, [2015-06-05T22:56:41.806950 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.807241 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.807577 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:41.808444 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 7 - 3 WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 7 - 3 WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'ijkh' THEN 'abcd' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 2 AND 7 OR "users"."rgt" BETWEEN 2 AND 7)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.808531 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.808811 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T22:56:41.809025 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.809249 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.809908 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 2) AND ("users"."rgt" >= 5) AND ("users"."uuid" != 'ijkh')
D, [2015-06-05T22:56:41.810291 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.810793 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = "depth" + 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" >= 2) AND ("users"."lft" < 5) AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.810878 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.811143 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:41.811476 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.812142 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft"  [["parent_uuid", "abcd"]]
D, [2015-06-05T22:56:41.812555 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.812955 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.813268 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.813586 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.813912 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.814216 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.814545 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.814853 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.815075 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.815363 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.815646 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.815929 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.816216 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.816514 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.816742 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.816995 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.817551 #97702] DEBUG -- :   [1m[36mScopedUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:41.821408 #97702] DEBUG -- :   [1m[35mScopedUser Load (0.2ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft" LIMIT 1  [["parent_uuid", "abcd"]]
D, [2015-06-05T22:56:41.821984 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.822639 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "organization_id" = ? WHERE "users"."id" = ?  [["organization_id", 999999999], ["id", 2]]
D, [2015-06-05T22:56:41.823219 #97702] DEBUG -- :   [1m[36mScopedUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.823932 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."organization_id" = ? AND ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'efgh')  [["organization_id", 999999999]]
D, [2015-06-05T22:56:41.824500 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."organization_id" = ? AND "users"."uuid" = 'efgh'  ORDER BY "users"."lft")[0m  [["organization_id", 999999999]]
D, [2015-06-05T22:56:41.824733 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.824926 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.825297 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.825689 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.826031 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.826398 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.826700 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.826915 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.827204 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.827478 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.827764 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.828067 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.828387 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.828602 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.828860 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.829292 #97702] DEBUG -- :   [1m[36mScopedUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:41.829943 #97702] DEBUG -- :   [1m[35mScopedUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft" LIMIT 1  [["parent_uuid", "abcd"]]
D, [2015-06-05T22:56:41.830208 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.830695 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "organization_id" = ? WHERE "users"."id" = ?  [["organization_id", 999999999], ["id", 2]]
D, [2015-06-05T22:56:41.831121 #97702] DEBUG -- :   [1m[36mScopedUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.831728 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."organization_id" = ? AND ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'efgh')  [["organization_id", 999999999]]
D, [2015-06-05T22:56:41.832169 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."organization_id" = ? AND "users"."uuid" = 'efgh'  ORDER BY "users"."lft")[0m  [["organization_id", 999999999]]
D, [2015-06-05T22:56:41.832409 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.832601 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.832962 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.833363 #97702] DEBUG -- :   [1m[36mScopedUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:41.834002 #97702] DEBUG -- :   [1m[35mScopedUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft" LIMIT 1  [["parent_uuid", "abcd"]]
D, [2015-06-05T22:56:41.834251 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.834720 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "organization_id" = ? WHERE "users"."id" = ?  [["organization_id", 999999999], ["id", 2]]
D, [2015-06-05T22:56:41.835134 #97702] DEBUG -- :   [1m[36mScopedUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.835771 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."organization_id" = ? AND ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'efgh')  [["organization_id", 999999999]]
D, [2015-06-05T22:56:41.836255 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."organization_id" = ? AND "users"."uuid" = 'efgh'  ORDER BY "users"."lft")[0m  [["organization_id", 999999999]]
D, [2015-06-05T22:56:41.836505 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.836702 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.837080 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.837509 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.837870 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.838471 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh') AND ("users"."lft" < 4)  ORDER BY "users"."lft" DESC LIMIT 1[0m
D, [2015-06-05T22:56:41.838802 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.839275 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'pqrs') AND ("users"."lft" < 8)  ORDER BY "users"."lft" DESC LIMIT 1[0m
D, [2015-06-05T22:56:41.839463 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.839755 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.840061 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.840608 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL AND ("users"."uuid" != 'abcd') AND ("users"."lft" < 1)  ORDER BY "users"."lft" DESC LIMIT 1[0m
D, [2015-06-05T22:56:41.840766 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.841065 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.841387 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:41.841914 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'ijkh' AND ("users"."uuid" != 'lmno') AND ("users"."lft" < 5)  ORDER BY "users"."lft" DESC LIMIT 1[0m
D, [2015-06-05T22:56:41.842065 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.842337 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.842639 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.843167 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'efgh') AND ("users"."lft" < 2)  ORDER BY "users"."lft" DESC LIMIT 1[0m
D, [2015-06-05T22:56:41.843303 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.843584 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.843892 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.844194 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.844698 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh') AND ("users"."lft" >= 4)  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T22:56:41.845029 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.845541 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'efgh') AND ("users"."lft" >= 2)  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T22:56:41.845725 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.846021 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.846317 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:41.846610 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.847157 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL AND ("users"."uuid" != 'abcd') AND ("users"."lft" >= 1)  ORDER BY "users"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:41.848265 #97702] DEBUG -- :   [1m[35mUser Load (0.3ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL AND ("users"."uuid" != 'tuvw') AND ("users"."lft" >= 11)  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T22:56:41.848522 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.848880 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.849301 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.849957 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'ijkh' AND ("users"."uuid" != 'lmno') AND ("users"."lft" >= 5)  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T22:56:41.850122 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.850452 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.850778 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:41.851314 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'pqrs') AND ("users"."lft" >= 8)  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T22:56:41.851468 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.851759 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.852058 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.852581 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh') AND ("users"."lft" < 4)  ORDER BY "users"."lft" DESC LIMIT 1
D, [2015-06-05T22:56:41.852764 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.853047 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.853409 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:41.854290 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 7 - 3 WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 7 - 3 WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'ijkh' THEN 'abcd' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 2 AND 7 OR "users"."rgt" BETWEEN 2 AND 7)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.854386 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.854675 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:41.854892 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.855135 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.855798 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 2) AND ("users"."rgt" >= 5) AND ("users"."uuid" != 'ijkh')[0m
D, [2015-06-05T22:56:41.856216 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.856721 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = "depth" + 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" >= 2) AND ("users"."lft" < 5) AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.856804 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.857115 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:41.857622 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh') AND ("users"."lft" < 2)  ORDER BY "users"."lft" DESC LIMIT 1
D, [2015-06-05T22:56:41.857906 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.858427 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh') AND ("users"."lft" >= 2)  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T22:56:41.859399 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.859812 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:41.860150 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:41.860436 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T22:56:41.860705 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.861032 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.861395 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.861969 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh') AND ("users"."lft" >= 4)  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T22:56:41.862130 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.862414 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.862760 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:41.863634 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 9 - 7 WHEN "lft" BETWEEN 8 AND 9 THEN "lft" + 4 - 8 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 9 - 7 WHEN "rgt" BETWEEN 8 AND 9 THEN "rgt" + 4 - 8 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'ijkh' THEN 'abcd' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 4 AND 9 OR "users"."rgt" BETWEEN 4 AND 9)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.863720 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.864026 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 5]]
D, [2015-06-05T22:56:41.864221 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.864484 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.865176 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 6) AND ("users"."rgt" >= 9) AND ("users"."uuid" != 'ijkh')[0m
D, [2015-06-05T22:56:41.865582 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.866077 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = "depth" + 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" >= 6) AND ("users"."lft" < 9) AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.866159 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.866473 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:41.866979 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh') AND ("users"."lft" >= 6)  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T22:56:41.867281 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:41.867777 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh') AND ("users"."lft" < 6)  ORDER BY "users"."lft" DESC LIMIT 1
D, [2015-06-05T22:56:41.868647 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.869031 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:41.869368 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:41.869655 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T22:56:41.869901 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.870239 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.870573 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:41.870889 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.871052 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.871299 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.871760 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 5]]
D, [2015-06-05T22:56:41.872737 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 7 THEN "lft" + 9 - 7 WHEN "lft" BETWEEN 8 AND 9 THEN "lft" + 2 - 8 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 7 THEN "rgt" + 9 - 7 WHEN "rgt" BETWEEN 8 AND 9 THEN "rgt" + 2 - 8 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'pqrs' THEN 'abcd' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 2 AND 9 OR "users"."rgt" BETWEEN 2 AND 9)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.872835 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.873157 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:41.873389 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.873664 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.874377 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'pqrs')[0m
D, [2015-06-05T22:56:41.874802 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'pqrs'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.874942 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.875242 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 5]]
D, [2015-06-05T22:56:41.875786 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'pqrs') AND ("users"."lft" < 2)  ORDER BY "users"."lft" DESC LIMIT 1[0m
D, [2015-06-05T22:56:41.876272 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'pqrs') AND ("users"."lft" >= 2)  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T22:56:41.877165 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.877548 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:41.877896 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:41.878183 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T22:56:41.878446 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.878787 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.879143 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.879465 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.879637 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.879903 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.880281 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T22:56:41.881713 #97702] DEBUG -- :   [1m[35mSQL (0.3ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 9 - 3 WHEN "lft" BETWEEN 4 AND 9 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 9 - 3 WHEN "rgt" BETWEEN 4 AND 9 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'efgh' THEN 'abcd' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 2 AND 9 OR "users"."rgt" BETWEEN 2 AND 9)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.886018 #97702] DEBUG -- :   [1m[36m (4.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.886487 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 5]]
D, [2015-06-05T22:56:41.886802 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.887108 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.887797 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 8) AND ("users"."rgt" >= 9) AND ("users"."uuid" != 'efgh')[0m
D, [2015-06-05T22:56:41.888221 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'efgh'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.888350 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.888650 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:41.889141 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'efgh') AND ("users"."lft" >= 8)  ORDER BY "users"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:41.889658 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'efgh') AND ("users"."lft" < 8)  ORDER BY "users"."lft" DESC LIMIT 1
D, [2015-06-05T22:56:41.890483 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.890879 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:41.891225 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:41.891492 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T22:56:41.891733 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.892082 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T22:56:41.892385 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.892583 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.892815 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.893157 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:41.893485 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT "users"."rgt" FROM "users"  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:41.894283 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 12 - 7 WHEN "lft" BETWEEN 8 AND 12 THEN "lft" + 4 - 8 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 12 - 7 WHEN "rgt" BETWEEN 8 AND 12 THEN "rgt" + 4 - 8 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'ijkh' THEN NULL ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 4 AND 12 OR "users"."rgt" BETWEEN 4 AND 12)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.894370 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.894667 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:41.894882 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.895139 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.895695 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.895821 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.896100 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:41.896448 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:41.897008 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 10) AND ("users"."rgt" >= 11) AND ("users"."uuid" != 'lmno')[0m
D, [2015-06-05T22:56:41.897785 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:41.898164 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:41.898503 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:41.898767 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:41.899057 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.899383 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.899711 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.900009 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:41.900163 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.900416 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:41.900753 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:41.901561 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 8 - 3 WHEN "lft" BETWEEN 4 AND 8 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 8 - 3 WHEN "rgt" BETWEEN 4 AND 8 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'efgh' THEN 'pqrs' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 2 AND 8 OR "users"."rgt" BETWEEN 2 AND 8)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.901647 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.901944 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 5]]
D, [2015-06-05T22:56:41.902158 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.902402 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.903025 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != 'efgh')
D, [2015-06-05T22:56:41.903412 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'efgh'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.903586 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.903851 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T22:56:41.904727 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:41.905124 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:41.905478 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:41.905777 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:41.906009 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.906372 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.906617 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.907153 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '989064ea476be97d0e2842fd079994db' LIMIT 1[0m
D, [2015-06-05T22:56:41.907631 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.908006 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.908484 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "New Child"], ["uuid", "989064ea476be97d0e2842fd079994db"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:41.908875 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.909340 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '989064ea476be97d0e2842fd079994db'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.909553 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.909834 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.910000 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.910264 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.910626 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.911433 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 10 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 10 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 10 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 10 - 13 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '989064ea476be97d0e2842fd079994db' THEN 'abcd' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 10 AND 14 OR "users"."rgt" BETWEEN 10 AND 14)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.911519 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.911809 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T22:56:41.912027 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.912261 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:41.912956 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 10) AND ("users"."rgt" >= 11) AND ("users"."uuid" != '989064ea476be97d0e2842fd079994db')[0m
D, [2015-06-05T22:56:41.913379 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '989064ea476be97d0e2842fd079994db'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.913533 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.913908 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:41.914685 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft" DESC LIMIT 1[0m  [["parent_uuid", "abcd"]]
D, [2015-06-05T22:56:41.914975 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.915369 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.915747 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.916124 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.916320 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.916600 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:41.916977 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:41.917813 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 3 THEN "lft" + 7 - 3 WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 3 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 3 THEN "rgt" + 7 - 3 WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 3 - 4 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'ijkh' THEN 'efgh' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 3 AND 7 OR "users"."rgt" BETWEEN 3 AND 7)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.917938 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.918199 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T22:56:41.918446 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.918670 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:41.919336 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 3) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'ijkh')
D, [2015-06-05T22:56:41.919736 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.920307 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = "depth" + 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" >= 3) AND ("users"."lft" < 6) AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.920396 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.920717 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:41.921555 #97702] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.921917 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:41.922271 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:41.922571 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T22:56:41.922867 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:41.923225 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:41.923564 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:41.923893 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.924411 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '9121cd650303994633be5f7cd576d06c' LIMIT 1[0m
D, [2015-06-05T22:56:41.924891 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.925264 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.925737 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "New Top"], ["uuid", "9121cd650303994633be5f7cd576d06c"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:41.926139 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.926619 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '9121cd650303994633be5f7cd576d06c'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.926855 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.927031 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.927304 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.927649 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T22:56:41.928497 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 13 - 12 WHEN "lft" BETWEEN 13 AND 13 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 13 - 12 WHEN "rgt" BETWEEN 13 AND 13 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'tuvw' THEN '9121cd650303994633be5f7cd576d06c' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 11 AND 13 OR "users"."rgt" BETWEEN 11 AND 13)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.928582 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.928888 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.929122 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.929355 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:41.930106 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 12) AND ("users"."rgt" >= 13) AND ("users"."uuid" != 'tuvw')
D, [2015-06-05T22:56:41.931061 #97702] DEBUG -- :   [1m[36mSQL (0.3ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'tuvw'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.931273 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.931707 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.932701 #97702] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:41.933121 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:41.933440 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:41.933730 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:41.934071 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.934474 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.934804 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:41.935164 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.935464 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.935941 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '1daa48d933fbbc73cf3b4a385ad8c267' LIMIT 1[0m
D, [2015-06-05T22:56:41.936403 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.936755 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.937166 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "New Top"], ["uuid", "1daa48d933fbbc73cf3b4a385ad8c267"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:41.937578 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.938047 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '1daa48d933fbbc73cf3b4a385ad8c267'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.938255 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.938389 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.938674 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.939012 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T22:56:41.939822 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 1 AND 10 THEN "lft" + 13 - 10 WHEN "lft" BETWEEN 11 AND 13 THEN "lft" + 1 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 1 AND 10 THEN "rgt" + 13 - 10 WHEN "rgt" BETWEEN 11 AND 13 THEN "rgt" + 1 - 11 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'abcd' THEN '1daa48d933fbbc73cf3b4a385ad8c267' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 1 AND 13 OR "users"."rgt" BETWEEN 1 AND 13)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.939930 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.940198 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.940416 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.940653 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.941291 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 4) AND ("users"."rgt" >= 13) AND ("users"."uuid" != 'abcd')
D, [2015-06-05T22:56:41.941701 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'abcd'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.942197 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = "depth" + 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" >= 4) AND ("users"."lft" < 13) AND ("users"."uuid" != 'abcd')  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.942281 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.942581 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T22:56:41.942889 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.943732 #97702] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:41.944137 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:41.944478 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:41.944741 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:41.945059 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.945547 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.945816 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.946308 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '49a3a0a300e6341e2f4fc2b53591b17d' LIMIT 1[0m
D, [2015-06-05T22:56:41.946770 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.947133 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.947570 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Root1"], ["uuid", "49a3a0a300e6341e2f4fc2b53591b17d"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:41.947955 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.948417 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '49a3a0a300e6341e2f4fc2b53591b17d'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.948625 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.948832 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.949251 #97702] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'a894c56446403ea17d93a5408a16412c' LIMIT 1[0m
D, [2015-06-05T22:56:41.949685 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.950068 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.950536 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Root2"], ["uuid", "a894c56446403ea17d93a5408a16412c"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:41.951019 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.951482 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'a894c56446403ea17d93a5408a16412c'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.951692 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.951912 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.952361 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '7bf5ae04b0b9775aab3f6c8e4c6a4052' LIMIT 1[0m
D, [2015-06-05T22:56:41.952804 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.953138 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.953558 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Root3"], ["uuid", "7bf5ae04b0b9775aab3f6c8e4c6a4052"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T22:56:41.953943 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.954399 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '7bf5ae04b0b9775aab3f6c8e4c6a4052'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.954603 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.954732 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.955020 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.955375 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:41.956223 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'a894c56446403ea17d93a5408a16412c' THEN '49a3a0a300e6341e2f4fc2b53591b17d' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 14 AND 16 OR "users"."rgt" BETWEEN 14 AND 16)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.956307 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.956623 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.956820 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.957086 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:41.957773 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != 'a894c56446403ea17d93a5408a16412c')
D, [2015-06-05T22:56:41.958168 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'a894c56446403ea17d93a5408a16412c'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.958308 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.958616 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:41.958793 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.959071 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.959405 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:41.960221 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 16 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 16 - 17 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '7bf5ae04b0b9775aab3f6c8e4c6a4052' THEN '49a3a0a300e6341e2f4fc2b53591b17d' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 16 AND 18 OR "users"."rgt" BETWEEN 16 AND 18)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.960323 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.960596 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.960830 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.961100 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:41.961725 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '7bf5ae04b0b9775aab3f6c8e4c6a4052')
D, [2015-06-05T22:56:41.962106 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '7bf5ae04b0b9775aab3f6c8e4c6a4052'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.962245 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.962578 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:41.963325 #97702] DEBUG -- :   [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" DESC LIMIT 1
D, [2015-06-05T22:56:41.964152 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 13) AND ("users"."lft" < 18)  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:41.964818 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != 'a894c56446403ea17d93a5408a16412c')
D, [2015-06-05T22:56:41.965284 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '7bf5ae04b0b9775aab3f6c8e4c6a4052')[0m
D, [2015-06-05T22:56:41.965513 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET lft = null, rgt = null
D, [2015-06-05T22:56:41.966333 #97702] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:41.966653 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" IS NULL)  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:41.967139 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'abcd' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T22:56:41.967526 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'efgh' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:41.967672 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.968157 #97702] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'efgh' AND "users"."id" != 2) LIMIT 1
D, [2015-06-05T22:56:41.968793 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 2], ["rgt", 3], ["id", 2]]
D, [2015-06-05T22:56:41.969186 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:41.969796 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'efgh')[0m
D, [2015-06-05T22:56:41.970192 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'efgh'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.970457 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.970794 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'ijkh' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:41.971132 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'lmno' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T22:56:41.971282 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.971725 #97702] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1[0m
D, [2015-06-05T22:56:41.972163 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 5], ["rgt", 6], ["id", 4]]
D, [2015-06-05T22:56:41.972517 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:41.973065 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'lmno')
D, [2015-06-05T22:56:41.973459 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'lmno'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.973667 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.973848 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.974265 #97702] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'ijkh' AND "users"."id" != 3) LIMIT 1
D, [2015-06-05T22:56:41.974740 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 4], ["rgt", 7], ["id", 3]]
D, [2015-06-05T22:56:41.975106 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:41.975704 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 4) AND ("users"."rgt" >= 7) AND ("users"."uuid" != 'ijkh')[0m
D, [2015-06-05T22:56:41.976105 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.976318 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.976623 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'pqrs' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:41.976807 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.977255 #97702] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'pqrs' AND "users"."id" != 5) LIMIT 1
D, [2015-06-05T22:56:41.977716 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 8], ["rgt", 9], ["id", 5]]
D, [2015-06-05T22:56:41.978064 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:41.978638 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 8) AND ("users"."rgt" >= 9) AND ("users"."uuid" != 'pqrs')[0m
D, [2015-06-05T22:56:41.979025 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'pqrs'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.979240 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.979376 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.979818 #97702] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'abcd' AND "users"."id" != 1) LIMIT 1[0m
D, [2015-06-05T22:56:41.980277 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 1], ["rgt", 10], ["id", 1]]
D, [2015-06-05T22:56:41.980624 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:41.981082 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'abcd'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.981319 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.981645 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'tuvw' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:41.981806 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.982254 #97702] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'tuvw' AND "users"."id" != 6) LIMIT 1
D, [2015-06-05T22:56:41.982677 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 11], ["rgt", 12], ["id", 6]]
D, [2015-06-05T22:56:41.983021 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:41.983502 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'tuvw'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:41.983716 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.984062 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = '49a3a0a300e6341e2f4fc2b53591b17d' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T22:56:41.984389 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'a894c56446403ea17d93a5408a16412c' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:41.984554 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.985005 #97702] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'a894c56446403ea17d93a5408a16412c' AND "users"."id" != 8) LIMIT 1
D, [2015-06-05T22:56:41.985460 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 14], ["rgt", 15], ["id", 8]]
D, [2015-06-05T22:56:41.985782 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:41.986378 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != 'a894c56446403ea17d93a5408a16412c')[0m
D, [2015-06-05T22:56:41.986764 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'a894c56446403ea17d93a5408a16412c'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.986977 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.987308 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = '7bf5ae04b0b9775aab3f6c8e4c6a4052' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:41.987442 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.987889 #97702] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = '7bf5ae04b0b9775aab3f6c8e4c6a4052' AND "users"."id" != 9) LIMIT 1
D, [2015-06-05T22:56:41.988335 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 16], ["rgt", 17], ["id", 9]]
D, [2015-06-05T22:56:41.988696 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:41.989230 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '7bf5ae04b0b9775aab3f6c8e4c6a4052')[0m
D, [2015-06-05T22:56:41.989627 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '7bf5ae04b0b9775aab3f6c8e4c6a4052'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.989867 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.990001 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.990439 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = '49a3a0a300e6341e2f4fc2b53591b17d' AND "users"."id" != 7) LIMIT 1[0m
D, [2015-06-05T22:56:41.990873 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 13], ["rgt", 18], ["id", 7]]
D, [2015-06-05T22:56:41.991216 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.991666 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '49a3a0a300e6341e2f4fc2b53591b17d'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.991864 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.992232 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" DESC LIMIT 1
D, [2015-06-05T22:56:41.992634 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 13) AND ("users"."lft" < 18)  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:41.993216 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != 'a894c56446403ea17d93a5408a16412c')
D, [2015-06-05T22:56:41.993681 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '7bf5ae04b0b9775aab3f6c8e4c6a4052')[0m
D, [2015-06-05T22:56:41.993871 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:41.994595 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:41.994877 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.995373 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '4e57109601bec323a1e79f194deddd49' LIMIT 1[0m
D, [2015-06-05T22:56:41.995823 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.996205 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:41.996639 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Node-1"], ["uuid", "4e57109601bec323a1e79f194deddd49"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:41.997005 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:41.997516 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '4e57109601bec323a1e79f194deddd49'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:41.997721 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:41.997931 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:41.998345 #97702] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '26ebf4791318c7a24148e041d9e1bed3' LIMIT 1[0m
D, [2015-06-05T22:56:41.998758 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:41.999089 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:41.999499 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Node-2"], ["uuid", "26ebf4791318c7a24148e041d9e1bed3"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:41.999883 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:42.000352 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '26ebf4791318c7a24148e041d9e1bed3'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.000553 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.000780 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.001196 #97702] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '580c479e27b8692cb4e14679e2f4c4e1' LIMIT 1[0m
D, [2015-06-05T22:56:42.001582 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:42.001914 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:42.002323 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Node-3"], ["uuid", "580c479e27b8692cb4e14679e2f4c4e1"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T22:56:42.002698 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:42.003154 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '580c479e27b8692cb4e14679e2f4c4e1'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.003390 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.003515 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.003767 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:42.004111 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:42.004965 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '26ebf4791318c7a24148e041d9e1bed3' THEN '4e57109601bec323a1e79f194deddd49' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 14 AND 16 OR "users"."rgt" BETWEEN 14 AND 16)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.005048 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.005356 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:42.005554 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.005817 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:42.006468 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '26ebf4791318c7a24148e041d9e1bed3')
D, [2015-06-05T22:56:42.006853 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '26ebf4791318c7a24148e041d9e1bed3'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.006989 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.007295 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:42.007467 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.007742 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:42.008054 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:42.008874 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 16 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 16 - 17 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '580c479e27b8692cb4e14679e2f4c4e1' THEN '4e57109601bec323a1e79f194deddd49' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 16 AND 18 OR "users"."rgt" BETWEEN 16 AND 18)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.008978 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.009249 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:42.009471 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.009703 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:42.010355 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '580c479e27b8692cb4e14679e2f4c4e1')
D, [2015-06-05T22:56:42.010742 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '580c479e27b8692cb4e14679e2f4c4e1'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.010901 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.011171 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:42.011561 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" DESC LIMIT 1
D, [2015-06-05T22:56:42.011959 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 13) AND ("users"."lft" < 18)  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.012540 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '26ebf4791318c7a24148e041d9e1bed3')
D, [2015-06-05T22:56:42.012984 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '580c479e27b8692cb4e14679e2f4c4e1')[0m
D, [2015-06-05T22:56:42.013181 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET lft = null, rgt = null
D, [2015-06-05T22:56:42.013985 #97702] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.014283 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" IS NULL)  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:42.014681 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'abcd' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T22:56:42.015041 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'efgh' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:42.015209 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.015729 #97702] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'efgh' AND "users"."id" != 2) LIMIT 1
D, [2015-06-05T22:56:42.016217 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 2], ["rgt", 3], ["id", 2]]
D, [2015-06-05T22:56:42.016549 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:42.017154 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'efgh')[0m
D, [2015-06-05T22:56:42.017549 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'efgh'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.017764 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.018096 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'ijkh' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:42.018422 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'lmno' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T22:56:42.018577 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.019031 #97702] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1[0m
D, [2015-06-05T22:56:42.019485 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 5], ["rgt", 6], ["id", 4]]
D, [2015-06-05T22:56:42.019841 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:42.020387 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'lmno')
D, [2015-06-05T22:56:42.020789 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'lmno'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.020993 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.021130 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.021566 #97702] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'ijkh' AND "users"."id" != 3) LIMIT 1
D, [2015-06-05T22:56:42.022016 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 4], ["rgt", 7], ["id", 3]]
D, [2015-06-05T22:56:42.022360 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:42.022907 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 4) AND ("users"."rgt" >= 7) AND ("users"."uuid" != 'ijkh')[0m
D, [2015-06-05T22:56:42.023290 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.023518 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.023817 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'pqrs' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:42.023971 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.024405 #97702] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'pqrs' AND "users"."id" != 5) LIMIT 1
D, [2015-06-05T22:56:42.024840 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 8], ["rgt", 9], ["id", 5]]
D, [2015-06-05T22:56:42.025185 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:42.025727 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 8) AND ("users"."rgt" >= 9) AND ("users"."uuid" != 'pqrs')[0m
D, [2015-06-05T22:56:42.026101 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'pqrs'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.026309 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.026465 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.026897 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'abcd' AND "users"."id" != 1) LIMIT 1[0m
D, [2015-06-05T22:56:42.027357 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 1], ["rgt", 10], ["id", 1]]
D, [2015-06-05T22:56:42.027680 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:42.028157 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'abcd'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.028368 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.028686 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'tuvw' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:42.028818 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.029321 #97702] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'tuvw' AND "users"."id" != 6) LIMIT 1
D, [2015-06-05T22:56:42.029858 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 11], ["rgt", 12], ["id", 6]]
D, [2015-06-05T22:56:42.030233 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:42.030728 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'tuvw'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.030950 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.031306 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = '4e57109601bec323a1e79f194deddd49' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T22:56:42.031659 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = '26ebf4791318c7a24148e041d9e1bed3' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:42.031793 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.032250 #97702] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = '26ebf4791318c7a24148e041d9e1bed3' AND "users"."id" != 8) LIMIT 1
D, [2015-06-05T22:56:42.032694 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 14], ["rgt", 15], ["id", 8]]
D, [2015-06-05T22:56:42.033042 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:42.033641 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '26ebf4791318c7a24148e041d9e1bed3')[0m
D, [2015-06-05T22:56:42.034064 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '26ebf4791318c7a24148e041d9e1bed3'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.034300 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.034657 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = '580c479e27b8692cb4e14679e2f4c4e1' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:42.034835 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.035281 #97702] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = '580c479e27b8692cb4e14679e2f4c4e1' AND "users"."id" != 9) LIMIT 1
D, [2015-06-05T22:56:42.035760 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 16], ["rgt", 17], ["id", 9]]
D, [2015-06-05T22:56:42.036130 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:42.036703 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '580c479e27b8692cb4e14679e2f4c4e1')[0m
D, [2015-06-05T22:56:42.037097 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '580c479e27b8692cb4e14679e2f4c4e1'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.037331 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.037467 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.037962 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = '4e57109601bec323a1e79f194deddd49' AND "users"."id" != 7) LIMIT 1[0m
D, [2015-06-05T22:56:42.038411 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 13], ["rgt", 18], ["id", 7]]
D, [2015-06-05T22:56:42.038786 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:42.039259 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '4e57109601bec323a1e79f194deddd49'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.039464 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.039831 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" DESC LIMIT 1
D, [2015-06-05T22:56:42.040238 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 13) AND ("users"."lft" < 18)  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.040829 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '26ebf4791318c7a24148e041d9e1bed3')
D, [2015-06-05T22:56:42.041307 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '580c479e27b8692cb4e14679e2f4c4e1')[0m
D, [2015-06-05T22:56:42.041508 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.042248 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.042522 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.043017 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '505d04a5ab34c4c29b1fc33f89fcd46d' LIMIT 1[0m
D, [2015-06-05T22:56:42.043453 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:42.043816 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:42.044263 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Node-1"], ["uuid", "505d04a5ab34c4c29b1fc33f89fcd46d"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:42.044649 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:42.045158 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '505d04a5ab34c4c29b1fc33f89fcd46d'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.045374 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.045602 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.046018 #97702] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '345baae395386a82dc55875e05a55c11' LIMIT 1[0m
D, [2015-06-05T22:56:42.046433 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:42.046829 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:42.047789 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Node-2"], ["uuid", "345baae395386a82dc55875e05a55c11"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:42.048445 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:42.049027 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '345baae395386a82dc55875e05a55c11'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.049271 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.049530 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.049992 #97702] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '11959bd08c134ac828c53eae1fb8bb60' LIMIT 1[0m
D, [2015-06-05T22:56:42.050404 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:42.050770 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:42.051204 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Node-3"], ["uuid", "11959bd08c134ac828c53eae1fb8bb60"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T22:56:42.051591 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:42.052080 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '11959bd08c134ac828c53eae1fb8bb60'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.052305 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.052865 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft"  [["parent_uuid", "505d04a5ab34c4c29b1fc33f89fcd46d"]]
D, [2015-06-05T22:56:42.053025 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.053303 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:42.053669 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:42.054519 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '345baae395386a82dc55875e05a55c11' THEN '505d04a5ab34c4c29b1fc33f89fcd46d' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 14 AND 16 OR "users"."rgt" BETWEEN 14 AND 16)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.054621 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.054915 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:42.055134 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.055385 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:42.056053 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '345baae395386a82dc55875e05a55c11')[0m
D, [2015-06-05T22:56:42.056443 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '345baae395386a82dc55875e05a55c11'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.056583 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.056872 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:42.057542 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?[0m  [["parent_uuid", "505d04a5ab34c4c29b1fc33f89fcd46d"]]
D, [2015-06-05T22:56:42.058088 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1  [["uuid", "505d04a5ab34c4c29b1fc33f89fcd46d"]]
D, [2015-06-05T22:56:42.058498 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?[0m  [["parent_uuid", "505d04a5ab34c4c29b1fc33f89fcd46d"]]
D, [2015-06-05T22:56:42.058749 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft"  [["parent_uuid", "505d04a5ab34c4c29b1fc33f89fcd46d"]]
D, [2015-06-05T22:56:42.058963 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.059246 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:42.059597 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:42.060446 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 16 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 16 - 17 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '11959bd08c134ac828c53eae1fb8bb60' THEN '505d04a5ab34c4c29b1fc33f89fcd46d' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 16 AND 18 OR "users"."rgt" BETWEEN 16 AND 18)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.060533 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.060821 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:42.061037 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.061301 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:42.061958 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '11959bd08c134ac828c53eae1fb8bb60')[0m
D, [2015-06-05T22:56:42.062330 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '11959bd08c134ac828c53eae1fb8bb60'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.062490 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.062784 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:42.063447 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?[0m  [["parent_uuid", "505d04a5ab34c4c29b1fc33f89fcd46d"]]
D, [2015-06-05T22:56:42.063571 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.063854 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:42.064186 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:42.064387 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.064659 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:42.064857 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.065101 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:42.065746 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '11959bd08c134ac828c53eae1fb8bb60')[0m
D, [2015-06-05T22:56:42.066131 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '11959bd08c134ac828c53eae1fb8bb60'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.066257 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.066560 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:42.066882 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1[0m  [["uuid", "505d04a5ab34c4c29b1fc33f89fcd46d"]]
D, [2015-06-05T22:56:42.067298 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?  [["parent_uuid", "505d04a5ab34c4c29b1fc33f89fcd46d"]]
D, [2015-06-05T22:56:42.067692 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft"[0m  [["parent_uuid", "505d04a5ab34c4c29b1fc33f89fcd46d"]]
D, [2015-06-05T22:56:42.068049 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.068319 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:42.068663 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:42.068850 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.069131 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:42.069337 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.069619 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:42.070255 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '11959bd08c134ac828c53eae1fb8bb60')[0m
D, [2015-06-05T22:56:42.070662 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '11959bd08c134ac828c53eae1fb8bb60'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.070792 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.071073 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:42.071725 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?[0m  [["parent_uuid", "505d04a5ab34c4c29b1fc33f89fcd46d"]]
D, [2015-06-05T22:56:42.072054 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft"  [["parent_uuid", "505d04a5ab34c4c29b1fc33f89fcd46d"]]
D, [2015-06-05T22:56:42.072286 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.072558 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:42.072894 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:42.073731 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 15 THEN "lft" + 17 - 15 WHEN "lft" BETWEEN 16 AND 17 THEN "lft" + 14 - 16 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 15 THEN "rgt" + 17 - 15 WHEN "rgt" BETWEEN 16 AND 17 THEN "rgt" + 14 - 16 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '11959bd08c134ac828c53eae1fb8bb60' THEN '505d04a5ab34c4c29b1fc33f89fcd46d' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 14 AND 17 OR "users"."rgt" BETWEEN 14 AND 17)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.073816 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.074115 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:42.074320 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.074570 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:42.075189 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '11959bd08c134ac828c53eae1fb8bb60')[0m
D, [2015-06-05T22:56:42.075613 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '11959bd08c134ac828c53eae1fb8bb60'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.075740 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.076022 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:42.076343 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:42.076683 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1  [["uuid", "505d04a5ab34c4c29b1fc33f89fcd46d"]]
D, [2015-06-05T22:56:42.077404 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?[0m  [["parent_uuid", "505d04a5ab34c4c29b1fc33f89fcd46d"]]
D, [2015-06-05T22:56:42.077820 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft"  [["parent_uuid", "505d04a5ab34c4c29b1fc33f89fcd46d"]]
D, [2015-06-05T22:56:42.078240 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.078729 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.078994 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.079520 #97702] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '974291b03b2b17c62ca8e788f1a9b98a' LIMIT 1
D, [2015-06-05T22:56:42.080131 #97702] DEBUG -- :   [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:42.081045 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T22:56:42.081652 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Root1"], ["uuid", "974291b03b2b17c62ca8e788f1a9b98a"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:42.082125 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:42.082682 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '974291b03b2b17c62ca8e788f1a9b98a'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.082907 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.083150 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.083599 #97702] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '18bb95da1304870f89d0fafe28785cde' LIMIT 1
D, [2015-06-05T22:56:42.084007 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:42.084358 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:42.084769 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Root2"], ["uuid", "18bb95da1304870f89d0fafe28785cde"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:42.085147 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:42.085611 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '18bb95da1304870f89d0fafe28785cde'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.085820 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.086035 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.086447 #97702] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'd304a351a889166249ec16d42bf9442c' LIMIT 1
D, [2015-06-05T22:56:42.086873 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:42.087216 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:42.087649 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Root3"], ["uuid", "d304a351a889166249ec16d42bf9442c"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T22:56:42.088069 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:42.088545 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'd304a351a889166249ec16d42bf9442c'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.088755 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.088891 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.089170 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:42.089515 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:42.090365 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '18bb95da1304870f89d0fafe28785cde' THEN '974291b03b2b17c62ca8e788f1a9b98a' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 14 AND 16 OR "users"."rgt" BETWEEN 14 AND 16)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.090449 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.090742 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:42.090959 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.091236 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:42.091920 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '18bb95da1304870f89d0fafe28785cde')[0m
D, [2015-06-05T22:56:42.092313 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '18bb95da1304870f89d0fafe28785cde'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.092461 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.092770 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:42.092960 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.093221 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:42.093577 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:42.094443 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 16 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 16 - 17 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'd304a351a889166249ec16d42bf9442c' THEN '974291b03b2b17c62ca8e788f1a9b98a' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 16 AND 18 OR "users"."rgt" BETWEEN 16 AND 18)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.094552 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.094849 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:42.095077 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.095363 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:42.096036 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != 'd304a351a889166249ec16d42bf9442c')[0m
D, [2015-06-05T22:56:42.096439 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'd304a351a889166249ec16d42bf9442c'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.096580 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.096902 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:42.097106 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.097601 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "name" = ? WHERE "users"."id" = ?  [["name", nil], ["id", 8]]
D, [2015-06-05T22:56:42.101488 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:42.102230 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '18bb95da1304870f89d0fafe28785cde')
D, [2015-06-05T22:56:42.102685 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '18bb95da1304870f89d0fafe28785cde'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.102913 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.103266 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" DESC LIMIT 1[0m
D, [2015-06-05T22:56:42.103667 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."lft" >= 13) AND ("users"."lft" < 18)  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.104234 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '18bb95da1304870f89d0fafe28785cde')[0m
D, [2015-06-05T22:56:42.104673 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != 'd304a351a889166249ec16d42bf9442c')
D, [2015-06-05T22:56:42.104864 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET lft = null, rgt = null[0m
D, [2015-06-05T22:56:42.105636 #97702] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:42.105916 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" IS NULL)  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T22:56:42.106323 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'abcd' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:42.106698 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'efgh' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T22:56:42.106857 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.107361 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 2], ["rgt", 3], ["id", 2]]
D, [2015-06-05T22:56:42.107718 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:42.108257 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'efgh')[0m
D, [2015-06-05T22:56:42.108638 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'efgh'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.108848 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.109174 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'ijkh' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:42.109500 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'lmno' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T22:56:42.109631 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.110075 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 5], ["rgt", 6], ["id", 4]]
D, [2015-06-05T22:56:42.110418 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:42.110935 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'lmno')[0m
D, [2015-06-05T22:56:42.111315 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'lmno'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.111519 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.111650 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.112090 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 4], ["rgt", 7], ["id", 3]]
D, [2015-06-05T22:56:42.112434 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:42.112978 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 4) AND ("users"."rgt" >= 7) AND ("users"."uuid" != 'ijkh')[0m
D, [2015-06-05T22:56:42.113366 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.113649 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.114011 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'pqrs' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:42.114175 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.114695 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 8], ["rgt", 9], ["id", 5]]
D, [2015-06-05T22:56:42.115060 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:42.115655 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 8) AND ("users"."rgt" >= 9) AND ("users"."uuid" != 'pqrs')
D, [2015-06-05T22:56:42.116049 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'pqrs'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.116259 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.116396 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.116846 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 1], ["rgt", 10], ["id", 1]]
D, [2015-06-05T22:56:42.117194 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:42.117662 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'abcd'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.117870 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.118199 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'tuvw' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:42.118330 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.118763 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 11], ["rgt", 12], ["id", 6]]
D, [2015-06-05T22:56:42.119104 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:42.119543 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'tuvw'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.119747 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.120069 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = '974291b03b2b17c62ca8e788f1a9b98a' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:42.120407 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = '18bb95da1304870f89d0fafe28785cde' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T22:56:42.120536 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.120965 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 14], ["rgt", 15], ["id", 8]]
D, [2015-06-05T22:56:42.121306 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:42.121876 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '18bb95da1304870f89d0fafe28785cde')[0m
D, [2015-06-05T22:56:42.122263 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '18bb95da1304870f89d0fafe28785cde'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.122471 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.122784 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'd304a351a889166249ec16d42bf9442c' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:42.122932 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.123401 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 16], ["rgt", 17], ["id", 9]]
D, [2015-06-05T22:56:42.123759 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:42.124331 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != 'd304a351a889166249ec16d42bf9442c')
D, [2015-06-05T22:56:42.124715 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'd304a351a889166249ec16d42bf9442c'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.124926 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.125062 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.125524 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 13], ["rgt", 18], ["id", 7]]
D, [2015-06-05T22:56:42.125878 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:42.126330 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '974291b03b2b17c62ca8e788f1a9b98a'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.126544 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.126877 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" DESC LIMIT 1
D, [2015-06-05T22:56:42.127276 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 13) AND ("users"."lft" < 18)  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.127865 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '18bb95da1304870f89d0fafe28785cde')
D, [2015-06-05T22:56:42.128307 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != 'd304a351a889166249ec16d42bf9442c')[0m
D, [2015-06-05T22:56:42.128496 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.129225 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.130128 #97702] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:42.130962 #97702] DEBUG -- :   [1m[36mUser Load (0.3ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.131603 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.131942 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.132276 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET lft = null
D, [2015-06-05T22:56:42.133046 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.133212 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.133563 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.134272 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:42.134666 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.135006 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.135273 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.135584 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET rgt = null
D, [2015-06-05T22:56:42.136243 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.136383 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.136679 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.137390 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:42.137769 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.138103 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.138363 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.138756 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:42.139080 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mDELETE FROM "users" WHERE "users"."uuid" = ?[0m  [["uuid", "ijkh"]]
D, [2015-06-05T22:56:42.139757 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:42.140132 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.140468 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.140726 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.140971 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.141290 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.142029 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:42.142408 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.142740 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.143022 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.143409 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:42.143631 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.144082 #97702] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'tuvw' AND "users"."id" != 6) LIMIT 1
D, [2015-06-05T22:56:42.144567 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "lft" = ? WHERE "users"."id" = ?[0m  [["lft", 0], ["id", 6]]
D, [2015-06-05T22:56:42.144905 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:42.145382 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'tuvw'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.145597 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.146306 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.146668 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.146981 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.147273 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.147524 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.147898 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.148637 #97702] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.148996 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.149331 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.149617 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.150063 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:42.150463 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10)  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.151107 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'efgh')[0m
D, [2015-06-05T22:56:42.151570 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 4) AND ("users"."rgt" >= 7) AND ("users"."uuid" != 'ijkh')
D, [2015-06-05T22:56:42.152014 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'lmno')[0m
D, [2015-06-05T22:56:42.152446 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 8) AND ("users"."rgt" >= 9) AND ("users"."uuid" != 'pqrs')
D, [2015-06-05T22:56:42.152648 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET lft = null, rgt = null[0m
D, [2015-06-05T22:56:42.153393 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:42.153662 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" IS NULL)  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T22:56:42.154041 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'abcd' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:42.154402 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'efgh' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T22:56:42.154539 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.154999 #97702] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'efgh' AND "users"."id" != 2) LIMIT 1[0m
D, [2015-06-05T22:56:42.155497 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 2], ["rgt", 3], ["id", 2]]
D, [2015-06-05T22:56:42.155842 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:42.156386 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'efgh')
D, [2015-06-05T22:56:42.156773 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'efgh'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.157006 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.157313 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'ijkh' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T22:56:42.157654 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'lmno' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T22:56:42.157787 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.158229 #97702] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1
D, [2015-06-05T22:56:42.158693 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 5], ["rgt", 6], ["id", 4]]
D, [2015-06-05T22:56:42.159024 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:42.159557 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'lmno')[0m
D, [2015-06-05T22:56:42.159948 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'lmno'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.160160 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.160295 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.160754 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'ijkh' AND "users"."id" != 3) LIMIT 1[0m
D, [2015-06-05T22:56:42.161188 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 4], ["rgt", 7], ["id", 3]]
D, [2015-06-05T22:56:42.161528 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:42.162059 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 4) AND ("users"."rgt" >= 7) AND ("users"."uuid" != 'ijkh')
D, [2015-06-05T22:56:42.162433 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.162638 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.162960 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'pqrs' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T22:56:42.163092 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.163542 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'pqrs' AND "users"."id" != 5) LIMIT 1[0m
D, [2015-06-05T22:56:42.164079 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 8], ["rgt", 9], ["id", 5]]
D, [2015-06-05T22:56:42.164502 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:42.165117 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 8) AND ("users"."rgt" >= 9) AND ("users"."uuid" != 'pqrs')
D, [2015-06-05T22:56:42.165518 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'pqrs'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.165769 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.165911 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.166380 #97702] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'abcd' AND "users"."id" != 1) LIMIT 1
D, [2015-06-05T22:56:42.166831 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 1], ["rgt", 10], ["id", 1]]
D, [2015-06-05T22:56:42.167177 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:42.167627 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'abcd'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.167834 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.168154 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'tuvw' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T22:56:42.168285 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.168709 #97702] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'tuvw' AND "users"."id" != 6) LIMIT 1[0m
D, [2015-06-05T22:56:42.169143 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 11], ["rgt", 12], ["id", 6]]
D, [2015-06-05T22:56:42.169477 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:42.169927 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'tuvw'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.170137 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.170925 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:42.171302 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.171614 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.171893 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.172335 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T22:56:42.172731 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10)  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.173840 #97702] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'efgh')
D, [2015-06-05T22:56:42.174656 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 4) AND ("users"."rgt" >= 7) AND ("users"."uuid" != 'ijkh')[0m
D, [2015-06-05T22:56:42.175155 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'lmno')
D, [2015-06-05T22:56:42.175595 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 8) AND ("users"."rgt" >= 9) AND ("users"."uuid" != 'pqrs')[0m
D, [2015-06-05T22:56:42.175784 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.176681 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.177208 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:42.177581 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:42.177826 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.178193 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.178536 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:42.178734 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.179109 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.179553 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:42.180334 #97702] DEBUG -- :   [1m[35mUser Load (0.2ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10) AND ("users"."uuid" != 'abcd')  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.180913 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.181361 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.181857 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:42.182207 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:42.182603 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:42.182983 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:42.183396 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:42.183765 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:42.183974 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.184366 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.185375 #97702] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.185728 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:42.185985 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.186519 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ? WHERE "users"."id" = ?  [["lft", nil], ["id", 3]]
D, [2015-06-05T22:56:42.186918 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:42.187592 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= NULL) AND ("users"."rgt" >= 7) AND ("users"."uuid" != 'ijkh')
D, [2015-06-05T22:56:42.187984 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.188229 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.189014 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.189197 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.189587 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.190381 #97702] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:42.190729 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:42.190977 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.191481 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "rgt" = ? WHERE "users"."id" = ?[0m  [["rgt", nil], ["id", 3]]
D, [2015-06-05T22:56:42.191859 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:42.192442 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 4) AND ("users"."rgt" >= NULL) AND ("users"."uuid" != 'ijkh')[0m
D, [2015-06-05T22:56:42.192837 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.193083 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.193842 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:42.194002 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.194426 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.195227 #97702] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.195542 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:42.195826 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.196279 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ? WHERE "users"."id" = ?  [["lft", 12], ["id", 6]]
D, [2015-06-05T22:56:42.196646 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:42.197134 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'tuvw'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.197349 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.198082 #97702] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:42.198235 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.198597 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.199339 #97702] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.199659 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:42.199985 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:42.200195 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.200648 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ? WHERE "users"."id" = ?[0m  [["lft", 1], ["id", 3]]
D, [2015-06-05T22:56:42.201016 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:42.201594 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 1) AND ("users"."rgt" >= 7) AND ("users"."uuid" != 'ijkh')[0m
D, [2015-06-05T22:56:42.201991 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.202210 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.203017 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:42.203193 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.203612 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.204350 #97702] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.204680 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:42.205000 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:42.205211 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.205672 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "rgt" = ? WHERE "users"."id" = ?[0m  [["rgt", 10], ["id", 3]]
D, [2015-06-05T22:56:42.206070 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:42.206663 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 4) AND ("users"."rgt" >= 10) AND ("users"."uuid" != 'ijkh')[0m
D, [2015-06-05T22:56:42.207059 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.207302 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.208148 #97702] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:42.208314 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.208695 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.208981 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.209481 #97702] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '495f32ff016c9f7dbd951937c8516ac3' LIMIT 1
D, [2015-06-05T22:56:42.209914 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:42.210301 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T22:56:42.210778 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Test 1"], ["uuid", "495f32ff016c9f7dbd951937c8516ac3"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:42.211253 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:42.211794 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '495f32ff016c9f7dbd951937c8516ac3'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.212038 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.212268 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.212724 #97702] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'f75e3c9da9d27ef577ddc08be6f81a99' LIMIT 1
D, [2015-06-05T22:56:42.213168 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:42.213549 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:42.214224 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Test 2"], ["uuid", "f75e3c9da9d27ef577ddc08be6f81a99"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:42.214866 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:42.215470 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'f75e3c9da9d27ef577ddc08be6f81a99'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.215713 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.215959 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.216418 #97702] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'd5dbebcf44b1f07684b65c57c426dc6d' LIMIT 1
D, [2015-06-05T22:56:42.216850 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:42.217199 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:42.217627 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Test 3"], ["uuid", "d5dbebcf44b1f07684b65c57c426dc6d"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T22:56:42.218027 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:42.218492 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'd5dbebcf44b1f07684b65c57c426dc6d'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.218693 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.218926 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.219315 #97702] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '0426f10e4b2dd9ba5c294ac085c2ba77' LIMIT 1
D, [2015-06-05T22:56:42.219727 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:42.220051 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:42.220478 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Test 4"], ["uuid", "0426f10e4b2dd9ba5c294ac085c2ba77"], ["lft", 19], ["rgt", 20]]
D, [2015-06-05T22:56:42.220864 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T22:56:42.221330 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '0426f10e4b2dd9ba5c294ac085c2ba77'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.221532 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.221695 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.221969 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:42.222317 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:42.223163 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'f75e3c9da9d27ef577ddc08be6f81a99' THEN '495f32ff016c9f7dbd951937c8516ac3' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 14 AND 16 OR "users"."rgt" BETWEEN 14 AND 16)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.223281 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.223554 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:42.223787 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.224041 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:42.224749 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != 'f75e3c9da9d27ef577ddc08be6f81a99')[0m
D, [2015-06-05T22:56:42.225154 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'f75e3c9da9d27ef577ddc08be6f81a99'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.225298 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.225613 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:42.226468 #97702] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.226837 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.227178 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.227476 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.227818 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.228085 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:42.228440 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:42.229281 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 16 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 16 - 17 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'd5dbebcf44b1f07684b65c57c426dc6d' THEN '495f32ff016c9f7dbd951937c8516ac3' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 16 AND 18 OR "users"."rgt" BETWEEN 16 AND 18)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.229384 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.229690 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:42.229895 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.230155 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:42.230817 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != 'd5dbebcf44b1f07684b65c57c426dc6d')[0m
D, [2015-06-05T22:56:42.231206 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'd5dbebcf44b1f07684b65c57c426dc6d'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.231344 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.231648 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:42.232476 #97702] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.232859 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.233185 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.233483 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.233768 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.234058 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:42.234396 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 10]]
D, [2015-06-05T22:56:42.235251 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 15 AND 18 THEN "lft" + 20 - 18 WHEN "lft" BETWEEN 19 AND 20 THEN "lft" + 15 - 19 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 15 AND 18 THEN "rgt" + 20 - 18 WHEN "rgt" BETWEEN 19 AND 20 THEN "rgt" + 15 - 19 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '0426f10e4b2dd9ba5c294ac085c2ba77' THEN 'f75e3c9da9d27ef577ddc08be6f81a99' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 15 AND 20 OR "users"."rgt" BETWEEN 15 AND 20)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.235338 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.235655 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:42.235902 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.236139 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T22:56:42.236797 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 15) AND ("users"."rgt" >= 16) AND ("users"."uuid" != '0426f10e4b2dd9ba5c294ac085c2ba77')[0m
D, [2015-06-05T22:56:42.237188 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '0426f10e4b2dd9ba5c294ac085c2ba77'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.237329 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.237629 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 10]]
D, [2015-06-05T22:56:42.238486 #97702] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.238868 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.239191 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.239481 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.239762 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.240311 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.240660 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:42.240834 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.241222 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:42.241757 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  DELETE FROM "users" WHERE ("users"."lft" >= 4) AND ("users"."lft" < 7) AND ("users"."uuid" != 'ijkh')
D, [2015-06-05T22:56:42.242157 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "lft" = ("lft" - 4) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" > 7)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.242505 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "rgt" = ("rgt" - 4) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."rgt" > 7)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.242775 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:42.243236 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 3]]
D, [2015-06-05T22:56:42.243518 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "users" WHERE "users"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T22:56:42.243627 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.244398 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.244803 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.245140 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.245399 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.245669 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.246095 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.246438 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:42.246616 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.246962 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:42.247519 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."lft" >= 4) AND ("users"."lft" < 7) AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.247952 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?[0m  [["user_id", 4]]
D, [2015-06-05T22:56:42.248191 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  DELETE FROM "users" WHERE "users"."id" = ?  [["id", 4]]
D, [2015-06-05T22:56:42.248607 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "lft" = ("lft" - 4) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" > 7)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.248961 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "rgt" = ("rgt" - 4) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."rgt" > 7)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.249248 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:42.249575 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 3]]
D, [2015-06-05T22:56:42.249824 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "users" WHERE "users"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T22:56:42.249927 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.250680 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.251060 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.251377 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.251682 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.251975 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.252473 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.252845 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:42.253009 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.253374 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:42.253931 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."lft" >= 4) AND ("users"."lft" < 7) AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.254345 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?[0m  [["user_id", 4]]
D, [2015-06-05T22:56:42.254585 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  DELETE FROM "users" WHERE "users"."id" = ?  [["id", 4]]
D, [2015-06-05T22:56:42.255005 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "lft" = ("lft" - 4) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" > 7)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.255358 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "rgt" = ("rgt" - 4) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."rgt" > 7)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.255659 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:42.256005 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 3]]
D, [2015-06-05T22:56:42.256238 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "users" WHERE "users"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T22:56:42.256343 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.256457 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.256608 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.257362 #97702] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.257802 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.258143 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.258433 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.258705 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.259211 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.259549 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:42.259876 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.260378 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'f5e9a3713c4888dfcb3934b93f0dd55a' LIMIT 1[0m
D, [2015-06-05T22:56:42.260831 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:42.261185 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:42.261669 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "users" ("name", "parent_uuid", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?, ?)  [["name", "Child"], ["parent_uuid", "ijkh"], ["uuid", "f5e9a3713c4888dfcb3934b93f0dd55a"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:42.262163 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."lft" LIMIT 1[0m  [["uuid", "ijkh"]]
D, [2015-06-05T22:56:42.262499 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:42.263430 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 7 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 7 - 13 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'f5e9a3713c4888dfcb3934b93f0dd55a' THEN 'ijkh' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 7 AND 14 OR "users"."rgt" BETWEEN 7 AND 14)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.263732 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:42.264117 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:42.264808 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != 'f5e9a3713c4888dfcb3934b93f0dd55a')
D, [2015-06-05T22:56:42.265197 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'f5e9a3713c4888dfcb3934b93f0dd55a'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.265518 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:42.265909 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:42.266411 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != 'f5e9a3713c4888dfcb3934b93f0dd55a')
D, [2015-06-05T22:56:42.266793 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'f5e9a3713c4888dfcb3934b93f0dd55a'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.267015 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.267352 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1[0m  [["uuid", "ijkh"]]
D, [2015-06-05T22:56:42.268272 #97702] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:42.268687 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.269026 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.269306 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.269572 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.269972 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.270313 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:42.270672 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.271160 #97702] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '76799e0a5829a3c6278a15aa4dc3cdab' LIMIT 1
D, [2015-06-05T22:56:42.271689 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:42.272057 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T22:56:42.272511 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "users" ("name", "parent_uuid", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?, ?)[0m  [["name", "Child"], ["parent_uuid", "ijkh"], ["uuid", "76799e0a5829a3c6278a15aa4dc3cdab"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:42.272923 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."lft" LIMIT 1  [["uuid", "ijkh"]]
D, [2015-06-05T22:56:42.273288 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:42.274156 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 7 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 7 - 13 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '76799e0a5829a3c6278a15aa4dc3cdab' THEN 'ijkh' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 7 AND 14 OR "users"."rgt" BETWEEN 7 AND 14)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.274463 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:42.274857 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:42.275628 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != '76799e0a5829a3c6278a15aa4dc3cdab')[0m
D, [2015-06-05T22:56:42.276054 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '76799e0a5829a3c6278a15aa4dc3cdab'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.276414 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:42.276818 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:42.277353 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != '76799e0a5829a3c6278a15aa4dc3cdab')[0m
D, [2015-06-05T22:56:42.277758 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '76799e0a5829a3c6278a15aa4dc3cdab'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.277965 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.278272 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1  [["uuid", "ijkh"]]
D, [2015-06-05T22:56:42.279194 #97702] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.279579 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.279925 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.280236 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.280596 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.281150 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T22:56:42.281525 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.282116 #97702] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'f07c46a89fb399998410c807ad025bfa' LIMIT 1
D, [2015-06-05T22:56:42.282591 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:42.282978 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T22:56:42.283432 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "New Root"], ["uuid", "f07c46a89fb399998410c807ad025bfa"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:42.283833 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:42.284315 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'f07c46a89fb399998410c807ad025bfa'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.284547 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.285369 #97702] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.285748 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.286106 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.286410 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.286687 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.287084 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.287425 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:42.287717 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:42.287926 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.288416 #97702] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1
D, [2015-06-05T22:56:42.288959 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?[0m  [["parent_uuid", "pqrs"], ["id", 4]]
D, [2015-06-05T22:56:42.289392 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."lft" LIMIT 1  [["uuid", "pqrs"]]
D, [2015-06-05T22:56:42.289749 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 4]]
D, [2015-06-05T22:56:42.290660 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 5 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 5 - 7 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'lmno' THEN 'pqrs' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 5 AND 8 OR "users"."rgt" BETWEEN 5 AND 8)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.290977 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 5]]
D, [2015-06-05T22:56:42.291359 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:42.292054 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != 'lmno')[0m
D, [2015-06-05T22:56:42.292460 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'lmno'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.292826 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 4]]
D, [2015-06-05T22:56:42.293206 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:42.293719 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != 'lmno')[0m
D, [2015-06-05T22:56:42.294116 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'lmno'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.294324 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.294606 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:42.294972 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:42.295307 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1  [["uuid", "pqrs"]]
D, [2015-06-05T22:56:42.296190 #97702] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.296582 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.296913 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.297199 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.297465 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.297856 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.298186 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:42.298494 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:42.298726 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.299200 #97702] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1
D, [2015-06-05T22:56:42.299715 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?[0m  [["parent_uuid", "pqrs"], ["id", 4]]
D, [2015-06-05T22:56:42.300108 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."lft" LIMIT 1  [["uuid", "pqrs"]]
D, [2015-06-05T22:56:42.300454 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 4]]
D, [2015-06-05T22:56:42.301326 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 5 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 5 - 7 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'lmno' THEN 'pqrs' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 5 AND 8 OR "users"."rgt" BETWEEN 5 AND 8)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.301626 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 5]]
D, [2015-06-05T22:56:42.302037 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:42.302710 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != 'lmno')[0m
D, [2015-06-05T22:56:42.303108 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'lmno'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.303473 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 4]]
D, [2015-06-05T22:56:42.303852 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:42.304389 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != 'lmno')[0m
D, [2015-06-05T22:56:42.304776 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'lmno'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.304978 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.305265 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:42.305589 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:42.305943 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1  [["uuid", "pqrs"]]
D, [2015-06-05T22:56:42.306828 #97702] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.307218 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.307569 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.307854 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.308123 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.308535 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.308857 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:42.309079 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.309551 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1[0m
D, [2015-06-05T22:56:42.310023 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?  [["parent_uuid", nil], ["id", 4]]
D, [2015-06-05T22:56:42.310348 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:42.310709 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T22:56:42.311014 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT "users"."rgt" FROM "users"  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.311792 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 12 - 6 WHEN "lft" BETWEEN 7 AND 12 THEN "lft" + 5 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 12 - 6 WHEN "rgt" BETWEEN 7 AND 12 THEN "rgt" + 5 - 7 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'lmno' THEN NULL ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 5 AND 12 OR "users"."rgt" BETWEEN 5 AND 12)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.312104 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 4]]
D, [2015-06-05T22:56:42.312473 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:42.313010 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'lmno'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.313357 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T22:56:42.313731 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:42.314179 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'lmno'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.314390 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.315227 #97702] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:42.315641 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.316037 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.316368 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.316684 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.317116 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.317485 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:42.317989 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.318886 #97702] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '9e89d45af07a0154f8479d736b4c9e4e' LIMIT 1
D, [2015-06-05T22:56:42.319331 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:42.319705 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T22:56:42.320163 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "parent_uuid", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?, ?)[0m  [["name", "Child"], ["parent_uuid", "ijkh"], ["uuid", "9e89d45af07a0154f8479d736b4c9e4e"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:42.324217 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."lft" LIMIT 1  [["uuid", "ijkh"]]
D, [2015-06-05T22:56:42.324686 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:42.325638 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 7 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 7 - 13 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '9e89d45af07a0154f8479d736b4c9e4e' THEN 'ijkh' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 7 AND 14 OR "users"."rgt" BETWEEN 7 AND 14)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.325973 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:42.326344 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:42.327016 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != '9e89d45af07a0154f8479d736b4c9e4e')[0m
D, [2015-06-05T22:56:42.327392 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '9e89d45af07a0154f8479d736b4c9e4e'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.327717 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:42.328085 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:42.328591 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != '9e89d45af07a0154f8479d736b4c9e4e')[0m
D, [2015-06-05T22:56:42.328969 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '9e89d45af07a0154f8479d736b4c9e4e'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.329192 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.330398 #97702] DEBUG -- :   [1m[35m (0.3ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T22:56:42.330967 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.331342 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.331659 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.331964 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.332361 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.332764 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T22:56:42.333228 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10)  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.333998 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."name" = ? LIMIT 1  [["name", "Child 1"]]
D, [2015-06-05T22:56:42.334474 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.334936 #97702] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '8cc84134de268bf7ea6d64c98b3e4b9b' LIMIT 1
D, [2015-06-05T22:56:42.335373 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:42.335723 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T22:56:42.336170 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Child 1.1"], ["uuid", "8cc84134de268bf7ea6d64c98b3e4b9b"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:42.336562 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:42.337046 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '8cc84134de268bf7ea6d64c98b3e4b9b'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.337257 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.337361 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.337775 #97702] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'f4840845811708a741942cfc0f5128e3' LIMIT 1
D, [2015-06-05T22:56:42.338181 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:42.338513 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:42.338924 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Child 1.1.1"], ["uuid", "f4840845811708a741942cfc0f5128e3"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:42.339305 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:42.339753 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'f4840845811708a741942cfc0f5128e3'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.339953 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.340054 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.340461 #97702] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'd6844ca2beb901b070e1d5659b0b4ecd' LIMIT 1
D, [2015-06-05T22:56:42.340876 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:42.341233 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:42.341639 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Child 1.1.1.1"], ["uuid", "d6844ca2beb901b070e1d5659b0b4ecd"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T22:56:42.342024 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:42.342513 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'd6844ca2beb901b070e1d5659b0b4ecd'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.342732 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.342837 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.343271 #97702] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '90ec61d192d5a2b3be9391c23cf6f7a1' LIMIT 1
D, [2015-06-05T22:56:42.343701 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:42.344037 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:42.344431 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Child 1.2"], ["uuid", "90ec61d192d5a2b3be9391c23cf6f7a1"], ["lft", 19], ["rgt", 20]]
D, [2015-06-05T22:56:42.344821 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T22:56:42.345275 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '90ec61d192d5a2b3be9391c23cf6f7a1'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.345474 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.345599 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.345880 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:42.346221 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:42.347072 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 3 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 3 - 13 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '8cc84134de268bf7ea6d64c98b3e4b9b' THEN 'efgh' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 3 AND 14 OR "users"."rgt" BETWEEN 3 AND 14)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.347178 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.347449 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:42.347664 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.347925 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:42.348600 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 3) AND ("users"."rgt" >= 4) AND ("users"."uuid" != '8cc84134de268bf7ea6d64c98b3e4b9b')[0m
D, [2015-06-05T22:56:42.348984 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '8cc84134de268bf7ea6d64c98b3e4b9b'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.349116 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.349410 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:42.349586 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.349862 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T22:56:42.350190 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:42.351018 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 4 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 4 - 15 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'f4840845811708a741942cfc0f5128e3' THEN '8cc84134de268bf7ea6d64c98b3e4b9b' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 4 AND 16 OR "users"."rgt" BETWEEN 4 AND 16)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.351103 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.351407 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:42.351618 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.351910 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:42.352632 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 4) AND ("users"."rgt" >= 5) AND ("users"."uuid" != 'f4840845811708a741942cfc0f5128e3')[0m
D, [2015-06-05T22:56:42.353046 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 3 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'f4840845811708a741942cfc0f5128e3'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.353190 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.353502 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:42.353687 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.353952 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:42.354276 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:42.355093 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 5 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 5 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 5 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 5 - 17 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'd6844ca2beb901b070e1d5659b0b4ecd' THEN 'f4840845811708a741942cfc0f5128e3' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 5 AND 18 OR "users"."rgt" BETWEEN 5 AND 18)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.355199 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.355466 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T22:56:42.355692 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.355922 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:42.356538 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'd6844ca2beb901b070e1d5659b0b4ecd')[0m
D, [2015-06-05T22:56:42.356956 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 4 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'd6844ca2beb901b070e1d5659b0b4ecd'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.357091 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.357383 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:42.357573 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.357813 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:42.358142 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 10]]
D, [2015-06-05T22:56:42.358971 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 9 AND 18 THEN "lft" + 20 - 18 WHEN "lft" BETWEEN 19 AND 20 THEN "lft" + 9 - 19 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 9 AND 18 THEN "rgt" + 20 - 18 WHEN "rgt" BETWEEN 19 AND 20 THEN "rgt" + 9 - 19 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '90ec61d192d5a2b3be9391c23cf6f7a1' THEN 'efgh' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 9 AND 20 OR "users"."rgt" BETWEEN 9 AND 20)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.359076 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.359342 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:42.359553 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.359805 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T22:56:42.360410 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 9) AND ("users"."rgt" >= 10) AND ("users"."uuid" != '90ec61d192d5a2b3be9391c23cf6f7a1')[0m
D, [2015-06-05T22:56:42.360825 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '90ec61d192d5a2b3be9391c23cf6f7a1'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.360963 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.361250 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 10]]
D, [2015-06-05T22:56:42.361623 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:42.362030 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 18)  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.362493 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.363127 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.363496 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL[0m
D, [2015-06-05T22:56:42.364040 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.364429 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.364793 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.365294 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:42.365694 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:42.365885 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.366201 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.366512 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:42.367020 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE ("users"."lft" <= 8) AND ("users"."rgt" >= 9) AND "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T22:56:42.367322 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:42.367495 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.367794 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.368053 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.368299 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.368613 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:42.368945 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:42.369106 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.369372 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.369607 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE (rgt - lft = 1)
D, [2015-06-05T22:56:42.369984 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."rgt" - "users"."lft" = 1)  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.370424 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."rgt" - "users"."lft" = 1)
D, [2015-06-05T22:56:42.370757 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:42.371036 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."rgt" - "users"."lft" = 1)  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.371440 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:42.371679 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."rgt" - "users"."lft" = 1)  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.372091 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:42.372331 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."rgt" - "users"."lft" = 1)  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.372724 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:42.372986 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."rgt" - "users"."lft" = 1)  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.373200 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.373515 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.373815 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:42.374138 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:42.374432 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:42.374749 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:42.375057 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:42.375353 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:42.375621 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.375903 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.376186 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:42.376566 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1  [["uuid", "ijkh"]]
D, [2015-06-05T22:56:42.376849 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:42.377038 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.377302 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.377591 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:42.377889 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:42.378171 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:42.378567 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6)  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.378792 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.379062 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.379347 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:42.379632 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T22:56:42.379913 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:42.380356 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'lmno')  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.380537 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.380808 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.381111 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:42.381402 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:42.381679 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:42.382056 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd'  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.382445 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:42.382702 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:42.383034 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.383255 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.383543 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.383837 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:42.384122 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:42.384377 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:42.384793 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.384996 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.385266 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.385555 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:42.385848 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:42.386104 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:42.386395 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:42.386881 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10) AND ("users"."uuid" != 'abcd') AND ("users"."rgt" - "users"."lft" = 1)  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.387084 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.387470 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.387761 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:42.388079 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:42.388611 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'efgh')
D, [2015-06-05T22:56:42.388876 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:42.389349 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'lmno')
D, [2015-06-05T22:56:42.389500 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.389847 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.390145 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:42.390483 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1  [["uuid", "abcd"]]
D, [2015-06-05T22:56:42.390699 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.391048 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.391384 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.391926 #97702] DEBUG -- :   [1m[35mNoDepth Load (0.1ms)[0m  SELECT  "no_depths".* FROM "no_depths"  ORDER BY "no_depths"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:42.392270 #97702] DEBUG -- :   [1m[36mNoDepth Load (0.1ms)[0m  [1mSELECT  "no_depths".* FROM "no_depths"  ORDER BY "no_depths"."rgt" desc LIMIT 1[0m
D, [2015-06-05T22:56:42.392635 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "no_depths" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "shallow"], ["lft", 1], ["rgt", 2]]
D, [2015-06-05T22:56:42.392918 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.393221 #97702] DEBUG -- :   [1m[35mNoDepth Load (0.1ms)[0m  SELECT  "no_depths".* FROM "no_depths"  ORDER BY "no_depths"."id" ASC LIMIT 1
D, [2015-06-05T22:56:42.393380 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.393762 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.394585 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "no_depths"."id") FROM "no_depths" LEFT OUTER JOIN "no_depths" "parent" ON "parent"."id" = "no_depths"."parent_id" WHERE ((("no_depths"."lft" IS NULL OR "no_depths"."rgt" IS NULL) OR "no_depths"."lft" >= "no_depths"."rgt") OR "no_depths"."parent_id" IS NOT NULL AND ("no_depths"."lft" <= "parent"."lft" OR "no_depths"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.394978 #97702] DEBUG -- :   [1m[35mNoDepth Load (0.1ms)[0m  SELECT  "no_depths"."lft", COUNT("no_depths"."lft") as _count FROM "no_depths" GROUP BY "no_depths"."lft", "no_depths"."id" HAVING COUNT("no_depths"."lft") > 1  ORDER BY "no_depths"."id" LIMIT 1
D, [2015-06-05T22:56:42.395303 #97702] DEBUG -- :   [1m[36mNoDepth Load (0.1ms)[0m  [1mSELECT  "no_depths"."rgt", COUNT("no_depths"."rgt") as _count FROM "no_depths" GROUP BY "no_depths"."rgt", "no_depths"."id" HAVING COUNT("no_depths"."rgt") > 1  ORDER BY "no_depths"."id" LIMIT 1[0m
D, [2015-06-05T22:56:42.395579 #97702] DEBUG -- :   [1m[35mNoDepth Load (0.1ms)[0m  SELECT "no_depths".* FROM "no_depths" WHERE "no_depths"."parent_id" IS NULL  ORDER BY "no_depths"."lft"
D, [2015-06-05T22:56:42.395875 #97702] DEBUG -- :   [1m[36mNoDepth Load (0.1ms)[0m  [1mSELECT  "no_depths".* FROM "no_depths"  ORDER BY "no_depths"."id" ASC LIMIT 1[0m
D, [2015-06-05T22:56:42.396096 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.396769 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.397211 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.397899 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '59aa184b5472102c9a2d1f28d30d0b35' LIMIT 1[0m
D, [2015-06-05T22:56:42.398472 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:42.398957 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:42.399506 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "District Manager"], ["uuid", "59aa184b5472102c9a2d1f28d30d0b35"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:42.399981 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:42.400530 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '59aa184b5472102c9a2d1f28d30d0b35'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.400831 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.401063 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.401522 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '3222815ae97c592bc0e4a54498b48924' LIMIT 1[0m
D, [2015-06-05T22:56:42.401952 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:42.402308 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:42.402758 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "CEO"], ["uuid", "3222815ae97c592bc0e4a54498b48924"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:42.403181 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:42.403678 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '3222815ae97c592bc0e4a54498b48924'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.403887 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.404032 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.404327 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:42.404675 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:42.405582 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 15 - 14 WHEN "lft" BETWEEN 15 AND 15 THEN "lft" + 13 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 15 - 14 WHEN "rgt" BETWEEN 15 AND 15 THEN "rgt" + 13 - 15 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '59aa184b5472102c9a2d1f28d30d0b35' THEN '3222815ae97c592bc0e4a54498b48924' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 13 AND 15 OR "users"."rgt" BETWEEN 13 AND 15)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.405668 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.405973 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:42.406198 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.406514 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:42.407240 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '59aa184b5472102c9a2d1f28d30d0b35')
D, [2015-06-05T22:56:42.407629 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '59aa184b5472102c9a2d1f28d30d0b35'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.407762 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.408097 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:42.408375 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.408816 #97702] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'af715d845a53bd1d7de329d1f9d6458b' LIMIT 1[0m
D, [2015-06-05T22:56:42.409228 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:42.409572 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:42.409998 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Store Manager"], ["uuid", "af715d845a53bd1d7de329d1f9d6458b"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T22:56:42.410379 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:42.410835 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'af715d845a53bd1d7de329d1f9d6458b'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.411041 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.411164 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.411444 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:42.411775 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:42.412637 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 15 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 15 - 17 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'af715d845a53bd1d7de329d1f9d6458b' THEN '59aa184b5472102c9a2d1f28d30d0b35' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 15 AND 18 OR "users"."rgt" BETWEEN 15 AND 18)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.412739 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.413188 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:42.413507 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.413938 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:42.414749 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 15) AND ("users"."rgt" >= 16) AND ("users"."uuid" != 'af715d845a53bd1d7de329d1f9d6458b')
D, [2015-06-05T22:56:42.415187 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'af715d845a53bd1d7de329d1f9d6458b'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.415327 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.415647 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:42.415957 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.416404 #97702] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '842aa1ac8d197a24742b644bd52dcb1e' LIMIT 1[0m
D, [2015-06-05T22:56:42.416852 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:42.417181 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:42.417604 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Cashier"], ["uuid", "842aa1ac8d197a24742b644bd52dcb1e"], ["lft", 19], ["rgt", 20]]
D, [2015-06-05T22:56:42.417983 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 10]]
D, [2015-06-05T22:56:42.418475 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '842aa1ac8d197a24742b644bd52dcb1e'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.418682 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.418805 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.419078 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:42.419419 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 10]]
D, [2015-06-05T22:56:42.420253 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 18 THEN "lft" + 20 - 18 WHEN "lft" BETWEEN 19 AND 20 THEN "lft" + 16 - 19 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 18 THEN "rgt" + 20 - 18 WHEN "rgt" BETWEEN 19 AND 20 THEN "rgt" + 16 - 19 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '842aa1ac8d197a24742b644bd52dcb1e' THEN 'af715d845a53bd1d7de329d1f9d6458b' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 16 AND 20 OR "users"."rgt" BETWEEN 16 AND 20)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.420337 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.420625 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:42.420822 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.421106 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 10]]
D, [2015-06-05T22:56:42.421758 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '842aa1ac8d197a24742b644bd52dcb1e')
D, [2015-06-05T22:56:42.422149 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 3 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '842aa1ac8d197a24742b644bd52dcb1e'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.422305 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.422585 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 10]]
D, [2015-06-05T22:56:42.422929 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:42.423227 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:42.423514 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:42.423823 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 10]]
D, [2015-06-05T22:56:42.424082 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.424641 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.424903 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.425424 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'd1c90dd087524945054a8842b7cc3886' LIMIT 1[0m
D, [2015-06-05T22:56:42.425878 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:42.426255 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:42.426708 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "District Manager"], ["uuid", "d1c90dd087524945054a8842b7cc3886"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T22:56:42.427106 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:42.427565 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'd1c90dd087524945054a8842b7cc3886'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.427776 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.428010 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.428413 #97702] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '8318a0465c8b0697b71d59732952132c' LIMIT 1[0m
D, [2015-06-05T22:56:42.428835 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:42.429172 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:42.429601 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "CEO"], ["uuid", "8318a0465c8b0697b71d59732952132c"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T22:56:42.429986 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:42.430453 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '8318a0465c8b0697b71d59732952132c'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.430655 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.430779 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.431042 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:42.431379 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:42.432237 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 15 - 14 WHEN "lft" BETWEEN 15 AND 15 THEN "lft" + 13 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 15 - 14 WHEN "rgt" BETWEEN 15 AND 15 THEN "rgt" + 13 - 15 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'd1c90dd087524945054a8842b7cc3886' THEN '8318a0465c8b0697b71d59732952132c' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 13 AND 15 OR "users"."rgt" BETWEEN 13 AND 15)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.432346 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.432638 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:42.432871 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.433134 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:42.433751 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != 'd1c90dd087524945054a8842b7cc3886')
D, [2015-06-05T22:56:42.434135 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'd1c90dd087524945054a8842b7cc3886'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.434268 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.434568 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:42.434847 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.435285 #97702] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '3ca531e269213878cbc9df7462607ade' LIMIT 1[0m
D, [2015-06-05T22:56:42.435702 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:42.436027 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:42.436430 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Store Manager"], ["uuid", "3ca531e269213878cbc9df7462607ade"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T22:56:42.436815 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:42.437299 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '3ca531e269213878cbc9df7462607ade'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.437504 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.437633 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.437924 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:42.438253 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T22:56:42.439080 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 15 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 15 - 17 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '3ca531e269213878cbc9df7462607ade' THEN 'd1c90dd087524945054a8842b7cc3886' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 15 AND 18 OR "users"."rgt" BETWEEN 15 AND 18)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.439166 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.439463 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:42.439659 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.439934 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:42.440570 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 15) AND ("users"."rgt" >= 16) AND ("users"."uuid" != '3ca531e269213878cbc9df7462607ade')
D, [2015-06-05T22:56:42.440954 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '3ca531e269213878cbc9df7462607ade'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.441077 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.441367 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:42.441622 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.442055 #97702] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'df01570c2ea8698467131002c856e94b' LIMIT 1[0m
D, [2015-06-05T22:56:42.442480 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T22:56:42.442804 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:42.443255 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Cashier"], ["uuid", "df01570c2ea8698467131002c856e94b"], ["lft", 19], ["rgt", 20]]
D, [2015-06-05T22:56:42.443637 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 10]]
D, [2015-06-05T22:56:42.444104 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'df01570c2ea8698467131002c856e94b'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.444311 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.444435 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.444711 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T22:56:42.445053 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 10]]
D, [2015-06-05T22:56:42.445891 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 18 THEN "lft" + 20 - 18 WHEN "lft" BETWEEN 19 AND 20 THEN "lft" + 16 - 19 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 18 THEN "rgt" + 20 - 18 WHEN "rgt" BETWEEN 19 AND 20 THEN "rgt" + 16 - 19 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'df01570c2ea8698467131002c856e94b' THEN '3ca531e269213878cbc9df7462607ade' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 16 AND 20 OR "users"."rgt" BETWEEN 16 AND 20)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.445975 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.446265 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T22:56:42.446492 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.446728 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 10]]
D, [2015-06-05T22:56:42.447379 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != 'df01570c2ea8698467131002c856e94b')
D, [2015-06-05T22:56:42.447768 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 3 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'df01570c2ea8698467131002c856e94b'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.447889 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.448186 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 10]]
D, [2015-06-05T22:56:42.448511 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:42.448797 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:42.449117 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:42.449415 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 10]]
D, [2015-06-05T22:56:42.449613 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.449848 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T22:56:42.450176 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T22:56:42.451010 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 19 THEN "lft" + 20 - 19 WHEN "lft" BETWEEN 20 AND 20 THEN "lft" + 14 - 20 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 19 THEN "rgt" + 20 - 19 WHEN "rgt" BETWEEN 20 AND 20 THEN "rgt" + 14 - 20 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'd1c90dd087524945054a8842b7cc3886' THEN NULL ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 14 AND 20 OR "users"."rgt" BETWEEN 14 AND 20)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.451095 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.451396 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T22:56:42.451621 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.451857 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:42.452390 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'd1c90dd087524945054a8842b7cc3886'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.452871 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = "depth" - 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" >= 15) AND ("users"."lft" < 20) AND ("users"."uuid" != 'd1c90dd087524945054a8842b7cc3886')  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.452953 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.453249 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T22:56:42.453576 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T22:56:42.453885 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T22:56:42.454164 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T22:56:42.454495 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 10]]
D, [2015-06-05T22:56:42.454766 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.455366 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.455697 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:42.455996 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:42.456688 #97702] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1  [["parent_uuid", "pqrs"]]
D, [2015-06-05T22:56:42.456819 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.457094 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:42.457431 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T22:56:42.458305 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 8 - 3 WHEN "lft" BETWEEN 4 AND 8 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 8 - 3 WHEN "rgt" BETWEEN 4 AND 8 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'efgh' THEN 'pqrs' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 2 AND 8 OR "users"."rgt" BETWEEN 2 AND 8)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.458393 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.458680 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 5]]
D, [2015-06-05T22:56:42.458885 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.459143 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:42.460362 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != 'efgh')[0m
D, [2015-06-05T22:56:42.461048 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'efgh'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.461293 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.461811 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:42.463426 #97702] DEBUG -- :   [1m[36m (0.3ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T22:56:42.464391 #97702] DEBUG -- :   [1m[35mUser Load (0.3ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T22:56:42.465071 #97702] DEBUG -- :   [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T22:56:42.465601 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T22:56:42.466025 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.466581 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T22:56:42.467138 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:42.467639 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:42.468606 #97702] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-05T22:56:42.469222 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?  [["parent_uuid", "ijkh"]]
D, [2015-06-05T22:56:42.469830 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft"[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-05T22:56:42.470518 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.471086 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:42.471631 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:42.473001 #97702] DEBUG -- :   [1m[36mSQL (0.3ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 4 - 3 WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 4 - 3 WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'efgh' THEN 'ijkh' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 2 AND 4 OR "users"."rgt" BETWEEN 2 AND 4)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.473133 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.473671 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 4]]
D, [2015-06-05T22:56:42.474019 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.474371 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T22:56:42.475123 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 3) AND ("users"."rgt" >= 4) AND ("users"."uuid" != 'efgh')
D, [2015-06-05T22:56:42.475558 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'efgh'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.475692 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.476009 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T22:56:42.476367 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:42.476700 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:42.476916 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.477264 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.477557 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:42.477886 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:42.478559 #97702] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1  [["parent_uuid", "ijkh"]]
D, [2015-06-05T22:56:42.478938 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-05T22:56:42.479293 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft" DESC LIMIT 1  [["parent_uuid", "ijkh"]]
D, [2015-06-05T22:56:42.479488 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.479771 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T22:56:42.480096 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T22:56:42.480945 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 6 - 3 WHEN "lft" BETWEEN 4 AND 6 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 6 - 3 WHEN "rgt" BETWEEN 4 AND 6 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'efgh' THEN 'ijkh' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 2 AND 6 OR "users"."rgt" BETWEEN 2 AND 6)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.481032 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.481311 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T22:56:42.481522 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.481768 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T22:56:42.482379 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'efgh')[0m
D, [2015-06-05T22:56:42.482779 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'efgh'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.482931 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.483252 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:42.483599 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T22:56:42.483927 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:42.484146 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.484580 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.484934 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:42.485425 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.485753 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T22:56:42.486123 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:42.486502 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT "users"."rgt" FROM "users"  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.487323 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 12 - 7 WHEN "lft" BETWEEN 8 AND 12 THEN "lft" + 4 - 8 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 12 - 7 WHEN "rgt" BETWEEN 8 AND 12 THEN "rgt" + 4 - 8 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'ijkh' THEN NULL ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 4 AND 12 OR "users"."rgt" BETWEEN 4 AND 12)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.487417 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.487740 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:42.487993 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.488266 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T22:56:42.488877 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.489042 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.489368 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T22:56:42.489642 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.489995 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.490344 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T22:56:42.490701 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.491086 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.491529 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:42.491808 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.492361 #97702] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'pqrs' AND "users"."id" != 5) LIMIT 1[0m
D, [2015-06-05T22:56:42.492877 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?  [["parent_uuid", nil], ["id", 5]]
D, [2015-06-05T22:56:42.493281 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T22:56:42.493816 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'pqrs'  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.494075 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.494254 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.494749 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.495330 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T22:56:42.495912 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10)  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.496450 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.496827 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.497310 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T22:56:42.497768 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10)  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.498437 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.498843 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.499285 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T22:56:42.499462 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.499861 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T22:56:42.500444 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10) AND ("users"."uuid" != 'abcd')  ORDER BY "users"."lft"[0m
D, [2015-06-05T22:56:42.501055 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 2]]
D, [2015-06-05T22:56:42.501379 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "users" WHERE "users"."id" = ?[0m  [["id", 2]]
D, [2015-06-05T22:56:42.501778 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 3]]
D, [2015-06-05T22:56:42.502008 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "users" WHERE "users"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T22:56:42.502336 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 4]]
D, [2015-06-05T22:56:42.502564 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "users" WHERE "users"."id" = ?[0m  [["id", 4]]
D, [2015-06-05T22:56:42.502874 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 5]]
D, [2015-06-05T22:56:42.503103 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "users" WHERE "users"."id" = ?[0m  [["id", 5]]
D, [2015-06-05T22:56:42.503568 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "lft" = ("lft" - 10) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" > 10)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.503921 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "rgt" = ("rgt" - 10) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."rgt" > 10)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.504225 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:42.504621 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?[0m  [["user_id", 1]]
D, [2015-06-05T22:56:42.505264 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T22:56:42.505962 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" >= 1) AND ("notes"."lft" < 10) AND ("notes"."id" != 1)[0m  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T22:56:42.506437 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "lft" = ("lft" - 10) WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" > 10)  ORDER BY "notes"."lft")  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T22:56:42.506898 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "rgt" = ("rgt" - 10) WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."rgt" > 10)  ORDER BY "notes"."lft")[0m  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T22:56:42.507161 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:42.507458 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 1]]
D, [2015-06-05T22:56:42.507810 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:42.508058 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 2]]
D, [2015-06-05T22:56:42.508361 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:42.508586 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T22:56:42.508898 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T22:56:42.509124 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 4]]
D, [2015-06-05T22:56:42.509420 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  DELETE FROM "users" WHERE "users"."id" = ?  [["id", 1]]
D, [2015-06-05T22:56:42.509551 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.510069 #97702] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."uuid" = ?  [["uuid", "abcd"]]
D, [2015-06-05T22:56:42.510424 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?[0m  [["parent_uuid", "abcd"]]
D, [2015-06-05T22:56:42.510582 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.511489 #97702] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.512024 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T22:56:42.512249 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.512679 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T22:56:42.513268 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mDELETE FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10) AND ("users"."uuid" != 'abcd')[0m
D, [2015-06-05T22:56:42.513796 #97702] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = ("lft" - 10) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" > 10)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.514375 #97702] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "rgt" = ("rgt" - 10) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."rgt" > 10)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.514778 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:42.515253 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?[0m  [["user_id", 1]]
D, [2015-06-05T22:56:42.515892 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T22:56:42.516584 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" >= 1) AND ("notes"."lft" < 10) AND ("notes"."id" != 1)[0m  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T22:56:42.517065 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "lft" = ("lft" - 10) WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" > 10)  ORDER BY "notes"."lft")  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T22:56:42.517505 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "rgt" = ("rgt" - 10) WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."rgt" > 10)  ORDER BY "notes"."lft")[0m  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T22:56:42.517787 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T22:56:42.518064 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 1]]
D, [2015-06-05T22:56:42.518427 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T22:56:42.518654 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 2]]
D, [2015-06-05T22:56:42.518967 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T22:56:42.519190 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T22:56:42.519487 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T22:56:42.519702 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 4]]
D, [2015-06-05T22:56:42.519998 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  DELETE FROM "users" WHERE "users"."id" = ?  [["id", 1]]
D, [2015-06-05T22:56:42.520128 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.520580 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."uuid" = ?  [["uuid", "abcd"]]
D, [2015-06-05T22:56:42.520910 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?[0m  [["parent_uuid", "abcd"]]
D, [2015-06-05T22:56:42.521070 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.521740 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.522210 #97702] DEBUG -- :   [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T22:56:42.522446 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.522873 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T22:56:42.523167 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.523532 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T22:56:42.523851 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T22:56:42.524185 #97702] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."id" DESC LIMIT 1
D, [2015-06-05T22:56:42.524349 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.524708 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T22:56:42.525302 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "lft" = ("lft" - 2) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" > 12)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.525652 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "rgt" = ("rgt" - 2) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."rgt" > 12)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.525990 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T22:56:42.526522 #97702] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 6]]
D, [2015-06-05T22:56:42.526901 #97702] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "users" WHERE "users"."id" = ?[0m  [["id", 6]]
D, [2015-06-05T22:56:42.527032 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.527231 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.527773 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.528248 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1[0m
D, [2015-06-05T22:56:42.528435 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.528851 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T22:56:42.529830 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.530147 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T22:56:42.530479 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T22:56:42.530817 #97702] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."id" DESC LIMIT 1[0m
D, [2015-06-05T22:56:42.530977 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T22:56:42.531345 #97702] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T22:56:42.531913 #97702] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "lft" = ("lft" - 2) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" > 12)  ORDER BY "users"."lft")
D, [2015-06-05T22:56:42.532260 #97702] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "rgt" = ("rgt" - 2) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."rgt" > 12)  ORDER BY "users"."lft")[0m
D, [2015-06-05T22:56:42.532516 #97702] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T22:56:42.532921 #97702] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?[0m  [["user_id", 6]]
D, [2015-06-05T22:56:42.533171 #97702] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  DELETE FROM "users" WHERE "users"."id" = ?  [["id", 6]]
D, [2015-06-05T22:56:42.533293 #97702] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T22:56:42.533441 #97702] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:25.378463 #98308] DEBUG -- :   [1m[36m (0.3ms)[0m  [1mCREATE TABLE "default_scoped_models" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-05T23:19:25.378907 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "categories" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-05T23:19:25.379245 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "departments" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar) [0m
D, [2015-06-05T23:19:25.379669 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "notes" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "notable_id" integer, "notable_type" varchar, "user_id" integer) 
D, [2015-06-05T23:19:25.380035 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "renamed_columns" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "mother_id" integer, "red" integer, "black" integer, "pitch" integer) [0m
D, [2015-06-05T23:19:25.380411 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "things" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "children_count" integer) 
D, [2015-06-05T23:19:25.380756 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "brokens" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-05T23:19:25.381104 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "orders" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) 
D, [2015-06-05T23:19:25.381464 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "positions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "position" integer) [0m
D, [2015-06-05T23:19:25.381827 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "no_depths" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) 
D, [2015-06-05T23:19:25.382193 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "single_table_inheritance" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "type" varchar, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) [0m
D, [2015-06-05T23:19:25.382562 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uuid" varchar, "name" varchar, "parent_uuid" varchar, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-05T23:19:25.401440 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL) [0m
D, [2015-06-05T23:19:25.401608 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  select sqlite_version(*)
D, [2015-06-05T23:19:25.401929 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
D, [2015-06-05T23:19:25.402061 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT version FROM "schema_migrations"
D, [2015-06-05T23:19:25.402172 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('0')[0m
D, [2015-06-05T23:19:25.781526 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T23:19:25.784010 #98308] DEBUG -- :   [1m[36mFixture Delete (0.1ms)[0m  [1mDELETE FROM "categories"[0m
D, [2015-06-05T23:19:25.785425 #98308] DEBUG -- :   [1m[35mFixture Insert (0.1ms)[0m  INSERT INTO "categories" ("id", "name", "lft", "rgt") VALUES (1, 'Top Level', 1, 10)
D, [2015-06-05T23:19:25.785561 #98308] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (2, 'Child 1', 1, 2, 3)[0m
D, [2015-06-05T23:19:25.785676 #98308] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (3, 'Child 2', 1, 4, 7)
D, [2015-06-05T23:19:25.785783 #98308] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (4, 'Child 2.1', 3, 5, 6)[0m
D, [2015-06-05T23:19:25.785944 #98308] DEBUG -- :   [1m[35mFixture Insert (0.1ms)[0m  INSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (5, 'Child 3', 1, 8, 9)
D, [2015-06-05T23:19:25.786049 #98308] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "categories" ("id", "name", "lft", "rgt") VALUES (6, 'Top Level 2', 11, 12)[0m
D, [2015-06-05T23:19:25.786131 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  commit transaction
D, [2015-06-05T23:19:25.786251 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:25.787016 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:25.792934 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:25.799988 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 11) AND ("categories"."lft" < 12)  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:25.800803 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.801254 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T23:19:25.804012 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:25.804480 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:25.804954 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:25.805632 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 11) AND ("categories"."lft" < 12)  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:25.805888 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.806287 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:25.806608 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:25.806999 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:25.807562 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 11) AND ("categories"."lft" < 12)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:25.807765 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:25.808066 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:25.808380 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:25.808707 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:25.809089 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:25.809696 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 11) AND ("categories"."lft" < 12)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:25.809942 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:25.810258 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:25.810603 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:25.810963 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:25.811565 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 11) AND ("categories"."lft" < 12)  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:25.812521 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.812907 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:25.813298 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:25.813667 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:25.814030 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:25.814649 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 11) AND ("categories"."lft" < 12)  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:25.814963 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.819656 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:25.819814 #98308] DEBUG -- :   [1m[36mFixture Delete (0.0ms)[0m  [1mDELETE FROM "departments"[0m
D, [2015-06-05T23:19:25.820034 #98308] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "departments" ("id", "name") VALUES (1, 'Top')
D, [2015-06-05T23:19:25.820638 #98308] DEBUG -- :   [1m[36mFixture Delete (0.0ms)[0m  [1mDELETE FROM "notes"[0m
D, [2015-06-05T23:19:25.820779 #98308] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "notes" ("id", "body", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (1, 'Top Level', 1, 10, 1, 'Category', 1)
D, [2015-06-05T23:19:25.820905 #98308] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "notes" ("id", "body", "parent_id", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (2, 'Child 1', 1, 2, 3, 1, 'Category', 1)[0m
D, [2015-06-05T23:19:25.821053 #98308] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "notes" ("id", "body", "parent_id", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (3, 'Child 2', 1, 4, 7, 1, 'Category', 1)
D, [2015-06-05T23:19:25.821174 #98308] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "notes" ("id", "body", "parent_id", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (4, 'Child 3', 1, 8, 9, 1, 'Category', 1)[0m
D, [2015-06-05T23:19:25.821283 #98308] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "notes" ("id", "body", "lft", "rgt", "notable_id", "notable_type") VALUES (5, 'Top Level 2', 1, 2, 1, 'Departments')
D, [2015-06-05T23:19:25.821764 #98308] DEBUG -- :   [1m[36mFixture Delete (0.0ms)[0m  [1mDELETE FROM "things"[0m
D, [2015-06-05T23:19:25.821891 #98308] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "things" ("id", "body", "lft", "rgt", "children_count") VALUES (1, 'Top Level', 1, 10, 2)
D, [2015-06-05T23:19:25.822007 #98308] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "things" ("id", "body", "parent_id", "lft", "rgt", "children_count") VALUES (2, 'Child 1', 1, 2, 3, 0)[0m
D, [2015-06-05T23:19:25.822150 #98308] DEBUG -- :   [1m[35mFixture Insert (0.1ms)[0m  INSERT INTO "things" ("id", "body", "parent_id", "lft", "rgt", "children_count") VALUES (3, 'Child 2', 1, 4, 7, 0)
D, [2015-06-05T23:19:25.822262 #98308] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "things" ("id", "body", "parent_id", "lft", "rgt", "children_count") VALUES (4, 'Child 2.1', 3, 8, 9, 0)[0m
D, [2015-06-05T23:19:25.822701 #98308] DEBUG -- :   [1m[35mFixture Delete (0.0ms)[0m  DELETE FROM "brokens"
D, [2015-06-05T23:19:25.822809 #98308] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "brokens" ("id", "name") VALUES (1, 'One')[0m
D, [2015-06-05T23:19:25.823308 #98308] DEBUG -- :   [1m[35mFixture Delete (0.0ms)[0m  DELETE FROM "users"
D, [2015-06-05T23:19:25.823438 #98308] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "users" ("id", "uuid", "name", "lft", "rgt") VALUES (1, 'abcd', 'Top Level', 1, 10)[0m
D, [2015-06-05T23:19:25.823550 #98308] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (2, 'efgh', 'Child 1', 'abcd', 2, 3)
D, [2015-06-05T23:19:25.823690 #98308] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (3, 'ijkh', 'Child 2', 'abcd', 4, 7)[0m
D, [2015-06-05T23:19:25.823798 #98308] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (4, 'lmno', 'Child 2.1', 'ijkh', 5, 6)
D, [2015-06-05T23:19:25.823908 #98308] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (5, 'pqrs', 'Child 3', 'abcd', 8, 9)[0m
D, [2015-06-05T23:19:25.824010 #98308] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "users" ("id", "uuid", "name", "lft", "rgt") VALUES (6, 'tuvw', 'Top Level 2', 11, 12)
D, [2015-06-05T23:19:25.824468 #98308] DEBUG -- :   [1m[36mFixture Delete (0.0ms)[0m  [1mDELETE FROM "default_scoped_models"[0m
D, [2015-06-05T23:19:25.824586 #98308] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "default_scoped_models" ("id", "name", "lft", "rgt") VALUES (1, 'Top Level', 1, 4)
D, [2015-06-05T23:19:25.824706 #98308] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "default_scoped_models" ("id", "name", "parent_id", "lft", "rgt") VALUES (2, 'Child 1', 1, 2, 3)[0m
D, [2015-06-05T23:19:25.824837 #98308] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "default_scoped_models" ("id", "name", "lft", "rgt") VALUES (6, 'Top Level 2', 5, 6)
D, [2015-06-05T23:19:25.824939 #98308] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "default_scoped_models" ("id", "name", "lft", "rgt") VALUES (7, 'Top Level 3', 7, 8)[0m
D, [2015-06-05T23:19:25.825018 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  commit transaction
D, [2015-06-05T23:19:25.825140 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:25.828994 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:25.831010 #98308] DEBUG -- :   [1m[36mRenamedColumns Load (0.1ms)[0m  [1mSELECT  "renamed_columns".* FROM "renamed_columns"  ORDER BY "renamed_columns"."black" desc LIMIT 1[0m
D, [2015-06-05T23:19:25.831421 #98308] DEBUG -- :   [1m[35mRenamedColumns Load (0.1ms)[0m  SELECT  "renamed_columns".* FROM "renamed_columns"  ORDER BY "renamed_columns"."black" desc LIMIT 1
D, [2015-06-05T23:19:25.831855 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "renamed_columns" ("red", "black") VALUES (?, ?)[0m  [["red", 1], ["black", 2]]
D, [2015-06-05T23:19:25.832450 #98308] DEBUG -- :   [1m[35mRenamedColumns Load (0.1ms)[0m  SELECT  "renamed_columns".* FROM "renamed_columns" WHERE "renamed_columns"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:25.833112 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "renamed_columns" SET "pitch" = 0 WHERE "renamed_columns"."id" IN (SELECT "renamed_columns"."id" FROM "renamed_columns" WHERE "renamed_columns"."id" = 1  ORDER BY "renamed_columns"."red")[0m
D, [2015-06-05T23:19:25.833345 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:25.833508 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.833954 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T23:19:25.836624 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.837420 #98308] DEBUG -- :   [1m[35mBroken Load (0.1ms)[0m  SELECT  "brokens".* FROM "brokens"  ORDER BY "brokens"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:25.838316 #98308] DEBUG -- :   [1m[36mBroken Load (0.1ms)[0m  [1mSELECT  "brokens".* FROM "brokens" WHERE "brokens"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T23:19:25.838828 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "brokens" ("lft", "rgt") VALUES (?, ?)  [["lft", 1], ["rgt", 2]]
D, [2015-06-05T23:19:25.839428 #98308] DEBUG -- :   [1m[36mBroken Load (0.1ms)[0m  [1mSELECT  "brokens".* FROM "brokens" WHERE "brokens"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:25.840026 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "brokens" SET "depth" = 0 WHERE "brokens"."id" IN (SELECT "brokens"."id" FROM "brokens" WHERE "brokens"."id" = 2  ORDER BY "brokens"."lft")
D, [2015-06-05T23:19:25.840238 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.840442 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-05T23:19:25.840860 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:25.841265 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:25.847615 #98308] DEBUG -- :   [1m[36mCategory Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1[0m  [["parent_id", 4]]
D, [2015-06-05T23:19:25.848022 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:25.848812 #98308] DEBUG -- :   [1m[36mCategory Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1[0m  [["parent_id", 3]]
D, [2015-06-05T23:19:25.849087 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:25.849630 #98308] DEBUG -- :   [1m[36mCategory Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1[0m  [["parent_id", 1]]
D, [2015-06-05T23:19:25.849786 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:25.850195 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:25.850799 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:25.851260 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:25.851570 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:25.851871 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:25.852140 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:25.852649 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:25.853361 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)
D, [2015-06-05T23:19:25.853531 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.853899 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:25.854292 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.854916 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:25.855326 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:25.855860 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "lawyers"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:25.856381 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:25.856932 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:25.857176 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.857354 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:25.857799 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:25.858130 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:25.858500 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "United States"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:25.858874 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:25.859306 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:25.859501 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:25.859628 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.859896 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:25.860227 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:25.861829 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 8 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 16 OR "categories"."rgt" BETWEEN 14 AND 16)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:25.861933 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.862371 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:25.862618 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.862895 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:25.863942 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)[0m
D, [2015-06-05T23:19:25.864373 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:25.864512 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.864820 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:25.865070 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.865559 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:25.865848 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:25.866259 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Patent Law"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T23:19:25.866624 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:25.867070 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:25.867275 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.867397 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:25.867686 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:25.867992 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:25.868799 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 15 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 15 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 15 AND 18 OR "categories"."rgt" BETWEEN 15 AND 18)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:25.868883 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:25.869148 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:25.869363 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:25.869599 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:25.870236 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 15) AND ("categories"."rgt" >= 16) AND ("categories"."id" != 9)
D, [2015-06-05T23:19:25.870612 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:25.870741 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:25.871017 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:25.871324 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:25.872035 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 7]]
D, [2015-06-05T23:19:25.872594 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?  [["parent_id", 8]]
D, [2015-06-05T23:19:25.873225 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" >= 13) AND ("categories"."lft" < 18) AND ("categories"."id" != 7)[0m
D, [2015-06-05T23:19:25.873389 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:25.873923 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:25.874247 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:25.874569 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:25.874834 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:25.875078 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:25.875463 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:25.876049 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10) AND ("categories"."id" != 1)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:25.876288 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:25.876598 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:25.876932 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:25.877577 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft"[0m  [["parent_id", 1]]
D, [2015-06-05T23:19:25.877857 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:25.878167 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:25.878469 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:25.879018 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3) AND ("categories"."lft" < 4)  ORDER BY "categories"."lft" DESC LIMIT 1[0m
D, [2015-06-05T23:19:25.879203 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:25.879492 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:25.879796 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:25.880691 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 7 - 3 WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 7 - 3 WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 3 THEN 1 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 2 AND 7 OR "categories"."rgt" BETWEEN 2 AND 7)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:25.880783 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:25.881064 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T23:19:25.881282 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:25.881506 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:25.882119 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 2) AND ("categories"."rgt" >= 5) AND ("categories"."id" != 3)
D, [2015-06-05T23:19:25.882486 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:25.882967 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = "depth" + 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" >= 2) AND ("categories"."lft" < 5) AND ("categories"."id" != 3)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:25.883050 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.883330 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:25.883603 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:25.884473 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft"  [["parent_id", 1]]
D, [2015-06-05T23:19:25.885125 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:25.885592 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:25.885925 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.886271 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:25.886617 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:25.886881 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:25.887209 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:25.887528 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:25.887756 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.888064 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:25.888326 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:25.888602 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:25.888907 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:25.889168 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:25.889373 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.889658 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:25.890199 #98308] DEBUG -- :   [1m[36mScopedCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:25.893606 #98308] DEBUG -- :   [1m[35mScopedCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft" LIMIT 1  [["parent_id", 1]]
D, [2015-06-05T23:19:25.894186 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.895296 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "organization_id" = ? WHERE "categories"."id" = ?  [["organization_id", 999999999], ["id", 2]]
D, [2015-06-05T23:19:25.896000 #98308] DEBUG -- :   [1m[36mScopedCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:25.896716 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE "categories"."organization_id" = ? AND ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 2)  [["organization_id", 999999999]]
D, [2015-06-05T23:19:25.897305 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."organization_id" = ? AND "categories"."id" = 2  ORDER BY "categories"."lft")[0m  [["organization_id", 999999999]]
D, [2015-06-05T23:19:25.897544 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:25.897780 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.898196 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:25.899005 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:25.899452 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:25.899844 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:25.900226 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:25.900614 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.901239 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T23:19:25.901887 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:25.902550 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:25.903156 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:25.903510 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:25.903795 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.904267 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T23:19:25.904881 #98308] DEBUG -- :   [1m[36mScopedCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:25.905710 #98308] DEBUG -- :   [1m[35mScopedCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft" LIMIT 1  [["parent_id", 1]]
D, [2015-06-05T23:19:25.906235 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.907099 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "organization_id" = ? WHERE "categories"."id" = ?  [["organization_id", 999999999], ["id", 2]]
D, [2015-06-05T23:19:25.907800 #98308] DEBUG -- :   [1m[36mScopedCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:25.908881 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "categories" WHERE "categories"."organization_id" = ? AND ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 2)  [["organization_id", 999999999]]
D, [2015-06-05T23:19:25.909398 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."organization_id" = ? AND "categories"."id" = 2  ORDER BY "categories"."lft")[0m  [["organization_id", 999999999]]
D, [2015-06-05T23:19:25.909690 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:25.909903 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.910331 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:25.910838 #98308] DEBUG -- :   [1m[36mScopedCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:25.912080 #98308] DEBUG -- :   [1m[35mScopedCategory Load (0.2ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft" LIMIT 1  [["parent_id", 1]]
D, [2015-06-05T23:19:25.912459 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.913030 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "organization_id" = ? WHERE "categories"."id" = ?  [["organization_id", 999999999], ["id", 2]]
D, [2015-06-05T23:19:25.913503 #98308] DEBUG -- :   [1m[36mScopedCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:25.914154 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "categories" WHERE "categories"."organization_id" = ? AND ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 2)  [["organization_id", 999999999]]
D, [2015-06-05T23:19:25.914610 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."organization_id" = ? AND "categories"."id" = 2  ORDER BY "categories"."lft")[0m  [["organization_id", 999999999]]
D, [2015-06-05T23:19:25.914874 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:25.915073 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.915523 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:25.916003 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:25.916361 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:25.917127 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3) AND ("categories"."lft" < 4)  ORDER BY "categories"."lft" DESC LIMIT 1[0m
D, [2015-06-05T23:19:25.917652 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:25.918704 #98308] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 5) AND ("categories"."lft" < 8)  ORDER BY "categories"."lft" DESC LIMIT 1[0m
D, [2015-06-05T23:19:25.919021 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-05T23:19:25.919533 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:25.920130 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:25.920867 #98308] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL AND ("categories"."id" != 1) AND ("categories"."lft" < 1)  ORDER BY "categories"."lft" DESC LIMIT 1[0m
D, [2015-06-05T23:19:25.921106 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:25.921484 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:25.921974 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:25.922640 #98308] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 3 AND ("categories"."id" != 4) AND ("categories"."lft" < 5)  ORDER BY "categories"."lft" DESC LIMIT 1[0m
D, [2015-06-05T23:19:25.922889 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:25.930813 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:25.931464 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:25.932550 #98308] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 2) AND ("categories"."lft" < 2)  ORDER BY "categories"."lft" DESC LIMIT 1[0m
D, [2015-06-05T23:19:25.932913 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-05T23:19:25.933373 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:25.934040 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:25.934547 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:25.935506 #98308] DEBUG -- :   [1m[35mCategory Load (0.2ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3) AND ("categories"."lft" >= 4)  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T23:19:25.936169 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:25.936993 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 2) AND ("categories"."lft" >= 2)  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T23:19:25.937272 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.937784 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T23:19:25.938284 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:25.938821 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:25.939748 #98308] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL AND ("categories"."id" != 1) AND ("categories"."lft" >= 1)  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:25.940680 #98308] DEBUG -- :   [1m[35mCategory Load (0.2ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL AND ("categories"."id" != 6) AND ("categories"."lft" >= 11)  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T23:19:25.940976 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.941404 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T23:19:25.941996 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:25.942832 #98308] DEBUG -- :   [1m[35mCategory Load (0.2ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 3 AND ("categories"."id" != 4) AND ("categories"."lft" >= 5)  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T23:19:25.943049 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.943476 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:25.944030 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:25.944819 #98308] DEBUG -- :   [1m[35mCategory Load (0.2ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 5) AND ("categories"."lft" >= 8)  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T23:19:25.945066 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.945534 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T23:19:25.946017 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:25.946892 #98308] DEBUG -- :   [1m[35mCategory Load (0.2ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3) AND ("categories"."lft" < 4)  ORDER BY "categories"."lft" DESC LIMIT 1
D, [2015-06-05T23:19:25.947143 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.947509 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:25.948094 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:25.949267 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 7 - 3 WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 7 - 3 WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 3 THEN 1 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 2 AND 7 OR "categories"."rgt" BETWEEN 2 AND 7)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:25.949375 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.949894 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:25.950244 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.950558 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:25.951535 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 2) AND ("categories"."rgt" >= 5) AND ("categories"."id" != 3)[0m
D, [2015-06-05T23:19:25.952128 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:25.952942 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "depth" = "depth" + 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" >= 2) AND ("categories"."lft" < 5) AND ("categories"."id" != 3)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:25.953057 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:25.953659 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:25.954597 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3) AND ("categories"."lft" < 2)  ORDER BY "categories"."lft" DESC LIMIT 1
D, [2015-06-05T23:19:25.954953 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:25.955466 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3) AND ("categories"."lft" >= 2)  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T23:19:25.957101 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:25.958255 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:25.958783 #98308] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:25.959116 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:25.959382 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.960011 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T23:19:25.960484 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:25.961217 #98308] DEBUG -- :   [1m[35mCategory Load (0.2ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3) AND ("categories"."lft" >= 4)  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T23:19:25.961422 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.961830 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:25.962436 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:25.964079 #98308] DEBUG -- :   [1m[35mSQL (0.3ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 9 - 7 WHEN "lft" BETWEEN 8 AND 9 THEN "lft" + 4 - 8 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 9 - 7 WHEN "rgt" BETWEEN 8 AND 9 THEN "rgt" + 4 - 8 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 3 THEN 1 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 4 AND 9 OR "categories"."rgt" BETWEEN 4 AND 9)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:25.964279 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.964924 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 5]]
D, [2015-06-05T23:19:25.965251 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.965728 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:25.966925 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 6) AND ("categories"."rgt" >= 9) AND ("categories"."id" != 3)[0m
D, [2015-06-05T23:19:25.967680 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:25.968620 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "depth" = "depth" + 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" >= 6) AND ("categories"."lft" < 9) AND ("categories"."id" != 3)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:25.968752 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:25.969313 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:25.970120 #98308] DEBUG -- :   [1m[35mCategory Load (0.2ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3) AND ("categories"."lft" >= 6)  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T23:19:25.970539 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:25.971212 #98308] DEBUG -- :   [1m[35mCategory Load (0.2ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3) AND ("categories"."lft" < 6)  ORDER BY "categories"."lft" DESC LIMIT 1
D, [2015-06-05T23:19:25.972220 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:25.972830 #98308] DEBUG -- :   [1m[35mCategory Load (0.2ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:25.973403 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:25.973869 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:25.974190 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.974673 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T23:19:25.975274 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:25.975810 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:25.976046 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.976476 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:25.976839 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 5]]
D, [2015-06-05T23:19:25.977700 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 7 THEN "lft" + 9 - 7 WHEN "lft" BETWEEN 8 AND 9 THEN "lft" + 2 - 8 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 7 THEN "rgt" + 9 - 7 WHEN "rgt" BETWEEN 8 AND 9 THEN "rgt" + 2 - 8 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 5 THEN 1 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 2 AND 9 OR "categories"."rgt" BETWEEN 2 AND 9)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:25.977789 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.978057 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:25.978265 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.978494 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:25.979148 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 5)[0m
D, [2015-06-05T23:19:25.979531 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 5  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:25.979725 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.980021 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 5]]
D, [2015-06-05T23:19:25.980506 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 5) AND ("categories"."lft" < 2)  ORDER BY "categories"."lft" DESC LIMIT 1[0m
D, [2015-06-05T23:19:25.980962 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 5) AND ("categories"."lft" >= 2)  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T23:19:25.981783 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:25.982169 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:25.982475 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:25.982746 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:25.982974 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.983347 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:25.983657 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:25.983945 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:25.984096 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.984347 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:25.984667 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T23:19:25.985496 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 9 - 3 WHEN "lft" BETWEEN 4 AND 9 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 9 - 3 WHEN "rgt" BETWEEN 4 AND 9 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 2 THEN 1 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 2 AND 9 OR "categories"."rgt" BETWEEN 2 AND 9)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:25.985583 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.985878 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 5]]
D, [2015-06-05T23:19:25.986062 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.986333 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:25.986992 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 8) AND ("categories"."rgt" >= 9) AND ("categories"."id" != 2)[0m
D, [2015-06-05T23:19:25.987375 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 2  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:25.987501 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.987784 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:25.988238 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 2) AND ("categories"."lft" >= 8)  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:25.988700 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 2) AND ("categories"."lft" < 8)  ORDER BY "categories"."lft" DESC LIMIT 1
D, [2015-06-05T23:19:25.989502 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:25.989856 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:25.990183 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:25.990462 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:25.990687 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:25.991044 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:25.991384 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:25.991546 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:25.991805 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:25.992136 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:25.992528 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT "categories"."rgt" FROM "categories"  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:25.993320 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 12 - 7 WHEN "lft" BETWEEN 8 AND 12 THEN "lft" + 4 - 8 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 12 - 7 WHEN "rgt" BETWEEN 8 AND 12 THEN "rgt" + 4 - 8 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 3 THEN NULL ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 4 AND 12 OR "categories"."rgt" BETWEEN 4 AND 12)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:25.993422 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.993736 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:25.993928 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:25.994212 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:25.994818 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:25.994963 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:25.995312 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:25.995717 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:25.996367 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 10) AND ("categories"."rgt" >= 11) AND ("categories"."id" != 4)[0m
D, [2015-06-05T23:19:25.997190 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:25.997691 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:25.998081 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:25.998477 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:25.999001 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-05T23:19:25.999537 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.000010 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.000557 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:26.000899 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.001648 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:26.002280 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:26.003373 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 8 - 3 WHEN "lft" BETWEEN 4 AND 8 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 8 - 3 WHEN "rgt" BETWEEN 4 AND 8 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 2 THEN 5 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 2 AND 8 OR "categories"."rgt" BETWEEN 2 AND 8)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.003496 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.003930 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 5]]
D, [2015-06-05T23:19:26.004203 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.004507 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.005360 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 2)
D, [2015-06-05T23:19:26.005865 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 2  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.006021 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.006453 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T23:19:26.007512 #98308] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:26.008042 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.008460 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.008877 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.009236 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.009624 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.009876 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.010616 #98308] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.011089 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T23:19:26.011668 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "New Child"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:26.012223 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.012888 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.013162 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.013598 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.013807 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.014139 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.014531 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.015540 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 10 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 10 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 10 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 10 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 1 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 10 AND 14 OR "categories"."rgt" BETWEEN 10 AND 14)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.015637 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.015985 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T23:19:26.016193 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.016513 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.017236 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 10) AND ("categories"."rgt" >= 11) AND ("categories"."id" != 7)
D, [2015-06-05T23:19:26.017650 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.017787 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.018105 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.018942 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft" DESC LIMIT 1  [["parent_id", 1]]
D, [2015-06-05T23:19:26.019228 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.019767 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.020205 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.020571 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.020835 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.021146 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.021503 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:26.022410 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 3 THEN "lft" + 7 - 3 WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 3 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 3 THEN "rgt" + 7 - 3 WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 3 - 4 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 3 THEN 2 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 3 AND 7 OR "categories"."rgt" BETWEEN 3 AND 7)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.022530 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.022839 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:26.023045 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.023302 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.024000 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 3) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 3)[0m
D, [2015-06-05T23:19:26.024422 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.024969 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = "depth" + 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" >= 3) AND ("categories"."lft" < 6) AND ("categories"."id" != 3)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.025058 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.025365 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:26.026334 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:26.026753 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.027077 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.027377 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.027697 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.028171 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.028526 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:26.028895 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.029477 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.029844 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.030305 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "New Top"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:26.030728 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.031241 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.031460 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.031629 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.031939 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.032361 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T23:19:26.033255 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 13 - 12 WHEN "lft" BETWEEN 13 AND 13 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 13 - 12 WHEN "rgt" BETWEEN 13 AND 13 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 6 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 11 AND 13 OR "categories"."rgt" BETWEEN 11 AND 13)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.033368 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.033769 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.034121 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.034696 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:26.035529 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 12) AND ("categories"."rgt" >= 13) AND ("categories"."id" != 6)
D, [2015-06-05T23:19:26.035993 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 6  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.036170 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.036523 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.037925 #98308] DEBUG -- :   [1m[35m (0.3ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:26.038822 #98308] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.069039 #98308] DEBUG -- :   [1m[35mCategory Load (0.2ms)[0m  SELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.069590 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.069954 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.070495 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.070874 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.071247 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.071526 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.072085 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.072484 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T23:19:26.072951 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "New Top"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:26.073372 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.073886 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.074163 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.074316 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.074632 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.075036 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T23:19:26.075993 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 1 AND 10 THEN "lft" + 13 - 10 WHEN "lft" BETWEEN 11 AND 13 THEN "lft" + 1 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 1 AND 10 THEN "rgt" + 13 - 10 WHEN "rgt" BETWEEN 11 AND 13 THEN "rgt" + 1 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 1 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 1 AND 13 OR "categories"."rgt" BETWEEN 1 AND 13)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.076127 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.076428 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.076663 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.076922 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.077692 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 4) AND ("categories"."rgt" >= 13) AND ("categories"."id" != 1)[0m
D, [2015-06-05T23:19:26.078128 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 1  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.078667 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = "depth" + 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" >= 4) AND ("categories"."lft" < 13) AND ("categories"."id" != 1)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.078761 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.079097 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T23:19:26.079428 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:26.080346 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.080740 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.081051 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.081322 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.081617 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.082088 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.082304 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.082804 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.083146 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.083546 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Root1"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:26.083924 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.084373 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.084575 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.084751 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.085196 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.085669 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.086056 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Root2"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:26.086430 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.086868 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.087062 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.087236 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.087678 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.087975 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.088358 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Root3"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T23:19:26.088736 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.089168 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.089385 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.089510 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.089778 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.090085 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.090894 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 8 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 16 OR "categories"."rgt" BETWEEN 14 AND 16)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.090977 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.091275 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.091490 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.091742 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.092379 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)
D, [2015-06-05T23:19:26.092764 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.092933 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.093227 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.093389 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.093650 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.093968 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.094727 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 16 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 16 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 16 AND 18 OR "categories"."rgt" BETWEEN 16 AND 18)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.094809 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.095094 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.095275 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.095531 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.096136 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)
D, [2015-06-05T23:19:26.096510 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.096643 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.096953 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:26.097341 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" DESC LIMIT 1
D, [2015-06-05T23:19:26.097713 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 13) AND ("categories"."lft" < 18)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.098283 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)
D, [2015-06-05T23:19:26.098746 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)[0m
D, [2015-06-05T23:19:26.098979 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET lft = null, rgt = null
D, [2015-06-05T23:19:26.100046 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.100350 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" IS NULL)  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T23:19:26.100766 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 1 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.101104 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 2 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T23:19:26.101243 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.101863 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 2], ["rgt", 3], ["id", 2]]
D, [2015-06-05T23:19:26.102230 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.102804 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 2)
D, [2015-06-05T23:19:26.103160 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 2  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.103392 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.103695 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 3 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.104007 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 4 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T23:19:26.104139 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.104645 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 5], ["rgt", 6], ["id", 4]]
D, [2015-06-05T23:19:26.105180 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.106285 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 4)
D, [2015-06-05T23:19:26.106745 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 4  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.106980 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.107132 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.107700 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 4], ["rgt", 7], ["id", 3]]
D, [2015-06-05T23:19:26.108094 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.108673 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 4) AND ("categories"."rgt" >= 7) AND ("categories"."id" != 3)
D, [2015-06-05T23:19:26.109112 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.109333 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.109674 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 5 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.109829 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.110342 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 8], ["rgt", 9], ["id", 5]]
D, [2015-06-05T23:19:26.110720 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:26.111274 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 8) AND ("categories"."rgt" >= 9) AND ("categories"."id" != 5)[0m
D, [2015-06-05T23:19:26.111662 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 5  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.111870 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.112009 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.112795 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 1], ["rgt", 10], ["id", 1]]
D, [2015-06-05T23:19:26.113159 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.113608 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 1  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.113815 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.114142 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 6 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.114288 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.114755 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 11], ["rgt", 12], ["id", 6]]
D, [2015-06-05T23:19:26.115101 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:26.115538 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 6  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.115764 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.116083 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 7 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.116406 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 8 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T23:19:26.116577 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.117230 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 14], ["rgt", 15], ["id", 8]]
D, [2015-06-05T23:19:26.117906 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.118592 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)
D, [2015-06-05T23:19:26.119029 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.119271 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.119624 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 9 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.119767 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.120308 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 16], ["rgt", 17], ["id", 9]]
D, [2015-06-05T23:19:26.120730 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:26.121302 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)[0m
D, [2015-06-05T23:19:26.121673 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.121892 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.122035 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.122530 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 13], ["rgt", 18], ["id", 7]]
D, [2015-06-05T23:19:26.122875 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.123305 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.123498 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.123849 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" DESC LIMIT 1[0m
D, [2015-06-05T23:19:26.124215 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 13) AND ("categories"."lft" < 18)  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.124740 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)[0m
D, [2015-06-05T23:19:26.125214 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)
D, [2015-06-05T23:19:26.125422 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.126214 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.126457 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.126978 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.127347 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.127785 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Node-1"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:26.128200 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.128646 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.128853 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.129031 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.129464 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.129769 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.130151 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Node-2"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:26.130523 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.130979 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.131179 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.131369 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.131848 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.132171 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.132555 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Node-3"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T23:19:26.132968 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.133427 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.133623 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.133760 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.134030 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.134377 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.135187 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 8 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 16 OR "categories"."rgt" BETWEEN 14 AND 16)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.135271 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.135577 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.135773 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.136488 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.137180 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)
D, [2015-06-05T23:19:26.137566 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.137710 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.138395 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.138592 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.138871 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.139194 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.140009 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 16 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 16 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 16 AND 18 OR "categories"."rgt" BETWEEN 16 AND 18)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.140095 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.140400 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.140617 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.140854 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.141481 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)
D, [2015-06-05T23:19:26.141875 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.142046 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.142344 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:26.142708 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" DESC LIMIT 1
D, [2015-06-05T23:19:26.143096 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 13) AND ("categories"."lft" < 18)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.143661 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)
D, [2015-06-05T23:19:26.144168 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)[0m
D, [2015-06-05T23:19:26.144377 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET lft = null, rgt = null
D, [2015-06-05T23:19:26.145130 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.145379 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" IS NULL)  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T23:19:26.145791 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 1 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.146134 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 2 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T23:19:26.146272 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.146824 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 2], ["rgt", 3], ["id", 2]]
D, [2015-06-05T23:19:26.147227 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.147810 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 2)
D, [2015-06-05T23:19:26.148210 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 2  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.148435 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.148784 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 3 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.149118 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 4 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T23:19:26.149271 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.149791 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 5], ["rgt", 6], ["id", 4]]
D, [2015-06-05T23:19:26.150189 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.150766 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 4)
D, [2015-06-05T23:19:26.151177 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 4  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.151400 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.151542 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.152049 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 4], ["rgt", 7], ["id", 3]]
D, [2015-06-05T23:19:26.152425 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.153018 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 4) AND ("categories"."rgt" >= 7) AND ("categories"."id" != 3)
D, [2015-06-05T23:19:26.153403 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.153623 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.153935 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 5 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.154073 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.154545 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 8], ["rgt", 9], ["id", 5]]
D, [2015-06-05T23:19:26.154917 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:26.155467 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 8) AND ("categories"."rgt" >= 9) AND ("categories"."id" != 5)[0m
D, [2015-06-05T23:19:26.156057 #98308] DEBUG -- :   [1m[35mSQL (0.3ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 5  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.156273 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.156424 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.156948 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 1], ["rgt", 10], ["id", 1]]
D, [2015-06-05T23:19:26.157320 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.157784 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 1  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.157985 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.158320 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 6 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.158480 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.159349 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 11], ["rgt", 12], ["id", 6]]
D, [2015-06-05T23:19:26.159721 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:26.160208 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 6  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.160431 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.160832 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 7 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.161235 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 8 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T23:19:26.161390 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.161966 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 14], ["rgt", 15], ["id", 8]]
D, [2015-06-05T23:19:26.162341 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.162942 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)
D, [2015-06-05T23:19:26.163361 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.163580 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.163902 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 9 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.164046 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.164520 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 16], ["rgt", 17], ["id", 9]]
D, [2015-06-05T23:19:26.164893 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:26.165434 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)[0m
D, [2015-06-05T23:19:26.165843 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.166068 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.166218 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.166733 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 13], ["rgt", 18], ["id", 7]]
D, [2015-06-05T23:19:26.167252 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.168069 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.168331 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.168735 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" DESC LIMIT 1[0m
D, [2015-06-05T23:19:26.169167 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 13) AND ("categories"."lft" < 18)  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.169778 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)[0m
D, [2015-06-05T23:19:26.170259 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)
D, [2015-06-05T23:19:26.170467 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.171204 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.171429 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.171935 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.172282 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.172681 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Node-1"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:26.173057 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.173477 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.173674 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.173845 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.174262 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.174514 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.174873 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Node-2"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:26.175218 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.175623 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.175813 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.175979 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.176389 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.176698 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.177054 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Node-3"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T23:19:26.177403 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.177811 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.178004 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.178520 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft"  [["parent_id", 7]]
D, [2015-06-05T23:19:26.178662 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.178923 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.179233 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.179981 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 8 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 16 OR "categories"."rgt" BETWEEN 14 AND 16)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.180066 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.180335 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.180523 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.180754 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.181380 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)[0m
D, [2015-06-05T23:19:26.181750 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.181889 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.182163 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.182779 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 7]]
D, [2015-06-05T23:19:26.184025 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.184425 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 7]]
D, [2015-06-05T23:19:26.184686 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft"  [["parent_id", 7]]
D, [2015-06-05T23:19:26.184917 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.185199 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.185531 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:26.186333 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 16 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 16 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 16 AND 18 OR "categories"."rgt" BETWEEN 16 AND 18)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.186421 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.186696 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.186884 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.187116 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:26.187713 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)[0m
D, [2015-06-05T23:19:26.188067 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.188212 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.188475 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.189083 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 7]]
D, [2015-06-05T23:19:26.189216 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.189476 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.189777 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.189953 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.190207 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.190383 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.190612 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:26.191174 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)[0m
D, [2015-06-05T23:19:26.191541 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.191664 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.191926 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.192217 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.192586 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?  [["parent_id", 7]]
D, [2015-06-05T23:19:26.192930 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft"[0m  [["parent_id", 7]]
D, [2015-06-05T23:19:26.193258 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.193515 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.193813 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.193992 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.194245 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.194426 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.194652 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:26.195211 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)[0m
D, [2015-06-05T23:19:26.195564 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.195685 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.195942 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.196527 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 7]]
D, [2015-06-05T23:19:26.197114 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft"  [["parent_id", 7]]
D, [2015-06-05T23:19:26.197326 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.197593 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.197894 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:26.198624 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 15 THEN "lft" + 17 - 15 WHEN "lft" BETWEEN 16 AND 17 THEN "lft" + 14 - 16 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 15 THEN "rgt" + 17 - 15 WHEN "rgt" BETWEEN 16 AND 17 THEN "rgt" + 14 - 16 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 17 OR "categories"."rgt" BETWEEN 14 AND 17)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.198725 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.198998 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.199179 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.199412 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:26.199984 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 9)[0m
D, [2015-06-05T23:19:26.200333 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.200458 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.200719 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.200995 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.201282 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.201877 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 7]]
D, [2015-06-05T23:19:26.202739 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft"  [["parent_id", 7]]
D, [2015-06-05T23:19:26.203130 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.203630 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.203871 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.204432 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.204823 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.205290 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Root1"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:26.205715 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.206180 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.206389 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.206568 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.207004 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.207302 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.207686 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Root2"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:26.211374 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.211979 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.212247 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.212452 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.212938 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.213234 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.213645 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Root3"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T23:19:26.214025 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.214461 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.214654 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.214776 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.215064 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.215406 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.216358 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 8 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 16 OR "categories"."rgt" BETWEEN 14 AND 16)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.216444 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.216811 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.216996 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.217337 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.218438 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)
D, [2015-06-05T23:19:26.218974 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.219155 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.219556 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.219758 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.220098 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.220473 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.221370 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 16 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 16 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 16 AND 18 OR "categories"."rgt" BETWEEN 16 AND 18)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.221454 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.221728 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.221940 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.222197 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.222869 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)
D, [2015-06-05T23:19:26.223308 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.223447 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.223807 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:26.223991 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.224534 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "name" = ? WHERE "categories"."id" = ?[0m  [["name", nil], ["id", 8]]
D, [2015-06-05T23:19:26.224960 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.225543 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)[0m
D, [2015-06-05T23:19:26.225921 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.226103 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.226443 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" DESC LIMIT 1
D, [2015-06-05T23:19:26.226821 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 13) AND ("categories"."lft" < 18)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.227391 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)
D, [2015-06-05T23:19:26.227842 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)[0m
D, [2015-06-05T23:19:26.228037 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET lft = null, rgt = null
D, [2015-06-05T23:19:26.228792 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.229035 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" IS NULL)  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T23:19:26.229411 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 1 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.229740 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 2 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T23:19:26.229881 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.230356 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 2], ["rgt", 3], ["id", 2]]
D, [2015-06-05T23:19:26.230714 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.231232 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 2)
D, [2015-06-05T23:19:26.231633 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 2  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.231840 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.232166 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 3 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.232485 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 4 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T23:19:26.232617 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.233059 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 5], ["rgt", 6], ["id", 4]]
D, [2015-06-05T23:19:26.233402 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.233913 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 4)
D, [2015-06-05T23:19:26.234284 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 4  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.234498 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.234633 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.235061 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 4], ["rgt", 7], ["id", 3]]
D, [2015-06-05T23:19:26.235411 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.235933 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 4) AND ("categories"."rgt" >= 7) AND ("categories"."id" != 3)
D, [2015-06-05T23:19:26.236308 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.236508 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.236894 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 5 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.237028 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.237470 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 8], ["rgt", 9], ["id", 5]]
D, [2015-06-05T23:19:26.237823 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:26.238346 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 8) AND ("categories"."rgt" >= 9) AND ("categories"."id" != 5)[0m
D, [2015-06-05T23:19:26.238711 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 5  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.238911 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.239044 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.239471 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 1], ["rgt", 10], ["id", 1]]
D, [2015-06-05T23:19:26.239819 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.240294 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 1  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.240508 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.240840 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 6 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.240973 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.241414 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 11], ["rgt", 12], ["id", 6]]
D, [2015-06-05T23:19:26.241763 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:26.242206 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 6  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.242407 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.242731 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 7 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.243029 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 8 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T23:19:26.243185 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.243612 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 14], ["rgt", 15], ["id", 8]]
D, [2015-06-05T23:19:26.243946 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.244466 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)
D, [2015-06-05T23:19:26.244836 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.245034 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.245334 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 9 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.245484 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.245914 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 16], ["rgt", 17], ["id", 9]]
D, [2015-06-05T23:19:26.246227 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:26.246755 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)[0m
D, [2015-06-05T23:19:26.247117 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.247316 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.247448 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.247867 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 13], ["rgt", 18], ["id", 7]]
D, [2015-06-05T23:19:26.248211 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.248630 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.248818 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.249179 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" DESC LIMIT 1[0m
D, [2015-06-05T23:19:26.249559 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 13) AND ("categories"."lft" < 18)  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.250092 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)[0m
D, [2015-06-05T23:19:26.250532 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)
D, [2015-06-05T23:19:26.250748 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.251464 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.252271 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.252647 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.252978 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.253249 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.253533 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET lft = null[0m
D, [2015-06-05T23:19:26.254157 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:26.254309 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.254643 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T23:19:26.255310 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.255704 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.256042 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.256298 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.256610 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET rgt = null[0m
D, [2015-06-05T23:19:26.257279 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:26.257429 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.257727 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.258431 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.258815 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.259121 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.259402 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.259790 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.260112 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  DELETE FROM "categories" WHERE "categories"."id" = ?  [["id", 3]]
D, [2015-06-05T23:19:26.260727 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.261081 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.261403 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.261647 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.261878 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.262187 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.262887 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.263275 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.263578 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.263849 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.264227 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:26.264456 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.265025 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = ? WHERE "categories"."id" = ?[0m  [["lft", 0], ["id", 6]]
D, [2015-06-05T23:19:26.265391 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:26.265869 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 6  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.266084 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.266785 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.267160 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.267462 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.267735 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.267956 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.268340 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.269037 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.269416 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.269764 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.270035 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.270412 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:26.270782 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.271382 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 2)[0m
D, [2015-06-05T23:19:26.271825 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 4) AND ("categories"."rgt" >= 7) AND ("categories"."id" != 3)
D, [2015-06-05T23:19:26.272266 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 4)[0m
D, [2015-06-05T23:19:26.272751 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 8) AND ("categories"."rgt" >= 9) AND ("categories"."id" != 5)
D, [2015-06-05T23:19:26.272952 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET lft = null, rgt = null[0m
D, [2015-06-05T23:19:26.273636 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:26.273896 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" IS NULL)  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.274274 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 1 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T23:19:26.274580 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 2 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.274732 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.275277 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 2], ["rgt", 3], ["id", 2]]
D, [2015-06-05T23:19:26.275634 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.276163 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 2)[0m
D, [2015-06-05T23:19:26.276534 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 2  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.276742 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.277077 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 3 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T23:19:26.277368 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 4 )  ORDER BY "categories"."lft", "categories"."rgt", id[0m
D, [2015-06-05T23:19:26.277532 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.278362 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 5], ["rgt", 6], ["id", 4]]
D, [2015-06-05T23:19:26.278711 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:26.279234 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 4)[0m
D, [2015-06-05T23:19:26.279607 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 4  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.279816 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.279952 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.280457 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?[0m  [["lft", 4], ["rgt", 7], ["id", 3]]
D, [2015-06-05T23:19:26.280802 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.281310 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 4) AND ("categories"."rgt" >= 7) AND ("categories"."id" != 3)[0m
D, [2015-06-05T23:19:26.281670 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.281889 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.282185 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 5 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T23:19:26.282316 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.282792 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 8], ["rgt", 9], ["id", 5]]
D, [2015-06-05T23:19:26.283136 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:26.283673 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 8) AND ("categories"."rgt" >= 9) AND ("categories"."id" != 5)
D, [2015-06-05T23:19:26.284038 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 5  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.284242 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.284375 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.284842 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 1], ["rgt", 10], ["id", 1]]
D, [2015-06-05T23:19:26.285200 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.285618 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 1  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.285831 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.286184 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."parent_id" = 6 )  ORDER BY "categories"."lft", "categories"."rgt", id
D, [2015-06-05T23:19:26.286341 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.286911 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ?, "rgt" = ? WHERE "categories"."id" = ?  [["lft", 11], ["rgt", 12], ["id", 6]]
D, [2015-06-05T23:19:26.287280 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:26.287754 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 6  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.288002 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.288777 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:26.289130 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.289459 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.289728 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.290128 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T23:19:26.290488 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.291056 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 2)
D, [2015-06-05T23:19:26.291517 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 4) AND ("categories"."rgt" >= 7) AND ("categories"."id" != 3)[0m
D, [2015-06-05T23:19:26.291953 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 4)
D, [2015-06-05T23:19:26.292397 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 8) AND ("categories"."rgt" >= 9) AND ("categories"."id" != 5)[0m
D, [2015-06-05T23:19:26.292604 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.293209 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.293544 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.293826 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.294042 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.294307 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.294591 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.294755 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.294994 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.295275 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.295995 #98308] DEBUG -- :   [1m[35mCategory Load (0.4ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10) AND ("categories"."id" != 1)  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.296379 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.296670 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.297053 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.297343 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.297651 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.297941 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:26.298226 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:26.298520 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:26.298695 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.298976 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.299781 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.300091 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.300306 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.300809 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ? WHERE "categories"."id" = ?  [["lft", nil], ["id", 3]]
D, [2015-06-05T23:19:26.301571 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.302351 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= NULL) AND ("categories"."rgt" >= 7) AND ("categories"."id" != 3)
D, [2015-06-05T23:19:26.302775 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.303006 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.303752 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.303916 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.304309 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.305007 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:26.305353 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.305571 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.306090 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "rgt" = ? WHERE "categories"."id" = ?[0m  [["rgt", nil], ["id", 3]]
D, [2015-06-05T23:19:26.306471 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.307035 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 4) AND ("categories"."rgt" >= NULL) AND ("categories"."id" != 3)[0m
D, [2015-06-05T23:19:26.307419 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.307633 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.308383 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:26.308547 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.308906 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.309630 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.309969 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:26.310193 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.310641 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "lft" = ? WHERE "categories"."id" = ?  [["lft", 12], ["id", 6]]
D, [2015-06-05T23:19:26.311010 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:26.311452 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 6  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.311659 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.312334 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:26.312489 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.312867 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.313538 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.313855 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.314153 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.314354 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.314805 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "lft" = ? WHERE "categories"."id" = ?[0m  [["lft", 1], ["id", 3]]
D, [2015-06-05T23:19:26.315160 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.315722 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 1) AND ("categories"."rgt" >= 7) AND ("categories"."id" != 3)[0m
D, [2015-06-05T23:19:26.316122 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.316333 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.317077 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:26.317236 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.317664 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.318387 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.318680 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.318988 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.319212 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.319665 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "rgt" = ? WHERE "categories"."id" = ?[0m  [["rgt", 10], ["id", 3]]
D, [2015-06-05T23:19:26.320024 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.320576 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 4) AND ("categories"."rgt" >= 10) AND ("categories"."id" != 3)[0m
D, [2015-06-05T23:19:26.320970 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.321183 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.321911 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:26.322069 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.322468 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.322709 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.323196 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.323547 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.323959 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Test 1"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:26.324351 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.324792 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.324991 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.325161 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.325599 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.325906 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.326308 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Test 2"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:26.326685 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.327108 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.327301 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.327493 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.328025 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.328458 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.328882 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Test 3"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T23:19:26.329296 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.329795 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.329999 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.330179 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.330639 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.330956 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.331315 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Test 4"], ["lft", 19], ["rgt", 20]]
D, [2015-06-05T23:19:26.331686 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T23:19:26.332130 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.332322 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.332447 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.332732 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.333058 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.333894 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 8 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 16 OR "categories"."rgt" BETWEEN 14 AND 16)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.334037 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.334624 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.335003 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.335335 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.336061 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)[0m
D, [2015-06-05T23:19:26.336485 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.336638 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.336964 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.337745 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.338096 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.338427 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.338698 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.338999 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.339262 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.339601 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:26.340390 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 16 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 16 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 16 AND 18 OR "categories"."rgt" BETWEEN 16 AND 18)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.340475 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.340758 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.340982 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.341230 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:26.341867 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 9)[0m
D, [2015-06-05T23:19:26.342241 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.342382 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.342678 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.343426 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.343779 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.344119 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.344384 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.344644 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.344936 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.345247 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 10]]
D, [2015-06-05T23:19:26.346035 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 15 AND 18 THEN "lft" + 20 - 18 WHEN "lft" BETWEEN 19 AND 20 THEN "lft" + 15 - 19 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 15 AND 18 THEN "rgt" + 20 - 18 WHEN "rgt" BETWEEN 19 AND 20 THEN "rgt" + 15 - 19 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 10 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 15 AND 20 OR "categories"."rgt" BETWEEN 15 AND 20)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.346120 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.346416 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.346612 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.346867 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T23:19:26.347542 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 15) AND ("categories"."rgt" >= 16) AND ("categories"."id" != 10)[0m
D, [2015-06-05T23:19:26.347970 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.348128 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.348430 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 10]]
D, [2015-06-05T23:19:26.349204 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.349573 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.349898 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.350175 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.350445 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.350968 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.351530 #98308] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT  "notable_id", "notable_type", "notes"."lft", COUNT("notes"."lft") as _count FROM "notes" GROUP BY "notable_id", "notable_type", "notes"."lft", "notes"."id" HAVING COUNT("notes"."lft") > 1  ORDER BY "notes"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.351896 #98308] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT  "notable_id", "notable_type", "notes"."rgt", COUNT("notes"."rgt") as _count FROM "notes" GROUP BY "notable_id", "notable_type", "notes"."rgt", "notes"."id" HAVING COUNT("notes"."rgt") > 1  ORDER BY "notes"."id" LIMIT 1
D, [2015-06-05T23:19:26.352040 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.352329 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.352847 #98308] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT "notes".* FROM "notes" WHERE "notes"."parent_id" IS NULL  ORDER BY "notes"."lft"[0m
D, [2015-06-05T23:19:26.356343 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.356707 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.357038 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.358021 #98308] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ?  ORDER BY "notes"."rgt" desc LIMIT 1[0m  [["notable_id", 2], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.358447 #98308] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ?  ORDER BY "notes"."rgt" desc LIMIT 1  [["notable_id", 2], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.358901 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "notes" ("body", "notable_id", "notable_type", "lft", "rgt") VALUES (?, ?, ?, ?, ?)[0m  [["body", "A"], ["notable_id", 2], ["notable_type", "Category"], ["lft", 1], ["rgt", 2]]
D, [2015-06-05T23:19:26.359515 #98308] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:26.360216 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 6  ORDER BY "notes"."lft")[0m  [["notable_id", 2], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.360433 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.360645 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.361215 #98308] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ?  ORDER BY "notes"."rgt" desc LIMIT 1  [["notable_id", 2], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.361593 #98308] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.362030 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "notes" ("body", "notable_id", "notable_type", "lft", "rgt") VALUES (?, ?, ?, ?, ?)  [["body", "B"], ["notable_id", 2], ["notable_type", "Category"], ["lft", 3], ["rgt", 4]]
D, [2015-06-05T23:19:26.362487 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.363040 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 7  ORDER BY "notes"."lft")  [["notable_id", 2], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.363252 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.363451 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.363966 #98308] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ?  ORDER BY "notes"."rgt" desc LIMIT 1[0m  [["notable_id", 2], ["notable_type", "Default"]]
D, [2015-06-05T23:19:26.364369 #98308] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ?  ORDER BY "notes"."rgt" desc LIMIT 1  [["notable_id", 2], ["notable_type", "Default"]]
D, [2015-06-05T23:19:26.364717 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "notes" ("body", "notable_id", "notable_type", "lft", "rgt") VALUES (?, ?, ?, ?, ?)[0m  [["body", "C"], ["notable_id", 2], ["notable_type", "Default"], ["lft", 1], ["rgt", 2]]
D, [2015-06-05T23:19:26.365150 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.365689 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 8  ORDER BY "notes"."lft")[0m  [["notable_id", 2], ["notable_type", "Default"]]
D, [2015-06-05T23:19:26.365900 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.366348 #98308] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."parent_id" IS NULL  ORDER BY "notes"."lft"[0m  [["notable_id", 2], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.366752 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."parent_id" IS NULL  ORDER BY "notes"."lft"  [["notable_id", 2], ["notable_type", "Default"]]
D, [2015-06-05T23:19:26.366965 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.367430 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.367667 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.368274 #98308] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ?  ORDER BY "notes"."rgt" desc LIMIT 1  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.368676 #98308] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ?  ORDER BY "notes"."rgt" desc LIMIT 1[0m  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.369042 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "notes" ("body", "notable_id", "notable_type", "lft", "rgt") VALUES (?, ?, ?, ?, ?)  [["body", "A"], ["notable_id", 3], ["notable_type", "Category"], ["lft", 1], ["rgt", 2]]
D, [2015-06-05T23:19:26.369496 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:26.370009 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 6  ORDER BY "notes"."lft")  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.370213 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.370417 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.370924 #98308] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ?  ORDER BY "notes"."rgt" desc LIMIT 1[0m  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.371228 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T23:19:26.371629 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "notes" ("body", "notable_id", "notable_type", "lft", "rgt") VALUES (?, ?, ?, ?, ?)[0m  [["body", "B"], ["notable_id", 3], ["notable_type", "Category"], ["lft", 3], ["rgt", 4]]
D, [2015-06-05T23:19:26.372063 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.372558 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 7  ORDER BY "notes"."lft")[0m  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.372769 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.372959 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.373476 #98308] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ?  ORDER BY "notes"."rgt" desc LIMIT 1  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.373772 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.374174 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "notes" ("body", "notable_id", "notable_type", "lft", "rgt") VALUES (?, ?, ?, ?, ?)  [["body", "C"], ["notable_id", 3], ["notable_type", "Category"], ["lft", 5], ["rgt", 6]]
D, [2015-06-05T23:19:26.374605 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.375117 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 8  ORDER BY "notes"."lft")  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.375315 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.375447 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.375723 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:26.376053 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.377251 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "notes" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 6 ELSE "parent_id" END WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" BETWEEN 2 AND 4 OR "notes"."rgt" BETWEEN 2 AND 4)  ORDER BY "notes"."lft")[0m  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.377338 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.377662 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.377931 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.378193 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.379653 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" <= 2) AND ("notes"."rgt" >= 3) AND ("notes"."id" != 7)  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.380225 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "depth" = 1 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 7  ORDER BY "notes"."lft")[0m  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.380378 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.380704 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.380867 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.381142 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:26.381472 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.382476 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "notes" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 8 THEN 6 ELSE "parent_id" END WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" BETWEEN 4 AND 6 OR "notes"."rgt" BETWEEN 4 AND 6)  ORDER BY "notes"."lft")[0m  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.382601 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.382899 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.383160 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.383417 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.384239 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" <= 4) AND ("notes"."rgt" >= 5) AND ("notes"."id" != 8)  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.384789 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "depth" = 1 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 8  ORDER BY "notes"."lft")[0m  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.384962 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.385357 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.385773 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET lft = null, rgt = null
D, [2015-06-05T23:19:26.386890 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "notes"."id") FROM "notes" LEFT OUTER JOIN "notes" "parent" ON "parent"."id" = "notes"."parent_id" WHERE ((("notes"."lft" IS NULL OR "notes"."rgt" IS NULL) OR "notes"."lft" >= "notes"."rgt") OR "notes"."parent_id" IS NOT NULL AND ("notes"."lft" <= "parent"."lft" OR "notes"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.387227 #98308] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE ("notes"."parent_id" IS NULL)  ORDER BY "notes"."lft", "notes"."rgt", id
D, [2015-06-05T23:19:26.387781 #98308] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT "notes".* FROM "notes" WHERE ("notes"."parent_id" = 1 AND "notable_id" = 1 AND "notable_type" = 'Category' )  ORDER BY "notes"."lft", "notes"."rgt", id[0m
D, [2015-06-05T23:19:26.388173 #98308] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE ("notes"."parent_id" = 2 AND "notable_id" = 1 AND "notable_type" = 'Category' )  ORDER BY "notes"."lft", "notes"."rgt", id
D, [2015-06-05T23:19:26.388345 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.388999 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "lft" = ?, "rgt" = ? WHERE "notes"."id" = ?  [["lft", 2], ["rgt", 3], ["id", 2]]
D, [2015-06-05T23:19:26.389452 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.390170 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" <= 2) AND ("notes"."rgt" >= 3) AND ("notes"."id" != 2)  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.390682 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 2  ORDER BY "notes"."lft")[0m  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.390908 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.391295 #98308] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT "notes".* FROM "notes" WHERE ("notes"."parent_id" = 3 AND "notable_id" = 1 AND "notable_type" = 'Category' )  ORDER BY "notes"."lft", "notes"."rgt", id[0m
D, [2015-06-05T23:19:26.391497 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.392008 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "notes" SET "lft" = ?, "rgt" = ? WHERE "notes"."id" = ?[0m  [["lft", 4], ["rgt", 5], ["id", 3]]
D, [2015-06-05T23:19:26.392439 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.393139 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" <= 4) AND ("notes"."rgt" >= 5) AND ("notes"."id" != 3)[0m  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.393645 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 3  ORDER BY "notes"."lft")  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.393883 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.394259 #98308] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE ("notes"."parent_id" = 4 AND "notable_id" = 1 AND "notable_type" = 'Category' )  ORDER BY "notes"."lft", "notes"."rgt", id
D, [2015-06-05T23:19:26.394426 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.394916 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "notes" SET "lft" = ?, "rgt" = ? WHERE "notes"."id" = ?  [["lft", 6], ["rgt", 7], ["id", 4]]
D, [2015-06-05T23:19:26.395347 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.396071 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" <= 6) AND ("notes"."rgt" >= 7) AND ("notes"."id" != 4)  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.396608 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 4  ORDER BY "notes"."lft")[0m  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.396833 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.397002 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.397508 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "notes" SET "lft" = ?, "rgt" = ? WHERE "notes"."id" = ?  [["lft", 1], ["rgt", 8], ["id", 1]]
D, [2015-06-05T23:19:26.397950 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.398505 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 1  ORDER BY "notes"."lft")  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.398718 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.399093 #98308] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE ("notes"."parent_id" = 5 AND "notable_id" = 1 AND "notable_type" = 'Departments' )  ORDER BY "notes"."lft", "notes"."rgt", id
D, [2015-06-05T23:19:26.399252 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.399702 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "notes" SET "lft" = ?, "rgt" = ? WHERE "notes"."id" = ?  [["lft", 1], ["rgt", 2], ["id", 5]]
D, [2015-06-05T23:19:26.400098 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:26.400610 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 5  ORDER BY "notes"."lft")  [["notable_id", 1], ["notable_type", "Departments"]]
D, [2015-06-05T23:19:26.400817 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.401198 #98308] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE ("notes"."parent_id" = 6 AND "notable_id" = 3 AND "notable_type" = 'Category' )  ORDER BY "notes"."lft", "notes"."rgt", id
D, [2015-06-05T23:19:26.401558 #98308] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT "notes".* FROM "notes" WHERE ("notes"."parent_id" = 7 AND "notable_id" = 3 AND "notable_type" = 'Category' )  ORDER BY "notes"."lft", "notes"."rgt", id[0m
D, [2015-06-05T23:19:26.401711 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.402157 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "notes" SET "lft" = ?, "rgt" = ? WHERE "notes"."id" = ?[0m  [["lft", 2], ["rgt", 3], ["id", 7]]
D, [2015-06-05T23:19:26.402527 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.403127 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" <= 2) AND ("notes"."rgt" >= 3) AND ("notes"."id" != 7)[0m  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.403539 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 7  ORDER BY "notes"."lft")  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.403744 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.404092 #98308] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE ("notes"."parent_id" = 8 AND "notable_id" = 3 AND "notable_type" = 'Category' )  ORDER BY "notes"."lft", "notes"."rgt", id
D, [2015-06-05T23:19:26.404249 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.404696 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "notes" SET "lft" = ?, "rgt" = ? WHERE "notes"."id" = ?  [["lft", 4], ["rgt", 5], ["id", 8]]
D, [2015-06-05T23:19:26.405070 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.405652 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" <= 4) AND ("notes"."rgt" >= 5) AND ("notes"."id" != 8)  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.406063 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 8  ORDER BY "notes"."lft")[0m  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.406557 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.406727 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.407189 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "notes" SET "lft" = ?, "rgt" = ? WHERE "notes"."id" = ?  [["lft", 1], ["rgt", 6], ["id", 6]]
D, [2015-06-05T23:19:26.407601 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:26.408080 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "depth" = 0 WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND "notes"."id" = 6  ORDER BY "notes"."lft")  [["notable_id", 3], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.408279 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.408919 #98308] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."parent_id" IS NULL AND "notes"."body" = ?  ORDER BY "notes"."lft" LIMIT 1  [["body", "A"]]
D, [2015-06-05T23:19:26.409371 #98308] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."parent_id" IS NULL AND "notes"."body" = ?  ORDER BY "notes"."lft" LIMIT 1[0m  [["body", "A"]]
D, [2015-06-05T23:19:26.410326 #98308] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."parent_id" = ?  ORDER BY "lft"  [["parent_id", 6]]
D, [2015-06-05T23:19:26.410595 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.411263 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.411658 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.411946 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.412276 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:26.412449 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.412731 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.412908 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.413140 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.413411 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.413684 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.413845 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.414087 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.414346 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.414602 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:26.414754 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.414993 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.415331 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.415502 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.415875 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:26.416393 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mDELETE FROM "categories" WHERE ("categories"."lft" >= 4) AND ("categories"."lft" < 7) AND ("categories"."id" != 3)[0m
D, [2015-06-05T23:19:26.416760 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = ("lft" - 4) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" > 7)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.417105 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "rgt" = ("rgt" - 4) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."rgt" > 7)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.417349 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.417608 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T23:19:26.417711 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.418463 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.418839 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.419146 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.419397 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.419620 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.420024 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.420330 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.420465 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.420780 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:26.421239 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 4) AND ("categories"."lft" < 7) AND ("categories"."id" != 3)  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.421502 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 4]]
D, [2015-06-05T23:19:26.421863 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = ("lft" - 4) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" > 7)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.422470 #98308] DEBUG -- :   [1m[36mSQL (0.4ms)[0m  [1mUPDATE "categories" SET "rgt" = ("rgt" - 4) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."rgt" > 7)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.422726 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.422949 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T23:19:26.423039 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.423720 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.424067 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.424370 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.424619 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.424840 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.425246 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.425547 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.425692 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.426014 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:26.430008 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 4) AND ("categories"."lft" < 7) AND ("categories"."id" != 3)  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.430407 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 4]]
D, [2015-06-05T23:19:26.430817 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = ("lft" - 4) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" > 7)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.431243 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "rgt" = ("rgt" - 4) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."rgt" > 7)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.431601 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.431827 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T23:19:26.431918 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.432077 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.432183 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.432903 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.433338 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.433684 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.433935 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.434197 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.434615 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.434998 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.435282 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.435784 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.436116 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T23:19:26.436558 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "categories" ("name", "parent_id", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Child"], ["parent_id", 3], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:26.436999 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."lft" LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.437378 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.438227 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 7 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 7 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 3 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 7 AND 14 OR "categories"."rgt" BETWEEN 7 AND 14)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.438545 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:26.438969 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.439654 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 7)[0m
D, [2015-06-05T23:19:26.440087 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.440493 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.440893 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.441450 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 7)[0m
D, [2015-06-05T23:19:26.441831 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.442032 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.442344 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.443223 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.443605 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.443937 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.444185 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.444439 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.444824 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.445160 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.445439 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.446101 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.446509 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T23:19:26.446925 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "parent_id", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Child"], ["parent_id", 3], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:26.447333 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."lft" LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.447734 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.448664 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 7 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 7 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 3 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 7 AND 14 OR "categories"."rgt" BETWEEN 7 AND 14)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.448962 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:26.449335 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.450019 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 7)[0m
D, [2015-06-05T23:19:26.450387 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.450712 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.451113 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.452003 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 7)[0m
D, [2015-06-05T23:19:26.452469 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.452699 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.453034 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.453907 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.454288 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.454630 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.454880 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.455145 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.455527 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.455768 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.456296 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.456656 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.457069 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "New Root"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:26.457451 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.457902 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.458118 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.458883 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:26.459237 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.459562 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.459833 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.460069 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.460460 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.460774 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:26.461059 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:26.461244 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.461800 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?[0m  [["parent_id", 5], ["id", 4]]
D, [2015-06-05T23:19:26.462139 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."lft" LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:26.462454 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 4]]
D, [2015-06-05T23:19:26.463275 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 5 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 5 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 4 THEN 5 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 5 AND 8 OR "categories"."rgt" BETWEEN 5 AND 8)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.463579 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 5]]
D, [2015-06-05T23:19:26.463942 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:26.464604 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 4)[0m
D, [2015-06-05T23:19:26.465008 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 4  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.465379 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 4]]
D, [2015-06-05T23:19:26.465740 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:26.466233 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 4)[0m
D, [2015-06-05T23:19:26.466601 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 4  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.466797 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.467074 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:26.467351 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:26.467680 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:26.468487 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.468855 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.469163 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.469429 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.469656 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.470063 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T23:19:26.470362 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.470635 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:26.470845 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.471410 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?  [["parent_id", 5], ["id", 4]]
D, [2015-06-05T23:19:26.471751 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."lft" LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:26.472064 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T23:19:26.472852 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 5 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 5 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 4 THEN 5 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 5 AND 8 OR "categories"."rgt" BETWEEN 5 AND 8)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.473169 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 5]]
D, [2015-06-05T23:19:26.473519 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.474152 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 4)
D, [2015-06-05T23:19:26.474521 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 4  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.474825 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T23:19:26.475185 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.475673 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 4)
D, [2015-06-05T23:19:26.476043 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 4  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.476237 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.476494 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.476784 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:26.477106 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:26.477881 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:26.478255 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.478574 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.478856 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.479098 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.479483 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.479825 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:26.480021 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.480550 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?  [["parent_id", nil], ["id", 4]]
D, [2015-06-05T23:19:26.480881 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.481218 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T23:19:26.481521 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT "categories"."rgt" FROM "categories"  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.482221 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 12 - 6 WHEN "lft" BETWEEN 7 AND 12 THEN "lft" + 5 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 12 - 6 WHEN "rgt" BETWEEN 7 AND 12 THEN "rgt" + 5 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 4 THEN NULL ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 5 AND 12 OR "categories"."rgt" BETWEEN 5 AND 12)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.482523 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 4]]
D, [2015-06-05T23:19:26.482860 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:26.483372 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 4  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.483708 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T23:19:26.484060 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.484446 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 4  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.484638 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.485374 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:26.485726 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.486057 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.486364 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.486605 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.487000 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.487308 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.487792 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.488664 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.488981 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.489409 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "parent_id", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Child"], ["parent_id", 3], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:26.489775 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."lft" LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.490111 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.490994 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 7 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 7 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 3 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 7 AND 14 OR "categories"."rgt" BETWEEN 7 AND 14)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.491312 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:26.491681 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.492368 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 7)
D, [2015-06-05T23:19:26.492749 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.493067 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.493420 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.493892 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 7)
D, [2015-06-05T23:19:26.494262 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.494474 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.495342 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.495716 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.496021 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.496292 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.496542 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.496948 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.497314 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:26.497721 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.498390 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."name" = ? LIMIT 1[0m  [["name", "Child 1"]]
D, [2015-06-05T23:19:26.498726 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.499236 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.499583 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T23:19:26.499995 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Child 1.1"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:26.500377 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.500852 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.501116 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.501328 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.502068 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.502467 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.502868 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Child 1.1.1"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:26.503275 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.503764 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.503986 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.504088 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.504519 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.504830 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.505202 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Child 1.1.1.1"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T23:19:26.505581 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:26.505998 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.506188 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.506286 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.506721 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.507029 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:26.507395 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Child 1.2"], ["lft", 19], ["rgt", 20]]
D, [2015-06-05T23:19:26.507778 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 10]]
D, [2015-06-05T23:19:26.508193 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.508385 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.508510 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.508784 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.509104 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.509920 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 3 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 3 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 2 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 3 AND 14 OR "categories"."rgt" BETWEEN 3 AND 14)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.510003 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.510295 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T23:19:26.510490 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.510746 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.511417 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 3) AND ("categories"."rgt" >= 4) AND ("categories"."id" != 7)
D, [2015-06-05T23:19:26.511786 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.511923 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.512210 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.512376 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.512633 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.512945 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.513719 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 4 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 4 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 8 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 4 AND 16 OR "categories"."rgt" BETWEEN 4 AND 16)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.513802 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.514097 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.514289 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.514564 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.515183 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 4) AND ("categories"."rgt" >= 5) AND ("categories"."id" != 8)
D, [2015-06-05T23:19:26.515568 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 3 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.515723 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.516001 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.516160 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.516416 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.516732 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.517527 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 5 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 5 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 5 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 5 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 5 AND 18 OR "categories"."rgt" BETWEEN 5 AND 18)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.517625 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.517934 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.518115 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.518373 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.519004 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 9)
D, [2015-06-05T23:19:26.519379 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 4 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.519511 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.519816 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:26.519971 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.520210 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.520523 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 10]]
D, [2015-06-05T23:19:26.521292 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 9 AND 18 THEN "lft" + 20 - 18 WHEN "lft" BETWEEN 19 AND 20 THEN "lft" + 9 - 19 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 9 AND 18 THEN "rgt" + 20 - 18 WHEN "rgt" BETWEEN 19 AND 20 THEN "rgt" + 9 - 19 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 10 THEN 2 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 9 AND 20 OR "categories"."rgt" BETWEEN 9 AND 20)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.521394 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.521684 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T23:19:26.521863 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.522109 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 10]]
D, [2015-06-05T23:19:26.522718 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 9) AND ("categories"."rgt" >= 10) AND ("categories"."id" != 10)
D, [2015-06-05T23:19:26.523083 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.523215 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.523512 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 10]]
D, [2015-06-05T23:19:26.523874 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T23:19:26.524265 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 18)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.524688 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.525273 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.525437 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.525671 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.525787 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.526023 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.526137 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.526373 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.526486 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.526700 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.526814 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.527067 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.529761 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.530043 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.530252 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.530488 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.530650 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.530896 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.531074 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.531306 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.534727 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.535229 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.535481 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.535723 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.535924 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.536158 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.536327 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.536585 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.536762 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.537072 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.537314 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.537548 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.537732 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.537958 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.538112 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.538434 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.538569 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.538870 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.539248 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL
D, [2015-06-05T23:19:26.539605 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.539814 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.540097 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.540494 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T23:19:26.540843 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.541006 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.541262 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.541565 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:26.542057 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE ("categories"."lft" <= 8) AND ("categories"."rgt" >= 9) AND "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:26.542348 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.542509 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.542772 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.542955 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.543184 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.543499 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."id" DESC LIMIT 1[0m
D, [2015-06-05T23:19:26.543931 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."lft" LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:26.544382 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE ("categories"."lft" <= 11) AND ("categories"."rgt" >= 12) AND "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:26.544788 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE ("categories"."lft" <= 11) AND ("categories"."rgt" >= 12) AND "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T23:19:26.544952 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.545223 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.545531 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.545848 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:26.546001 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.546252 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.546508 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE (rgt - lft = 1)[0m
D, [2015-06-05T23:19:26.546851 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."rgt" - "categories"."lft" = 1)  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.547283 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."rgt" - "categories"."lft" = 1)[0m
D, [2015-06-05T23:19:26.547635 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.547870 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."rgt" - "categories"."lft" = 1)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.548263 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:26.548506 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."rgt" - "categories"."lft" = 1)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.548869 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:26.549084 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."rgt" - "categories"."lft" = 1)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.549441 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:26.549681 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."rgt" - "categories"."lft" = 1)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.549875 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.550199 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.550473 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.550781 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.551071 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:26.551357 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:26.551634 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.551933 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.552119 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.552382 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.552685 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:26.553071 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.553365 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.553543 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.553807 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.554096 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.554368 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.554635 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.555019 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6)  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.555198 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.555457 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.555744 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.556016 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.556279 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.556686 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 4)  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.556851 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.557135 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.557423 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.557679 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.557961 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:26.558302 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = 1  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.558644 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.558896 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:26.559206 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.559374 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.559653 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.559935 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.560201 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.560469 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:26.560869 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.561033 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.561310 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.561605 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.561871 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.562127 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:26.562375 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.562861 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10) AND ("categories"."id" != 1) AND ("categories"."rgt" - "categories"."lft" = 1)  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.563041 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.563428 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T23:19:26.563731 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.564036 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.564550 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 2) AND ("categories"."rgt" >= 3) AND ("categories"."id" != 2)[0m
D, [2015-06-05T23:19:26.564815 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:26.565279 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 4)[0m
D, [2015-06-05T23:19:26.565420 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.565797 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.566100 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.566420 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.566624 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.566959 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.569346 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.570163 #98308] DEBUG -- :   [1m[36mNoDepth Load (0.1ms)[0m  [1mSELECT  "no_depths".* FROM "no_depths"  ORDER BY "no_depths"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.570555 #98308] DEBUG -- :   [1m[35mNoDepth Load (0.1ms)[0m  SELECT  "no_depths".* FROM "no_depths"  ORDER BY "no_depths"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.571041 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "no_depths" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "shallow"], ["lft", 1], ["rgt", 2]]
D, [2015-06-05T23:19:26.571435 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.571859 #98308] DEBUG -- :   [1m[36mNoDepth Load (0.1ms)[0m  [1mSELECT  "no_depths".* FROM "no_depths"  ORDER BY "no_depths"."id" ASC LIMIT 1[0m
D, [2015-06-05T23:19:26.572030 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.572461 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.573364 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "no_depths"."id") FROM "no_depths" LEFT OUTER JOIN "no_depths" "parent" ON "parent"."id" = "no_depths"."parent_id" WHERE ((("no_depths"."lft" IS NULL OR "no_depths"."rgt" IS NULL) OR "no_depths"."lft" >= "no_depths"."rgt") OR "no_depths"."parent_id" IS NOT NULL AND ("no_depths"."lft" <= "parent"."lft" OR "no_depths"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:26.573763 #98308] DEBUG -- :   [1m[36mNoDepth Load (0.1ms)[0m  [1mSELECT  "no_depths"."lft", COUNT("no_depths"."lft") as _count FROM "no_depths" GROUP BY "no_depths"."lft", "no_depths"."id" HAVING COUNT("no_depths"."lft") > 1  ORDER BY "no_depths"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.574082 #98308] DEBUG -- :   [1m[35mNoDepth Load (0.1ms)[0m  SELECT  "no_depths"."rgt", COUNT("no_depths"."rgt") as _count FROM "no_depths" GROUP BY "no_depths"."rgt", "no_depths"."id" HAVING COUNT("no_depths"."rgt") > 1  ORDER BY "no_depths"."id" LIMIT 1
D, [2015-06-05T23:19:26.574463 #98308] DEBUG -- :   [1m[36mNoDepth Load (0.1ms)[0m  [1mSELECT "no_depths".* FROM "no_depths" WHERE "no_depths"."parent_id" IS NULL  ORDER BY "no_depths"."lft"[0m
D, [2015-06-05T23:19:26.574791 #98308] DEBUG -- :   [1m[35mNoDepth Load (0.1ms)[0m  SELECT  "no_depths".* FROM "no_depths"  ORDER BY "no_depths"."id" ASC LIMIT 1
D, [2015-06-05T23:19:26.575016 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.575534 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.575853 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.576450 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.576852 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.577300 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "United States"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:26.577708 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.578178 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.578406 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.578578 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.579034 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.579346 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.579729 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "lawyers"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:26.580146 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.580627 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.580827 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.580975 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.581247 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.581581 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.582418 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 15 - 14 WHEN "lft" BETWEEN 15 AND 15 THEN "lft" + 13 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 15 - 14 WHEN "rgt" BETWEEN 15 AND 15 THEN "rgt" + 13 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 13 AND 15 OR "categories"."rgt" BETWEEN 13 AND 15)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.582502 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.582800 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.582998 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.583260 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.584314 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 7)[0m
D, [2015-06-05T23:19:26.584840 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.585023 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.585356 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.585615 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.586092 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.586399 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.586807 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "New York"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T23:19:26.587173 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.587619 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.587818 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.587938 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.588240 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.588555 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.589372 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 15 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 15 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 15 AND 18 OR "categories"."rgt" BETWEEN 15 AND 18)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.589455 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.589752 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.589947 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.590200 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.590818 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 15) AND ("categories"."rgt" >= 16) AND ("categories"."id" != 9)
D, [2015-06-05T23:19:26.591180 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.591298 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.591581 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:26.591802 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.592263 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.592554 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.592956 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Patent Law"], ["lft", 19], ["rgt", 20]]
D, [2015-06-05T23:19:26.593324 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T23:19:26.593743 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.593945 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.594067 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.594335 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:26.594669 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 10]]
D, [2015-06-05T23:19:26.595449 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 18 THEN "lft" + 20 - 18 WHEN "lft" BETWEEN 19 AND 20 THEN "lft" + 16 - 19 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 18 THEN "rgt" + 20 - 18 WHEN "rgt" BETWEEN 19 AND 20 THEN "rgt" + 16 - 19 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 10 THEN 9 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 16 AND 20 OR "categories"."rgt" BETWEEN 16 AND 20)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.595548 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.595845 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.596037 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.596285 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T23:19:26.596901 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 10)[0m
D, [2015-06-05T23:19:26.597264 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 3 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.597414 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.597714 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 10]]
D, [2015-06-05T23:19:26.597953 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.598447 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.598767 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.599148 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Switzerland"], ["lft", 21], ["rgt", 22]]
D, [2015-06-05T23:19:26.599538 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T23:19:26.599979 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 11  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.600186 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.600321 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.600599 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.600933 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 11]]
D, [2015-06-05T23:19:26.601719 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 20 AND 20 THEN "lft" + 22 - 20 WHEN "lft" BETWEEN 21 AND 22 THEN "lft" + 20 - 21 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 20 AND 20 THEN "rgt" + 22 - 20 WHEN "rgt" BETWEEN 21 AND 22 THEN "rgt" + 20 - 21 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 11 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 20 AND 22 OR "categories"."rgt" BETWEEN 20 AND 22)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.601821 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.602125 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.602325 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.602570 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T23:19:26.603215 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 20) AND ("categories"."rgt" >= 21) AND ("categories"."id" != 11)
D, [2015-06-05T23:19:26.603588 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 11  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.603718 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.604003 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 11]]
D, [2015-06-05T23:19:26.604212 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.604667 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.604979 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.605381 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Bern"], ["lft", 23], ["rgt", 24]]
D, [2015-06-05T23:19:26.605754 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T23:19:26.606186 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 12  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.606385 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.606520 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.606806 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 11]]
D, [2015-06-05T23:19:26.607135 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 12]]
D, [2015-06-05T23:19:26.607950 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 21 AND 22 THEN "lft" + 24 - 22 WHEN "lft" BETWEEN 23 AND 24 THEN "lft" + 21 - 23 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 21 AND 22 THEN "rgt" + 24 - 22 WHEN "rgt" BETWEEN 23 AND 24 THEN "rgt" + 21 - 23 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 12 THEN 11 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 21 AND 24 OR "categories"."rgt" BETWEEN 21 AND 24)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.608039 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.608362 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 11]]
D, [2015-06-05T23:19:26.608575 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.608839 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T23:19:26.609516 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 21) AND ("categories"."rgt" >= 22) AND ("categories"."id" != 12)[0m
D, [2015-06-05T23:19:26.609931 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 12  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.610071 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.610421 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 12]]
D, [2015-06-05T23:19:26.610801 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.611105 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.611397 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.611689 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T23:19:26.611988 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T23:19:26.612303 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T23:19:26.612563 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.613172 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.613399 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.613955 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.614317 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.614743 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "United States"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:26.615139 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.615603 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.615820 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.615987 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.616432 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.616757 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.617139 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "lawyers"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:26.617579 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.618444 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.618721 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.618887 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.619249 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.619643 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.620508 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 15 - 14 WHEN "lft" BETWEEN 15 AND 15 THEN "lft" + 13 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 15 - 14 WHEN "rgt" BETWEEN 15 AND 15 THEN "rgt" + 13 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 13 AND 15 OR "categories"."rgt" BETWEEN 13 AND 15)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.620595 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.620872 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.621062 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.621298 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.621892 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 7)[0m
D, [2015-06-05T23:19:26.622238 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.622376 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.622639 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.622849 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.623287 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.623569 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.623941 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "New York"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T23:19:26.624296 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.624695 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.624892 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.625027 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.625284 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.625586 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.626315 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 15 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 15 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 15 AND 18 OR "categories"."rgt" BETWEEN 15 AND 18)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.626399 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.626670 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.626853 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.627086 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.627668 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 15) AND ("categories"."rgt" >= 16) AND ("categories"."id" != 9)
D, [2015-06-05T23:19:26.628015 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.628133 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.628391 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:26.628597 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.629380 #98308] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.629918 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.630584 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Patent Law"], ["lft", 19], ["rgt", 20]]
D, [2015-06-05T23:19:26.631242 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T23:19:26.632001 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.632353 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.632568 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.633022 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:26.633387 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 10]]
D, [2015-06-05T23:19:26.634291 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 18 THEN "lft" + 20 - 18 WHEN "lft" BETWEEN 19 AND 20 THEN "lft" + 16 - 19 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 18 THEN "rgt" + 20 - 18 WHEN "rgt" BETWEEN 19 AND 20 THEN "rgt" + 16 - 19 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 10 THEN 9 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 16 AND 20 OR "categories"."rgt" BETWEEN 16 AND 20)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.634392 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.634714 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.634937 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.635213 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T23:19:26.635903 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 10)[0m
D, [2015-06-05T23:19:26.636314 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 3 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.636453 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.636757 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 10]]
D, [2015-06-05T23:19:26.636998 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.637508 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.637851 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.638288 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Switzerland"], ["lft", 21], ["rgt", 22]]
D, [2015-06-05T23:19:26.638709 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T23:19:26.639246 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 11  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.639489 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.639621 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.639904 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.640239 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 11]]
D, [2015-06-05T23:19:26.641065 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 20 AND 20 THEN "lft" + 22 - 20 WHEN "lft" BETWEEN 21 AND 22 THEN "lft" + 20 - 21 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 20 AND 20 THEN "rgt" + 22 - 20 WHEN "rgt" BETWEEN 21 AND 22 THEN "rgt" + 20 - 21 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 11 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 20 AND 22 OR "categories"."rgt" BETWEEN 20 AND 22)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.641172 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.641476 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.641682 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.641944 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T23:19:26.642583 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 20) AND ("categories"."rgt" >= 21) AND ("categories"."id" != 11)
D, [2015-06-05T23:19:26.642965 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 11  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.643099 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.643385 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 11]]
D, [2015-06-05T23:19:26.647135 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.647821 #98308] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.648360 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.648913 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Bern"], ["lft", 23], ["rgt", 24]]
D, [2015-06-05T23:19:26.649366 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T23:19:26.649851 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 12  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.650055 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.650185 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.650472 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 11]]
D, [2015-06-05T23:19:26.650915 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 12]]
D, [2015-06-05T23:19:26.652053 #98308] DEBUG -- :   [1m[35mSQL (0.3ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 21 AND 22 THEN "lft" + 24 - 22 WHEN "lft" BETWEEN 23 AND 24 THEN "lft" + 21 - 23 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 21 AND 22 THEN "rgt" + 24 - 22 WHEN "rgt" BETWEEN 23 AND 24 THEN "rgt" + 21 - 23 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 12 THEN 11 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 21 AND 24 OR "categories"."rgt" BETWEEN 21 AND 24)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.652165 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.652520 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 11]]
D, [2015-06-05T23:19:26.652799 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.653063 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T23:19:26.653755 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 21) AND ("categories"."rgt" >= 22) AND ("categories"."id" != 12)[0m
D, [2015-06-05T23:19:26.654215 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 12  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.654347 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.654680 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 12]]
D, [2015-06-05T23:19:26.654998 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.655273 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.655564 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.655909 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T23:19:26.656221 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T23:19:26.656487 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T23:19:26.656682 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.656915 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.657237 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.658036 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 19 THEN "lft" + 24 - 19 WHEN "lft" BETWEEN 20 AND 24 THEN "lft" + 14 - 20 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 19 THEN "rgt" + 24 - 19 WHEN "rgt" BETWEEN 20 AND 24 THEN "rgt" + 14 - 20 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN NULL ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 24 OR "categories"."rgt" BETWEEN 14 AND 24)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.658122 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.658417 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.658604 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.658854 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.659391 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.659887 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = "depth" - 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" >= 19) AND ("categories"."lft" < 24) AND ("categories"."id" != 7)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.660020 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.660287 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.660594 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.660886 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.661176 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.661438 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T23:19:26.661728 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T23:19:26.662004 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T23:19:26.662230 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.662815 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.663028 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.663554 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.663875 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.664362 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "United States"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:26.664753 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.665242 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.665444 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.665620 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.666070 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.666388 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.666776 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "lawyers"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:26.667162 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.667608 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.667822 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.667954 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.668257 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.668591 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.669394 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 15 - 14 WHEN "lft" BETWEEN 15 AND 15 THEN "lft" + 13 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 15 - 14 WHEN "rgt" BETWEEN 15 AND 15 THEN "rgt" + 13 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 13 AND 15 OR "categories"."rgt" BETWEEN 13 AND 15)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.669504 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.669777 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.670036 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.670295 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.670931 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 7)[0m
D, [2015-06-05T23:19:26.671303 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.671436 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.671722 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.671935 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.672394 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.672714 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.673085 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "New York"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T23:19:26.673463 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.673897 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.674117 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.674239 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.674497 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.674831 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.675623 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 15 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 15 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 15 AND 18 OR "categories"."rgt" BETWEEN 15 AND 18)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.675706 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.676028 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.676213 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.676473 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.677088 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 15) AND ("categories"."rgt" >= 16) AND ("categories"."id" != 9)
D, [2015-06-05T23:19:26.677458 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.677581 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.677843 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:26.678077 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.678530 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.678813 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.679210 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Patent Law"], ["lft", 19], ["rgt", 20]]
D, [2015-06-05T23:19:26.679588 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T23:19:26.680037 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.680232 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.680382 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.680638 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:26.681027 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 10]]
D, [2015-06-05T23:19:26.681828 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 18 THEN "lft" + 20 - 18 WHEN "lft" BETWEEN 19 AND 20 THEN "lft" + 16 - 19 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 18 THEN "rgt" + 20 - 18 WHEN "rgt" BETWEEN 19 AND 20 THEN "rgt" + 16 - 19 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 10 THEN 9 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 16 AND 20 OR "categories"."rgt" BETWEEN 16 AND 20)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.681929 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.682238 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.682421 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.682674 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T23:19:26.683300 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 10)[0m
D, [2015-06-05T23:19:26.683677 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 3 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.683804 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.684063 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 10]]
D, [2015-06-05T23:19:26.684296 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.684735 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.685045 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.685442 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Switzerland"], ["lft", 21], ["rgt", 22]]
D, [2015-06-05T23:19:26.685825 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T23:19:26.686247 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 11  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.686446 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.686566 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.686849 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.687179 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 11]]
D, [2015-06-05T23:19:26.687951 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 20 AND 20 THEN "lft" + 22 - 20 WHEN "lft" BETWEEN 21 AND 22 THEN "lft" + 20 - 21 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 20 AND 20 THEN "rgt" + 22 - 20 WHEN "rgt" BETWEEN 21 AND 22 THEN "rgt" + 20 - 21 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 11 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 20 AND 22 OR "categories"."rgt" BETWEEN 20 AND 22)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.688034 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.688325 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.688528 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.688787 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T23:19:26.689415 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 20) AND ("categories"."rgt" >= 21) AND ("categories"."id" != 11)
D, [2015-06-05T23:19:26.689782 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 11  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.689901 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.690191 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 11]]
D, [2015-06-05T23:19:26.690420 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.690855 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.691159 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.691552 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Bern"], ["lft", 23], ["rgt", 24]]
D, [2015-06-05T23:19:26.691921 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T23:19:26.692341 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 12  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.692535 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.692655 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.692929 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 11]]
D, [2015-06-05T23:19:26.693248 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 12]]
D, [2015-06-05T23:19:26.694020 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 21 AND 22 THEN "lft" + 24 - 22 WHEN "lft" BETWEEN 23 AND 24 THEN "lft" + 21 - 23 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 21 AND 22 THEN "rgt" + 24 - 22 WHEN "rgt" BETWEEN 23 AND 24 THEN "rgt" + 21 - 23 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 12 THEN 11 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 21 AND 24 OR "categories"."rgt" BETWEEN 21 AND 24)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.694103 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.694395 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 11]]
D, [2015-06-05T23:19:26.694577 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.694828 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T23:19:26.695419 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 21) AND ("categories"."rgt" >= 22) AND ("categories"."id" != 12)[0m
D, [2015-06-05T23:19:26.695794 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 12  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.695940 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.696195 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 12]]
D, [2015-06-05T23:19:26.696510 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.696835 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.697144 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.697421 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T23:19:26.697707 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T23:19:26.697992 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T23:19:26.698175 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.698459 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 11]]
D, [2015-06-05T23:19:26.698798 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.699631 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 19 THEN "lft" + 23 - 19 WHEN "lft" BETWEEN 20 AND 23 THEN "lft" + 14 - 20 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 19 THEN "rgt" + 23 - 19 WHEN "rgt" BETWEEN 20 AND 23 THEN "rgt" + 14 - 20 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 23 OR "categories"."rgt" BETWEEN 14 AND 23)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.699718 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.700014 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 11]]
D, [2015-06-05T23:19:26.700201 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.700459 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.701169 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 18) AND ("categories"."rgt" >= 23) AND ("categories"."id" != 7)[0m
D, [2015-06-05T23:19:26.701713 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.701885 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.702246 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.702617 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.702924 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.703215 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.703478 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T23:19:26.703764 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T23:19:26.704057 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T23:19:26.704292 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.704871 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.705083 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.705611 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.705965 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.706357 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "United States"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:26.706793 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.707243 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.707480 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.707646 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.708100 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.708419 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.708773 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "lawyers"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:26.709152 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.709579 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.709772 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.709925 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.710170 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.710506 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.711314 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 15 - 14 WHEN "lft" BETWEEN 15 AND 15 THEN "lft" + 13 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 15 - 14 WHEN "rgt" BETWEEN 15 AND 15 THEN "rgt" + 13 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 13 AND 15 OR "categories"."rgt" BETWEEN 13 AND 15)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.711399 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.711703 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.711885 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.712138 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.712779 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 7)[0m
D, [2015-06-05T23:19:26.713152 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.713285 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.713568 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.713772 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.714228 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.714511 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.714927 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "New York"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T23:19:26.715330 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.715773 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.716013 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.716136 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.716394 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.716734 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.717538 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 15 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 15 - 17 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 9 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 15 AND 18 OR "categories"."rgt" BETWEEN 15 AND 18)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.717636 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.717957 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.718168 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.718400 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.719027 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 15) AND ("categories"."rgt" >= 16) AND ("categories"."id" != 9)
D, [2015-06-05T23:19:26.719394 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 9  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.719517 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.719809 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:26.720015 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.720474 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.720784 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.721153 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Patent Law"], ["lft", 19], ["rgt", 20]]
D, [2015-06-05T23:19:26.721528 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T23:19:26.721953 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.722180 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.722301 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.722554 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:26.722876 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 10]]
D, [2015-06-05T23:19:26.723683 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 18 THEN "lft" + 20 - 18 WHEN "lft" BETWEEN 19 AND 20 THEN "lft" + 16 - 19 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 18 THEN "rgt" + 20 - 18 WHEN "rgt" BETWEEN 19 AND 20 THEN "rgt" + 16 - 19 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 10 THEN 9 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 16 AND 20 OR "categories"."rgt" BETWEEN 16 AND 20)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.723767 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.724067 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.724293 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.724552 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T23:19:26.725154 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 17) AND ("categories"."id" != 10)[0m
D, [2015-06-05T23:19:26.725528 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 3 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 10  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.725651 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.725937 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 10]]
D, [2015-06-05T23:19:26.726147 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.726611 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.726926 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.727318 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Switzerland"], ["lft", 21], ["rgt", 22]]
D, [2015-06-05T23:19:26.727700 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T23:19:26.728131 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 11  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.728325 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.728451 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.728743 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.729079 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 11]]
D, [2015-06-05T23:19:26.729869 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 20 AND 20 THEN "lft" + 22 - 20 WHEN "lft" BETWEEN 21 AND 22 THEN "lft" + 20 - 21 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 20 AND 20 THEN "rgt" + 22 - 20 WHEN "rgt" BETWEEN 21 AND 22 THEN "rgt" + 20 - 21 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 11 THEN 8 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 20 AND 22 OR "categories"."rgt" BETWEEN 20 AND 22)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.729952 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.730246 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.730437 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.730690 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T23:19:26.731326 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 20) AND ("categories"."rgt" >= 21) AND ("categories"."id" != 11)
D, [2015-06-05T23:19:26.731716 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 11  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.731839 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.732121 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 11]]
D, [2015-06-05T23:19:26.732334 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.732800 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.733104 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.733482 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "categories" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Bern"], ["lft", 23], ["rgt", 24]]
D, [2015-06-05T23:19:26.733862 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T23:19:26.734310 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 12  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.734503 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.734631 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.734899 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 11]]
D, [2015-06-05T23:19:26.735244 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 12]]
D, [2015-06-05T23:19:26.736056 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 21 AND 22 THEN "lft" + 24 - 22 WHEN "lft" BETWEEN 23 AND 24 THEN "lft" + 21 - 23 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 21 AND 22 THEN "rgt" + 24 - 22 WHEN "rgt" BETWEEN 23 AND 24 THEN "rgt" + 21 - 23 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 12 THEN 11 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 21 AND 24 OR "categories"."rgt" BETWEEN 21 AND 24)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.736152 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.736440 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 11]]
D, [2015-06-05T23:19:26.736630 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.736890 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T23:19:26.737517 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 21) AND ("categories"."rgt" >= 22) AND ("categories"."id" != 12)[0m
D, [2015-06-05T23:19:26.737886 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 12  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.738005 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.738307 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 12]]
D, [2015-06-05T23:19:26.738606 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.738915 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.739216 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.739514 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T23:19:26.739832 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 11]]
D, [2015-06-05T23:19:26.740137 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T23:19:26.740320 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.740573 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 12]]
D, [2015-06-05T23:19:26.740915 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.741765 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 19 THEN "lft" + 21 - 19 WHEN "lft" BETWEEN 20 AND 21 THEN "lft" + 14 - 20 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 19 THEN "rgt" + 21 - 19 WHEN "rgt" BETWEEN 20 AND 21 THEN "rgt" + 14 - 20 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 7 THEN 12 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 21 OR "categories"."rgt" BETWEEN 14 AND 21)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.741876 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.742164 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 12]]
D, [2015-06-05T23:19:26.742352 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.742642 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.743313 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 16) AND ("categories"."rgt" >= 21) AND ("categories"."id" != 7)[0m
D, [2015-06-05T23:19:26.743711 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 3 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.744255 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = "depth" + 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" >= 16) AND ("categories"."lft" < 21) AND ("categories"."id" != 7)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.744338 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.744652 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.745011 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.745285 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.745600 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:26.745910 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 10]]
D, [2015-06-05T23:19:26.746219 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 11]]
D, [2015-06-05T23:19:26.746520 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 12]]
D, [2015-06-05T23:19:26.746754 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.747471 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.747776 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.748081 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:26.748843 #98308] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 5]]
D, [2015-06-05T23:19:26.748979 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.749257 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:26.749601 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T23:19:26.750578 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 8 - 3 WHEN "lft" BETWEEN 4 AND 8 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 8 - 3 WHEN "rgt" BETWEEN 4 AND 8 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 2 THEN 5 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 2 AND 8 OR "categories"."rgt" BETWEEN 2 AND 8)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.750719 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.751141 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 5]]
D, [2015-06-05T23:19:26.751373 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.751648 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.752386 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 7) AND ("categories"."rgt" >= 8) AND ("categories"."id" != 2)[0m
D, [2015-06-05T23:19:26.752819 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 2  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.752973 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.753284 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:26.754227 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "categories"."id") FROM "categories" LEFT OUTER JOIN "categories" "parent" ON "parent"."id" = "categories"."parent_id" WHERE ((("categories"."lft" IS NULL OR "categories"."rgt" IS NULL) OR "categories"."lft" >= "categories"."rgt") OR "categories"."parent_id" IS NOT NULL AND ("categories"."lft" <= "parent"."lft" OR "categories"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.754646 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories"."lft", COUNT("categories"."lft") as _count FROM "categories" GROUP BY "categories"."lft", "categories"."id" HAVING COUNT("categories"."lft") > 1  ORDER BY "categories"."id" LIMIT 1
D, [2015-06-05T23:19:26.754956 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories"."rgt", COUNT("categories"."rgt") as _count FROM "categories" GROUP BY "categories"."rgt", "categories"."id" HAVING COUNT("categories"."rgt") > 1  ORDER BY "categories"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.755263 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.755496 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.755878 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.756222 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.756501 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.757230 #98308] DEBUG -- :   [1m[36mCategory Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1[0m  [["parent_id", 3]]
D, [2015-06-05T23:19:26.757628 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?  [["parent_id", 3]]
D, [2015-06-05T23:19:26.758009 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft"[0m  [["parent_id", 3]]
D, [2015-06-05T23:19:26.758341 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.758594 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.758968 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:26.759778 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 4 - 3 WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 4 - 3 WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 2 THEN 3 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 2 AND 4 OR "categories"."rgt" BETWEEN 2 AND 4)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.759862 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.760120 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 4]]
D, [2015-06-05T23:19:26.760351 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.760614 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.761247 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 3) AND ("categories"."rgt" >= 4) AND ("categories"."id" != 2)
D, [2015-06-05T23:19:26.761622 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 2  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.761778 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.762034 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T23:19:26.762388 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:26.762707 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.762907 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.763318 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.763610 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.763914 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.764571 #98308] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 3]]
D, [2015-06-05T23:19:26.764950 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 3]]
D, [2015-06-05T23:19:26.765289 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft" DESC LIMIT 1  [["parent_id", 3]]
D, [2015-06-05T23:19:26.765475 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.765763 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:26.766065 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T23:19:26.766880 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 6 - 3 WHEN "lft" BETWEEN 4 AND 6 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 6 - 3 WHEN "rgt" BETWEEN 4 AND 6 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 2 THEN 3 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 2 AND 6 OR "categories"."rgt" BETWEEN 2 AND 6)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.767010 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.767270 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T23:19:26.767480 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.767725 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.768332 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 5) AND ("categories"."rgt" >= 6) AND ("categories"."id" != 2)[0m
D, [2015-06-05T23:19:26.768721 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 2 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 2  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.768855 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.769148 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:26.769513 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.769834 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.770033 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.770384 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.770701 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.770964 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.771617 #98308] DEBUG -- :   [1m[36mCategory Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1[0m  [["parent_id", 1]]
D, [2015-06-05T23:19:26.771976 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?  [["parent_id", 1]]
D, [2015-06-05T23:19:26.772343 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft"[0m  [["parent_id", 1]]
D, [2015-06-05T23:19:26.772694 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.772940 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.773283 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:26.774100 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 7 - 3 WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 7 - 3 WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 2 THEN 1 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 2 AND 7 OR "categories"."rgt" BETWEEN 2 AND 7)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.774184 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.774468 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:26.774648 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.774896 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.775544 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 6) AND ("categories"."rgt" >= 7) AND ("categories"."id" != 2)
D, [2015-06-05T23:19:26.775929 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 2  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.776093 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.776391 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T23:19:26.776774 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.777053 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.777280 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.777620 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.777906 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.778211 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.778873 #98308] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 1]]
D, [2015-06-05T23:19:26.779234 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-05T23:19:26.779594 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "lft"  [["parent_id", 1]]
D, [2015-06-05T23:19:26.779894 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.780283 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.780661 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.786494 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.787000 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.787403 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:26.787752 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT "categories"."rgt" FROM "categories"  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.788560 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 12 - 7 WHEN "lft" BETWEEN 8 AND 12 THEN "lft" + 4 - 8 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 12 - 7 WHEN "rgt" BETWEEN 8 AND 12 THEN "rgt" + 4 - 8 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 3 THEN NULL ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 4 AND 12 OR "categories"."rgt" BETWEEN 4 AND 12)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.788649 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.788936 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:26.789154 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.789407 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.789968 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 3  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.790134 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.790413 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:26.790661 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.791018 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.791341 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:26.791576 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.791858 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.792173 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:26.792407 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.793002 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?[0m  [["parent_id", nil], ["id", 5]]
D, [2015-06-05T23:19:26.793398 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:26.793864 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 5  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.794094 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.794252 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.794721 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.795206 #98308] DEBUG -- :   [1m[36mThing Load (0.1ms)[0m  [1mSELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.799180 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?  [["parent_id", 1]]
D, [2015-06-05T23:19:26.799389 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.799752 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.800149 #98308] DEBUG -- :   [1m[36mThing Load (0.0ms)[0m  [1mSELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.800831 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?  [["parent_id", 1]]
D, [2015-06-05T23:19:26.800995 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.802401 #98308] DEBUG -- :   [1m[35mThing Load (0.1ms)[0m  SELECT  "things".* FROM "things"  ORDER BY "things"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.802803 #98308] DEBUG -- :   [1m[36mThing Load (0.1ms)[0m  [1mSELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T23:19:26.803301 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "things" ("body", "parent_id", "lft", "rgt") VALUES (?, ?, ?, ?)  [["body", "Child 3"], ["parent_id", 1], ["lft", 11], ["rgt", 12]]
D, [2015-06-05T23:19:26.803647 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "things" SET "children_count" = COALESCE("children_count", 0) + 1 WHERE "things"."id" = ?[0m  [["id", 1]]
D, [2015-06-05T23:19:26.804073 #98308] DEBUG -- :   [1m[35mThing Load (0.1ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ?  ORDER BY "things"."lft" LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.804421 #98308] DEBUG -- :   [1m[36mThing Load (0.0ms)[0m  [1mSELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1 [0m  [["id", 5]]
D, [2015-06-05T23:19:26.805429 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "things" SET "lft" = CASE WHEN "lft" BETWEEN 10 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 10 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 10 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 10 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 5 THEN 1 ELSE "parent_id" END WHERE "things"."id" IN (SELECT "things"."id" FROM "things" WHERE ("things"."lft" BETWEEN 10 AND 12 OR "things"."rgt" BETWEEN 10 AND 12)  ORDER BY "things"."lft")
D, [2015-06-05T23:19:26.805763 #98308] DEBUG -- :   [1m[36mThing Load (0.0ms)[0m  [1mSELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T23:19:26.806254 #98308] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:26.807100 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "things" WHERE ("things"."lft" <= 10) AND ("things"."rgt" >= 11) AND ("things"."id" != 5)[0m
D, [2015-06-05T23:19:26.807560 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "things" SET "depth" = 1 WHERE "things"."id" IN (SELECT "things"."id" FROM "things" WHERE "things"."id" = 5  ORDER BY "things"."lft")
D, [2015-06-05T23:19:26.807916 #98308] DEBUG -- :   [1m[36mThing Load (0.0ms)[0m  [1mSELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1 [0m  [["id", 5]]
D, [2015-06-05T23:19:26.808303 #98308] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:26.808835 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "things" WHERE ("things"."lft" <= 10) AND ("things"."rgt" >= 11) AND ("things"."id" != 5)[0m
D, [2015-06-05T23:19:26.809236 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "things" SET "depth" = 1 WHERE "things"."id" IN (SELECT "things"."id" FROM "things" WHERE "things"."id" = 5  ORDER BY "things"."lft")
D, [2015-06-05T23:19:26.809479 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.809874 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?  [["parent_id", 1]]
D, [2015-06-05T23:19:26.810182 #98308] DEBUG -- :   [1m[36mThing Load (0.0ms)[0m  [1mSELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.810409 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.810808 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.811123 #98308] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.811769 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-05T23:19:26.812172 #98308] DEBUG -- :   [1m[35mThing Load (0.1ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."parent_id" = ?  ORDER BY "lft" DESC LIMIT 1  [["parent_id", 1]]
D, [2015-06-05T23:19:26.812369 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.812748 #98308] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:26.813284 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "things" WHERE ("things"."lft" >= 4) AND ("things"."lft" < 7) AND ("things"."id" != 3)[0m
D, [2015-06-05T23:19:26.813667 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "things" SET "lft" = ("lft" - 4) WHERE "things"."id" IN (SELECT "things"."id" FROM "things" WHERE ("things"."lft" > 7)  ORDER BY "things"."lft")
D, [2015-06-05T23:19:26.814024 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "things" SET "rgt" = ("rgt" - 4) WHERE "things"."id" IN (SELECT "things"."id" FROM "things" WHERE ("things"."rgt" > 7)  ORDER BY "things"."lft")[0m
D, [2015-06-05T23:19:26.814293 #98308] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.814594 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mDELETE FROM "things" WHERE "things"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T23:19:26.815074 #98308] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.815433 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "things" SET "children_count" = COALESCE("children_count", 0) - 1 WHERE "things"."id" = ?[0m  [["id", 1]]
D, [2015-06-05T23:19:26.815534 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.815904 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-05T23:19:26.816182 #98308] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.816386 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.816914 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.819639 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.820395 #98308] DEBUG -- :   [1m[35mDefaultWithCallbacks Load (0.1ms)[0m  SELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.820807 #98308] DEBUG -- :   [1m[36mDefaultWithCallbacks Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.821274 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "categories" ("lft", "rgt") VALUES (?, ?)  [["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:26.821797 #98308] DEBUG -- :   [1m[36mDefaultWithCallbacks Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.822362 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 7  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.822587 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.824012 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.824534 #98308] DEBUG -- :   [1m[36mDefaultWithCallbacks Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.824905 #98308] DEBUG -- :   [1m[35mDefaultWithCallbacks Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:26.825341 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "categories" ("parent_id", "lft", "rgt") VALUES (?, ?, ?)[0m  [["parent_id", 7], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:26.825788 #98308] DEBUG -- :   [1m[35mDefaultWithCallbacks Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."lft" LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.826179 #98308] DEBUG -- :   [1m[36mDefaultWithCallbacks Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.827298 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 8 THEN 7 ELSE "parent_id" END WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" BETWEEN 14 AND 16 OR "categories"."rgt" BETWEEN 14 AND 16)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.827672 #98308] DEBUG -- :   [1m[36mDefaultWithCallbacks Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.828076 #98308] DEBUG -- :   [1m[35mDefaultWithCallbacks Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.828985 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)[0m
D, [2015-06-05T23:19:26.829406 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.829766 #98308] DEBUG -- :   [1m[36mDefaultWithCallbacks Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.830158 #98308] DEBUG -- :   [1m[35mDefaultWithCallbacks Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.830682 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE ("categories"."lft" <= 14) AND ("categories"."rgt" >= 15) AND ("categories"."id" != 8)[0m
D, [2015-06-05T23:19:26.831076 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 1 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 8  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.831296 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.831476 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.831981 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "parent_id" = NULL WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."parent_id" = ? AND "categories"."id" = 8  ORDER BY "lft")[0m  [["parent_id", 7]]
D, [2015-06-05T23:19:26.832116 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.832291 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.832834 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.834458 #98308] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "positions"."id") FROM "positions" LEFT OUTER JOIN "positions" "parent" ON "parent"."id" = "positions"."parent_id" WHERE ((("positions"."lft" IS NULL OR "positions"."rgt" IS NULL) OR "positions"."lft" >= "positions"."rgt") OR "positions"."parent_id" IS NOT NULL AND ("positions"."lft" <= "parent"."lft" OR "positions"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:26.835087 #98308] DEBUG -- :   [1m[35mPosition Load (0.1ms)[0m  SELECT  "positions"."lft", COUNT("positions"."lft") as _count FROM "positions" GROUP BY "positions"."lft", "positions"."id" HAVING COUNT("positions"."lft") > 1  ORDER BY "positions"."id" LIMIT 1
D, [2015-06-05T23:19:26.835445 #98308] DEBUG -- :   [1m[36mPosition Load (0.1ms)[0m  [1mSELECT  "positions"."rgt", COUNT("positions"."rgt") as _count FROM "positions" GROUP BY "positions"."rgt", "positions"."id" HAVING COUNT("positions"."rgt") > 1  ORDER BY "positions"."id" LIMIT 1[0m
D, [2015-06-05T23:19:26.835850 #98308] DEBUG -- :   [1m[35mPosition Load (0.1ms)[0m  SELECT "positions".* FROM "positions" WHERE "positions"."parent_id" IS NULL  ORDER BY "positions"."lft"
D, [2015-06-05T23:19:26.836034 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.836462 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.839296 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.839964 #98308] DEBUG -- :   [1m[35mOrder Load (0.1ms)[0m  SELECT  "orders".* FROM "orders"  ORDER BY "orders"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.840286 #98308] DEBUG -- :   [1m[36mOrder Load (0.1ms)[0m  [1mSELECT  "orders".* FROM "orders"  ORDER BY "orders"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.840686 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "orders" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Alpha"], ["lft", 1], ["rgt", 2]]
D, [2015-06-05T23:19:26.841233 #98308] DEBUG -- :   [1m[36mOrder Load (0.1ms)[0m  [1mSELECT  "orders".* FROM "orders" WHERE "orders"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.841814 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "orders" SET "depth" = 0 WHERE "orders"."id" IN (SELECT "orders"."id" FROM "orders" WHERE "orders"."id" = 1  ORDER BY "orders"."lft")
D, [2015-06-05T23:19:26.842010 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.842297 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.842723 #98308] DEBUG -- :   [1m[36mOrder Load (0.1ms)[0m  [1mSELECT  "orders".* FROM "orders"  ORDER BY "orders"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.843082 #98308] DEBUG -- :   [1m[35mOrder Load (0.1ms)[0m  SELECT  "orders".* FROM "orders" WHERE "orders"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T23:19:26.843452 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "orders" ("name", "lft", "rgt") VALUES (?, ?, ?)[0m  [["name", "Gamma"], ["lft", 3], ["rgt", 4]]
D, [2015-06-05T23:19:26.843817 #98308] DEBUG -- :   [1m[35mOrder Load (0.0ms)[0m  SELECT  "orders".* FROM "orders" WHERE "orders"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.844235 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "orders" SET "depth" = 0 WHERE "orders"."id" IN (SELECT "orders"."id" FROM "orders" WHERE "orders"."id" = 2  ORDER BY "orders"."lft")[0m
D, [2015-06-05T23:19:26.844419 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.844675 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.845085 #98308] DEBUG -- :   [1m[35mOrder Load (0.1ms)[0m  SELECT  "orders".* FROM "orders"  ORDER BY "orders"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.845369 #98308] DEBUG -- :   [1m[36mOrder Load (0.0ms)[0m  [1mSELECT  "orders".* FROM "orders" WHERE "orders"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T23:19:26.845721 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "orders" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "Omega"], ["lft", 5], ["rgt", 6]]
D, [2015-06-05T23:19:26.846073 #98308] DEBUG -- :   [1m[36mOrder Load (0.0ms)[0m  [1mSELECT  "orders".* FROM "orders" WHERE "orders"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.846484 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "orders" SET "depth" = 0 WHERE "orders"."id" IN (SELECT "orders"."id" FROM "orders" WHERE "orders"."id" = 3  ORDER BY "orders"."lft")
D, [2015-06-05T23:19:26.846665 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.846855 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.847591 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.847740 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.847981 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.848106 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.848422 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.848905 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T23:19:26.849382 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.849752 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.850029 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.850392 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T23:19:26.850767 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10)  ORDER BY "categories"."lft"[0m
D, [2015-06-05T23:19:26.851365 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.851732 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.860529 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.861358 #98308] DEBUG -- :   [1m[36mSuperclass Load (0.1ms)[0m  [1mSELECT  "single_table_inheritance".* FROM "single_table_inheritance"  ORDER BY "single_table_inheritance"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:26.861705 #98308] DEBUG -- :   [1m[35mSuperclass Load (0.1ms)[0m  SELECT  "single_table_inheritance".* FROM "single_table_inheritance"  ORDER BY "single_table_inheritance"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.862245 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "single_table_inheritance" ("type", "name", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["type", "Subclass1"], ["name", "Subclass1"], ["lft", 1], ["rgt", 2]]
D, [2015-06-05T23:19:26.862636 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.865140 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.865679 #98308] DEBUG -- :   [1m[35mSuperclass Load (0.1ms)[0m  SELECT  "single_table_inheritance".* FROM "single_table_inheritance"  ORDER BY "single_table_inheritance"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.866291 #98308] DEBUG -- :   [1m[36mSubclass1 Load (0.1ms)[0m  [1mSELECT  "single_table_inheritance".* FROM "single_table_inheritance" WHERE "single_table_inheritance"."type" IN ('Subclass1') AND "single_table_inheritance"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T23:19:26.866866 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "single_table_inheritance" ("type", "name", "parent_id", "lft", "rgt") VALUES (?, ?, ?, ?, ?)  [["type", "Subclass2"], ["name", "Subclass2"], ["parent_id", 1], ["lft", 3], ["rgt", 4]]
D, [2015-06-05T23:19:26.867373 #98308] DEBUG -- :   [1m[36mSuperclass Load (0.1ms)[0m  [1mSELECT  "single_table_inheritance".* FROM "single_table_inheritance" WHERE "single_table_inheritance"."id" = ?  ORDER BY "single_table_inheritance"."lft" LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.868043 #98308] DEBUG -- :   [1m[35mSubclass2 Load (0.1ms)[0m  SELECT  "single_table_inheritance".* FROM "single_table_inheritance" WHERE "single_table_inheritance"."type" IN ('Subclass2') AND "single_table_inheritance"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:26.869300 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "single_table_inheritance" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 2 THEN 1 ELSE "parent_id" END WHERE "single_table_inheritance"."id" IN (SELECT "single_table_inheritance"."id" FROM "single_table_inheritance" WHERE ("single_table_inheritance"."lft" BETWEEN 2 AND 4 OR "single_table_inheritance"."rgt" BETWEEN 2 AND 4)  ORDER BY "single_table_inheritance"."lft")[0m
D, [2015-06-05T23:19:26.869853 #98308] DEBUG -- :   [1m[35mSubclass1 Load (0.1ms)[0m  SELECT  "single_table_inheritance".* FROM "single_table_inheritance" WHERE "single_table_inheritance"."type" IN ('Subclass1') AND "single_table_inheritance"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T23:19:26.870455 #98308] DEBUG -- :   [1m[36mSubclass2 Load (0.1ms)[0m  [1mSELECT  "single_table_inheritance".* FROM "single_table_inheritance" WHERE "single_table_inheritance"."type" IN ('Subclass2') AND "single_table_inheritance"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T23:19:26.870927 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.871125 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.871716 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.872327 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:26.872513 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.872988 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T23:19:26.873551 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10) AND ("categories"."id" != 1)  ORDER BY "categories"."lft"
D, [2015-06-05T23:19:26.873940 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 2]]
D, [2015-06-05T23:19:26.874183 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  DELETE FROM "categories" WHERE "categories"."id" = ?  [["id", 3]]
D, [2015-06-05T23:19:26.874384 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 4]]
D, [2015-06-05T23:19:26.874608 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  DELETE FROM "categories" WHERE "categories"."id" = ?  [["id", 5]]
D, [2015-06-05T23:19:26.874978 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "lft" = ("lft" - 10) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" > 10)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.875322 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "rgt" = ("rgt" - 10) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."rgt" > 10)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.875602 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.875818 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  DELETE FROM "categories" WHERE "categories"."id" = ?  [["id", 1]]
D, [2015-06-05T23:19:26.875935 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.876391 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "categories" WHERE "categories"."id" = ?  [["id", 1]]
D, [2015-06-05T23:19:26.876734 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-05T23:19:26.876872 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.877405 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.877889 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."id" ASC LIMIT 1
D, [2015-06-05T23:19:26.878914 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT "notes".id FROM "notes" WHERE "notes"."user_id" = ?[0m  [["user_id", 1]]
D, [2015-06-05T23:19:26.879452 #98308] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 1]]
D, [2015-06-05T23:19:26.880018 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.880543 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T23:19:26.881331 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" >= 1) AND ("notes"."lft" < 10) AND ("notes"."id" != 1)[0m  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.881980 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "lft" = ("lft" - 10) WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" > 10)  ORDER BY "notes"."lft")  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.882492 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "rgt" = ("rgt" - 10) WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."rgt" > 10)  ORDER BY "notes"."lft")[0m  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T23:19:26.882788 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.883073 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 1]]
D, [2015-06-05T23:19:26.883440 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:26.883704 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 2]]
D, [2015-06-05T23:19:26.884027 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:26.884239 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T23:19:26.884559 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T23:19:26.884800 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 4]]
D, [2015-06-05T23:19:26.884960 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.885499 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "notes" WHERE "notes"."user_id" = ? AND "notes"."id" IN (1, 2, 3, 4)[0m  [["user_id", 1]]
D, [2015-06-05T23:19:26.885690 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.886342 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.886845 #98308] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1
D, [2015-06-05T23:19:26.887061 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.887542 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T23:19:26.888131 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mDELETE FROM "categories" WHERE ("categories"."lft" >= 1) AND ("categories"."lft" < 10) AND ("categories"."id" != 1)[0m
D, [2015-06-05T23:19:26.888559 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = ("lft" - 10) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" > 10)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.888973 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "rgt" = ("rgt" - 10) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."rgt" > 10)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.889255 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.889555 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 1]]
D, [2015-06-05T23:19:26.889663 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.890108 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 1]]
D, [2015-06-05T23:19:26.890502 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?  [["parent_id", 1]]
D, [2015-06-05T23:19:26.890652 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.891223 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.891705 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:26.891899 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.892249 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T23:19:26.892524 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.892839 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.893204 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.893496 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."id" DESC LIMIT 1[0m
D, [2015-06-05T23:19:26.893627 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.893975 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.894470 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = ("lft" - 2) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" > 12)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.894814 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "rgt" = ("rgt" - 2) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."rgt" > 12)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.895076 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:26.895331 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 6]]
D, [2015-06-05T23:19:26.895424 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.895573 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.896039 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.896426 #98308] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:26.896570 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.896942 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T23:19:26.904476 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.904908 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.905396 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.906158 #98308] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."id" DESC LIMIT 1[0m
D, [2015-06-05T23:19:26.906371 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.906932 #98308] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.907557 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "lft" = ("lft" - 2) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."lft" > 12)  ORDER BY "categories"."lft")
D, [2015-06-05T23:19:26.907908 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "categories" SET "rgt" = ("rgt" - 2) WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE ("categories"."rgt" > 12)  ORDER BY "categories"."lft")[0m
D, [2015-06-05T23:19:26.908162 #98308] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:26.908462 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "categories" WHERE "categories"."id" = ?[0m  [["id", 6]]
D, [2015-06-05T23:19:26.908571 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.908736 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.909305 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.909816 #98308] DEBUG -- :   [1m[36mDefaultScopedModel Load (0.1ms)[0m  [1mSELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:26.912687 #98308] DEBUG -- :   [1m[35mDefaultScopedModel Load (0.0ms)[0m  SELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:26.913612 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.913989 #98308] DEBUG -- :   [1m[35mDefaultScopedModel Load (0.0ms)[0m  SELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:26.915597 #98308] DEBUG -- :   [1m[36mDefaultScopedModel Load (0.1ms)[0m  [1mSELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:26.918423 #98308] DEBUG -- :   [1m[35mDefaultScopedModel Load (0.3ms)[0m  SELECT  "default_scoped_models".* FROM "default_scoped_models"  ORDER BY "default_scoped_models"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.919281 #98308] DEBUG -- :   [1m[36mDefaultScopedModel Load (0.1ms)[0m  [1mSELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.920228 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "default_scoped_models" ("name", "parent_id", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Helloworld"], ["parent_id", 6], ["lft", 9], ["rgt", 10]]
D, [2015-06-05T23:19:26.921025 #98308] DEBUG -- :   [1m[36mDefaultScopedModel Load (0.1ms)[0m  [1mSELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ?  ORDER BY "default_scoped_models"."lft" LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:26.921645 #98308] DEBUG -- :   [1m[35mDefaultScopedModel Load (0.1ms)[0m  SELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.922493 #98308] DEBUG -- :   [1m[36mDefaultScopedModel Load (0.1ms)[0m  [1mSELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:26.924472 #98308] DEBUG -- :   [1m[35mSQL (0.3ms)[0m  UPDATE "default_scoped_models" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 6 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 6 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN "id" = 8 THEN 6 ELSE "parent_id" END WHERE "default_scoped_models"."id" IN (SELECT "default_scoped_models"."id" FROM "default_scoped_models" WHERE ("default_scoped_models"."lft" BETWEEN 6 AND 10 OR "default_scoped_models"."rgt" BETWEEN 6 AND 10)  ORDER BY "default_scoped_models"."lft")
D, [2015-06-05T23:19:26.924931 #98308] DEBUG -- :   [1m[36mDefaultScopedModel Load (0.0ms)[0m  [1mSELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.925445 #98308] DEBUG -- :   [1m[35mDefaultScopedModel Load (0.0ms)[0m  SELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.926220 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "default_scoped_models" WHERE ("default_scoped_models"."lft" <= 6) AND ("default_scoped_models"."rgt" >= 7) AND ("default_scoped_models"."id" != 8)[0m
D, [2015-06-05T23:19:26.926727 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "default_scoped_models" SET "depth" = 1 WHERE "default_scoped_models"."id" IN (SELECT "default_scoped_models"."id" FROM "default_scoped_models" WHERE "default_scoped_models"."id" = 8  ORDER BY "default_scoped_models"."lft")
D, [2015-06-05T23:19:26.927073 #98308] DEBUG -- :   [1m[36mDefaultScopedModel Load (0.0ms)[0m  [1mSELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.927448 #98308] DEBUG -- :   [1m[35mDefaultScopedModel Load (0.0ms)[0m  SELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:26.927996 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "default_scoped_models" WHERE ("default_scoped_models"."lft" <= 6) AND ("default_scoped_models"."rgt" >= 7) AND ("default_scoped_models"."id" != 8)[0m
D, [2015-06-05T23:19:26.928377 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "default_scoped_models" SET "depth" = 1 WHERE "default_scoped_models"."id" IN (SELECT "default_scoped_models"."id" FROM "default_scoped_models" WHERE "default_scoped_models"."id" = 8  ORDER BY "default_scoped_models"."lft")
D, [2015-06-05T23:19:26.928620 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.928980 #98308] DEBUG -- :   [1m[35mDefaultScopedModel Load (0.1ms)[0m  SELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:26.929230 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.929885 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.930361 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.932435 #98308] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1  [["parent_uuid", "lmno"]]
D, [2015-06-05T23:19:26.932810 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.933609 #98308] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1  [["parent_uuid", "ijkh"]]
D, [2015-06-05T23:19:26.933895 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.934475 #98308] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1  [["parent_uuid", "abcd"]]
D, [2015-06-05T23:19:26.934619 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.934948 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.935255 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.935565 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.935825 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.936101 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:26.936377 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:26.937047 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10)  ORDER BY "users"."lft"
D, [2015-06-05T23:19:26.937657 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10)[0m
D, [2015-06-05T23:19:26.937797 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.938098 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.938431 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.939079 #98308] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '902f9f5c428db7147b2d1473d5b37067' LIMIT 1[0m
D, [2015-06-05T23:19:26.939605 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.940053 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:26.940560 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "lawyers"], ["uuid", "902f9f5c428db7147b2d1473d5b37067"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:26.941068 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.941632 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '902f9f5c428db7147b2d1473d5b37067'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:26.941854 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.942059 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.942514 #98308] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '0ad270fdd2d2b805bd2a4d3aeafe8562' LIMIT 1[0m
D, [2015-06-05T23:19:26.942947 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.943287 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.943731 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "United States"], ["uuid", "0ad270fdd2d2b805bd2a4d3aeafe8562"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:26.944208 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.944773 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '0ad270fdd2d2b805bd2a4d3aeafe8562'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:26.944996 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.945136 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.945433 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:26.945779 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:26.946821 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '0ad270fdd2d2b805bd2a4d3aeafe8562' THEN '902f9f5c428db7147b2d1473d5b37067' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 14 AND 16 OR "users"."rgt" BETWEEN 14 AND 16)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:26.946911 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.947242 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.947457 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.947715 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.948702 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '0ad270fdd2d2b805bd2a4d3aeafe8562')
D, [2015-06-05T23:19:26.949105 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '0ad270fdd2d2b805bd2a4d3aeafe8562'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:26.949234 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.949531 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.949818 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.950255 #98308] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '9d5ded8a22971abc6c92d7a4215cacc9' LIMIT 1[0m
D, [2015-06-05T23:19:26.950687 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:26.951019 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:26.951674 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Patent Law"], ["uuid", "9d5ded8a22971abc6c92d7a4215cacc9"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T23:19:26.952376 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.952961 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '9d5ded8a22971abc6c92d7a4215cacc9'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:26.953202 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.953356 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.953649 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:26.954016 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:26.954871 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 15 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 15 - 17 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '9d5ded8a22971abc6c92d7a4215cacc9' THEN '0ad270fdd2d2b805bd2a4d3aeafe8562' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 15 AND 18 OR "users"."rgt" BETWEEN 15 AND 18)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:26.954957 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.955249 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:26.955472 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.955707 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:26.956358 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 15) AND ("users"."rgt" >= 16) AND ("users"."uuid" != '9d5ded8a22971abc6c92d7a4215cacc9')
D, [2015-06-05T23:19:26.956746 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '9d5ded8a22971abc6c92d7a4215cacc9'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:26.956871 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.957158 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:26.957475 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:26.958191 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?[0m  [["parent_uuid", "902f9f5c428db7147b2d1473d5b37067"]]
D, [2015-06-05T23:19:26.958765 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?  [["parent_uuid", "0ad270fdd2d2b805bd2a4d3aeafe8562"]]
D, [2015-06-05T23:19:26.959384 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" >= 13) AND ("users"."lft" < 18) AND ("users"."uuid" != '902f9f5c428db7147b2d1473d5b37067')[0m
D, [2015-06-05T23:19:26.959546 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.960041 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.960407 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.960752 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.961045 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.961334 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.961599 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:26.962116 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10) AND ("users"."uuid" != 'abcd')  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:26.962370 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.962667 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.962961 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.963602 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft"[0m  [["parent_uuid", "abcd"]]
D, [2015-06-05T23:19:26.963895 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.964185 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.964525 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.965219 #98308] DEBUG -- :   [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh') AND ("users"."lft" < 4)  ORDER BY "users"."lft" DESC LIMIT 1[0m
D, [2015-06-05T23:19:26.965401 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.965699 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.966040 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:26.966897 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 7 - 3 WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 7 - 3 WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'ijkh' THEN 'abcd' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 2 AND 7 OR "users"."rgt" BETWEEN 2 AND 7)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:26.966983 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.967267 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T23:19:26.967464 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.967707 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:26.968349 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 2) AND ("users"."rgt" >= 5) AND ("users"."uuid" != 'ijkh')
D, [2015-06-05T23:19:26.968737 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:26.969223 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = "depth" + 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" >= 2) AND ("users"."lft" < 5) AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."lft")
D, [2015-06-05T23:19:26.969340 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.969622 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:26.969927 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.970627 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft"  [["parent_uuid", "abcd"]]
D, [2015-06-05T23:19:26.971061 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.971489 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:26.971798 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.972146 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.972449 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.972749 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.973070 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.973374 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.973594 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.973868 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.974157 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:26.974449 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:26.974760 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.975088 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.975302 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.975598 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-05T23:19:26.976158 #98308] DEBUG -- :   [1m[36mScopedUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:26.979970 #98308] DEBUG -- :   [1m[35mScopedUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft" LIMIT 1  [["parent_uuid", "abcd"]]
D, [2015-06-05T23:19:26.980557 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.981192 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "organization_id" = ? WHERE "users"."id" = ?  [["organization_id", 999999999], ["id", 2]]
D, [2015-06-05T23:19:26.981794 #98308] DEBUG -- :   [1m[36mScopedUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.982506 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."organization_id" = ? AND ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'efgh')  [["organization_id", 999999999]]
D, [2015-06-05T23:19:26.983080 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."organization_id" = ? AND "users"."uuid" = 'efgh'  ORDER BY "users"."lft")[0m  [["organization_id", 999999999]]
D, [2015-06-05T23:19:26.983334 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.983535 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.983917 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.984320 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.984769 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.985139 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.985458 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.985705 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.986020 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.986318 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.986588 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.986894 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:26.987199 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.987430 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.987703 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.988150 #98308] DEBUG -- :   [1m[36mScopedUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:26.988803 #98308] DEBUG -- :   [1m[35mScopedUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft" LIMIT 1  [["parent_uuid", "abcd"]]
D, [2015-06-05T23:19:26.989079 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.989582 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "organization_id" = ? WHERE "users"."id" = ?  [["organization_id", 999999999], ["id", 2]]
D, [2015-06-05T23:19:26.989996 #98308] DEBUG -- :   [1m[36mScopedUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.990623 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."organization_id" = ? AND ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'efgh')  [["organization_id", 999999999]]
D, [2015-06-05T23:19:26.991045 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."organization_id" = ? AND "users"."uuid" = 'efgh'  ORDER BY "users"."lft")[0m  [["organization_id", 999999999]]
D, [2015-06-05T23:19:26.991280 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.991470 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.991828 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.992259 #98308] DEBUG -- :   [1m[36mScopedUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:26.992872 #98308] DEBUG -- :   [1m[35mScopedUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft" LIMIT 1  [["parent_uuid", "abcd"]]
D, [2015-06-05T23:19:26.993131 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:26.993607 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "organization_id" = ? WHERE "users"."id" = ?  [["organization_id", 999999999], ["id", 2]]
D, [2015-06-05T23:19:26.994014 #98308] DEBUG -- :   [1m[36mScopedUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.994635 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."organization_id" = ? AND ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'efgh')  [["organization_id", 999999999]]
D, [2015-06-05T23:19:26.995147 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."organization_id" = ? AND "users"."uuid" = 'efgh'  ORDER BY "users"."lft")[0m  [["organization_id", 999999999]]
D, [2015-06-05T23:19:26.995418 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:26.995603 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:26.995979 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:26.996399 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:26.996758 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:26.997348 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh') AND ("users"."lft" < 4)  ORDER BY "users"."lft" DESC LIMIT 1[0m
D, [2015-06-05T23:19:26.997696 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:26.998445 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'pqrs') AND ("users"."lft" < 8)  ORDER BY "users"."lft" DESC LIMIT 1[0m
D, [2015-06-05T23:19:26.998643 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-05T23:19:26.998950 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:26.999265 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:26.999773 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL AND ("users"."uuid" != 'abcd') AND ("users"."lft" < 1)  ORDER BY "users"."lft" DESC LIMIT 1[0m
D, [2015-06-05T23:19:26.999916 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.000224 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.000505 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:27.001328 #98308] DEBUG -- :   [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'ijkh' AND ("users"."uuid" != 'lmno') AND ("users"."lft" < 5)  ORDER BY "users"."lft" DESC LIMIT 1[0m
D, [2015-06-05T23:19:27.001675 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.002087 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.002503 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:27.003127 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'efgh') AND ("users"."lft" < 2)  ORDER BY "users"."lft" DESC LIMIT 1[0m
D, [2015-06-05T23:19:27.003291 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.003633 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.003946 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:27.004249 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.004750 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh') AND ("users"."lft" >= 4)  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T23:19:27.005069 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:27.005542 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'efgh') AND ("users"."lft" >= 2)  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T23:19:27.005713 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.006018 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.006320 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:27.006592 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:27.007066 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL AND ("users"."uuid" != 'abcd') AND ("users"."lft" >= 1)  ORDER BY "users"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:27.007553 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL AND ("users"."uuid" != 'tuvw') AND ("users"."lft" >= 11)  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T23:19:27.007690 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.007988 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.008288 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:27.008795 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'ijkh' AND ("users"."uuid" != 'lmno') AND ("users"."lft" >= 5)  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T23:19:27.008936 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.009220 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.009531 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:27.010029 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'pqrs') AND ("users"."lft" >= 8)  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T23:19:27.010180 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.010451 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.010885 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.011448 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh') AND ("users"."lft" < 4)  ORDER BY "users"."lft" DESC LIMIT 1
D, [2015-06-05T23:19:27.011653 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.011931 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:27.012287 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:27.013197 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 7 - 3 WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 7 - 3 WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'ijkh' THEN 'abcd' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 2 AND 7 OR "users"."rgt" BETWEEN 2 AND 7)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.013285 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.013578 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:27.013777 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.014047 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.014802 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 2) AND ("users"."rgt" >= 5) AND ("users"."uuid" != 'ijkh')[0m
D, [2015-06-05T23:19:27.015230 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.015783 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = "depth" + 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" >= 2) AND ("users"."lft" < 5) AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.015867 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.016197 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:27.016715 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh') AND ("users"."lft" < 2)  ORDER BY "users"."lft" DESC LIMIT 1
D, [2015-06-05T23:19:27.017011 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:27.017509 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh') AND ("users"."lft" >= 2)  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T23:19:27.018486 #98308] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.018925 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.019284 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.019574 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.019840 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.020176 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.020506 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.021059 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh') AND ("users"."lft" >= 4)  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T23:19:27.021226 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.021509 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:27.021858 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:27.022690 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 9 - 7 WHEN "lft" BETWEEN 8 AND 9 THEN "lft" + 4 - 8 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 9 - 7 WHEN "rgt" BETWEEN 8 AND 9 THEN "rgt" + 4 - 8 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'ijkh' THEN 'abcd' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 4 AND 9 OR "users"."rgt" BETWEEN 4 AND 9)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.022777 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.023048 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 5]]
D, [2015-06-05T23:19:27.023270 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.023506 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.024174 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 6) AND ("users"."rgt" >= 9) AND ("users"."uuid" != 'ijkh')[0m
D, [2015-06-05T23:19:27.024577 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.025059 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = "depth" + 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" >= 6) AND ("users"."lft" < 9) AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.025142 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.025442 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:27.025951 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh') AND ("users"."lft" >= 6)  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T23:19:27.026232 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:27.026766 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh') AND ("users"."lft" < 6)  ORDER BY "users"."lft" DESC LIMIT 1
D, [2015-06-05T23:19:27.027647 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.028039 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.028402 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.028702 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.028969 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.029322 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.029667 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:27.029985 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:27.030171 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.030456 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:27.030859 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 5]]
D, [2015-06-05T23:19:27.031766 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 7 THEN "lft" + 9 - 7 WHEN "lft" BETWEEN 8 AND 9 THEN "lft" + 2 - 8 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 7 THEN "rgt" + 9 - 7 WHEN "rgt" BETWEEN 8 AND 9 THEN "rgt" + 2 - 8 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'pqrs' THEN 'abcd' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 2 AND 9 OR "users"."rgt" BETWEEN 2 AND 9)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.031858 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.032159 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:27.032376 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.032628 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:27.033302 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'pqrs')[0m
D, [2015-06-05T23:19:27.033698 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'pqrs'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.033826 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.034106 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 5]]
D, [2015-06-05T23:19:27.034671 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'pqrs') AND ("users"."lft" < 2)  ORDER BY "users"."lft" DESC LIMIT 1[0m
D, [2015-06-05T23:19:27.035532 #98308] DEBUG -- :   [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'pqrs') AND ("users"."lft" >= 2)  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T23:19:27.036536 #98308] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.036945 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.037292 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.037566 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.037853 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.038193 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.038527 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:27.038844 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:27.039007 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.039268 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:27.039604 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T23:19:27.040472 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 9 - 3 WHEN "lft" BETWEEN 4 AND 9 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 9 - 3 WHEN "rgt" BETWEEN 4 AND 9 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'efgh' THEN 'abcd' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 2 AND 9 OR "users"."rgt" BETWEEN 2 AND 9)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.040562 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.040849 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 5]]
D, [2015-06-05T23:19:27.041066 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.041314 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:27.041975 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 8) AND ("users"."rgt" >= 9) AND ("users"."uuid" != 'efgh')[0m
D, [2015-06-05T23:19:27.042382 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'efgh'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.042510 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.042801 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:27.043296 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'efgh') AND ("users"."lft" >= 8)  ORDER BY "users"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:27.043774 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'efgh') AND ("users"."lft" < 8)  ORDER BY "users"."lft" DESC LIMIT 1
D, [2015-06-05T23:19:27.044614 #98308] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.045001 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.045342 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.045618 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.045872 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.046216 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.046550 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.046743 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.047000 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.047335 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:27.047972 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT "users"."rgt" FROM "users"  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.048845 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 12 - 7 WHEN "lft" BETWEEN 8 AND 12 THEN "lft" + 4 - 8 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 12 - 7 WHEN "rgt" BETWEEN 8 AND 12 THEN "rgt" + 4 - 8 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'ijkh' THEN NULL ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 4 AND 12 OR "users"."rgt" BETWEEN 4 AND 12)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.048954 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.049273 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:27.049536 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.049833 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.050452 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.050632 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.050932 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:27.051326 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:27.051898 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 10) AND ("users"."rgt" >= 11) AND ("users"."uuid" != 'lmno')[0m
D, [2015-06-05T23:19:27.052720 #98308] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:27.053114 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.053448 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.053748 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.054036 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.054384 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.054743 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:27.055058 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:27.055238 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.055506 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:27.055856 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:27.056720 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 8 - 3 WHEN "lft" BETWEEN 4 AND 8 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 8 - 3 WHEN "rgt" BETWEEN 4 AND 8 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'efgh' THEN 'pqrs' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 2 AND 8 OR "users"."rgt" BETWEEN 2 AND 8)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.056807 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.057088 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 5]]
D, [2015-06-05T23:19:27.057305 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.057553 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:27.058206 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != 'efgh')
D, [2015-06-05T23:19:27.058617 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'efgh'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.058758 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.059059 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T23:19:27.059950 #98308] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:27.060337 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.060678 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.060971 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.061232 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.061578 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.061834 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.062345 #98308] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '90154640f93a7a2d8d65760c4feef6fd' LIMIT 1[0m
D, [2015-06-05T23:19:27.062803 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.063160 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:27.063630 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "New Child"], ["uuid", "90154640f93a7a2d8d65760c4feef6fd"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:27.064052 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.064566 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '90154640f93a7a2d8d65760c4feef6fd'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.064789 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.065070 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:27.065246 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.065504 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:27.065822 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.066609 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 10 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 10 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 10 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 10 - 13 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '90154640f93a7a2d8d65760c4feef6fd' THEN 'abcd' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 10 AND 14 OR "users"."rgt" BETWEEN 10 AND 14)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.066711 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.066989 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T23:19:27.067192 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.067424 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:27.068056 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 10) AND ("users"."rgt" >= 11) AND ("users"."uuid" != '90154640f93a7a2d8d65760c4feef6fd')[0m
D, [2015-06-05T23:19:27.068425 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '90154640f93a7a2d8d65760c4feef6fd'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.068548 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.068817 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:27.069514 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft" DESC LIMIT 1[0m  [["parent_uuid", "abcd"]]
D, [2015-06-05T23:19:27.069764 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.070144 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.070461 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.070788 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:27.070985 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.071234 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:27.071555 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:27.072356 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 3 THEN "lft" + 7 - 3 WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 3 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 3 THEN "rgt" + 7 - 3 WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 3 - 4 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'ijkh' THEN 'efgh' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 3 AND 7 OR "users"."rgt" BETWEEN 3 AND 7)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.072458 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.072751 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T23:19:27.072982 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.077315 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.078259 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 3) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'ijkh')
D, [2015-06-05T23:19:27.078702 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.079242 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = "depth" + 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" >= 3) AND ("users"."lft" < 6) AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.079331 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.079624 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:27.080546 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.081014 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.081404 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.081672 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.082033 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.082365 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.082721 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:27.083077 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.083565 #98308] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '188aead7e44d6dd15eb58a3bc15d78ed' LIMIT 1[0m
D, [2015-06-05T23:19:27.083997 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.084370 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:27.085126 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "New Top"], ["uuid", "188aead7e44d6dd15eb58a3bc15d78ed"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:27.085707 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.086280 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '188aead7e44d6dd15eb58a3bc15d78ed'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.086513 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.086685 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.086983 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.087340 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T23:19:27.088179 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 13 - 12 WHEN "lft" BETWEEN 13 AND 13 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 13 - 12 WHEN "rgt" BETWEEN 13 AND 13 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'tuvw' THEN '188aead7e44d6dd15eb58a3bc15d78ed' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 11 AND 13 OR "users"."rgt" BETWEEN 11 AND 13)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.088280 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.088585 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.088805 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.089037 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:27.089712 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 12) AND ("users"."rgt" >= 13) AND ("users"."uuid" != 'tuvw')
D, [2015-06-05T23:19:27.090115 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'tuvw'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.090245 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.090552 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:27.091397 #98308] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:27.091794 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.092147 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.092413 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.093046 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.093457 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.093818 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:27.094159 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:27.094440 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.094915 #98308] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '51ed262764b5538ff6ceee7665de9211' LIMIT 1[0m
D, [2015-06-05T23:19:27.095364 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.095687 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:27.096122 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "New Top"], ["uuid", "51ed262764b5538ff6ceee7665de9211"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:27.096522 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.097024 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '51ed262764b5538ff6ceee7665de9211'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.097236 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.097361 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.097661 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.098024 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T23:19:27.098865 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 1 AND 10 THEN "lft" + 13 - 10 WHEN "lft" BETWEEN 11 AND 13 THEN "lft" + 1 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 1 AND 10 THEN "rgt" + 13 - 10 WHEN "rgt" BETWEEN 11 AND 13 THEN "rgt" + 1 - 11 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'abcd' THEN '51ed262764b5538ff6ceee7665de9211' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 1 AND 13 OR "users"."rgt" BETWEEN 1 AND 13)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.098986 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.099268 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.099497 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.099729 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:27.100396 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 4) AND ("users"."rgt" >= 13) AND ("users"."uuid" != 'abcd')
D, [2015-06-05T23:19:27.100790 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'abcd'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.101271 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = "depth" + 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" >= 4) AND ("users"."lft" < 13) AND ("users"."uuid" != 'abcd')  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.101355 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.101647 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T23:19:27.101960 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:27.102781 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:27.103181 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.103524 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.103825 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.104128 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.104533 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.104843 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.105333 #98308] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'f43ec00153736effa2e2578040daaa0a' LIMIT 1[0m
D, [2015-06-05T23:19:27.105766 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.106116 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:27.106540 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Root1"], ["uuid", "f43ec00153736effa2e2578040daaa0a"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:27.106938 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.107406 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'f43ec00153736effa2e2578040daaa0a'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.107612 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.107832 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.108244 #98308] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '4df291b25df5530bf25918eda81a4a90' LIMIT 1[0m
D, [2015-06-05T23:19:27.108636 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.108952 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.109360 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Root2"], ["uuid", "4df291b25df5530bf25918eda81a4a90"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:27.109737 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:27.110183 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '4df291b25df5530bf25918eda81a4a90'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.110385 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.110584 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.110986 #98308] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '12a3deb5f4b144f81af9225684e71552' LIMIT 1[0m
D, [2015-06-05T23:19:27.111407 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.111736 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:27.112139 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Root3"], ["uuid", "12a3deb5f4b144f81af9225684e71552"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T23:19:27.112511 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:27.112963 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '12a3deb5f4b144f81af9225684e71552'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.113181 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.113305 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.113578 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.113918 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:27.114724 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '4df291b25df5530bf25918eda81a4a90' THEN 'f43ec00153736effa2e2578040daaa0a' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 14 AND 16 OR "users"."rgt" BETWEEN 14 AND 16)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.114827 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.115100 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.115331 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.115600 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:27.116247 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '4df291b25df5530bf25918eda81a4a90')
D, [2015-06-05T23:19:27.116682 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '4df291b25df5530bf25918eda81a4a90'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.116831 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.117201 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:27.117412 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.117728 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.118081 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:27.118972 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 16 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 16 - 17 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '12a3deb5f4b144f81af9225684e71552' THEN 'f43ec00153736effa2e2578040daaa0a' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 16 AND 18 OR "users"."rgt" BETWEEN 16 AND 18)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.119074 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.119355 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.119607 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.119896 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:27.120926 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '12a3deb5f4b144f81af9225684e71552')
D, [2015-06-05T23:19:27.121427 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '12a3deb5f4b144f81af9225684e71552'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.121587 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.121951 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:27.122410 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" DESC LIMIT 1
D, [2015-06-05T23:19:27.122798 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 13) AND ("users"."lft" < 18)  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.123392 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '4df291b25df5530bf25918eda81a4a90')
D, [2015-06-05T23:19:27.123857 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '12a3deb5f4b144f81af9225684e71552')[0m
D, [2015-06-05T23:19:27.124059 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET lft = null, rgt = null
D, [2015-06-05T23:19:27.124872 #98308] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.125149 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" IS NULL)  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.125554 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'abcd' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T23:19:27.125902 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'efgh' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.126043 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.126499 #98308] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'efgh' AND "users"."id" != 2) LIMIT 1
D, [2015-06-05T23:19:27.127082 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 2], ["rgt", 3], ["id", 2]]
D, [2015-06-05T23:19:27.127483 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:27.128061 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'efgh')[0m
D, [2015-06-05T23:19:27.128514 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'efgh'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.128738 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.129107 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'ijkh' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.129476 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'lmno' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T23:19:27.129611 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.130066 #98308] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1[0m
D, [2015-06-05T23:19:27.130538 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 5], ["rgt", 6], ["id", 4]]
D, [2015-06-05T23:19:27.130914 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:27.131499 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'lmno')
D, [2015-06-05T23:19:27.131906 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'lmno'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.132123 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.132285 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.132736 #98308] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'ijkh' AND "users"."id" != 3) LIMIT 1
D, [2015-06-05T23:19:27.133160 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 4], ["rgt", 7], ["id", 3]]
D, [2015-06-05T23:19:27.133544 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.134104 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 4) AND ("users"."rgt" >= 7) AND ("users"."uuid" != 'ijkh')[0m
D, [2015-06-05T23:19:27.134509 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.134720 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.135057 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'pqrs' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.135193 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.135632 #98308] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'pqrs' AND "users"."id" != 5) LIMIT 1
D, [2015-06-05T23:19:27.136085 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 8], ["rgt", 9], ["id", 5]]
D, [2015-06-05T23:19:27.136440 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:27.136992 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 8) AND ("users"."rgt" >= 9) AND ("users"."uuid" != 'pqrs')[0m
D, [2015-06-05T23:19:27.137433 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'pqrs'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.137645 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.137778 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.138222 #98308] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'abcd' AND "users"."id" != 1) LIMIT 1[0m
D, [2015-06-05T23:19:27.138671 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 1], ["rgt", 10], ["id", 1]]
D, [2015-06-05T23:19:27.139017 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:27.139467 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'abcd'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.139678 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.140001 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'tuvw' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.140135 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.140569 #98308] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'tuvw' AND "users"."id" != 6) LIMIT 1
D, [2015-06-05T23:19:27.140999 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 11], ["rgt", 12], ["id", 6]]
D, [2015-06-05T23:19:27.141334 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:27.141777 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'tuvw'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.141986 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.142319 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'f43ec00153736effa2e2578040daaa0a' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T23:19:27.142665 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = '4df291b25df5530bf25918eda81a4a90' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.142796 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.143220 #98308] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = '4df291b25df5530bf25918eda81a4a90' AND "users"."id" != 8) LIMIT 1
D, [2015-06-05T23:19:27.143649 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 14], ["rgt", 15], ["id", 8]]
D, [2015-06-05T23:19:27.143989 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:27.144546 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '4df291b25df5530bf25918eda81a4a90')[0m
D, [2015-06-05T23:19:27.144939 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '4df291b25df5530bf25918eda81a4a90'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.145151 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.145490 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = '12a3deb5f4b144f81af9225684e71552' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.145626 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.146059 #98308] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = '12a3deb5f4b144f81af9225684e71552' AND "users"."id" != 9) LIMIT 1
D, [2015-06-05T23:19:27.146505 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 16], ["rgt", 17], ["id", 9]]
D, [2015-06-05T23:19:27.146846 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:27.147404 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '12a3deb5f4b144f81af9225684e71552')[0m
D, [2015-06-05T23:19:27.147767 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '12a3deb5f4b144f81af9225684e71552'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.148002 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.148134 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.148582 #98308] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'f43ec00153736effa2e2578040daaa0a' AND "users"."id" != 7) LIMIT 1[0m
D, [2015-06-05T23:19:27.149023 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 13], ["rgt", 18], ["id", 7]]
D, [2015-06-05T23:19:27.149380 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.149838 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'f43ec00153736effa2e2578040daaa0a'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.150035 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.150405 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" DESC LIMIT 1
D, [2015-06-05T23:19:27.150807 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 13) AND ("users"."lft" < 18)  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.151382 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '4df291b25df5530bf25918eda81a4a90')
D, [2015-06-05T23:19:27.151870 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '12a3deb5f4b144f81af9225684e71552')[0m
D, [2015-06-05T23:19:27.152059 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.152815 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.153093 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.153602 #98308] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'f26de9fa8c5b23e89d0a36ebcc86d5f3' LIMIT 1[0m
D, [2015-06-05T23:19:27.154044 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.154409 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:27.154881 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Node-1"], ["uuid", "f26de9fa8c5b23e89d0a36ebcc86d5f3"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:27.155278 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.155750 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'f26de9fa8c5b23e89d0a36ebcc86d5f3'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.155957 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.156191 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.156587 #98308] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '1b9ad23929908727938fb6ffbcb1978c' LIMIT 1[0m
D, [2015-06-05T23:19:27.157018 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.157370 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.157792 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Node-2"], ["uuid", "1b9ad23929908727938fb6ffbcb1978c"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:27.158169 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:27.158622 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '1b9ad23929908727938fb6ffbcb1978c'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.158821 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.159048 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.159458 #98308] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'bee79cdf6cb9a0bc4d220f224c261939' LIMIT 1[0m
D, [2015-06-05T23:19:27.159847 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.160177 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:27.160599 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Node-3"], ["uuid", "bee79cdf6cb9a0bc4d220f224c261939"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T23:19:27.160983 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:27.161441 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'bee79cdf6cb9a0bc4d220f224c261939'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.161642 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.161768 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.162052 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.162391 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:27.163244 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '1b9ad23929908727938fb6ffbcb1978c' THEN 'f26de9fa8c5b23e89d0a36ebcc86d5f3' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 14 AND 16 OR "users"."rgt" BETWEEN 14 AND 16)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.163329 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.163634 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.163828 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.164092 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:27.164752 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '1b9ad23929908727938fb6ffbcb1978c')
D, [2015-06-05T23:19:27.165145 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '1b9ad23929908727938fb6ffbcb1978c'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.165283 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.165582 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:27.165763 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.166036 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.166368 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:27.167183 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 16 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 16 - 17 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'bee79cdf6cb9a0bc4d220f224c261939' THEN 'f26de9fa8c5b23e89d0a36ebcc86d5f3' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 16 AND 18 OR "users"."rgt" BETWEEN 16 AND 18)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.167268 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.167540 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.167764 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.168023 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:27.168630 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != 'bee79cdf6cb9a0bc4d220f224c261939')
D, [2015-06-05T23:19:27.169013 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'bee79cdf6cb9a0bc4d220f224c261939'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.169174 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.169460 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:27.169860 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" DESC LIMIT 1
D, [2015-06-05T23:19:27.170247 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 13) AND ("users"."lft" < 18)  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.170836 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '1b9ad23929908727938fb6ffbcb1978c')
D, [2015-06-05T23:19:27.171289 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != 'bee79cdf6cb9a0bc4d220f224c261939')[0m
D, [2015-06-05T23:19:27.171492 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET lft = null, rgt = null
D, [2015-06-05T23:19:27.172288 #98308] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.172580 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" IS NULL)  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.172980 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'abcd' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T23:19:27.173340 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'efgh' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.173504 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.173971 #98308] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'efgh' AND "users"."id" != 2) LIMIT 1
D, [2015-06-05T23:19:27.174459 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 2], ["rgt", 3], ["id", 2]]
D, [2015-06-05T23:19:27.174820 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:27.175389 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'efgh')[0m
D, [2015-06-05T23:19:27.175781 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'efgh'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.175998 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.176331 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'ijkh' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.176692 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'lmno' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T23:19:27.176825 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.177266 #98308] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1[0m
D, [2015-06-05T23:19:27.177714 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 5], ["rgt", 6], ["id", 4]]
D, [2015-06-05T23:19:27.178081 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:27.178635 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'lmno')
D, [2015-06-05T23:19:27.179019 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'lmno'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.179262 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.179398 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.179886 #98308] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'ijkh' AND "users"."id" != 3) LIMIT 1
D, [2015-06-05T23:19:27.180375 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 4], ["rgt", 7], ["id", 3]]
D, [2015-06-05T23:19:27.180756 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.181344 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 4) AND ("users"."rgt" >= 7) AND ("users"."uuid" != 'ijkh')[0m
D, [2015-06-05T23:19:27.181739 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.181966 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.182293 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'pqrs' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.182430 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.182872 #98308] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'pqrs' AND "users"."id" != 5) LIMIT 1
D, [2015-06-05T23:19:27.183346 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 8], ["rgt", 9], ["id", 5]]
D, [2015-06-05T23:19:27.183675 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:27.184246 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 8) AND ("users"."rgt" >= 9) AND ("users"."uuid" != 'pqrs')[0m
D, [2015-06-05T23:19:27.184636 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'pqrs'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.184880 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.185016 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.185461 #98308] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'abcd' AND "users"."id" != 1) LIMIT 1[0m
D, [2015-06-05T23:19:27.185904 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 1], ["rgt", 10], ["id", 1]]
D, [2015-06-05T23:19:27.186248 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:27.186704 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'abcd'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.186948 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.187291 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'tuvw' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.187442 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.187997 #98308] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'tuvw' AND "users"."id" != 6) LIMIT 1
D, [2015-06-05T23:19:27.188498 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 11], ["rgt", 12], ["id", 6]]
D, [2015-06-05T23:19:27.188883 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:27.189378 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'tuvw'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.189599 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.189950 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'f26de9fa8c5b23e89d0a36ebcc86d5f3' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T23:19:27.190321 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = '1b9ad23929908727938fb6ffbcb1978c' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.190476 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.190922 #98308] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = '1b9ad23929908727938fb6ffbcb1978c' AND "users"."id" != 8) LIMIT 1
D, [2015-06-05T23:19:27.191368 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 14], ["rgt", 15], ["id", 8]]
D, [2015-06-05T23:19:27.191738 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:27.192318 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '1b9ad23929908727938fb6ffbcb1978c')[0m
D, [2015-06-05T23:19:27.192722 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '1b9ad23929908727938fb6ffbcb1978c'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.192945 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.193274 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'bee79cdf6cb9a0bc4d220f224c261939' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.193411 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.193879 #98308] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'bee79cdf6cb9a0bc4d220f224c261939' AND "users"."id" != 9) LIMIT 1
D, [2015-06-05T23:19:27.194332 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 16], ["rgt", 17], ["id", 9]]
D, [2015-06-05T23:19:27.194697 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:27.195396 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != 'bee79cdf6cb9a0bc4d220f224c261939')[0m
D, [2015-06-05T23:19:27.196013 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'bee79cdf6cb9a0bc4d220f224c261939'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.196294 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.196437 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.196984 #98308] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'f26de9fa8c5b23e89d0a36ebcc86d5f3' AND "users"."id" != 7) LIMIT 1[0m
D, [2015-06-05T23:19:27.197466 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 13], ["rgt", 18], ["id", 7]]
D, [2015-06-05T23:19:27.197848 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.198337 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'f26de9fa8c5b23e89d0a36ebcc86d5f3'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.198542 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.198917 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" DESC LIMIT 1
D, [2015-06-05T23:19:27.199328 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 13) AND ("users"."lft" < 18)  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.199960 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '1b9ad23929908727938fb6ffbcb1978c')
D, [2015-06-05T23:19:27.200435 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != 'bee79cdf6cb9a0bc4d220f224c261939')[0m
D, [2015-06-05T23:19:27.200628 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.201658 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.202097 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.202696 #98308] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '6254379b0ceb1f79c1477a784e703098' LIMIT 1[0m
D, [2015-06-05T23:19:27.203157 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.203550 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:27.204004 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Node-1"], ["uuid", "6254379b0ceb1f79c1477a784e703098"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:27.204388 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.204892 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '6254379b0ceb1f79c1477a784e703098'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.205099 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.205344 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.205769 #98308] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'd56352f84d3dc7b77d2cb436aac8edbc' LIMIT 1[0m
D, [2015-06-05T23:19:27.206183 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.206517 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.206947 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Node-2"], ["uuid", "d56352f84d3dc7b77d2cb436aac8edbc"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:27.207330 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:27.207788 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'd56352f84d3dc7b77d2cb436aac8edbc'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.208021 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.208225 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.208649 #98308] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '2cd4f7adb96ba259e6f4639de981a447' LIMIT 1[0m
D, [2015-06-05T23:19:27.209043 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.209390 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:27.209819 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Node-3"], ["uuid", "2cd4f7adb96ba259e6f4639de981a447"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T23:19:27.210217 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:27.210672 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '2cd4f7adb96ba259e6f4639de981a447'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.210899 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.211450 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft"  [["parent_uuid", "6254379b0ceb1f79c1477a784e703098"]]
D, [2015-06-05T23:19:27.211598 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.211883 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:27.212234 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:27.213103 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'd56352f84d3dc7b77d2cb436aac8edbc' THEN '6254379b0ceb1f79c1477a784e703098' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 14 AND 16 OR "users"."rgt" BETWEEN 14 AND 16)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.213191 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.213503 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:27.213723 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.213990 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:27.214680 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != 'd56352f84d3dc7b77d2cb436aac8edbc')[0m
D, [2015-06-05T23:19:27.215101 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'd56352f84d3dc7b77d2cb436aac8edbc'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.215247 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.215535 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:27.216253 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?[0m  [["parent_uuid", "6254379b0ceb1f79c1477a784e703098"]]
D, [2015-06-05T23:19:27.216776 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1  [["uuid", "6254379b0ceb1f79c1477a784e703098"]]
D, [2015-06-05T23:19:27.217209 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?[0m  [["parent_uuid", "6254379b0ceb1f79c1477a784e703098"]]
D, [2015-06-05T23:19:27.217472 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft"  [["parent_uuid", "6254379b0ceb1f79c1477a784e703098"]]
D, [2015-06-05T23:19:27.217689 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.217978 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:27.218326 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:27.219192 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 16 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 16 - 17 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '2cd4f7adb96ba259e6f4639de981a447' THEN '6254379b0ceb1f79c1477a784e703098' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 16 AND 18 OR "users"."rgt" BETWEEN 16 AND 18)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.219279 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.219595 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:27.219824 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.220061 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:27.220735 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '2cd4f7adb96ba259e6f4639de981a447')[0m
D, [2015-06-05T23:19:27.221128 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '2cd4f7adb96ba259e6f4639de981a447'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.221270 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.221580 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:27.222255 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?[0m  [["parent_uuid", "6254379b0ceb1f79c1477a784e703098"]]
D, [2015-06-05T23:19:27.222387 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.222670 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:27.223012 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:27.223204 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.223479 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:27.223702 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.223962 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:27.224584 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '2cd4f7adb96ba259e6f4639de981a447')[0m
D, [2015-06-05T23:19:27.224976 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '2cd4f7adb96ba259e6f4639de981a447'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.225101 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.225393 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:27.225729 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1[0m  [["uuid", "6254379b0ceb1f79c1477a784e703098"]]
D, [2015-06-05T23:19:27.226167 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?  [["parent_uuid", "6254379b0ceb1f79c1477a784e703098"]]
D, [2015-06-05T23:19:27.226537 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft"[0m  [["parent_uuid", "6254379b0ceb1f79c1477a784e703098"]]
D, [2015-06-05T23:19:27.226942 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.227217 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.227570 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:27.227777 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.228062 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:27.228272 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.228525 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:27.229165 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '2cd4f7adb96ba259e6f4639de981a447')[0m
D, [2015-06-05T23:19:27.229569 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '2cd4f7adb96ba259e6f4639de981a447'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.229732 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.230014 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:27.230681 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?[0m  [["parent_uuid", "6254379b0ceb1f79c1477a784e703098"]]
D, [2015-06-05T23:19:27.231036 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft"  [["parent_uuid", "6254379b0ceb1f79c1477a784e703098"]]
D, [2015-06-05T23:19:27.231275 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.231555 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:27.231910 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:27.232743 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 15 THEN "lft" + 17 - 15 WHEN "lft" BETWEEN 16 AND 17 THEN "lft" + 14 - 16 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 15 THEN "rgt" + 17 - 15 WHEN "rgt" BETWEEN 16 AND 17 THEN "rgt" + 14 - 16 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '2cd4f7adb96ba259e6f4639de981a447' THEN '6254379b0ceb1f79c1477a784e703098' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 14 AND 17 OR "users"."rgt" BETWEEN 14 AND 17)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.232836 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.233135 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:27.233354 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.233606 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:27.234263 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '2cd4f7adb96ba259e6f4639de981a447')[0m
D, [2015-06-05T23:19:27.234650 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '2cd4f7adb96ba259e6f4639de981a447'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.234785 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.235076 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:27.235386 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.235715 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1  [["uuid", "6254379b0ceb1f79c1477a784e703098"]]
D, [2015-06-05T23:19:27.236453 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?[0m  [["parent_uuid", "6254379b0ceb1f79c1477a784e703098"]]
D, [2015-06-05T23:19:27.236881 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft"  [["parent_uuid", "6254379b0ceb1f79c1477a784e703098"]]
D, [2015-06-05T23:19:27.237311 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.237816 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.238106 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.238632 #98308] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '8e8ea22cb501bdb7f2f10f12728e54e1' LIMIT 1
D, [2015-06-05T23:19:27.239080 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:27.239460 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T23:19:27.239884 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Root1"], ["uuid", "8e8ea22cb501bdb7f2f10f12728e54e1"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:27.240291 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:27.240792 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '8e8ea22cb501bdb7f2f10f12728e54e1'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.241002 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.241230 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.241660 #98308] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'fdce6129c0bfa0f969eb910e05f27b8c' LIMIT 1
D, [2015-06-05T23:19:27.242071 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:27.242397 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:27.242816 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Root2"], ["uuid", "fdce6129c0bfa0f969eb910e05f27b8c"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:27.243213 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:27.243680 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'fdce6129c0bfa0f969eb910e05f27b8c'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.243893 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.244105 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.244530 #98308] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '5fced73ef221129e43b240e4985e6342' LIMIT 1
D, [2015-06-05T23:19:27.244947 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:27.245279 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:27.245683 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Root3"], ["uuid", "5fced73ef221129e43b240e4985e6342"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T23:19:27.246062 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:27.246538 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '5fced73ef221129e43b240e4985e6342'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.246739 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.246888 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.247190 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:27.247547 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:27.248410 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'fdce6129c0bfa0f969eb910e05f27b8c' THEN '8e8ea22cb501bdb7f2f10f12728e54e1' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 14 AND 16 OR "users"."rgt" BETWEEN 14 AND 16)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.248495 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.248804 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:27.249002 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.249259 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:27.249933 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != 'fdce6129c0bfa0f969eb910e05f27b8c')[0m
D, [2015-06-05T23:19:27.250324 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'fdce6129c0bfa0f969eb910e05f27b8c'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.250470 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.250811 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:27.251199 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.251676 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:27.252055 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:27.252987 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 16 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 16 - 17 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '5fced73ef221129e43b240e4985e6342' THEN '8e8ea22cb501bdb7f2f10f12728e54e1' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 16 AND 18 OR "users"."rgt" BETWEEN 16 AND 18)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.253076 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.253379 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:27.253599 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.253853 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:27.254512 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '5fced73ef221129e43b240e4985e6342')[0m
D, [2015-06-05T23:19:27.254926 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '5fced73ef221129e43b240e4985e6342'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.255068 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.255370 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:27.255599 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.256062 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "name" = ? WHERE "users"."id" = ?  [["name", nil], ["id", 8]]
D, [2015-06-05T23:19:27.256426 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:27.256971 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != 'fdce6129c0bfa0f969eb910e05f27b8c')
D, [2015-06-05T23:19:27.257356 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'fdce6129c0bfa0f969eb910e05f27b8c'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.257562 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.257906 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" DESC LIMIT 1[0m
D, [2015-06-05T23:19:27.258316 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."lft" >= 13) AND ("users"."lft" < 18)  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.258882 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != 'fdce6129c0bfa0f969eb910e05f27b8c')[0m
D, [2015-06-05T23:19:27.259357 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '5fced73ef221129e43b240e4985e6342')
D, [2015-06-05T23:19:27.259567 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET lft = null, rgt = null[0m
D, [2015-06-05T23:19:27.260340 #98308] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:27.260623 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" IS NULL)  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T23:19:27.261023 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'abcd' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.261395 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'efgh' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T23:19:27.261538 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.262031 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 2], ["rgt", 3], ["id", 2]]
D, [2015-06-05T23:19:27.262395 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:27.262972 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'efgh')[0m
D, [2015-06-05T23:19:27.263375 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'efgh'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.263606 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.263950 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'ijkh' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.264298 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'lmno' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T23:19:27.264433 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.265025 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 5], ["rgt", 6], ["id", 4]]
D, [2015-06-05T23:19:27.265417 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:27.266000 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'lmno')[0m
D, [2015-06-05T23:19:27.266400 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'lmno'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.266630 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.266776 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.267232 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 4], ["rgt", 7], ["id", 3]]
D, [2015-06-05T23:19:27.267613 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.268175 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 4) AND ("users"."rgt" >= 7) AND ("users"."uuid" != 'ijkh')[0m
D, [2015-06-05T23:19:27.268558 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.268768 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.269100 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'pqrs' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.269247 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.269704 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 8], ["rgt", 9], ["id", 5]]
D, [2015-06-05T23:19:27.270056 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:27.270593 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 8) AND ("users"."rgt" >= 9) AND ("users"."uuid" != 'pqrs')
D, [2015-06-05T23:19:27.270983 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'pqrs'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.271204 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.271362 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.271843 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 1], ["rgt", 10], ["id", 1]]
D, [2015-06-05T23:19:27.272321 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:27.273027 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'abcd'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.273308 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.273651 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'tuvw' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.273807 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.274319 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 11], ["rgt", 12], ["id", 6]]
D, [2015-06-05T23:19:27.274710 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:27.275181 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'tuvw'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.275401 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.275736 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = '8e8ea22cb501bdb7f2f10f12728e54e1' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.276094 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'fdce6129c0bfa0f969eb910e05f27b8c' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T23:19:27.276239 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.276695 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 14], ["rgt", 15], ["id", 8]]
D, [2015-06-05T23:19:27.277065 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:27.277646 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != 'fdce6129c0bfa0f969eb910e05f27b8c')[0m
D, [2015-06-05T23:19:27.278054 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'fdce6129c0bfa0f969eb910e05f27b8c'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.278271 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.278589 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = '5fced73ef221129e43b240e4985e6342' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.278734 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.279202 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 16], ["rgt", 17], ["id", 9]]
D, [2015-06-05T23:19:27.279567 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:27.280158 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '5fced73ef221129e43b240e4985e6342')
D, [2015-06-05T23:19:27.280586 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '5fced73ef221129e43b240e4985e6342'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.280805 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.280945 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.281408 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 13], ["rgt", 18], ["id", 7]]
D, [2015-06-05T23:19:27.281790 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.282265 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '8e8ea22cb501bdb7f2f10f12728e54e1'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.282488 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.282869 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" DESC LIMIT 1
D, [2015-06-05T23:19:27.283294 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 13) AND ("users"."lft" < 18)  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.283891 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != 'fdce6129c0bfa0f969eb910e05f27b8c')
D, [2015-06-05T23:19:27.284524 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '5fced73ef221129e43b240e4985e6342')[0m
D, [2015-06-05T23:19:27.284908 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.285719 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.286650 #98308] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:27.287054 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.287379 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.287647 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.287962 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET lft = null
D, [2015-06-05T23:19:27.288590 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.288745 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.289060 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.293492 #98308] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:27.294033 #98308] DEBUG -- :   [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.294361 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.294673 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.294981 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET rgt = null
D, [2015-06-05T23:19:27.295692 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.295852 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.296207 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.296942 #98308] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:27.297346 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.297687 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.297961 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.298439 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.298790 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mDELETE FROM "users" WHERE "users"."uuid" = ?[0m  [["uuid", "ijkh"]]
D, [2015-06-05T23:19:27.299492 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:27.299871 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.300187 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.300492 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.300750 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.301077 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.301840 #98308] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:27.302203 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.302544 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.302835 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.303232 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:27.303446 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.303903 #98308] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'tuvw' AND "users"."id" != 6) LIMIT 1
D, [2015-06-05T23:19:27.304390 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "lft" = ? WHERE "users"."id" = ?[0m  [["lft", 0], ["id", 6]]
D, [2015-06-05T23:19:27.304752 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:27.305213 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'tuvw'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.305447 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.306144 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.306524 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.306855 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.307132 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.307371 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.307754 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.308511 #98308] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.308934 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.309276 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.309537 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.309984 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:27.310380 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10)  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.311019 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'efgh')[0m
D, [2015-06-05T23:19:27.311473 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 4) AND ("users"."rgt" >= 7) AND ("users"."uuid" != 'ijkh')
D, [2015-06-05T23:19:27.311933 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'lmno')[0m
D, [2015-06-05T23:19:27.312386 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 8) AND ("users"."rgt" >= 9) AND ("users"."uuid" != 'pqrs')
D, [2015-06-05T23:19:27.312591 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET lft = null, rgt = null[0m
D, [2015-06-05T23:19:27.313337 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:27.313609 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" IS NULL)  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T23:19:27.314017 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'abcd' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.314360 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'efgh' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T23:19:27.314524 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.314964 #98308] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'efgh' AND "users"."id" != 2) LIMIT 1[0m
D, [2015-06-05T23:19:27.315439 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 2], ["rgt", 3], ["id", 2]]
D, [2015-06-05T23:19:27.315790 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:27.316344 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'efgh')
D, [2015-06-05T23:19:27.316753 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'efgh'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.316990 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.317300 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'ijkh' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T23:19:27.317633 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'lmno' )  ORDER BY "users"."lft", "users"."rgt", id
D, [2015-06-05T23:19:27.317765 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.318187 #98308] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1
D, [2015-06-05T23:19:27.318628 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 5], ["rgt", 6], ["id", 4]]
D, [2015-06-05T23:19:27.318978 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:27.319536 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'lmno')[0m
D, [2015-06-05T23:19:27.319959 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'lmno'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.320271 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.320455 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.321019 #98308] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'ijkh' AND "users"."id" != 3) LIMIT 1[0m
D, [2015-06-05T23:19:27.321498 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 4], ["rgt", 7], ["id", 3]]
D, [2015-06-05T23:19:27.321886 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.322466 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 4) AND ("users"."rgt" >= 7) AND ("users"."uuid" != 'ijkh')
D, [2015-06-05T23:19:27.322874 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.323097 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.323405 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'pqrs' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T23:19:27.323566 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.324007 #98308] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'pqrs' AND "users"."id" != 5) LIMIT 1[0m
D, [2015-06-05T23:19:27.324450 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 8], ["rgt", 9], ["id", 5]]
D, [2015-06-05T23:19:27.324786 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:27.325359 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 8) AND ("users"."rgt" >= 9) AND ("users"."uuid" != 'pqrs')
D, [2015-06-05T23:19:27.325748 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'pqrs'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.325975 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.326111 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.326545 #98308] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'abcd' AND "users"."id" != 1) LIMIT 1
D, [2015-06-05T23:19:27.326986 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?[0m  [["lft", 1], ["rgt", 10], ["id", 1]]
D, [2015-06-05T23:19:27.327327 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:27.327778 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'abcd'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.327989 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.328317 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."parent_uuid" = 'tuvw' )  ORDER BY "users"."lft", "users"."rgt", id[0m
D, [2015-06-05T23:19:27.328463 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.328894 #98308] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'tuvw' AND "users"."id" != 6) LIMIT 1[0m
D, [2015-06-05T23:19:27.329337 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ?, "rgt" = ? WHERE "users"."id" = ?  [["lft", 11], ["rgt", 12], ["id", 6]]
D, [2015-06-05T23:19:27.329677 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:27.330106 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'tuvw'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.330307 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.331105 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:27.331484 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.331802 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.332086 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.332513 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T23:19:27.332909 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10)  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.333516 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'efgh')
D, [2015-06-05T23:19:27.334016 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 4) AND ("users"."rgt" >= 7) AND ("users"."uuid" != 'ijkh')[0m
D, [2015-06-05T23:19:27.334874 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'lmno')
D, [2015-06-05T23:19:27.335425 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 8) AND ("users"."rgt" >= 9) AND ("users"."uuid" != 'pqrs')[0m
D, [2015-06-05T23:19:27.335656 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.336267 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.336629 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.336956 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:27.337175 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.337454 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.337753 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:27.337943 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.338198 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.338491 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:27.338963 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10) AND ("users"."uuid" != 'abcd')  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.339356 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.339622 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.339925 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:27.340174 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:27.340485 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.340805 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:27.341128 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:27.341436 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:27.341614 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.341898 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.342733 #98308] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.343045 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.343264 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.343756 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ? WHERE "users"."id" = ?  [["lft", nil], ["id", 3]]
D, [2015-06-05T23:19:27.344127 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.344724 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= NULL) AND ("users"."rgt" >= 7) AND ("users"."uuid" != 'ijkh')
D, [2015-06-05T23:19:27.345128 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.345363 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.346108 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.346291 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.346663 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.347400 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:27.347709 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.347963 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.348472 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "rgt" = ? WHERE "users"."id" = ?[0m  [["rgt", nil], ["id", 3]]
D, [2015-06-05T23:19:27.348829 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.349429 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 4) AND ("users"."rgt" >= NULL) AND ("users"."uuid" != 'ijkh')[0m
D, [2015-06-05T23:19:27.349823 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.350026 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.350777 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:27.350941 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.351315 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.352042 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.352365 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:27.352613 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.353081 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "lft" = ? WHERE "users"."id" = ?  [["lft", 12], ["id", 6]]
D, [2015-06-05T23:19:27.353462 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:27.353927 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'tuvw'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.354142 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.354860 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:27.355020 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.355388 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.356136 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.356453 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.356747 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:27.356962 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.357409 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "lft" = ? WHERE "users"."id" = ?[0m  [["lft", 1], ["id", 3]]
D, [2015-06-05T23:19:27.357777 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.358361 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 1) AND ("users"."rgt" >= 7) AND ("users"."uuid" != 'ijkh')[0m
D, [2015-06-05T23:19:27.358757 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.358971 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.359724 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:27.359885 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.360233 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.360996 #98308] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.361355 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.361680 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:27.361883 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.362344 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "rgt" = ? WHERE "users"."id" = ?[0m  [["rgt", 10], ["id", 3]]
D, [2015-06-05T23:19:27.362706 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.363286 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 4) AND ("users"."rgt" >= 10) AND ("users"."uuid" != 'ijkh')[0m
D, [2015-06-05T23:19:27.363678 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.363894 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.364677 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:27.364839 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.365240 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.365499 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.365971 #98308] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '4c3fa8d7a308a32bbcef7bc4b38ecea0' LIMIT 1
D, [2015-06-05T23:19:27.366418 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:27.366776 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T23:19:27.367220 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Test 1"], ["uuid", "4c3fa8d7a308a32bbcef7bc4b38ecea0"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:27.367620 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:27.368084 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '4c3fa8d7a308a32bbcef7bc4b38ecea0'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.368291 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.368500 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.368914 #98308] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'd1b757650c5207190da8b51b7f5c0d92' LIMIT 1
D, [2015-06-05T23:19:27.369365 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:27.369699 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:27.370064 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Test 2"], ["uuid", "d1b757650c5207190da8b51b7f5c0d92"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:27.370554 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:27.371114 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'd1b757650c5207190da8b51b7f5c0d92'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.371366 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.371587 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.372040 #98308] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '856e7f882c553da1909b452f729a15d2' LIMIT 1
D, [2015-06-05T23:19:27.372491 #98308] DEBUG -- :   [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:27.372831 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:27.373276 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Test 3"], ["uuid", "856e7f882c553da1909b452f729a15d2"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T23:19:27.373679 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:27.374162 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '856e7f882c553da1909b452f729a15d2'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.374373 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.374608 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.375034 #98308] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'f35d266067c3d99987738ea68501a868' LIMIT 1
D, [2015-06-05T23:19:27.375468 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:27.375774 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:27.376194 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Test 4"], ["uuid", "f35d266067c3d99987738ea68501a868"], ["lft", 19], ["rgt", 20]]
D, [2015-06-05T23:19:27.376584 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T23:19:27.377044 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'f35d266067c3d99987738ea68501a868'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.377270 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.377399 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.377684 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:27.378007 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:27.378860 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 14 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 14 - 15 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'd1b757650c5207190da8b51b7f5c0d92' THEN '4c3fa8d7a308a32bbcef7bc4b38ecea0' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 14 AND 16 OR "users"."rgt" BETWEEN 14 AND 16)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.378962 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.379270 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:27.379490 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.379724 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:27.380398 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != 'd1b757650c5207190da8b51b7f5c0d92')[0m
D, [2015-06-05T23:19:27.380797 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'd1b757650c5207190da8b51b7f5c0d92'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.380938 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.381244 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:27.382077 #98308] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.382496 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.382837 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.383140 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.383491 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.383784 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:27.384462 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:27.385627 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 16 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 16 - 17 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '856e7f882c553da1909b452f729a15d2' THEN '4c3fa8d7a308a32bbcef7bc4b38ecea0' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 16 AND 18 OR "users"."rgt" BETWEEN 16 AND 18)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.385731 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.386092 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:27.386361 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.386613 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:27.387311 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != '856e7f882c553da1909b452f729a15d2')[0m
D, [2015-06-05T23:19:27.387734 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '856e7f882c553da1909b452f729a15d2'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.387878 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.388191 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:27.389023 #98308] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.389410 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.389730 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.389979 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.390290 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.390556 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:27.390929 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 10]]
D, [2015-06-05T23:19:27.391812 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 15 AND 18 THEN "lft" + 20 - 18 WHEN "lft" BETWEEN 19 AND 20 THEN "lft" + 15 - 19 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 15 AND 18 THEN "rgt" + 20 - 18 WHEN "rgt" BETWEEN 19 AND 20 THEN "rgt" + 15 - 19 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'f35d266067c3d99987738ea68501a868' THEN 'd1b757650c5207190da8b51b7f5c0d92' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 15 AND 20 OR "users"."rgt" BETWEEN 15 AND 20)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.391899 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.392176 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:27.392406 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.392671 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T23:19:27.393304 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 15) AND ("users"."rgt" >= 16) AND ("users"."uuid" != 'f35d266067c3d99987738ea68501a868')[0m
D, [2015-06-05T23:19:27.393703 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'f35d266067c3d99987738ea68501a868'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.393891 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.394200 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 10]]
D, [2015-06-05T23:19:27.395111 #98308] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.395510 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.395863 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.396132 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.396436 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.396967 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.397343 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.397515 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.397902 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:27.398454 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  DELETE FROM "users" WHERE ("users"."lft" >= 4) AND ("users"."lft" < 7) AND ("users"."uuid" != 'ijkh')
D, [2015-06-05T23:19:27.398853 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "lft" = ("lft" - 4) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" > 7)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.399217 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "rgt" = ("rgt" - 4) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."rgt" > 7)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.399491 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.399914 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 3]]
D, [2015-06-05T23:19:27.400211 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "users" WHERE "users"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T23:19:27.400320 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.401071 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.401466 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.401804 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.402082 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.402362 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.402786 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.403138 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.403290 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.403643 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:27.404182 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."lft" >= 4) AND ("users"."lft" < 7) AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.404613 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?[0m  [["user_id", 4]]
D, [2015-06-05T23:19:27.404869 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  DELETE FROM "users" WHERE "users"."id" = ?  [["id", 4]]
D, [2015-06-05T23:19:27.405317 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "lft" = ("lft" - 4) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" > 7)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.405664 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "rgt" = ("rgt" - 4) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."rgt" > 7)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.405940 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.406288 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 3]]
D, [2015-06-05T23:19:27.406519 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "users" WHERE "users"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T23:19:27.406623 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.407391 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.407786 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.408123 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.408406 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.408679 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.409165 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.409512 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.409669 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.410042 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:27.410567 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."lft" >= 4) AND ("users"."lft" < 7) AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.410994 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?[0m  [["user_id", 4]]
D, [2015-06-05T23:19:27.411269 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  DELETE FROM "users" WHERE "users"."id" = ?  [["id", 4]]
D, [2015-06-05T23:19:27.411665 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "lft" = ("lft" - 4) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" > 7)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.412022 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "rgt" = ("rgt" - 4) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."rgt" > 7)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.412298 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.412654 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 3]]
D, [2015-06-05T23:19:27.412873 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "users" WHERE "users"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T23:19:27.412977 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.413109 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.413244 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.413985 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.414375 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.414709 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.414988 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.415269 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.415746 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.416105 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.416438 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.416928 #98308] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '8ed0875303cbb25a174784d2536c3339' LIMIT 1[0m
D, [2015-06-05T23:19:27.417364 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.417704 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:27.418206 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "users" ("name", "parent_uuid", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?, ?)  [["name", "Child"], ["parent_uuid", "ijkh"], ["uuid", "8ed0875303cbb25a174784d2536c3339"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:27.418701 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."lft" LIMIT 1[0m  [["uuid", "ijkh"]]
D, [2015-06-05T23:19:27.419078 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:27.419967 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 7 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 7 - 13 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '8ed0875303cbb25a174784d2536c3339' THEN 'ijkh' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 7 AND 14 OR "users"."rgt" BETWEEN 7 AND 14)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.420245 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:27.420626 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.421318 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != '8ed0875303cbb25a174784d2536c3339')
D, [2015-06-05T23:19:27.421709 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '8ed0875303cbb25a174784d2536c3339'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.422041 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:27.422419 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.422935 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != '8ed0875303cbb25a174784d2536c3339')
D, [2015-06-05T23:19:27.423315 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '8ed0875303cbb25a174784d2536c3339'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.423514 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.423879 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1[0m  [["uuid", "ijkh"]]
D, [2015-06-05T23:19:27.424768 #98308] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:27.425174 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.425514 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.425775 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.426070 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.426461 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.426799 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.427149 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.427600 #98308] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'f2222063f8b6986fc8fee708b0d3ff21' LIMIT 1
D, [2015-06-05T23:19:27.428137 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:27.428493 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T23:19:27.428925 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "parent_uuid", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?, ?)[0m  [["name", "Child"], ["parent_uuid", "ijkh"], ["uuid", "f2222063f8b6986fc8fee708b0d3ff21"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:27.429346 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."lft" LIMIT 1  [["uuid", "ijkh"]]
D, [2015-06-05T23:19:27.429680 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.430569 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 7 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 7 - 13 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'f2222063f8b6986fc8fee708b0d3ff21' THEN 'ijkh' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 7 AND 14 OR "users"."rgt" BETWEEN 7 AND 14)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.430884 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:27.431274 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:27.432042 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != 'f2222063f8b6986fc8fee708b0d3ff21')[0m
D, [2015-06-05T23:19:27.432485 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'f2222063f8b6986fc8fee708b0d3ff21'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.432859 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.433250 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:27.433777 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != 'f2222063f8b6986fc8fee708b0d3ff21')[0m
D, [2015-06-05T23:19:27.434169 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'f2222063f8b6986fc8fee708b0d3ff21'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.434420 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.434930 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1  [["uuid", "ijkh"]]
D, [2015-06-05T23:19:27.436145 #98308] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.436590 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.436938 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.437203 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.437502 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.437917 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.438201 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.438697 #98308] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'ad13b8773bb0de303debc675b2723397' LIMIT 1
D, [2015-06-05T23:19:27.439124 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:27.439501 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T23:19:27.439937 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "New Root"], ["uuid", "ad13b8773bb0de303debc675b2723397"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:27.440352 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:27.440834 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ad13b8773bb0de303debc675b2723397'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.441071 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.441891 #98308] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.442258 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.442599 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.442889 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.443160 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.443561 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.443920 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:27.444200 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:27.444402 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.444891 #98308] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1
D, [2015-06-05T23:19:27.445389 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?[0m  [["parent_uuid", "pqrs"], ["id", 4]]
D, [2015-06-05T23:19:27.445788 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."lft" LIMIT 1  [["uuid", "pqrs"]]
D, [2015-06-05T23:19:27.446125 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 4]]
D, [2015-06-05T23:19:27.446973 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 5 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 5 - 7 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'lmno' THEN 'pqrs' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 5 AND 8 OR "users"."rgt" BETWEEN 5 AND 8)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.447281 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 5]]
D, [2015-06-05T23:19:27.447650 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:27.448336 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != 'lmno')[0m
D, [2015-06-05T23:19:27.448723 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'lmno'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.449078 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 4]]
D, [2015-06-05T23:19:27.449473 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:27.449975 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != 'lmno')[0m
D, [2015-06-05T23:19:27.450369 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'lmno'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.450570 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.450864 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:27.451184 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:27.451518 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1  [["uuid", "pqrs"]]
D, [2015-06-05T23:19:27.452384 #98308] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.452803 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.453140 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.453412 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.453681 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.454088 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.454434 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:27.454752 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:27.454986 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.455470 #98308] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1
D, [2015-06-05T23:19:27.456017 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?[0m  [["parent_uuid", "pqrs"], ["id", 4]]
D, [2015-06-05T23:19:27.456417 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."lft" LIMIT 1  [["uuid", "pqrs"]]
D, [2015-06-05T23:19:27.456761 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 4]]
D, [2015-06-05T23:19:27.457653 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 5 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 5 - 7 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'lmno' THEN 'pqrs' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 5 AND 8 OR "users"."rgt" BETWEEN 5 AND 8)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.457947 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 5]]
D, [2015-06-05T23:19:27.458322 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:27.458998 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != 'lmno')[0m
D, [2015-06-05T23:19:27.459400 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'lmno'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.459730 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 4]]
D, [2015-06-05T23:19:27.460120 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:27.460642 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != 'lmno')[0m
D, [2015-06-05T23:19:27.461021 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'lmno'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.461254 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.461532 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:27.461848 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:27.462198 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1  [["uuid", "pqrs"]]
D, [2015-06-05T23:19:27.463090 #98308] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.463479 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.463828 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.464115 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.464420 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.464838 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.465193 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:27.465418 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.465910 #98308] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1[0m
D, [2015-06-05T23:19:27.466403 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?  [["parent_uuid", nil], ["id", 4]]
D, [2015-06-05T23:19:27.466728 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:27.467088 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T23:19:27.467393 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT "users"."rgt" FROM "users"  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.468172 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 12 - 6 WHEN "lft" BETWEEN 7 AND 12 THEN "lft" + 5 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 12 - 6 WHEN "rgt" BETWEEN 7 AND 12 THEN "rgt" + 5 - 7 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'lmno' THEN NULL ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 5 AND 12 OR "users"."rgt" BETWEEN 5 AND 12)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.468469 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 4]]
D, [2015-06-05T23:19:27.468840 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:27.469399 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'lmno'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.469732 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T23:19:27.470110 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:27.470541 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'lmno'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.470764 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.471542 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:27.471939 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.472307 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.472620 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.472955 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.473381 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.473757 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.474242 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.475112 #98308] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '4f504e80b7fa6d6d1baf6c8105309b7a' LIMIT 1
D, [2015-06-05T23:19:27.475567 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:27.475916 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T23:19:27.476363 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "parent_uuid", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?, ?)[0m  [["name", "Child"], ["parent_uuid", "ijkh"], ["uuid", "4f504e80b7fa6d6d1baf6c8105309b7a"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:27.476789 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."lft" LIMIT 1  [["uuid", "ijkh"]]
D, [2015-06-05T23:19:27.477115 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.478002 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 7 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 7 - 13 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '4f504e80b7fa6d6d1baf6c8105309b7a' THEN 'ijkh' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 7 AND 14 OR "users"."rgt" BETWEEN 7 AND 14)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.478310 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:27.478693 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:27.479360 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != '4f504e80b7fa6d6d1baf6c8105309b7a')[0m
D, [2015-06-05T23:19:27.479771 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '4f504e80b7fa6d6d1baf6c8105309b7a'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.480100 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.480488 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:27.480996 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != '4f504e80b7fa6d6d1baf6c8105309b7a')[0m
D, [2015-06-05T23:19:27.481381 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '4f504e80b7fa6d6d1baf6c8105309b7a'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.481600 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.482513 #98308] DEBUG -- :   [1m[35m (0.2ms)[0m  SELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))
D, [2015-06-05T23:19:27.482901 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.483253 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.483541 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.483813 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.484261 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.485042 #98308] DEBUG -- :   [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T23:19:27.485608 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10)  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.486388 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."name" = ? LIMIT 1  [["name", "Child 1"]]
D, [2015-06-05T23:19:27.486892 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.487388 #98308] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '88ebe92eb441d4ffb92e89d84b135831' LIMIT 1
D, [2015-06-05T23:19:27.487842 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:27.488215 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T23:19:27.488667 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Child 1.1"], ["uuid", "88ebe92eb441d4ffb92e89d84b135831"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:27.489076 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:27.489576 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '88ebe92eb441d4ffb92e89d84b135831'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.489791 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.489895 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.490318 #98308] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '4981e280e9cb66331090c4a3956704c7' LIMIT 1
D, [2015-06-05T23:19:27.490740 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:27.491061 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:27.491495 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Child 1.1.1"], ["uuid", "4981e280e9cb66331090c4a3956704c7"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:27.491878 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:27.492346 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '4981e280e9cb66331090c4a3956704c7'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.492562 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.492670 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.493091 #98308] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '80ae068bdac6fa4083f37f2f2b128005' LIMIT 1
D, [2015-06-05T23:19:27.493513 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:27.493842 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:27.494258 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Child 1.1.1.1"], ["uuid", "80ae068bdac6fa4083f37f2f2b128005"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T23:19:27.494654 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:27.495133 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '80ae068bdac6fa4083f37f2f2b128005'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.495345 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.495446 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.495881 #98308] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'cb9f464277383d8c950e6457ea4713a5' LIMIT 1
D, [2015-06-05T23:19:27.496327 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:27.496678 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:27.497105 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mINSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)[0m  [["name", "Child 1.2"], ["uuid", "cb9f464277383d8c950e6457ea4713a5"], ["lft", 19], ["rgt", 20]]
D, [2015-06-05T23:19:27.497513 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T23:19:27.498007 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'cb9f464277383d8c950e6457ea4713a5'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.498226 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.498365 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.498663 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:27.499020 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.499893 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 3 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 3 - 13 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '88ebe92eb441d4ffb92e89d84b135831' THEN 'efgh' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 3 AND 14 OR "users"."rgt" BETWEEN 3 AND 14)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.499979 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.500274 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:27.500501 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.500765 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:27.501478 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 3) AND ("users"."rgt" >= 4) AND ("users"."uuid" != '88ebe92eb441d4ffb92e89d84b135831')[0m
D, [2015-06-05T23:19:27.501880 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '88ebe92eb441d4ffb92e89d84b135831'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.502033 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.502347 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:27.502538 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.502802 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 7]]
D, [2015-06-05T23:19:27.503160 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:27.503950 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 14 THEN "lft" + 16 - 14 WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 4 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 14 THEN "rgt" + 16 - 14 WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 4 - 15 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '4981e280e9cb66331090c4a3956704c7' THEN '88ebe92eb441d4ffb92e89d84b135831' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 4 AND 16 OR "users"."rgt" BETWEEN 4 AND 16)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.504050 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.504328 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:27.504534 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.504767 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:27.505358 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 4) AND ("users"."rgt" >= 5) AND ("users"."uuid" != '4981e280e9cb66331090c4a3956704c7')[0m
D, [2015-06-05T23:19:27.505720 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 3 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '4981e280e9cb66331090c4a3956704c7'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.505860 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.506127 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:27.509910 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.510355 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:27.510715 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:27.511670 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 5 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 5 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 5 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 5 - 17 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '80ae068bdac6fa4083f37f2f2b128005' THEN '4981e280e9cb66331090c4a3956704c7' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 5 AND 18 OR "users"."rgt" BETWEEN 5 AND 18)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.511826 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.512104 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 8]]
D, [2015-06-05T23:19:27.512329 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.512562 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:27.513222 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6) AND ("users"."uuid" != '80ae068bdac6fa4083f37f2f2b128005')[0m
D, [2015-06-05T23:19:27.513603 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 4 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '80ae068bdac6fa4083f37f2f2b128005'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.513745 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.514050 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:27.514233 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.514523 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:27.514865 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 10]]
D, [2015-06-05T23:19:27.515668 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 9 AND 18 THEN "lft" + 20 - 18 WHEN "lft" BETWEEN 19 AND 20 THEN "lft" + 9 - 19 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 9 AND 18 THEN "rgt" + 20 - 18 WHEN "rgt" BETWEEN 19 AND 20 THEN "rgt" + 9 - 19 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'cb9f464277383d8c950e6457ea4713a5' THEN 'efgh' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 9 AND 20 OR "users"."rgt" BETWEEN 9 AND 20)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.515782 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.516056 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:27.516278 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.516531 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 10]]
D, [2015-06-05T23:19:27.517153 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 9) AND ("users"."rgt" >= 10) AND ("users"."uuid" != 'cb9f464277383d8c950e6457ea4713a5')[0m
D, [2015-06-05T23:19:27.517548 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'cb9f464277383d8c950e6457ea4713a5'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.517703 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.518330 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 10]]
D, [2015-06-05T23:19:27.518910 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:27.519408 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 18)  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.519910 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.520546 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.520880 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL[0m
D, [2015-06-05T23:19:27.521234 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.521463 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.521735 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.522128 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:27.522465 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:27.522641 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.522930 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.523204 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:27.523738 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE ("users"."lft" <= 8) AND ("users"."rgt" >= 9) AND "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T23:19:27.524019 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:27.524208 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.524488 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.524752 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.525005 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.525313 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:27.525630 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:27.525793 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.526050 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.526341 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE (rgt - lft = 1)
D, [2015-06-05T23:19:27.526713 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."rgt" - "users"."lft" = 1)  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.527152 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."rgt" - "users"."lft" = 1)
D, [2015-06-05T23:19:27.527492 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:27.527748 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."rgt" - "users"."lft" = 1)  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.528190 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:27.528434 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."rgt" - "users"."lft" = 1)  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.528841 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:27.529109 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."rgt" - "users"."lft" = 1)  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.529508 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:27.529772 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE ("users"."rgt" - "users"."lft" = 1)  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.529995 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.530285 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.530583 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:27.530908 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:27.531212 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:27.531484 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:27.531773 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:27.532099 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.532361 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.532687 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.532983 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:27.533337 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1  [["uuid", "ijkh"]]
D, [2015-06-05T23:19:27.533640 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.533809 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.534105 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.534419 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:27.534728 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:27.535018 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.535459 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6)  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.535669 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.535989 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.536293 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:27.536583 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-05T23:19:27.536858 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.537298 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'lmno')  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.537486 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.537797 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.538094 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.538391 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:27.538666 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:27.539034 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd'  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.539400 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:27.539657 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:27.539987 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.540217 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.540540 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.540853 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.541121 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:27.541403 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:27.541805 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.542010 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.542324 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.542628 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:27.542897 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:27.543172 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:27.543459 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:27.543951 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10) AND ("users"."uuid" != 'abcd') AND ("users"."rgt" - "users"."lft" = 1)  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.544180 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.544596 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.544906 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:27.545228 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:27.545774 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 2) AND ("users"."rgt" >= 3) AND ("users"."uuid" != 'efgh')
D, [2015-06-05T23:19:27.546037 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:27.546513 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'lmno')
D, [2015-06-05T23:19:27.546646 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.547085 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.547445 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:27.547822 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1  [["uuid", "abcd"]]
D, [2015-06-05T23:19:27.548042 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.548434 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.548740 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.549307 #98308] DEBUG -- :   [1m[35mNoDepth Load (0.1ms)[0m  SELECT  "no_depths".* FROM "no_depths"  ORDER BY "no_depths"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.549647 #98308] DEBUG -- :   [1m[36mNoDepth Load (0.1ms)[0m  [1mSELECT  "no_depths".* FROM "no_depths"  ORDER BY "no_depths"."rgt" desc LIMIT 1[0m
D, [2015-06-05T23:19:27.550012 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "no_depths" ("name", "lft", "rgt") VALUES (?, ?, ?)  [["name", "shallow"], ["lft", 1], ["rgt", 2]]
D, [2015-06-05T23:19:27.550289 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.550590 #98308] DEBUG -- :   [1m[35mNoDepth Load (0.1ms)[0m  SELECT  "no_depths".* FROM "no_depths"  ORDER BY "no_depths"."id" ASC LIMIT 1
D, [2015-06-05T23:19:27.550743 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.551119 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.551962 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(DISTINCT "no_depths"."id") FROM "no_depths" LEFT OUTER JOIN "no_depths" "parent" ON "parent"."id" = "no_depths"."parent_id" WHERE ((("no_depths"."lft" IS NULL OR "no_depths"."rgt" IS NULL) OR "no_depths"."lft" >= "no_depths"."rgt") OR "no_depths"."parent_id" IS NOT NULL AND ("no_depths"."lft" <= "parent"."lft" OR "no_depths"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.552368 #98308] DEBUG -- :   [1m[35mNoDepth Load (0.1ms)[0m  SELECT  "no_depths"."lft", COUNT("no_depths"."lft") as _count FROM "no_depths" GROUP BY "no_depths"."lft", "no_depths"."id" HAVING COUNT("no_depths"."lft") > 1  ORDER BY "no_depths"."id" LIMIT 1
D, [2015-06-05T23:19:27.552696 #98308] DEBUG -- :   [1m[36mNoDepth Load (0.1ms)[0m  [1mSELECT  "no_depths"."rgt", COUNT("no_depths"."rgt") as _count FROM "no_depths" GROUP BY "no_depths"."rgt", "no_depths"."id" HAVING COUNT("no_depths"."rgt") > 1  ORDER BY "no_depths"."id" LIMIT 1[0m
D, [2015-06-05T23:19:27.552948 #98308] DEBUG -- :   [1m[35mNoDepth Load (0.1ms)[0m  SELECT "no_depths".* FROM "no_depths" WHERE "no_depths"."parent_id" IS NULL  ORDER BY "no_depths"."lft"
D, [2015-06-05T23:19:27.553264 #98308] DEBUG -- :   [1m[36mNoDepth Load (0.1ms)[0m  [1mSELECT  "no_depths".* FROM "no_depths"  ORDER BY "no_depths"."id" ASC LIMIT 1[0m
D, [2015-06-05T23:19:27.553455 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.553968 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.554285 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.554891 #98308] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '8c42551b7ee65d919bbe627f84c9fe8a' LIMIT 1[0m
D, [2015-06-05T23:19:27.555411 #98308] DEBUG -- :   [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.555852 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:27.556365 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "District Manager"], ["uuid", "8c42551b7ee65d919bbe627f84c9fe8a"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:27.556773 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.557298 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '8c42551b7ee65d919bbe627f84c9fe8a'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.557507 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.557718 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.558172 #98308] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'a0035e4bc35f877dab1e7c7b3a7f016d' LIMIT 1[0m
D, [2015-06-05T23:19:27.558627 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.558938 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.559369 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "CEO"], ["uuid", "a0035e4bc35f877dab1e7c7b3a7f016d"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:27.559750 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:27.560225 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'a0035e4bc35f877dab1e7c7b3a7f016d'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.560432 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.560556 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.560832 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:27.561193 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:27.562045 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 15 - 14 WHEN "lft" BETWEEN 15 AND 15 THEN "lft" + 13 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 15 - 14 WHEN "rgt" BETWEEN 15 AND 15 THEN "rgt" + 13 - 15 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '8c42551b7ee65d919bbe627f84c9fe8a' THEN 'a0035e4bc35f877dab1e7c7b3a7f016d' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 13 AND 15 OR "users"."rgt" BETWEEN 13 AND 15)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.562129 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.562435 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:27.562637 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.562889 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.563587 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '8c42551b7ee65d919bbe627f84c9fe8a')
D, [2015-06-05T23:19:27.563979 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '8c42551b7ee65d919bbe627f84c9fe8a'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.564111 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.564404 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.564649 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.565076 #98308] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '9a9dc356361300939d1dc111507afddd' LIMIT 1[0m
D, [2015-06-05T23:19:27.565510 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.565821 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:27.566236 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Store Manager"], ["uuid", "9a9dc356361300939d1dc111507afddd"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T23:19:27.566642 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:27.567373 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '9a9dc356361300939d1dc111507afddd'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.567766 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.567917 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.568276 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.568659 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:27.569578 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 15 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 15 - 17 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '9a9dc356361300939d1dc111507afddd' THEN '8c42551b7ee65d919bbe627f84c9fe8a' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 15 AND 18 OR "users"."rgt" BETWEEN 15 AND 18)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.569666 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.569978 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.570184 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.570434 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:27.571082 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 15) AND ("users"."rgt" >= 16) AND ("users"."uuid" != '9a9dc356361300939d1dc111507afddd')
D, [2015-06-05T23:19:27.571465 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '9a9dc356361300939d1dc111507afddd'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.571588 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.571874 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:27.572122 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.572569 #98308] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'f70c3d7164406b5ab8461dadbe48258e' LIMIT 1[0m
D, [2015-06-05T23:19:27.572998 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.573308 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:27.573752 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Cashier"], ["uuid", "f70c3d7164406b5ab8461dadbe48258e"], ["lft", 19], ["rgt", 20]]
D, [2015-06-05T23:19:27.574153 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 10]]
D, [2015-06-05T23:19:27.574637 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'f70c3d7164406b5ab8461dadbe48258e'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.574848 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.574972 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.575262 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:27.575609 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 10]]
D, [2015-06-05T23:19:27.576436 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 18 THEN "lft" + 20 - 18 WHEN "lft" BETWEEN 19 AND 20 THEN "lft" + 16 - 19 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 18 THEN "rgt" + 20 - 18 WHEN "rgt" BETWEEN 19 AND 20 THEN "rgt" + 16 - 19 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'f70c3d7164406b5ab8461dadbe48258e' THEN '9a9dc356361300939d1dc111507afddd' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 16 AND 20 OR "users"."rgt" BETWEEN 16 AND 20)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.576522 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.576815 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:27.577014 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.577271 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 10]]
D, [2015-06-05T23:19:27.577915 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != 'f70c3d7164406b5ab8461dadbe48258e')
D, [2015-06-05T23:19:27.578278 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 3 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'f70c3d7164406b5ab8461dadbe48258e'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.578421 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.578688 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 10]]
D, [2015-06-05T23:19:27.579007 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:27.579317 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.579637 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:27.579931 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 10]]
D, [2015-06-05T23:19:27.580170 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.580687 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.580954 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.581491 #98308] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '6bd451a0a7bbf76eb14e31d165d3df44' LIMIT 1[0m
D, [2015-06-05T23:19:27.581940 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.582330 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:27.582763 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "District Manager"], ["uuid", "6bd451a0a7bbf76eb14e31d165d3df44"], ["lft", 13], ["rgt", 14]]
D, [2015-06-05T23:19:27.583166 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.583647 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '6bd451a0a7bbf76eb14e31d165d3df44'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.583875 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.584090 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.584533 #98308] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '298264af4e59c433cd04cf06b89c7970' LIMIT 1[0m
D, [2015-06-05T23:19:27.584963 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.585272 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.585683 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "CEO"], ["uuid", "298264af4e59c433cd04cf06b89c7970"], ["lft", 15], ["rgt", 16]]
D, [2015-06-05T23:19:27.586070 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:27.586544 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '298264af4e59c433cd04cf06b89c7970'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.586774 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.586905 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.587180 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:27.587497 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:27.588342 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 15 - 14 WHEN "lft" BETWEEN 15 AND 15 THEN "lft" + 13 - 15 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 15 - 14 WHEN "rgt" BETWEEN 15 AND 15 THEN "rgt" + 13 - 15 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '6bd451a0a7bbf76eb14e31d165d3df44' THEN '298264af4e59c433cd04cf06b89c7970' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 13 AND 15 OR "users"."rgt" BETWEEN 13 AND 15)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.588451 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.588727 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:27.588977 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.589236 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.589874 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 14) AND ("users"."rgt" >= 15) AND ("users"."uuid" != '6bd451a0a7bbf76eb14e31d165d3df44')
D, [2015-06-05T23:19:27.590285 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '6bd451a0a7bbf76eb14e31d165d3df44'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.590421 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.590721 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.590972 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.591416 #98308] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'fd04206a917f7985ad26b57d7ac97a39' LIMIT 1[0m
D, [2015-06-05T23:19:27.591850 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.592172 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:27.592603 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Store Manager"], ["uuid", "fd04206a917f7985ad26b57d7ac97a39"], ["lft", 17], ["rgt", 18]]
D, [2015-06-05T23:19:27.592993 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:27.593450 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'fd04206a917f7985ad26b57d7ac97a39'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.593653 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.593777 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.594059 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.594401 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 9]]
D, [2015-06-05T23:19:27.595248 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 15 AND 16 THEN "lft" + 18 - 16 WHEN "lft" BETWEEN 17 AND 18 THEN "lft" + 15 - 17 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 15 AND 16 THEN "rgt" + 18 - 16 WHEN "rgt" BETWEEN 17 AND 18 THEN "rgt" + 15 - 17 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'fd04206a917f7985ad26b57d7ac97a39' THEN '6bd451a0a7bbf76eb14e31d165d3df44' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 15 AND 18 OR "users"."rgt" BETWEEN 15 AND 18)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.595334 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.595628 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.595830 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.596089 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:27.596743 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 15) AND ("users"."rgt" >= 16) AND ("users"."uuid" != 'fd04206a917f7985ad26b57d7ac97a39')
D, [2015-06-05T23:19:27.597144 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'fd04206a917f7985ad26b57d7ac97a39'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.597288 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.597602 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:27.597858 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.598311 #98308] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'a52c9e346a0d94c5f8414f5a88f95d38' LIMIT 1[0m
D, [2015-06-05T23:19:27.598742 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."rgt" desc LIMIT 1
D, [2015-06-05T23:19:27.599071 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:27.599481 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  INSERT INTO "users" ("name", "uuid", "lft", "rgt") VALUES (?, ?, ?, ?)  [["name", "Cashier"], ["uuid", "a52c9e346a0d94c5f8414f5a88f95d38"], ["lft", 19], ["rgt", 20]]
D, [2015-06-05T23:19:27.599874 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 10]]
D, [2015-06-05T23:19:27.600389 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'a52c9e346a0d94c5f8414f5a88f95d38'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.600599 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.600719 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.601008 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 9]]
D, [2015-06-05T23:19:27.601333 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 10]]
D, [2015-06-05T23:19:27.602164 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 16 AND 18 THEN "lft" + 20 - 18 WHEN "lft" BETWEEN 19 AND 20 THEN "lft" + 16 - 19 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 16 AND 18 THEN "rgt" + 20 - 18 WHEN "rgt" BETWEEN 19 AND 20 THEN "rgt" + 16 - 19 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'a52c9e346a0d94c5f8414f5a88f95d38' THEN 'fd04206a917f7985ad26b57d7ac97a39' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 16 AND 20 OR "users"."rgt" BETWEEN 16 AND 20)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.602276 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.602549 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 9]]
D, [2015-06-05T23:19:27.602779 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.603037 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 10]]
D, [2015-06-05T23:19:27.603664 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 16) AND ("users"."rgt" >= 17) AND ("users"."uuid" != 'a52c9e346a0d94c5f8414f5a88f95d38')
D, [2015-06-05T23:19:27.604045 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 3 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'a52c9e346a0d94c5f8414f5a88f95d38'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.604195 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.604467 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 10]]
D, [2015-06-05T23:19:27.604803 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:27.605104 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.605404 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:27.605729 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 10]]
D, [2015-06-05T23:19:27.605905 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.606171 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 8]]
D, [2015-06-05T23:19:27.606506 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 7]]
D, [2015-06-05T23:19:27.607318 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 14 AND 19 THEN "lft" + 20 - 19 WHEN "lft" BETWEEN 20 AND 20 THEN "lft" + 14 - 20 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 14 AND 19 THEN "rgt" + 20 - 19 WHEN "rgt" BETWEEN 20 AND 20 THEN "rgt" + 14 - 20 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = '6bd451a0a7bbf76eb14e31d165d3df44' THEN NULL ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 14 AND 20 OR "users"."rgt" BETWEEN 14 AND 20)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.607402 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.607711 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 8]]
D, [2015-06-05T23:19:27.607909 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.608164 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.608688 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = '6bd451a0a7bbf76eb14e31d165d3df44'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.609203 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = "depth" - 1 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" >= 15) AND ("users"."lft" < 20) AND ("users"."uuid" != '6bd451a0a7bbf76eb14e31d165d3df44')  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.609285 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.609572 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 7]]
D, [2015-06-05T23:19:27.609890 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 8]]
D, [2015-06-05T23:19:27.610167 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 7]]
D, [2015-06-05T23:19:27.610460 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 9]]
D, [2015-06-05T23:19:27.610773 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 10]]
D, [2015-06-05T23:19:27.611001 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.611637 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.611992 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:27.612302 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:27.612991 #98308] DEBUG -- :   [1m[35mUser Exists (0.0ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1  [["parent_uuid", "pqrs"]]
D, [2015-06-05T23:19:27.613135 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.613397 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:27.613742 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T23:19:27.614608 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 8 - 3 WHEN "lft" BETWEEN 4 AND 8 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 8 - 3 WHEN "rgt" BETWEEN 4 AND 8 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'efgh' THEN 'pqrs' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 2 AND 8 OR "users"."rgt" BETWEEN 2 AND 8)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.614694 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.614978 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 5]]
D, [2015-06-05T23:19:27.615208 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.615483 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:27.616577 #98308] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 7) AND ("users"."rgt" >= 8) AND ("users"."uuid" != 'efgh')[0m
D, [2015-06-05T23:19:27.617153 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'efgh'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.617321 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.617712 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:27.618728 #98308] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSELECT COUNT(DISTINCT "users"."id") FROM "users" LEFT OUTER JOIN "users" "parent" ON "parent"."uuid" = "users"."parent_uuid" WHERE ((("users"."lft" IS NULL OR "users"."rgt" IS NULL) OR "users"."lft" >= "users"."rgt") OR "users"."parent_uuid" IS NOT NULL AND ("users"."lft" <= "parent"."lft" OR "users"."rgt" >= "parent"."rgt"))[0m
D, [2015-06-05T23:19:27.619149 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users"."lft", COUNT("users"."lft") as _count FROM "users" GROUP BY "users"."lft", "users"."uuid" HAVING COUNT("users"."lft") > 1  ORDER BY "users"."uuid" LIMIT 1
D, [2015-06-05T23:19:27.619506 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users"."rgt", COUNT("users"."rgt") as _count FROM "users" GROUP BY "users"."rgt", "users"."uuid" HAVING COUNT("users"."rgt") > 1  ORDER BY "users"."uuid" LIMIT 1[0m
D, [2015-06-05T23:19:27.619790 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft"
D, [2015-06-05T23:19:27.620046 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.620422 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.620765 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:27.621085 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.621750 #98308] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-05T23:19:27.622141 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?  [["parent_uuid", "ijkh"]]
D, [2015-06-05T23:19:27.622484 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft"[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-05T23:19:27.622806 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.623078 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:27.623439 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:27.624307 #98308] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 4 - 3 WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 4 - 3 WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'efgh' THEN 'ijkh' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 2 AND 4 OR "users"."rgt" BETWEEN 2 AND 4)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.624393 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.624681 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 4]]
D, [2015-06-05T23:19:27.624876 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.625124 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-05T23:19:27.625766 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 3) AND ("users"."rgt" >= 4) AND ("users"."uuid" != 'efgh')
D, [2015-06-05T23:19:27.626149 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'efgh'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.626280 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.626539 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T23:19:27.626881 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:27.627213 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.627444 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.627787 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.628076 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:27.628386 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.629040 #98308] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1  [["parent_uuid", "ijkh"]]
D, [2015-06-05T23:19:27.629419 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-05T23:19:27.629967 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "lft" DESC LIMIT 1  [["parent_uuid", "ijkh"]]
D, [2015-06-05T23:19:27.630203 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.630531 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-05T23:19:27.630921 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 2]]
D, [2015-06-05T23:19:27.631868 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 3 THEN "lft" + 6 - 3 WHEN "lft" BETWEEN 4 AND 6 THEN "lft" + 2 - 4 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 3 THEN "rgt" + 6 - 3 WHEN "rgt" BETWEEN 4 AND 6 THEN "rgt" + 2 - 4 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'efgh' THEN 'ijkh' ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 2 AND 6 OR "users"."rgt" BETWEEN 2 AND 6)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.631966 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.632288 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T23:19:27.632540 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.632791 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-05T23:19:27.633501 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE ("users"."lft" <= 5) AND ("users"."rgt" >= 6) AND ("users"."uuid" != 'efgh')[0m
D, [2015-06-05T23:19:27.633944 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 2 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'efgh'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.634078 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.634367 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:27.634709 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-05T23:19:27.635040 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.635274 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.635752 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.636071 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.636566 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.636848 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-05T23:19:27.637209 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:27.637536 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT "users"."rgt" FROM "users"  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.638334 #98308] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "users" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 7 THEN "lft" + 12 - 7 WHEN "lft" BETWEEN 8 AND 12 THEN "lft" + 4 - 8 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 7 THEN "rgt" + 12 - 7 WHEN "rgt" BETWEEN 8 AND 12 THEN "rgt" + 4 - 8 ELSE "rgt" END, "parent_uuid" = CASE WHEN "uuid" = 'ijkh' THEN NULL ELSE "parent_uuid" END WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" BETWEEN 4 AND 12 OR "users"."rgt" BETWEEN 4 AND 12)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.638439 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.638724 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:27.638928 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.639181 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-05T23:19:27.639775 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'ijkh'  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.639923 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.640216 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 3]]
D, [2015-06-05T23:19:27.640449 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.640845 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.641146 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-05T23:19:27.641404 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.641709 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.642018 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:27.642228 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.642728 #98308] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'pqrs' AND "users"."id" != 5) LIMIT 1[0m
D, [2015-06-05T23:19:27.643212 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?  [["parent_uuid", nil], ["id", 5]]
D, [2015-06-05T23:19:27.643595 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-05T23:19:27.644058 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'pqrs'  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.644279 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.644431 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.644936 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.645350 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T23:19:27.645792 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10)  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.646181 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.646530 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.646888 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T23:19:27.647324 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10)  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.647953 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.648385 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.648753 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T23:19:27.648942 #98308] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.649299 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T23:19:27.649845 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10) AND ("users"."uuid" != 'abcd')  ORDER BY "users"."lft"[0m
D, [2015-06-05T23:19:27.650339 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 2]]
D, [2015-06-05T23:19:27.650589 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "users" WHERE "users"."id" = ?[0m  [["id", 2]]
D, [2015-06-05T23:19:27.650913 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 3]]
D, [2015-06-05T23:19:27.651145 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "users" WHERE "users"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T23:19:27.651427 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 4]]
D, [2015-06-05T23:19:27.651697 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "users" WHERE "users"."id" = ?[0m  [["id", 4]]
D, [2015-06-05T23:19:27.651980 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 5]]
D, [2015-06-05T23:19:27.652211 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "users" WHERE "users"."id" = ?[0m  [["id", 5]]
D, [2015-06-05T23:19:27.652630 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "lft" = ("lft" - 10) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" > 10)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.652995 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "rgt" = ("rgt" - 10) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."rgt" > 10)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.653278 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:27.653611 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?[0m  [["user_id", 1]]
D, [2015-06-05T23:19:27.654245 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T23:19:27.654945 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" >= 1) AND ("notes"."lft" < 10) AND ("notes"."id" != 1)[0m  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T23:19:27.655453 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "lft" = ("lft" - 10) WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" > 10)  ORDER BY "notes"."lft")  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T23:19:27.655942 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "rgt" = ("rgt" - 10) WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."rgt" > 10)  ORDER BY "notes"."lft")[0m  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T23:19:27.656239 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:27.656526 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 1]]
D, [2015-06-05T23:19:27.656891 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:27.657140 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 2]]
D, [2015-06-05T23:19:27.657446 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:27.657684 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T23:19:27.657997 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T23:19:27.658221 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 4]]
D, [2015-06-05T23:19:27.658530 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  DELETE FROM "users" WHERE "users"."id" = ?  [["id", 1]]
D, [2015-06-05T23:19:27.658652 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.659186 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."uuid" = ?  [["uuid", "abcd"]]
D, [2015-06-05T23:19:27.659543 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?[0m  [["parent_uuid", "abcd"]]
D, [2015-06-05T23:19:27.659703 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.660501 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.660953 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T23:19:27.661165 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.661554 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T23:19:27.662098 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mDELETE FROM "users" WHERE ("users"."lft" >= 1) AND ("users"."lft" < 10) AND ("users"."uuid" != 'abcd')[0m
D, [2015-06-05T23:19:27.662493 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "lft" = ("lft" - 10) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" > 10)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.662848 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "rgt" = ("rgt" - 10) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."rgt" > 10)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.663130 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:27.663554 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?[0m  [["user_id", 1]]
D, [2015-06-05T23:19:27.664135 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T23:19:27.664830 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" >= 1) AND ("notes"."lft" < 10) AND ("notes"."id" != 1)[0m  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T23:19:27.665300 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "notes" SET "lft" = ("lft" - 10) WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."lft" > 10)  ORDER BY "notes"."lft")  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T23:19:27.665745 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "notes" SET "rgt" = ("rgt" - 10) WHERE "notes"."id" IN (SELECT "notes"."id" FROM "notes" WHERE "notes"."notable_id" = ? AND "notes"."notable_type" = ? AND ("notes"."rgt" > 10)  ORDER BY "notes"."lft")[0m  [["notable_id", 1], ["notable_type", "Category"]]
D, [2015-06-05T23:19:27.666015 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-05T23:19:27.666262 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 1]]
D, [2015-06-05T23:19:27.666643 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 2]]
D, [2015-06-05T23:19:27.666890 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 2]]
D, [2015-06-05T23:19:27.667193 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 3]]
D, [2015-06-05T23:19:27.667431 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 3]]
D, [2015-06-05T23:19:27.667797 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1   [["id", 4]]
D, [2015-06-05T23:19:27.668110 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "notes" WHERE "notes"."id" = ?[0m  [["id", 4]]
D, [2015-06-05T23:19:27.668522 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  DELETE FROM "users" WHERE "users"."id" = ?  [["id", 1]]
D, [2015-06-05T23:19:27.668650 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.669172 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."uuid" = ?  [["uuid", "abcd"]]
D, [2015-06-05T23:19:27.669566 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?[0m  [["parent_uuid", "abcd"]]
D, [2015-06-05T23:19:27.669729 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.670460 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.670945 #98308] DEBUG -- :   [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1
D, [2015-06-05T23:19:27.671182 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.671605 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 1]]
D, [2015-06-05T23:19:27.671897 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.672265 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:19:27.672593 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-05T23:19:27.672920 #98308] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."id" DESC LIMIT 1
D, [2015-06-05T23:19:27.673083 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.673443 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1   [["id", 6]]
D, [2015-06-05T23:19:27.673994 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "lft" = ("lft" - 2) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" > 12)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.674357 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "rgt" = ("rgt" - 2) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."rgt" > 12)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.674636 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-05T23:19:27.675055 #98308] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 6]]
D, [2015-06-05T23:19:27.675315 #98308] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mDELETE FROM "users" WHERE "users"."id" = ?[0m  [["id", 6]]
D, [2015-06-05T23:19:27.675437 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  RELEASE SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.675596 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.676113 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.676549 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."lft" LIMIT 1[0m
D, [2015-06-05T23:19:27.676728 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.677115 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 1]]
D, [2015-06-05T23:19:27.678098 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.678391 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-05T23:19:27.678737 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-05T23:19:27.679050 #98308] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users"  ORDER BY "users"."id" DESC LIMIT 1[0m
D, [2015-06-05T23:19:27.679241 #98308] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-05T23:19:27.679614 #98308] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1 [0m  [["id", 6]]
D, [2015-06-05T23:19:27.680243 #98308] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "lft" = ("lft" - 2) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."lft" > 12)  ORDER BY "users"."lft")
D, [2015-06-05T23:19:27.680601 #98308] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "rgt" = ("rgt" - 2) WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE ("users"."rgt" > 12)  ORDER BY "users"."lft")[0m
D, [2015-06-05T23:19:27.680883 #98308] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-05T23:19:27.681311 #98308] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?[0m  [["user_id", 6]]
D, [2015-06-05T23:19:27.681573 #98308] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  DELETE FROM "users" WHERE "users"."id" = ?  [["id", 6]]
D, [2015-06-05T23:19:27.681691 #98308] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
D, [2015-06-05T23:19:27.681865 #98308] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-05T23:23:25.496976 #98416] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mCREATE TABLE "default_scoped_models" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-05T23:23:25.497440 #98416] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "categories" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-05T23:23:25.497784 #98416] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "departments" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar) [0m
D, [2015-06-05T23:23:25.498171 #98416] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "notes" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "notable_id" integer, "notable_type" varchar, "user_id" integer) 
D, [2015-06-05T23:23:25.498521 #98416] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "renamed_columns" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "mother_id" integer, "red" integer, "black" integer, "pitch" integer) [0m
D, [2015-06-05T23:23:25.498912 #98416] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "things" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "children_count" integer) 
D, [2015-06-05T23:23:25.499276 #98416] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "brokens" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-05T23:23:25.499618 #98416] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "orders" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) 
D, [2015-06-05T23:23:25.499988 #98416] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "positions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "position" integer) [0m
D, [2015-06-05T23:23:25.500349 #98416] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "no_depths" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) 
D, [2015-06-05T23:23:25.500726 #98416] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "single_table_inheritance" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "type" varchar, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) [0m
D, [2015-06-05T23:23:25.501098 #98416] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uuid" varchar, "name" varchar, "parent_uuid" varchar, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-05T23:23:25.513907 #98416] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL) [0m
D, [2015-06-05T23:23:25.514073 #98416] DEBUG -- :   [1m[35m (0.0ms)[0m  select sqlite_version(*)
D, [2015-06-05T23:23:25.514394 #98416] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
D, [2015-06-05T23:23:25.514521 #98416] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT version FROM "schema_migrations"
D, [2015-06-05T23:23:25.514644 #98416] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('0')[0m
D, [2015-06-05T23:25:29.667578 #98464] DEBUG -- :   [1m[36m (0.3ms)[0m  [1mCREATE TABLE "default_scoped_models" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-05T23:25:29.668094 #98464] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "categories" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-05T23:25:29.668423 #98464] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "departments" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar) [0m
D, [2015-06-05T23:25:29.668798 #98464] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "notes" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "notable_id" integer, "notable_type" varchar, "user_id" integer) 
D, [2015-06-05T23:25:29.669170 #98464] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "renamed_columns" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "mother_id" integer, "red" integer, "black" integer, "pitch" integer) [0m
D, [2015-06-05T23:25:29.669539 #98464] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "things" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "children_count" integer) 
D, [2015-06-05T23:25:29.669896 #98464] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "brokens" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-05T23:25:29.670270 #98464] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "orders" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) 
D, [2015-06-05T23:25:29.670621 #98464] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "positions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "position" integer) [0m
D, [2015-06-05T23:25:29.670968 #98464] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "no_depths" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) 
D, [2015-06-05T23:25:29.671344 #98464] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "single_table_inheritance" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "type" varchar, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) [0m
D, [2015-06-05T23:25:29.671715 #98464] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uuid" varchar, "name" varchar, "parent_uuid" varchar, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-05T23:25:29.684610 #98464] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL) [0m
D, [2015-06-05T23:25:29.684782 #98464] DEBUG -- :   [1m[35m (0.0ms)[0m  select sqlite_version(*)
D, [2015-06-05T23:25:29.685087 #98464] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
D, [2015-06-05T23:25:29.685239 #98464] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT version FROM "schema_migrations"
D, [2015-06-05T23:25:29.685353 #98464] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('0')[0m
D, [2015-06-05T23:29:25.480624 #98537] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mCREATE TABLE "default_scoped_models" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-05T23:29:25.481080 #98537] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "categories" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-05T23:29:25.481424 #98537] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "departments" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar) [0m
D, [2015-06-05T23:29:25.481811 #98537] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "notes" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "notable_id" integer, "notable_type" varchar, "user_id" integer) 
D, [2015-06-05T23:29:25.482172 #98537] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "renamed_columns" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "mother_id" integer, "red" integer, "black" integer, "pitch" integer) [0m
D, [2015-06-05T23:29:25.482520 #98537] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "things" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "children_count" integer) 
D, [2015-06-05T23:29:25.482882 #98537] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "brokens" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-05T23:29:25.483251 #98537] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "orders" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) 
D, [2015-06-05T23:29:25.483634 #98537] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "positions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "position" integer) [0m
D, [2015-06-05T23:29:25.483993 #98537] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "no_depths" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) 
D, [2015-06-05T23:29:25.484359 #98537] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "single_table_inheritance" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "type" varchar, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) [0m
D, [2015-06-05T23:29:25.484734 #98537] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uuid" varchar, "name" varchar, "parent_uuid" varchar, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-05T23:29:25.497479 #98537] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL) [0m
D, [2015-06-05T23:29:25.497644 #98537] DEBUG -- :   [1m[35m (0.0ms)[0m  select sqlite_version(*)
D, [2015-06-05T23:29:25.497958 #98537] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
D, [2015-06-05T23:29:25.498087 #98537] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT version FROM "schema_migrations"
D, [2015-06-05T23:29:25.498201 #98537] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('0')[0m
D, [2015-06-07T17:23:28.739517 #15367] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mCREATE TABLE "default_scoped_models" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-07T17:23:28.740361 #15367] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "categories" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-07T17:23:28.740699 #15367] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "departments" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar) [0m
D, [2015-06-07T17:23:28.741098 #15367] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "notes" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "notable_id" integer, "notable_type" varchar, "user_id" integer) 
D, [2015-06-07T17:23:28.741473 #15367] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "renamed_columns" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "mother_id" integer, "red" integer, "black" integer, "pitch" integer) [0m
D, [2015-06-07T17:23:28.741918 #15367] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "things" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "children_count" integer) 
D, [2015-06-07T17:23:28.742263 #15367] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "brokens" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-07T17:23:28.742628 #15367] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "orders" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) 
D, [2015-06-07T17:23:28.743000 #15367] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "positions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "position" integer) [0m
D, [2015-06-07T17:23:28.743363 #15367] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "no_depths" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) 
D, [2015-06-07T17:23:28.743728 #15367] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "single_table_inheritance" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "type" varchar, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) [0m
D, [2015-06-07T17:23:28.744111 #15367] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uuid" varchar, "name" varchar, "parent_uuid" varchar, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-07T17:23:28.762567 #15367] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL) [0m
D, [2015-06-07T17:23:28.762740 #15367] DEBUG -- :   [1m[35m (0.0ms)[0m  select sqlite_version(*)
D, [2015-06-07T17:23:28.763045 #15367] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
D, [2015-06-07T17:23:28.763199 #15367] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT version FROM "schema_migrations"
D, [2015-06-07T17:23:28.763316 #15367] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('0')[0m
D, [2015-06-07T17:24:29.836452 #15402] DEBUG -- :   [1m[36m (0.3ms)[0m  [1mCREATE TABLE "default_scoped_models" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-07T17:24:29.836915 #15402] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "categories" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-07T17:24:29.837255 #15402] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "departments" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar) [0m
D, [2015-06-07T17:24:29.837640 #15402] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "notes" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "notable_id" integer, "notable_type" varchar, "user_id" integer) 
D, [2015-06-07T17:24:29.837986 #15402] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "renamed_columns" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "mother_id" integer, "red" integer, "black" integer, "pitch" integer) [0m
D, [2015-06-07T17:24:29.838350 #15402] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "things" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "children_count" integer) 
D, [2015-06-07T17:24:29.838711 #15402] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "brokens" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-07T17:24:29.839050 #15402] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "orders" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) 
D, [2015-06-07T17:24:29.839415 #15402] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "positions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "position" integer) [0m
D, [2015-06-07T17:24:29.839774 #15402] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "no_depths" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) 
D, [2015-06-07T17:24:29.840146 #15402] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "single_table_inheritance" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "type" varchar, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) [0m
D, [2015-06-07T17:24:29.840521 #15402] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uuid" varchar, "name" varchar, "parent_uuid" varchar, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-07T17:24:29.853269 #15402] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL) [0m
D, [2015-06-07T17:24:29.853462 #15402] DEBUG -- :   [1m[35m (0.0ms)[0m  select sqlite_version(*)
D, [2015-06-07T17:24:29.853750 #15402] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
D, [2015-06-07T17:24:29.853874 #15402] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT version FROM "schema_migrations"
D, [2015-06-07T17:24:29.853985 #15402] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('0')[0m
D, [2015-06-07T17:31:50.631116 #15659] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mCREATE TABLE "default_scoped_models" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-07T17:31:50.631566 #15659] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "categories" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-07T17:31:50.631888 #15659] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "departments" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar) [0m
D, [2015-06-07T17:31:50.632271 #15659] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "notes" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "notable_id" integer, "notable_type" varchar, "user_id" integer) 
D, [2015-06-07T17:31:50.632639 #15659] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "renamed_columns" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "mother_id" integer, "red" integer, "black" integer, "pitch" integer) [0m
D, [2015-06-07T17:31:50.633014 #15659] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "things" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "children_count" integer) 
D, [2015-06-07T17:31:50.633350 #15659] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "brokens" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-07T17:31:50.633712 #15659] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "orders" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) 
D, [2015-06-07T17:31:50.634084 #15659] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "positions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "position" integer) [0m
D, [2015-06-07T17:31:50.634443 #15659] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "no_depths" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) 
D, [2015-06-07T17:31:50.634790 #15659] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "single_table_inheritance" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "type" varchar, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) [0m
D, [2015-06-07T17:31:50.635197 #15659] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uuid" varchar, "name" varchar, "parent_uuid" varchar, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-07T17:31:50.648032 #15659] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL) [0m
D, [2015-06-07T17:31:50.648199 #15659] DEBUG -- :   [1m[35m (0.0ms)[0m  select sqlite_version(*)
D, [2015-06-07T17:31:50.648495 #15659] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
D, [2015-06-07T17:31:50.648634 #15659] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT version FROM "schema_migrations"
D, [2015-06-07T17:31:50.648768 #15659] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('0')[0m
D, [2015-06-07T17:38:38.525574 #15765] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mCREATE TABLE "default_scoped_models" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-07T17:38:38.526025 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "categories" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-07T17:38:38.526382 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "departments" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar) [0m
D, [2015-06-07T17:38:38.526757 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "notes" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "notable_id" integer, "notable_type" varchar, "user_id" integer) 
D, [2015-06-07T17:38:38.527096 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "renamed_columns" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "mother_id" integer, "red" integer, "black" integer, "pitch" integer) [0m
D, [2015-06-07T17:38:38.527463 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "things" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "children_count" integer) 
D, [2015-06-07T17:38:38.527797 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "brokens" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-07T17:38:38.528153 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "orders" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) 
D, [2015-06-07T17:38:38.528514 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "positions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "position" integer) [0m
D, [2015-06-07T17:38:38.528858 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "no_depths" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) 
D, [2015-06-07T17:38:38.529228 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "single_table_inheritance" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "type" varchar, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) [0m
D, [2015-06-07T17:38:38.529604 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uuid" varchar, "name" varchar, "parent_uuid" varchar, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-07T17:38:38.542277 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL) [0m
D, [2015-06-07T17:38:38.542444 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  select sqlite_version(*)
D, [2015-06-07T17:38:38.542758 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
D, [2015-06-07T17:38:38.542880 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT version FROM "schema_migrations"
D, [2015-06-07T17:38:38.542992 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('0')[0m
D, [2015-06-07T17:38:39.076524 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:38:39.079337 #15765] DEBUG -- :   [1m[36mFixture Delete (0.0ms)[0m  [1mDELETE FROM "categories"[0m
D, [2015-06-07T17:38:39.080789 #15765] DEBUG -- :   [1m[35mFixture Insert (0.1ms)[0m  INSERT INTO "categories" ("id", "name", "lft", "rgt") VALUES (1, 'Top Level', 1, 10)
D, [2015-06-07T17:38:39.080973 #15765] DEBUG -- :   [1m[36mFixture Insert (0.1ms)[0m  [1mINSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (2, 'Child 1', 1, 2, 3)[0m
D, [2015-06-07T17:38:39.081092 #15765] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (3, 'Child 2', 1, 4, 7)
D, [2015-06-07T17:38:39.081203 #15765] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (4, 'Child 2.1', 3, 5, 6)[0m
D, [2015-06-07T17:38:39.081312 #15765] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (5, 'Child 3', 1, 8, 9)
D, [2015-06-07T17:38:39.081415 #15765] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "categories" ("id", "name", "lft", "rgt") VALUES (6, 'Top Level 2', 11, 12)[0m
D, [2015-06-07T17:38:39.081530 #15765] DEBUG -- :   [1m[35mFixture Delete (0.0ms)[0m  DELETE FROM "departments"
D, [2015-06-07T17:38:39.081711 #15765] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "departments" ("id", "name") VALUES (1, 'Top')[0m
D, [2015-06-07T17:38:39.082317 #15765] DEBUG -- :   [1m[35mFixture Delete (0.0ms)[0m  DELETE FROM "notes"
D, [2015-06-07T17:38:39.082473 #15765] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "notes" ("id", "body", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (1, 'Top Level', 1, 10, 1, 'Category', 1)[0m
D, [2015-06-07T17:38:39.082600 #15765] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "notes" ("id", "body", "parent_id", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (2, 'Child 1', 1, 2, 3, 1, 'Category', 1)
D, [2015-06-07T17:38:39.082724 #15765] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "notes" ("id", "body", "parent_id", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (3, 'Child 2', 1, 4, 7, 1, 'Category', 1)[0m
D, [2015-06-07T17:38:39.082860 #15765] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "notes" ("id", "body", "parent_id", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (4, 'Child 3', 1, 8, 9, 1, 'Category', 1)
D, [2015-06-07T17:38:39.082971 #15765] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "notes" ("id", "body", "lft", "rgt", "notable_id", "notable_type") VALUES (5, 'Top Level 2', 1, 2, 1, 'Departments')[0m
D, [2015-06-07T17:38:39.083423 #15765] DEBUG -- :   [1m[35mFixture Delete (0.0ms)[0m  DELETE FROM "things"
D, [2015-06-07T17:38:39.083553 #15765] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "things" ("id", "body", "lft", "rgt", "children_count") VALUES (1, 'Top Level', 1, 10, 2)[0m
D, [2015-06-07T17:38:39.083688 #15765] DEBUG -- :   [1m[35mFixture Insert (0.1ms)[0m  INSERT INTO "things" ("id", "body", "parent_id", "lft", "rgt", "children_count") VALUES (2, 'Child 1', 1, 2, 3, 0)
D, [2015-06-07T17:38:39.083809 #15765] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "things" ("id", "body", "parent_id", "lft", "rgt", "children_count") VALUES (3, 'Child 2', 1, 4, 7, 0)[0m
D, [2015-06-07T17:38:39.083922 #15765] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "things" ("id", "body", "parent_id", "lft", "rgt", "children_count") VALUES (4, 'Child 2.1', 3, 8, 9, 0)
D, [2015-06-07T17:38:39.084372 #15765] DEBUG -- :   [1m[36mFixture Delete (0.0ms)[0m  [1mDELETE FROM "brokens"[0m
D, [2015-06-07T17:38:39.084484 #15765] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "brokens" ("id", "name") VALUES (1, 'One')
D, [2015-06-07T17:38:39.084990 #15765] DEBUG -- :   [1m[36mFixture Delete (0.0ms)[0m  [1mDELETE FROM "users"[0m
D, [2015-06-07T17:38:39.085134 #15765] DEBUG -- :   [1m[35mFixture Insert (0.1ms)[0m  INSERT INTO "users" ("id", "uuid", "name", "lft", "rgt") VALUES (1, 'abcd', 'Top Level', 1, 10)
D, [2015-06-07T17:38:39.085267 #15765] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (2, 'efgh', 'Child 1', 'abcd', 2, 3)[0m
D, [2015-06-07T17:38:39.085383 #15765] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (3, 'ijkh', 'Child 2', 'abcd', 4, 7)
D, [2015-06-07T17:38:39.085494 #15765] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (4, 'lmno', 'Child 2.1', 'ijkh', 5, 6)[0m
D, [2015-06-07T17:38:39.085624 #15765] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (5, 'pqrs', 'Child 3', 'abcd', 8, 9)
D, [2015-06-07T17:38:39.085733 #15765] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "users" ("id", "uuid", "name", "lft", "rgt") VALUES (6, 'tuvw', 'Top Level 2', 11, 12)[0m
D, [2015-06-07T17:38:39.085820 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  commit transaction
D, [2015-06-07T17:38:39.085955 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.088822 #15765] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:38:39.105710 #15765] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "lmno"]]
D, [2015-06-07T17:38:39.106181 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.106922 #15765] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:38:39.107180 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.107733 #15765] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "abcd"]]
D, [2015-06-07T17:38:39.107925 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.108368 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.108694 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.108992 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.109288 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.109545 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:38:39.109819 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.110237 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.110568 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.110932 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.114279 #15765] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'd20198e22857c9e9f0b28182a55d25e0' LIMIT 1
D, [2015-06-07T17:38:39.114729 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.115065 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.115498 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.115977 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.116334 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.116608 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.116894 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:38:39.117180 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.117449 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.117750 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.118021 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.118696 #15765] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "total_order"  [["parent_uuid", "abcd"]]
D, [2015-06-07T17:38:39.121111 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.121489 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.121972 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.122507 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.122832 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.123131 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.123459 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.123658 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.123940 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.124208 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.124500 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.124673 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.124931 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.125467 #15765] DEBUG -- :   [1m[35mScopedUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
E, [2015-06-07T17:38:39.125503 #15765] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.125660 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.125929 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.126250 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.126555 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.126741 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.127036 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.127304 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.127587 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.127759 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.128027 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.128403 #15765] DEBUG -- :   [1m[36mScopedUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1[0m
E, [2015-06-07T17:38:39.128434 #15765] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.128562 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.128841 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.129203 #15765] DEBUG -- :   [1m[35mScopedUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
E, [2015-06-07T17:38:39.129236 #15765] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.129344 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.129597 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.129933 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.130228 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.130558 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.130816 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.131095 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.131393 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.131648 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.131931 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:38:39.132216 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.132469 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.132753 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.133050 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.133271 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.133586 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.133866 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.134157 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.134411 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.134719 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-07T17:38:39.135036 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.135321 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.135595 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.135859 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:38:39.136162 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.136416 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.136693 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:38:39.136974 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.137248 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.137506 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.137851 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.138111 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.138411 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.138725 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.138987 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.139279 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.139557 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.139750 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.140017 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.140225 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.140422 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.140688 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.140973 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.141238 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.141406 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.141628 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.141779 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.141962 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.142235 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.142544 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.142736 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.143011 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.143308 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.143802 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.144393 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.144859 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:38:39.145209 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:38:39.145382 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.145629 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:38:39.145796 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.145994 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.146307 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.146629 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.147148 #15765] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'cd32d19b8fe787f4d6962d0ea03fa3c0' LIMIT 1
D, [2015-06-07T17:38:39.147419 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.147677 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.147977 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.148326 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.148529 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.148817 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.149101 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-07T17:38:39.149278 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.149580 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.149845 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.150037 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.150286 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.150527 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.151023 #15765] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '62b60baae014f9482a83189666ebda0b' LIMIT 1
D, [2015-06-07T17:38:39.151232 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.151654 #15765] DEBUG -- :   [1m[35m (0.2ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.151941 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.152178 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.152638 #15765] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '01b7f636c198fc766461b3f742e41c1f' LIMIT 1[0m
D, [2015-06-07T17:38:39.152841 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.153104 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.153378 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.153624 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.154069 #15765] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '8a89cac086f27fb6184ad85d487a5e81' LIMIT 1
D, [2015-06-07T17:38:39.154268 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.154517 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.154793 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.155016 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.155462 #15765] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '3fb1ab1094fa25ea069f8baeaa220f5a' LIMIT 1[0m
D, [2015-06-07T17:38:39.155664 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.155918 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.156197 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.156504 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.156753 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.156967 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.157225 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.157453 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.157708 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.157952 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.164518 #15765] DEBUG -- :   [1m[35m (6.3ms)[0m  begin transaction
D, [2015-06-07T17:38:39.164927 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.165310 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.165721 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.166060 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:38:39.166306 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.166559 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.166840 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.167014 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.167290 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.167548 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.167792 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.168035 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.168329 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.168619 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:38:39.168787 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.169061 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.169284 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.169547 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.169784 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.170022 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.170254 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.170494 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.170731 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.170961 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.171171 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.171432 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.171685 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.172199 #15765] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'be952e9f17d2c1b5d3e27e5391a555e2' LIMIT 1
D, [2015-06-07T17:38:39.172415 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.172685 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.172955 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.173301 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.173458 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.173663 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.173887 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.174148 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.174454 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.174598 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.174747 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.174945 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.175197 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.175494 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.175643 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.175777 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.175972 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.176229 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.176532 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.176787 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.177232 #15765] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '6a6c4387933c04dbf45ec77dab56682c' LIMIT 1[0m
D, [2015-06-07T17:38:39.177454 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.177688 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.177960 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.178289 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.178662 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.179197 #15765] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'e078a0ff7b17abafecfcc9a470f34c92' LIMIT 1[0m
D, [2015-06-07T17:38:39.179642 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.179923 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.180280 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.180562 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.181089 #15765] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'd340ccbdfbcf54d0c9ed0499dd6400e4' LIMIT 1
D, [2015-06-07T17:38:39.181303 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.181532 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.181848 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.182167 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:38:39.182469 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:38:39.182652 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.183546 #15765] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1[0m
D, [2015-06-07T17:38:39.184458 #15765] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?  [["parent_uuid", "pqrs"], ["id", 4]]
D, [2015-06-07T17:38:39.185018 #15765] DEBUG -- :   [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."total_order" LIMIT 1[0m  [["uuid", "pqrs"]]
E, [2015-06-07T17:38:39.185088 #15765] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.185260 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.185531 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.185847 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.186163 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:38:39.186485 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.186698 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.187161 #15765] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1
D, [2015-06-07T17:38:39.187986 #15765] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?[0m  [["parent_uuid", "pqrs"], ["id", 4]]
D, [2015-06-07T17:38:39.188846 #15765] DEBUG -- :   [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."total_order" LIMIT 1  [["uuid", "pqrs"]]
E, [2015-06-07T17:38:39.188891 #15765] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.189045 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.189396 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.189735 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.190118 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:38:39.190352 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.190839 #15765] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1
D, [2015-06-07T17:38:39.191324 #15765] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?[0m  [["parent_uuid", nil], ["id", 4]]
D, [2015-06-07T17:38:39.191636 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:38:39.191819 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.192091 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.192453 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.192769 #15765] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.193218 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.194050 #15765] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'be62e3f274369d52696d3819a0f800b0' LIMIT 1
D, [2015-06-07T17:38:39.194271 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.194542 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.194849 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.195261 #15765] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
E, [2015-06-07T17:38:39.195292 #15765] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.195403 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.195754 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.196914 #15765] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL[0m
D, [2015-06-07T17:38:39.197340 #15765] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order"
E, [2015-06-07T17:38:39.197376 #15765] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order"
D, [2015-06-07T17:38:39.197502 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.197827 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.198223 #15765] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1[0m
E, [2015-06-07T17:38:39.198253 #15765] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.198356 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.198631 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.198995 #15765] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.199267 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.199533 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.199829 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.200069 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.200412 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.200770 #15765] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-07T17:38:39.200934 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.201183 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.201325 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.201586 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.201876 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.202057 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.202303 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.202590 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:38:39.203197 #15765] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1[0m  [["uuid", "ijkh"]]
D, [2015-06-07T17:38:39.203495 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.203710 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.203971 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.204259 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:38:39.204569 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.204825 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.205085 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.205360 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.205733 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:38:39.206045 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.206299 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.206553 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.206829 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.207124 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.207424 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:38:39.207704 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:38:39.208134 #15765] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd'  ORDER BY "users"."total_order"
E, [2015-06-07T17:38:39.208167 #15765] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd'  ORDER BY "users"."total_order"
D, [2015-06-07T17:38:39.208281 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.208555 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.208842 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.209133 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:38:39.209419 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:38:39.209898 #15765] DEBUG -- :   [1m[35mUser Load (0.2ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."total_order"
E, [2015-06-07T17:38:39.209927 #15765] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."total_order"
D, [2015-06-07T17:38:39.210044 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.210316 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.210610 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.210905 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:38:39.211178 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:38:39.211449 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.211706 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.212134 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.212475 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.212824 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:38:39.213094 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.213480 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.213785 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.214137 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1  [["uuid", "abcd"]]
D, [2015-06-07T17:38:39.214340 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.214722 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.218441 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.218856 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.219658 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.220224 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.220718 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.221425 #15765] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'fee4cfc62c02fbef9aee2ca63c3d1f60' LIMIT 1
D, [2015-06-07T17:38:39.221676 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.221984 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.222429 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.222687 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.223186 #15765] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '465707e049803fb5527d24d83a486878' LIMIT 1[0m
D, [2015-06-07T17:38:39.223396 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.223679 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.224098 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.224481 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.224804 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.225474 #15765] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "pqrs"]]
D, [2015-06-07T17:38:39.225598 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.225866 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:38:39.226033 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.226213 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.226577 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.226861 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.227187 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.227794 #15765] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:38:39.228359 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:38:39.228857 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "total_order"[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:38:39.229316 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.229684 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:38:39.229864 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.230063 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.230415 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.230767 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.231078 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.231769 #15765] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:38:39.232112 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:38:39.232554 #15765] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "total_order" DESC LIMIT 1[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:38:39.232761 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.233048 #15765] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:38:39.233207 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.233392 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.233844 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.234136 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.251528 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.252073 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.252348 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.252613 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.253040 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.253437 #15765] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:38:39.253725 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.254033 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.254425 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.254705 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.255410 #15765] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'pqrs' AND "users"."id" != 5) LIMIT 1
D, [2015-06-07T17:38:39.256059 #15765] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?[0m  [["parent_uuid", nil], ["id", 5]]
D, [2015-06-07T17:38:39.256646 #15765] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.257336 #15765] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'pqrs'  ORDER BY "users"."total_order")[0m
E, [2015-06-07T17:38:39.257373 #15765] ERROR -- : SQLite3::SQLException: no such column: users.total_order: UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'pqrs'  ORDER BY "users"."total_order")
D, [2015-06-07T17:38:39.257514 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.257807 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.258288 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.258692 #15765] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1[0m
E, [2015-06-07T17:38:39.258745 #15765] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.258881 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.259168 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.259592 #15765] DEBUG -- :   [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
E, [2015-06-07T17:38:39.259626 #15765] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.259738 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.260097 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.260449 #15765] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1[0m
E, [2015-06-07T17:38:39.260479 #15765] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.260579 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.260875 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.261205 #15765] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
E, [2015-06-07T17:38:39.261238 #15765] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.261411 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.262127 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:38:39.262632 #15765] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1[0m
E, [2015-06-07T17:38:39.262665 #15765] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.262807 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.263156 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.263497 #15765] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."id" DESC LIMIT 1
D, [2015-06-07T17:38:39.263703 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.263844 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.264108 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.264493 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.264886 #15765] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1[0m
E, [2015-06-07T17:38:39.264916 #15765] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.265022 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.265335 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.265606 #15765] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."id" DESC LIMIT 1
D, [2015-06-07T17:38:39.265788 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.265916 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.266154 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.266637 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.267267 #15765] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"[0m
E, [2015-06-07T17:38:39.267299 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
D, [2015-06-07T17:38:39.267412 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.267757 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.268196 #15765] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.271132 #15765] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"[0m
E, [2015-06-07T17:38:39.271174 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
D, [2015-06-07T17:38:39.271309 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.271693 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.272038 #15765] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
E, [2015-06-07T17:38:39.272068 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
D, [2015-06-07T17:38:39.272195 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.272483 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.272835 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.273190 #15765] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
E, [2015-06-07T17:38:39.273219 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
D, [2015-06-07T17:38:39.273328 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.273622 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.273970 #15765] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"[0m
E, [2015-06-07T17:38:39.273999 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
D, [2015-06-07T17:38:39.274121 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.274402 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.274711 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.275086 #15765] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"[0m
E, [2015-06-07T17:38:39.275115 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
D, [2015-06-07T17:38:39.275223 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.276713 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.277303 #15765] DEBUG -- :   [1m[35mFixture Delete (0.0ms)[0m  DELETE FROM "default_scoped_models"
D, [2015-06-07T17:38:39.277465 #15765] DEBUG -- :   [1m[36mFixture Insert (0.1ms)[0m  [1mINSERT INTO "default_scoped_models" ("id", "name", "lft", "rgt") VALUES (1, 'Top Level', 1, 4)[0m
D, [2015-06-07T17:38:39.277579 #15765] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "default_scoped_models" ("id", "name", "parent_id", "lft", "rgt") VALUES (2, 'Child 1', 1, 2, 3)
D, [2015-06-07T17:38:39.277690 #15765] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "default_scoped_models" ("id", "name", "lft", "rgt") VALUES (6, 'Top Level 2', 5, 6)[0m
D, [2015-06-07T17:38:39.277817 #15765] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "default_scoped_models" ("id", "name", "lft", "rgt") VALUES (7, 'Top Level 3', 7, 8)
D, [2015-06-07T17:38:39.277900 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mcommit transaction[0m
D, [2015-06-07T17:38:39.278014 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.281051 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.281449 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.282206 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.282609 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.284805 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.285151 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.285805 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.286169 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.286633 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:38:39.288663 #15765] DEBUG -- :   [1m[35mCategory Exists (0.1ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 4]]
D, [2015-06-07T17:38:39.289019 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.289696 #15765] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 3]]
D, [2015-06-07T17:38:39.289969 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.290549 #15765] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 1]]
D, [2015-06-07T17:38:39.290697 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.291061 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.291379 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.291742 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:38:39.292014 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.292280 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:38:39.292569 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:38:39.292973 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.293395 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.293914 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.294618 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.294923 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.295314 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.295752 #15765] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.296038 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.296299 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.296563 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:38:39.296830 #15765] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.297053 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.297359 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.297656 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.298267 #15765] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "total_order"  [["parent_id", 1]]
D, [2015-06-07T17:38:39.298835 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.299163 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.299504 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.299827 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.300152 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.300458 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.300716 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.300913 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.301197 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.301487 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.301792 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.301945 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.302231 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.302764 #15765] DEBUG -- :   [1m[35mScopedCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
E, [2015-06-07T17:38:39.302797 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.302906 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.303228 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.303537 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.303824 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.304018 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.304302 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.304588 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.304833 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.305006 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.305282 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.305669 #15765] DEBUG -- :   [1m[36mScopedCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1[0m
E, [2015-06-07T17:38:39.305699 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.305800 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.306096 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.306438 #15765] DEBUG -- :   [1m[35mScopedCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
E, [2015-06-07T17:38:39.306467 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.306588 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.306871 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.307205 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.307474 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.307794 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.308109 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.308409 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.308719 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.309011 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.309312 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:38:39.309612 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.309897 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.310197 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.310484 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.310771 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.311061 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.311319 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.311604 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.311928 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.312218 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-07T17:38:39.312515 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.312818 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.313123 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.313410 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:38:39.313674 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.313981 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.314281 #15765] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:38:39.314544 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.314866 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.315161 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.315458 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.315780 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:38:39.316062 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.316347 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.316645 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.316911 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.317179 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.317370 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.317654 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.317839 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.318037 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.318328 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.318635 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.318883 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.319049 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.319267 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.319443 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.319601 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.319893 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.320216 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.320363 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.320624 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.320756 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.320981 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.321281 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.321570 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:38:39.321849 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:38:39.321987 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.322235 #15765] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:38:39.322365 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.322522 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.322839 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.323063 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.323340 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.323554 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.323896 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.324249 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.324425 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.324743 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.325055 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-07T17:38:39.325214 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.325525 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.325827 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.325980 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.326254 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.326486 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.326756 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.326978 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.327291 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.327469 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.327694 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.327956 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.328269 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.328567 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.329039 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.329483 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.329941 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.330246 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.330538 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.330797 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.331155 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.331452 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.331760 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.331978 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.332218 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.332461 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.332709 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.333116 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.333361 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.333581 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.333826 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.334192 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.334476 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.334682 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.334967 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.335329 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.335523 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.335798 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.336088 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.336318 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.336591 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.336929 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.337419 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.337674 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.338004 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.338304 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.338573 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.338809 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.339075 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.339319 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.339553 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.339784 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.340037 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.340253 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.340508 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.340740 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.341034 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.341294 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.341538 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.342143 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.342400 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.343002 #15765] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."parent_id" IS NULL  ORDER BY "notes"."total_order"
E, [2015-06-07T17:38:39.343033 #15765] ERROR -- : SQLite3::SQLException: no such column: notes.total_order: SELECT "notes".* FROM "notes" WHERE "notes"."parent_id" IS NULL  ORDER BY "notes"."total_order"
D, [2015-06-07T17:38:39.343478 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.343764 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.347563 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.347994 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.348265 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.348629 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.348876 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.349146 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.349393 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.349678 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.350399 #15765] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.350834 #15765] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:38:39.351229 #15765] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:38:39.351418 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.351749 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.351964 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.352209 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.352524 #15765] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.352841 #15765] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.353004 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.353273 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.353549 #15765] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.353844 #15765] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:38:39.353999 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.354267 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.354652 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.354826 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.355051 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.355284 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.355559 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.355859 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.355987 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.356110 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.356313 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.356570 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.356889 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.357020 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.357156 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.357346 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.357607 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.357937 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.358241 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.358518 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.358764 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.359053 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.359356 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.359653 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.359993 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.360224 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.360510 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.360704 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.360947 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.361162 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.361421 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.361763 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:38:39.362051 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.362255 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.362835 #15765] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?  [["parent_id", 5], ["id", 4]]
D, [2015-06-07T17:38:39.363332 #15765] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1[0m  [["id", 5]]
E, [2015-06-07T17:38:39.363367 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.363533 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.363825 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.364149 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.364509 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:38:39.364863 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.365143 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.365799 #15765] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?  [["parent_id", 5], ["id", 4]]
D, [2015-06-07T17:38:39.366308 #15765] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1[0m  [["id", 5]]
E, [2015-06-07T17:38:39.366341 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.366464 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.366763 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.367081 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.367413 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:38:39.367629 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.368126 #15765] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?[0m  [["parent_id", nil], ["id", 4]]
D, [2015-06-07T17:38:39.368475 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:38:39.368645 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.368911 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.369227 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.369540 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.370019 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.370672 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.371011 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.371409 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.371951 #15765] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1[0m
E, [2015-06-07T17:38:39.371983 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.372104 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.372519 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.372681 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.372933 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.373071 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.373341 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.373461 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.373706 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.373852 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.374105 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.374221 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.374466 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.374583 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.374830 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.374963 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.375202 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.375316 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.375557 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.375715 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.375979 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.378800 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.379124 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.379364 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.379641 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.379839 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.380107 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.380301 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.380560 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.380722 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.380993 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.381176 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.381429 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.381631 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.381879 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.382107 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.382358 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.382713 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.383090 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.383279 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.383536 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.383712 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.383965 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.384145 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.384393 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.384569 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.384809 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.384986 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.385223 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.385399 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.385641 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.385826 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.386142 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.386390 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.386629 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.386791 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.387033 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.387195 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.387433 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.387583 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.387815 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.388001 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.388244 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.388407 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.388659 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.388824 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.389158 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.389294 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.389596 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.390041 #15765] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."denv" = 1
E, [2015-06-07T17:38:39.390082 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT "categories".* FROM "categories" WHERE "categories"."denv" = 1
D, [2015-06-07T17:38:39.390197 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.390470 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.390847 #15765] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1[0m
E, [2015-06-07T17:38:39.390878 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.390989 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.391250 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.391569 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.391850 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.392116 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.392308 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.392550 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.392860 #15765] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."id" DESC LIMIT 1[0m
D, [2015-06-07T17:38:39.393392 #15765] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1  [["id", 6]]
E, [2015-06-07T17:38:39.393430 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.393549 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.393837 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.394148 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.394475 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-07T17:38:39.394639 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.394921 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.395234 #15765] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE (is_leaf = 1)[0m
E, [2015-06-07T17:38:39.395283 #15765] ERROR -- : SQLite3::SQLException: no such column: is_leaf: SELECT "categories".* FROM "categories" WHERE (is_leaf = 1)
D, [2015-06-07T17:38:39.395399 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.395680 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.396004 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:38:39.396191 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.396456 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.396755 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:38:39.397296 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.397595 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.397782 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.398061 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.398362 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:38:39.398646 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.398925 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.399165 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.399457 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.399758 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:38:39.400056 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.400319 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.400530 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.400806 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.401130 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.401471 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.401790 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.402265 #15765] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = 1  ORDER BY "categories"."total_order"[0m
E, [2015-06-07T17:38:39.402302 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = 1  ORDER BY "categories"."total_order"
D, [2015-06-07T17:38:39.402444 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.402786 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.403129 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.403419 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.403673 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.404111 #15765] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3)  ORDER BY "categories"."total_order"[0m
E, [2015-06-07T17:38:39.404141 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3)  ORDER BY "categories"."total_order"
D, [2015-06-07T17:38:39.404263 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.404605 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.405055 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:38:39.405438 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:38:39.405709 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.405987 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.406253 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.406689 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.406984 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.407302 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:38:39.407565 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.407938 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.408245 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:38:39.408565 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.408756 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.409115 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.409446 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.409733 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.410392 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.410736 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.410987 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.411259 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.411503 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.411776 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.411997 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.412254 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.412493 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.412767 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.412946 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.413185 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.413421 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.413679 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.413858 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.414087 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.414387 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.414740 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.415125 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:38:39.415430 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:38:39.416097 #15765] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 5]]
D, [2015-06-07T17:38:39.416236 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.416474 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.416635 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.416816 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.417100 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.417370 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:38:39.417635 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.418196 #15765] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 3]]
D, [2015-06-07T17:38:39.418581 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 3]]
D, [2015-06-07T17:38:39.418945 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "total_order"  [["parent_id", 3]]
D, [2015-06-07T17:38:39.419233 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.419471 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:38:39.419620 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.419803 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.420100 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.420373 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:38:39.425904 #15765] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.426660 #15765] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 3]]
D, [2015-06-07T17:38:39.427028 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 3]]
D, [2015-06-07T17:38:39.427487 #15765] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "total_order" DESC LIMIT 1  [["parent_id", 3]]
D, [2015-06-07T17:38:39.427686 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.427962 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:38:39.428109 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.428309 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.428649 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.428958 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:38:39.429289 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.429925 #15765] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 1]]
D, [2015-06-07T17:38:39.430261 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-07T17:38:39.430600 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "total_order"  [["parent_id", 1]]
D, [2015-06-07T17:38:39.430938 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.431201 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:38:39.431344 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.431524 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.431869 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.432212 #15765] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:38:39.432470 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:38:39.433067 #15765] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 1]]
D, [2015-06-07T17:38:39.433388 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-07T17:38:39.433725 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "total_order"  [["parent_id", 1]]
D, [2015-06-07T17:38:39.434039 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.434414 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.434750 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.435188 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.435440 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:38:39.435611 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.435810 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.436129 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:38:39.436414 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:38:39.436656 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.436919 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.437257 #15765] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:38:39.437505 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.438189 #15765] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?  [["parent_id", nil], ["id", 5]]
D, [2015-06-07T17:38:39.438822 #15765] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:38:39.439439 #15765] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 5  ORDER BY "categories"."total_order")
E, [2015-06-07T17:38:39.439471 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 5  ORDER BY "categories"."total_order")
D, [2015-06-07T17:38:39.439627 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.439900 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.440341 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.440826 #15765] DEBUG -- :   [1m[35mThing Load (0.1ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.444644 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-07T17:38:39.444843 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.445249 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.445773 #15765] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.446564 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-07T17:38:39.446752 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.447972 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.448200 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.448535 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.448920 #15765] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:38:39.449621 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-07T17:38:39.450035 #15765] DEBUG -- :   [1m[35mThing Load (0.1ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."parent_id" = ?  ORDER BY "total_order" DESC LIMIT 1  [["parent_id", 1]]
D, [2015-06-07T17:38:39.450247 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.450433 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.450686 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.451099 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.453841 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.454189 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.454480 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.454867 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.456110 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.456473 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.459440 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.459803 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.460071 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.460621 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.460820 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.461092 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.461226 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.461579 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.462085 #15765] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1[0m
E, [2015-06-07T17:38:39.462117 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.462253 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.462523 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.462879 #15765] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
E, [2015-06-07T17:38:39.462908 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.463014 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.463346 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.468195 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.468568 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.468860 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.469303 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.469815 #15765] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1[0m
E, [2015-06-07T17:38:39.469866 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.469986 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.470293 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.470799 #15765] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."id" ASC LIMIT 1
D, [2015-06-07T17:38:39.471794 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT "notes".id FROM "notes" WHERE "notes"."user_id" = ?[0m  [["user_id", 1]]
D, [2015-06-07T17:38:39.472322 #15765] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 1]]
D, [2015-06-07T17:38:39.472912 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.473146 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.473480 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.473841 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.474443 #15765] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1[0m
E, [2015-06-07T17:38:39.474604 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.474933 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.475960 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.476618 #15765] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
E, [2015-06-07T17:38:39.476669 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.476837 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.477307 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.477770 #15765] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."id" DESC LIMIT 1[0m
D, [2015-06-07T17:38:39.478009 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.478246 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.478891 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.479679 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.480306 #15765] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
E, [2015-06-07T17:38:39.480351 #15765] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:38:39.480576 #15765] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:38:39.481073 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:38:39.481600 #15765] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."id" DESC LIMIT 1[0m
D, [2015-06-07T17:38:39.481853 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:38:39.482075 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:38:39.482438 #15765] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:38:39.483069 #15765] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:38:39.483919 #15765] DEBUG -- :   [1m[35mDefaultScopedModel Load (0.1ms)[0m  SELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-07T17:38:39.488463 #15765] DEBUG -- :   [1m[36mDefaultScopedModel Load (0.1ms)[0m  [1mSELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-07T17:38:39.489277 #15765] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.225852 #15884] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mCREATE TABLE "default_scoped_models" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-07T17:44:24.226302 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "categories" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-07T17:44:24.226644 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "departments" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar) [0m
D, [2015-06-07T17:44:24.227023 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "notes" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "notable_id" integer, "notable_type" varchar, "user_id" integer) 
D, [2015-06-07T17:44:24.227403 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "renamed_columns" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "mother_id" integer, "red" integer, "black" integer, "pitch" integer) [0m
D, [2015-06-07T17:44:24.227772 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "things" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "children_count" integer) 
D, [2015-06-07T17:44:24.228094 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "brokens" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-07T17:44:24.228451 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "orders" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) 
D, [2015-06-07T17:44:24.228802 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "positions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "position" integer) [0m
D, [2015-06-07T17:44:24.229166 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "no_depths" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) 
D, [2015-06-07T17:44:24.229535 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "single_table_inheritance" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "type" varchar, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) [0m
D, [2015-06-07T17:44:24.229906 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uuid" varchar, "name" varchar, "parent_uuid" varchar, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-07T17:44:24.242483 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL) [0m
D, [2015-06-07T17:44:24.242665 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  select sqlite_version(*)
D, [2015-06-07T17:44:24.242962 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
D, [2015-06-07T17:44:24.243114 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT version FROM "schema_migrations"
D, [2015-06-07T17:44:24.243236 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('0')[0m
D, [2015-06-07T17:44:24.635376 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:44:24.637910 #15884] DEBUG -- :   [1m[36mFixture Delete (0.0ms)[0m  [1mDELETE FROM "categories"[0m
D, [2015-06-07T17:44:24.639320 #15884] DEBUG -- :   [1m[35mFixture Insert (0.1ms)[0m  INSERT INTO "categories" ("id", "name", "lft", "rgt") VALUES (1, 'Top Level', 1, 10)
D, [2015-06-07T17:44:24.639456 #15884] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (2, 'Child 1', 1, 2, 3)[0m
D, [2015-06-07T17:44:24.639594 #15884] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (3, 'Child 2', 1, 4, 7)
D, [2015-06-07T17:44:24.639706 #15884] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (4, 'Child 2.1', 3, 5, 6)[0m
D, [2015-06-07T17:44:24.639809 #15884] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (5, 'Child 3', 1, 8, 9)
D, [2015-06-07T17:44:24.639912 #15884] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "categories" ("id", "name", "lft", "rgt") VALUES (6, 'Top Level 2', 11, 12)[0m
D, [2015-06-07T17:44:24.640005 #15884] DEBUG -- :   [1m[35mFixture Delete (0.0ms)[0m  DELETE FROM "departments"
D, [2015-06-07T17:44:24.640230 #15884] DEBUG -- :   [1m[36mFixture Insert (0.1ms)[0m  [1mINSERT INTO "departments" ("id", "name") VALUES (1, 'Top')[0m
D, [2015-06-07T17:44:24.640824 #15884] DEBUG -- :   [1m[35mFixture Delete (0.0ms)[0m  DELETE FROM "notes"
D, [2015-06-07T17:44:24.640976 #15884] DEBUG -- :   [1m[36mFixture Insert (0.1ms)[0m  [1mINSERT INTO "notes" ("id", "body", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (1, 'Top Level', 1, 10, 1, 'Category', 1)[0m
D, [2015-06-07T17:44:24.641100 #15884] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "notes" ("id", "body", "parent_id", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (2, 'Child 1', 1, 2, 3, 1, 'Category', 1)
D, [2015-06-07T17:44:24.641217 #15884] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "notes" ("id", "body", "parent_id", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (3, 'Child 2', 1, 4, 7, 1, 'Category', 1)[0m
D, [2015-06-07T17:44:24.641333 #15884] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "notes" ("id", "body", "parent_id", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (4, 'Child 3', 1, 8, 9, 1, 'Category', 1)
D, [2015-06-07T17:44:24.641460 #15884] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "notes" ("id", "body", "lft", "rgt", "notable_id", "notable_type") VALUES (5, 'Top Level 2', 1, 2, 1, 'Departments')[0m
D, [2015-06-07T17:44:24.641939 #15884] DEBUG -- :   [1m[35mFixture Delete (0.0ms)[0m  DELETE FROM "things"
D, [2015-06-07T17:44:24.642061 #15884] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "things" ("id", "body", "lft", "rgt", "children_count") VALUES (1, 'Top Level', 1, 10, 2)[0m
D, [2015-06-07T17:44:24.642174 #15884] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "things" ("id", "body", "parent_id", "lft", "rgt", "children_count") VALUES (2, 'Child 1', 1, 2, 3, 0)
D, [2015-06-07T17:44:24.642305 #15884] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "things" ("id", "body", "parent_id", "lft", "rgt", "children_count") VALUES (3, 'Child 2', 1, 4, 7, 0)[0m
D, [2015-06-07T17:44:24.642428 #15884] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "things" ("id", "body", "parent_id", "lft", "rgt", "children_count") VALUES (4, 'Child 2.1', 3, 8, 9, 0)
D, [2015-06-07T17:44:24.642863 #15884] DEBUG -- :   [1m[36mFixture Delete (0.0ms)[0m  [1mDELETE FROM "brokens"[0m
D, [2015-06-07T17:44:24.642970 #15884] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "brokens" ("id", "name") VALUES (1, 'One')
D, [2015-06-07T17:44:24.643467 #15884] DEBUG -- :   [1m[36mFixture Delete (0.0ms)[0m  [1mDELETE FROM "users"[0m
D, [2015-06-07T17:44:24.643613 #15884] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "users" ("id", "uuid", "name", "lft", "rgt") VALUES (1, 'abcd', 'Top Level', 1, 10)
D, [2015-06-07T17:44:24.643731 #15884] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (2, 'efgh', 'Child 1', 'abcd', 2, 3)[0m
D, [2015-06-07T17:44:24.643838 #15884] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (3, 'ijkh', 'Child 2', 'abcd', 4, 7)
D, [2015-06-07T17:44:24.643948 #15884] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (4, 'lmno', 'Child 2.1', 'ijkh', 5, 6)[0m
D, [2015-06-07T17:44:24.644072 #15884] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (5, 'pqrs', 'Child 3', 'abcd', 8, 9)
D, [2015-06-07T17:44:24.644173 #15884] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "users" ("id", "uuid", "name", "lft", "rgt") VALUES (6, 'tuvw', 'Top Level 2', 11, 12)[0m
D, [2015-06-07T17:44:24.644260 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  commit transaction
D, [2015-06-07T17:44:24.644393 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.647249 #15884] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:44:24.662972 #15884] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "lmno"]]
D, [2015-06-07T17:44:24.663407 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.664121 #15884] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:44:24.664402 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.664959 #15884] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "abcd"]]
D, [2015-06-07T17:44:24.665179 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.665660 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.666282 #15884] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.666840 #15884] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.667416 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.667767 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:44:24.668076 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.668624 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.668983 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.669378 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.671496 #15884] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '727fa02ea5cbb0da87f922217715433e' LIMIT 1
D, [2015-06-07T17:44:24.671840 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.672143 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.672500 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.672898 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.673249 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.673567 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.673830 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:44:24.674116 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.674390 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.674681 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.674983 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:24.675645 #15884] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "total_order"  [["parent_uuid", "abcd"]]
D, [2015-06-07T17:44:24.677942 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.678325 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.678776 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.679305 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.679613 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.679961 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.680262 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.680537 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.680828 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.681116 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.681394 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.681572 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.681866 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.682420 #15884] DEBUG -- :   [1m[35mScopedUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
E, [2015-06-07T17:44:24.682454 #15884] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.682623 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.682899 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.683247 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.683538 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.683745 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.684014 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.684302 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.684580 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.684773 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.685040 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.685450 #15884] DEBUG -- :   [1m[36mScopedUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1[0m
E, [2015-06-07T17:44:24.685480 #15884] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.685618 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.685886 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.686239 #15884] DEBUG -- :   [1m[35mScopedUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
E, [2015-06-07T17:44:24.686270 #15884] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.686372 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.686630 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.686964 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.687285 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.687613 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.687918 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.688216 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:24.688535 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.688809 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.689109 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:44:24.689422 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.689690 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.689991 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.690284 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.690597 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.690884 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.691184 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.691483 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.691763 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.692041 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-07T17:44:24.692333 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:24.692632 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.692904 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.693184 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:44:24.693472 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.693752 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.694028 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:44:24.694330 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.694594 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.694887 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.695199 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.695493 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.695786 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.696074 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.696356 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.696632 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.696930 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.697128 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.697394 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.697605 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.697798 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.698077 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.698369 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.698650 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.698817 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.699040 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.699215 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.699400 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.699671 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.699961 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.700133 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.700363 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.700561 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.700728 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.700997 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.701295 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:44:24.701608 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:44:24.701793 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.702172 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:44:24.702385 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.702605 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.702966 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.703315 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.703919 #15884] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'ce11678884dfd248c29ecae69e84d67a' LIMIT 1
D, [2015-06-07T17:44:24.704212 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.704511 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.704874 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.705259 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.705484 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.705774 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.706064 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-07T17:44:24.706270 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.706540 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.706839 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.707027 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.707290 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.707559 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.708020 #15884] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '06f56cc05ff52f1203e9ae5422f8629b' LIMIT 1
D, [2015-06-07T17:44:24.708229 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.708533 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.708826 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.709061 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.709527 #15884] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '70e5eca021f3f5b7531ebe1eb99d01b5' LIMIT 1[0m
D, [2015-06-07T17:44:24.709729 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.709991 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.710282 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.710515 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.710964 #15884] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'afcc32c63db5a4929ea5db2b64e904b3' LIMIT 1
D, [2015-06-07T17:44:24.711166 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.711399 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.711743 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.711977 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.712427 #15884] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '405ce4ee611529213f6b33841d9b4041' LIMIT 1[0m
D, [2015-06-07T17:44:24.712625 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.712863 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.713359 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:44:24.714025 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.714765 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:44:24.715130 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.715475 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.715750 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.716020 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.722484 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.722922 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.723267 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.723563 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.723965 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.724337 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:44:24.724548 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.724859 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.725135 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:24.725340 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.725598 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.725898 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.726151 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.726429 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.726744 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:24.727020 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:44:24.727226 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.727487 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.727744 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.727995 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.728213 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.728481 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.728689 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.728959 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.729168 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.729434 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.729645 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.729917 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.730183 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.730715 #15884] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '85fada8622926f70398097c2d8d77578' LIMIT 1
D, [2015-06-07T17:44:24.730936 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.731204 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.731491 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.731832 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.731995 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.732178 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.732438 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.732711 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.733030 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.733182 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.733309 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.733533 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.733798 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.734114 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.734265 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.734381 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.734608 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.734875 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.735191 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.735483 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.735952 #15884] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'f89ce33db679f1648efc23c5c74eec3f' LIMIT 1[0m
D, [2015-06-07T17:44:24.736163 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.736433 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.736728 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.737078 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.737392 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.737815 #15884] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '453facc440ae682ffc88585282e0ad35' LIMIT 1[0m
D, [2015-06-07T17:44:24.738116 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.738374 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.739090 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:44:24.739925 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.740973 #15884] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '84e26431c763a2d102961e204ffb57d8' LIMIT 1
D, [2015-06-07T17:44:24.741445 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.741903 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.742450 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.743069 #15884] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:44:24.743591 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:44:24.743884 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.745617 #15884] DEBUG -- :   [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1[0m
D, [2015-06-07T17:44:24.747748 #15884] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?  [["parent_uuid", "pqrs"], ["id", 4]]
D, [2015-06-07T17:44:24.748746 #15884] DEBUG -- :   [1m[36mUser Load (0.3ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."total_order" LIMIT 1[0m  [["uuid", "pqrs"]]
E, [2015-06-07T17:44:24.748811 #15884] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.749087 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.749535 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.750054 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:44:24.750597 #15884] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:44:24.751034 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.751302 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.752066 #15884] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1
D, [2015-06-07T17:44:24.752865 #15884] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?[0m  [["parent_uuid", "pqrs"], ["id", 4]]
D, [2015-06-07T17:44:24.753544 #15884] DEBUG -- :   [1m[35mUser Load (0.3ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."total_order" LIMIT 1  [["uuid", "pqrs"]]
E, [2015-06-07T17:44:24.753602 #15884] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.753830 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.754257 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.754853 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.755513 #15884] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:44:24.755890 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.756670 #15884] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1
D, [2015-06-07T17:44:24.757548 #15884] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?[0m  [["parent_uuid", nil], ["id", 4]]
D, [2015-06-07T17:44:24.758136 #15884] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:44:24.758512 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.758984 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.759413 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.759855 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.760404 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.761278 #15884] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'b91e58794bdf3332514c2d4479077156' LIMIT 1
D, [2015-06-07T17:44:24.761505 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.761766 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.762120 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.762509 #15884] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
E, [2015-06-07T17:44:24.762540 #15884] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.762678 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.763040 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.764223 #15884] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL[0m
D, [2015-06-07T17:44:24.764639 #15884] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order"
E, [2015-06-07T17:44:24.764669 #15884] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order"
D, [2015-06-07T17:44:24.764831 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.765208 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.765590 #15884] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1[0m
E, [2015-06-07T17:44:24.765619 #15884] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.765722 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.766020 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.766367 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.766667 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.766969 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.767238 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.767593 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.767895 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:24.768269 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-07T17:44:24.768432 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.768751 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.768899 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.769198 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.769499 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.769692 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.769983 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.770282 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:44:24.770918 #15884] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1[0m  [["uuid", "ijkh"]]
D, [2015-06-07T17:44:24.771287 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.771475 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.771872 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.772159 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:44:24.772461 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.772815 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.773045 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.773389 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.773685 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:44:24.773961 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:24.774254 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.774515 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.774819 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.775115 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.775403 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:44:24.775677 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:44:24.776054 #15884] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd'  ORDER BY "users"."total_order"
E, [2015-06-07T17:44:24.776083 #15884] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd'  ORDER BY "users"."total_order"
D, [2015-06-07T17:44:24.776227 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.776536 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.776841 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.777115 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:44:24.777400 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:44:24.777818 #15884] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."total_order"
E, [2015-06-07T17:44:24.777847 #15884] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."total_order"
D, [2015-06-07T17:44:24.777978 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.778291 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.778604 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.778884 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:44:24.779174 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:44:24.779453 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.779695 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.780200 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.781103 #15884] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:24.781891 #15884] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:44:24.782435 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.783102 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:44:24.783639 #15884] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.784256 #15884] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1  [["uuid", "abcd"]]
D, [2015-06-07T17:44:24.784642 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.785269 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:44:24.790149 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.790568 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.791360 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.791847 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.792168 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.792778 #15884] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '9ea9da86d738902afc28280ab163eacd' LIMIT 1
D, [2015-06-07T17:44:24.792999 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.793297 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.793614 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.793843 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.794309 #15884] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '6820264a41858c8be648b502017a1eec' LIMIT 1[0m
D, [2015-06-07T17:44:24.794509 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.794791 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.795222 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.795670 #15884] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.796349 #15884] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.798000 #15884] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "pqrs"]]
D, [2015-06-07T17:44:24.798315 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.798726 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:44:24.798941 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.799174 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.799581 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.799944 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.800241 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.800905 #15884] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:44:24.801430 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:44:24.801824 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "total_order"[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:44:24.802160 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.802436 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:44:24.802624 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.802812 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.803242 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:44:24.803568 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.803886 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.804688 #15884] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:44:24.805076 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:44:24.805542 #15884] DEBUG -- :   [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "total_order" DESC LIMIT 1[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:44:24.805770 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.806088 #15884] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:44:24.806255 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.806455 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.806962 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.807282 #15884] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.812852 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.813328 #15884] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.813541 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.813835 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.814317 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.814699 #15884] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:44:24.814976 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.815280 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.815606 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.815834 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.816335 #15884] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'pqrs' AND "users"."id" != 5) LIMIT 1
D, [2015-06-07T17:44:24.816806 #15884] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?[0m  [["parent_uuid", nil], ["id", 5]]
D, [2015-06-07T17:44:24.817297 #15884] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.817927 #15884] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'pqrs'  ORDER BY "users"."total_order")[0m
E, [2015-06-07T17:44:24.817960 #15884] ERROR -- : SQLite3::SQLException: no such column: users.total_order: UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'pqrs'  ORDER BY "users"."total_order")
D, [2015-06-07T17:44:24.818102 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.818361 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.818863 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:44:24.819245 #15884] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1[0m
E, [2015-06-07T17:44:24.819274 #15884] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.819390 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.819691 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.820026 #15884] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
E, [2015-06-07T17:44:24.820054 #15884] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.820156 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.820546 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.820886 #15884] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1[0m
E, [2015-06-07T17:44:24.820915 #15884] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.821015 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.821347 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.821701 #15884] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
E, [2015-06-07T17:44:24.821729 #15884] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.821830 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.822236 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.822617 #15884] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1[0m
E, [2015-06-07T17:44:24.822646 #15884] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.822746 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.823090 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.823773 #15884] DEBUG -- :   [1m[35mUser Load (0.2ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."id" DESC LIMIT 1
D, [2015-06-07T17:44:24.824272 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.824541 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.825041 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.825785 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.826602 #15884] DEBUG -- :   [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1[0m
E, [2015-06-07T17:44:24.826656 #15884] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.826846 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.827316 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.827799 #15884] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."id" DESC LIMIT 1
D, [2015-06-07T17:44:24.828117 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.828347 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.828785 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.829579 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:44:24.830676 #15884] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"[0m
E, [2015-06-07T17:44:24.830727 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
D, [2015-06-07T17:44:24.830922 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.831349 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.832011 #15884] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.835279 #15884] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"[0m
E, [2015-06-07T17:44:24.835394 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
D, [2015-06-07T17:44:24.835755 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.836657 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.837253 #15884] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
E, [2015-06-07T17:44:24.837286 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
D, [2015-06-07T17:44:24.837437 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.837759 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.838136 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.838511 #15884] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
E, [2015-06-07T17:44:24.838541 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
D, [2015-06-07T17:44:24.838663 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.838937 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.839302 #15884] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"[0m
E, [2015-06-07T17:44:24.839330 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
D, [2015-06-07T17:44:24.839435 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.839692 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.840009 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.840379 #15884] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"[0m
E, [2015-06-07T17:44:24.840408 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
D, [2015-06-07T17:44:24.840518 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.841983 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.842524 #15884] DEBUG -- :   [1m[35mFixture Delete (0.0ms)[0m  DELETE FROM "default_scoped_models"
D, [2015-06-07T17:44:24.842678 #15884] DEBUG -- :   [1m[36mFixture Insert (0.1ms)[0m  [1mINSERT INTO "default_scoped_models" ("id", "name", "lft", "rgt") VALUES (1, 'Top Level', 1, 4)[0m
D, [2015-06-07T17:44:24.842826 #15884] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "default_scoped_models" ("id", "name", "parent_id", "lft", "rgt") VALUES (2, 'Child 1', 1, 2, 3)
D, [2015-06-07T17:44:24.842931 #15884] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "default_scoped_models" ("id", "name", "lft", "rgt") VALUES (6, 'Top Level 2', 5, 6)[0m
D, [2015-06-07T17:44:24.843035 #15884] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "default_scoped_models" ("id", "name", "lft", "rgt") VALUES (7, 'Top Level 3', 7, 8)
D, [2015-06-07T17:44:24.843114 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mcommit transaction[0m
D, [2015-06-07T17:44:24.843249 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.846287 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.846704 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.847404 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.847775 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.850011 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.850389 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.851052 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.851397 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.851848 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:44:24.854027 #15884] DEBUG -- :   [1m[35mCategory Exists (0.1ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 4]]
D, [2015-06-07T17:44:24.854400 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.855128 #15884] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 3]]
D, [2015-06-07T17:44:24.855457 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:24.856043 #15884] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 1]]
D, [2015-06-07T17:44:24.856190 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.856556 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.856838 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:24.857125 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:44:24.857401 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.857672 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:44:24.857946 #15884] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:44:24.858306 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.858630 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.858927 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.859312 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.859542 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.859818 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.860179 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.860472 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.860739 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.861008 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:44:24.861254 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.861502 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.861775 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.862063 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:24.862700 #15884] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "total_order"  [["parent_id", 1]]
D, [2015-06-07T17:44:24.863301 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.863600 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.863953 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.864297 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.864623 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.864932 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.865194 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.865389 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.865652 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.865970 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.866248 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.866637 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.867138 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.867888 #15884] DEBUG -- :   [1m[35mScopedCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
E, [2015-06-07T17:44:24.867927 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.868072 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.868449 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.868871 #15884] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.869190 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.869418 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.869722 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.870052 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.870342 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.870548 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.870850 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.871302 #15884] DEBUG -- :   [1m[36mScopedCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1[0m
E, [2015-06-07T17:44:24.871335 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.871453 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.871774 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.872145 #15884] DEBUG -- :   [1m[35mScopedCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
E, [2015-06-07T17:44:24.872179 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.872349 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.872703 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:44:24.873188 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.873500 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.873807 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.874136 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.874417 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:24.874713 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.874979 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.875266 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:44:24.875557 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.875817 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.876122 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.876411 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.876674 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.876980 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.877276 #15884] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.877543 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.877834 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.878230 #15884] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-07T17:44:24.878749 #15884] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:24.879622 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.880173 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.880766 #15884] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:44:24.881223 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.881603 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.882030 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:44:24.882386 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.882702 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.883006 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.883291 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.883587 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.883891 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.884148 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.884436 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.884698 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.884987 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.885171 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.885451 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.885632 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.885850 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.886115 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.886421 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.886710 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.886852 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.887104 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.887236 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.887417 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.887754 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.888061 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.888243 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.888474 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.888641 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.888805 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.889117 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.889422 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:44:24.889709 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:44:24.889846 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.890102 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:44:24.890230 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.890391 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.890712 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.890946 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.891223 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.891475 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.891740 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.892087 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.892252 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.892540 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.892811 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-07T17:44:24.892984 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.893235 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.893535 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:24.893687 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.893939 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.894176 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.894436 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.894658 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.894971 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.895149 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.895381 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.895682 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.895943 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.896119 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.896448 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.896665 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.896932 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.897106 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.897342 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.897553 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.897956 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.898252 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.898511 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.898716 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.898966 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.899171 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.899421 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.899641 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.899879 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.900125 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.900372 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.900720 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.901012 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.901218 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.901501 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.901784 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.901960 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.902242 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.902529 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:24.902751 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.903019 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.903331 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.903606 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.903779 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.904039 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.904274 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.904539 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.904742 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.904992 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.905223 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.905491 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.905721 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.905964 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.906185 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.906443 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.906762 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.907153 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.907554 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.907942 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.908626 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.908956 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.909644 #15884] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."parent_id" IS NULL  ORDER BY "notes"."total_order"
E, [2015-06-07T17:44:24.909683 #15884] ERROR -- : SQLite3::SQLException: no such column: notes.total_order: SELECT "notes".* FROM "notes" WHERE "notes"."parent_id" IS NULL  ORDER BY "notes"."total_order"
D, [2015-06-07T17:44:24.910183 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.910524 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.914598 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.915007 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.915281 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.915641 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.915903 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.916148 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.916390 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.916666 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.917227 #15884] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:24.917570 #15884] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:44:24.917972 #15884] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:44:24.918251 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.918885 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.919201 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.919711 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.920234 #15884] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.920634 #15884] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.920863 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.921199 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.921537 #15884] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.921833 #15884] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:44:24.921997 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.922281 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.922654 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.922850 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.923054 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.923300 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.923591 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.923942 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.924128 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.924269 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.924495 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.924820 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.925237 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.925407 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.925540 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.925770 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.926108 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.926460 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.926767 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.927065 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.927290 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.927601 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.927930 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.928213 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.928579 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.928812 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.929093 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.929295 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.929529 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.929747 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.930020 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.930379 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:44:24.930694 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.930869 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.931452 #15884] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?  [["parent_id", 5], ["id", 4]]
D, [2015-06-07T17:44:24.931942 #15884] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1[0m  [["id", 5]]
E, [2015-06-07T17:44:24.931973 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.932148 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.932412 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.932741 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.933080 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:44:24.933371 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.933583 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.934177 #15884] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?  [["parent_id", 5], ["id", 4]]
D, [2015-06-07T17:44:24.934636 #15884] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1[0m  [["id", 5]]
E, [2015-06-07T17:44:24.934677 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.934795 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.935046 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.935353 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.935659 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:44:24.935860 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.936352 #15884] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?[0m  [["parent_id", nil], ["id", 4]]
D, [2015-06-07T17:44:24.936651 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:44:24.936836 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.937093 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.937384 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.937711 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.938190 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.938817 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.939075 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.939404 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.939844 #15884] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1[0m
E, [2015-06-07T17:44:24.939874 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.939977 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.940356 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.940496 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.940748 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.940879 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.941117 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.941231 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.941469 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.941582 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.941815 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.941937 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.942183 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.942306 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.942533 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.942655 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.942885 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.943008 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.943238 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.943366 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.943595 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.946245 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.946565 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.946781 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.947039 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.947308 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.947772 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.948168 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.948539 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.948715 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.948996 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.949215 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.949501 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.949710 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.949998 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.950263 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.950555 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.950934 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.951328 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.951530 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.951799 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.951987 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.952264 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.952452 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.952707 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.952888 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.953151 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.953337 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.953605 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.953778 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.954055 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.954449 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.954994 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.955278 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.955561 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.955731 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.955971 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.956123 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.956372 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.956522 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.956767 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.956935 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.957187 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.957353 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.957599 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.957762 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.958112 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.958234 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.958565 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.958999 #15884] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."denv" = 1
E, [2015-06-07T17:44:24.959030 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT "categories".* FROM "categories" WHERE "categories"."denv" = 1
D, [2015-06-07T17:44:24.959150 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.959418 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.959786 #15884] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1[0m
E, [2015-06-07T17:44:24.959823 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.959923 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.960191 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.960511 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.960786 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.961053 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.961238 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.961493 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.961800 #15884] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."id" DESC LIMIT 1[0m
D, [2015-06-07T17:44:24.962332 #15884] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1  [["id", 6]]
E, [2015-06-07T17:44:24.962363 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:44:24.962483 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.962773 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.963177 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:24.963841 #15884] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-07T17:44:24.964340 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.965145 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:44:24.965838 #15884] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE (is_leaf = 1)[0m
E, [2015-06-07T17:44:24.965891 #15884] ERROR -- : SQLite3::SQLException: no such column: is_leaf: SELECT "categories".* FROM "categories" WHERE (is_leaf = 1)
D, [2015-06-07T17:44:24.966041 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.966396 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.966800 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:44:24.967015 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.967298 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.967605 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:44:24.968150 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.968452 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.968641 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.968924 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.969230 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:44:24.969514 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:24.969796 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.970041 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:24.970325 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:24.970656 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:44:24.970965 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.971258 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.971482 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.971783 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.972075 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.972365 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.972640 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.973062 #15884] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = 1  ORDER BY "categories"."total_order"[0m
E, [2015-06-07T17:44:24.973093 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = 1  ORDER BY "categories"."total_order"
D, [2015-06-07T17:44:24.973211 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.973510 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.973797 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:24.974070 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.974349 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.974784 #15884] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3)  ORDER BY "categories"."total_order"[0m
E, [2015-06-07T17:44:24.974813 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3)  ORDER BY "categories"."total_order"
D, [2015-06-07T17:44:24.974929 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.975220 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.975510 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:44:24.975777 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:44:24.976038 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.976291 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:24.976515 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.976892 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.977170 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:24.977455 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:44:24.977698 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.978042 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.978316 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:44:24.978628 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:24.978818 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.979180 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.979499 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.979795 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.980454 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.980829 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.981067 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.981337 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.981577 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.981851 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.982022 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.982264 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.982536 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.982805 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.982977 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.983210 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.983465 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.983732 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.983911 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:24.984146 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.984384 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.984748 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.985122 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:44:24.985406 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:44:24.986048 #15884] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 5]]
D, [2015-06-07T17:44:24.986180 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.986424 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:24.986583 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.986765 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.987054 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.987331 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:44:24.987592 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.988140 #15884] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 3]]
D, [2015-06-07T17:44:24.988536 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 3]]
D, [2015-06-07T17:44:24.988992 #15884] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "total_order"  [["parent_id", 3]]
D, [2015-06-07T17:44:24.989505 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.995256 #15884] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:44:24.995478 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:24.995714 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:24.996140 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:24.996739 #15884] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:44:24.997339 #15884] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:24.998516 #15884] DEBUG -- :   [1m[35mCategory Exists (0.1ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 3]]
D, [2015-06-07T17:44:24.999233 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 3]]
D, [2015-06-07T17:44:24.999826 #15884] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "total_order" DESC LIMIT 1  [["parent_id", 3]]
D, [2015-06-07T17:44:25.000049 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:25.000359 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:44:25.000508 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:25.000744 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:25.001123 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:25.001438 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:44:25.001723 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:25.002359 #15884] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 1]]
D, [2015-06-07T17:44:25.002728 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-07T17:44:25.003075 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "total_order"  [["parent_id", 1]]
D, [2015-06-07T17:44:25.003385 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:25.003669 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:44:25.003817 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:25.004030 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:44:25.004388 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:25.004728 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:44:25.004985 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:44:25.005639 #15884] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 1]]
D, [2015-06-07T17:44:25.005973 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-07T17:44:25.006334 #15884] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "total_order"  [["parent_id", 1]]
D, [2015-06-07T17:44:25.006615 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:25.007088 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:44:25.007386 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:25.007821 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:25.008114 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:44:25.008272 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:25.008463 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:25.008806 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:25.009132 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:44:25.009334 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:25.009627 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:25.009936 #15884] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:44:25.010168 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:25.010703 #15884] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?  [["parent_id", nil], ["id", 5]]
D, [2015-06-07T17:44:25.011204 #15884] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:44:25.011787 #15884] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 5  ORDER BY "categories"."total_order")
E, [2015-06-07T17:44:25.011819 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 5  ORDER BY "categories"."total_order")
D, [2015-06-07T17:44:25.011941 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:25.012176 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:25.012653 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:25.013112 #15884] DEBUG -- :   [1m[35mThing Load (0.1ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:25.016784 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-07T17:44:25.016975 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:25.017402 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:25.017800 #15884] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:25.018463 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-07T17:44:25.018634 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:25.019846 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:25.020045 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:25.020415 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:25.020830 #15884] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:44:25.021505 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-07T17:44:25.021931 #15884] DEBUG -- :   [1m[35mThing Load (0.2ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."parent_id" = ?  ORDER BY "total_order" DESC LIMIT 1  [["parent_id", 1]]
D, [2015-06-07T17:44:25.022115 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:25.022304 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:25.022559 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:25.023069 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:25.025772 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:25.026111 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:25.026394 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:25.026872 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:25.028075 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:25.028493 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:25.031683 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:25.032106 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:25.032436 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:25.033086 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:25.033336 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:25.033618 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:25.033756 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:25.034130 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:25.034704 #15884] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1[0m
E, [2015-06-07T17:44:25.034742 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:44:25.034870 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:25.035165 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:25.035562 #15884] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
E, [2015-06-07T17:44:25.035594 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:44:25.035729 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:25.036153 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:25.041122 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:25.041515 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:25.041792 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:25.042269 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:25.042805 #15884] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1[0m
E, [2015-06-07T17:44:25.042838 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:44:25.042954 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:25.043236 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:25.043735 #15884] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."id" ASC LIMIT 1
D, [2015-06-07T17:44:25.044769 #15884] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT "notes".id FROM "notes" WHERE "notes"."user_id" = ?[0m  [["user_id", 1]]
D, [2015-06-07T17:44:25.045269 #15884] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 1]]
D, [2015-06-07T17:44:25.045843 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:25.046104 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:44:25.046444 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:25.047002 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:44:25.048228 #15884] DEBUG -- :   [1m[36mCategory Load (0.3ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1[0m
E, [2015-06-07T17:44:25.048330 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:44:25.048603 #15884] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:44:25.049349 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:25.049860 #15884] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
E, [2015-06-07T17:44:25.049894 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:44:25.050051 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:25.050352 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:25.050672 #15884] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."id" DESC LIMIT 1[0m
D, [2015-06-07T17:44:25.050866 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:25.051039 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:25.051279 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:25.051683 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:25.052102 #15884] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
E, [2015-06-07T17:44:25.052151 #15884] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:44:25.052265 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:44:25.052591 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:44:25.052855 #15884] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."id" DESC LIMIT 1[0m
D, [2015-06-07T17:44:25.052999 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:44:25.053160 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:44:25.053376 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:44:25.053767 #15884] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:44:25.054346 #15884] DEBUG -- :   [1m[35mDefaultScopedModel Load (0.1ms)[0m  SELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-07T17:44:25.057262 #15884] DEBUG -- :   [1m[36mDefaultScopedModel Load (0.0ms)[0m  [1mSELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-07T17:44:25.057746 #15884] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.232996 #15923] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mCREATE TABLE "default_scoped_models" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-07T17:45:54.233447 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "categories" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-07T17:45:54.233774 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "departments" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar) [0m
D, [2015-06-07T17:45:54.234160 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "notes" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "notable_id" integer, "notable_type" varchar, "user_id" integer) 
D, [2015-06-07T17:45:54.234526 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "renamed_columns" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "mother_id" integer, "red" integer, "black" integer, "pitch" integer) [0m
D, [2015-06-07T17:45:54.234888 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "things" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "children_count" integer) 
D, [2015-06-07T17:45:54.235218 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "brokens" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-07T17:45:54.235573 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "orders" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) 
D, [2015-06-07T17:45:54.235926 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "positions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "position" integer) [0m
D, [2015-06-07T17:45:54.236285 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "no_depths" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) 
D, [2015-06-07T17:45:54.236676 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "single_table_inheritance" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "type" varchar, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) [0m
D, [2015-06-07T17:45:54.237052 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uuid" varchar, "name" varchar, "parent_uuid" varchar, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-07T17:45:54.249718 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL) [0m
D, [2015-06-07T17:45:54.249914 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  select sqlite_version(*)
D, [2015-06-07T17:45:54.250214 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
D, [2015-06-07T17:45:54.250338 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT version FROM "schema_migrations"
D, [2015-06-07T17:45:54.250484 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('0')[0m
D, [2015-06-07T17:45:54.629541 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:45:54.632048 #15923] DEBUG -- :   [1m[36mFixture Delete (0.0ms)[0m  [1mDELETE FROM "categories"[0m
D, [2015-06-07T17:45:54.633410 #15923] DEBUG -- :   [1m[35mFixture Insert (0.1ms)[0m  INSERT INTO "categories" ("id", "name", "lft", "rgt") VALUES (1, 'Top Level', 1, 10)
D, [2015-06-07T17:45:54.633539 #15923] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (2, 'Child 1', 1, 2, 3)[0m
D, [2015-06-07T17:45:54.633672 #15923] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (3, 'Child 2', 1, 4, 7)
D, [2015-06-07T17:45:54.633786 #15923] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (4, 'Child 2.1', 3, 5, 6)[0m
D, [2015-06-07T17:45:54.633893 #15923] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (5, 'Child 3', 1, 8, 9)
D, [2015-06-07T17:45:54.633998 #15923] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "categories" ("id", "name", "lft", "rgt") VALUES (6, 'Top Level 2', 11, 12)[0m
D, [2015-06-07T17:45:54.634096 #15923] DEBUG -- :   [1m[35mFixture Delete (0.0ms)[0m  DELETE FROM "departments"
D, [2015-06-07T17:45:54.634301 #15923] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "departments" ("id", "name") VALUES (1, 'Top')[0m
D, [2015-06-07T17:45:54.634913 #15923] DEBUG -- :   [1m[35mFixture Delete (0.0ms)[0m  DELETE FROM "notes"
D, [2015-06-07T17:45:54.635054 #15923] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "notes" ("id", "body", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (1, 'Top Level', 1, 10, 1, 'Category', 1)[0m
D, [2015-06-07T17:45:54.635175 #15923] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "notes" ("id", "body", "parent_id", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (2, 'Child 1', 1, 2, 3, 1, 'Category', 1)
D, [2015-06-07T17:45:54.635332 #15923] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "notes" ("id", "body", "parent_id", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (3, 'Child 2', 1, 4, 7, 1, 'Category', 1)[0m
D, [2015-06-07T17:45:54.635453 #15923] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "notes" ("id", "body", "parent_id", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (4, 'Child 3', 1, 8, 9, 1, 'Category', 1)
D, [2015-06-07T17:45:54.635566 #15923] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "notes" ("id", "body", "lft", "rgt", "notable_id", "notable_type") VALUES (5, 'Top Level 2', 1, 2, 1, 'Departments')[0m
D, [2015-06-07T17:45:54.636082 #15923] DEBUG -- :   [1m[35mFixture Delete (0.0ms)[0m  DELETE FROM "things"
D, [2015-06-07T17:45:54.636210 #15923] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "things" ("id", "body", "lft", "rgt", "children_count") VALUES (1, 'Top Level', 1, 10, 2)[0m
D, [2015-06-07T17:45:54.636353 #15923] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "things" ("id", "body", "parent_id", "lft", "rgt", "children_count") VALUES (2, 'Child 1', 1, 2, 3, 0)
D, [2015-06-07T17:45:54.636463 #15923] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "things" ("id", "body", "parent_id", "lft", "rgt", "children_count") VALUES (3, 'Child 2', 1, 4, 7, 0)[0m
D, [2015-06-07T17:45:54.636573 #15923] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "things" ("id", "body", "parent_id", "lft", "rgt", "children_count") VALUES (4, 'Child 2.1', 3, 8, 9, 0)
D, [2015-06-07T17:45:54.637057 #15923] DEBUG -- :   [1m[36mFixture Delete (0.0ms)[0m  [1mDELETE FROM "brokens"[0m
D, [2015-06-07T17:45:54.637168 #15923] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "brokens" ("id", "name") VALUES (1, 'One')
D, [2015-06-07T17:45:54.637769 #15923] DEBUG -- :   [1m[36mFixture Delete (0.1ms)[0m  [1mDELETE FROM "users"[0m
D, [2015-06-07T17:45:54.637919 #15923] DEBUG -- :   [1m[35mFixture Insert (0.1ms)[0m  INSERT INTO "users" ("id", "uuid", "name", "lft", "rgt") VALUES (1, 'abcd', 'Top Level', 1, 10)
D, [2015-06-07T17:45:54.638036 #15923] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (2, 'efgh', 'Child 1', 'abcd', 2, 3)[0m
D, [2015-06-07T17:45:54.638150 #15923] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (3, 'ijkh', 'Child 2', 'abcd', 4, 7)
D, [2015-06-07T17:45:54.638286 #15923] DEBUG -- :   [1m[36mFixture Insert (0.1ms)[0m  [1mINSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (4, 'lmno', 'Child 2.1', 'ijkh', 5, 6)[0m
D, [2015-06-07T17:45:54.638400 #15923] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (5, 'pqrs', 'Child 3', 'abcd', 8, 9)
D, [2015-06-07T17:45:54.638508 #15923] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "users" ("id", "uuid", "name", "lft", "rgt") VALUES (6, 'tuvw', 'Top Level 2', 11, 12)[0m
D, [2015-06-07T17:45:54.638593 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  commit transaction
D, [2015-06-07T17:45:54.638731 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.641666 #15923] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:45:54.657302 #15923] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "lmno"]]
D, [2015-06-07T17:45:54.657783 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.658511 #15923] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:45:54.658789 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.659367 #15923] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "abcd"]]
D, [2015-06-07T17:45:54.659557 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.659996 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.660398 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.660739 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.661041 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.661301 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:45:54.661583 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.662011 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.662367 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.662724 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.665289 #15923] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'a3fca6d20773c1d0b3f725de518e9570' LIMIT 1
D, [2015-06-07T17:45:54.665707 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.666001 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.666373 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.666804 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.667165 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.667468 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.667740 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:45:54.668029 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.668293 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.668603 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:45:54.668872 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.669559 #15923] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "total_order"  [["parent_uuid", "abcd"]]
D, [2015-06-07T17:45:54.671913 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.672291 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.672759 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.673281 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.673584 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.673935 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.674235 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.674464 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.674739 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.675035 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.675337 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.675518 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.675810 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.676363 #15923] DEBUG -- :   [1m[35mScopedUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
E, [2015-06-07T17:45:54.676397 #15923] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.676540 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.676807 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.677148 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.677441 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.677660 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.677923 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.678210 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.678484 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.678665 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.678980 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:45:54.679382 #15923] DEBUG -- :   [1m[36mScopedUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1[0m
E, [2015-06-07T17:45:54.679411 #15923] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.679520 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.679781 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.680121 #15923] DEBUG -- :   [1m[35mScopedUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
E, [2015-06-07T17:45:54.680152 #15923] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.680250 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.680503 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.680833 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.681150 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.681452 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.681743 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.682004 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.682343 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.682625 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.682916 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:45:54.683210 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.683493 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.683782 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.684074 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.684336 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.684631 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.684939 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.685222 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.685530 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.685797 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-07T17:45:54.686086 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.686378 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.686645 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.686923 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:45:54.687210 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.687487 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.687797 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:45:54.688143 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.688433 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.688749 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.689056 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.689352 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.689642 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.689972 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.690238 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.690536 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.690815 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.691025 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.691274 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.691494 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.691676 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.691962 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.692244 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.692536 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.692691 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.692930 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.693110 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.693280 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.693560 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.693819 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.693989 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.694224 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.694377 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.694737 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.695257 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.695935 #15923] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:45:54.696473 #15923] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:45:54.696763 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.697139 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:45:54.697405 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.697732 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.698128 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.698450 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.699099 #15923] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '59673cb13bb4bb1080ac123d06085984' LIMIT 1
D, [2015-06-07T17:45:54.699479 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.699891 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.700288 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.700733 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.701002 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.701366 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.701787 #15923] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-07T17:45:54.702060 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.702445 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.702837 #15923] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.703194 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.703520 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.703799 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.704369 #15923] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '7f3368cb5dee3ad803acc786e01e7168' LIMIT 1
D, [2015-06-07T17:45:54.704634 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.704936 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.705291 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.705578 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.706148 #15923] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '2774a37303b313bf0e926fd1e2a8e9eb' LIMIT 1[0m
D, [2015-06-07T17:45:54.706394 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.706690 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.707044 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.707335 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.707918 #15923] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '8757d109adc252f865b1b4639079d62f' LIMIT 1
D, [2015-06-07T17:45:54.708171 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.708454 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.708831 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.709128 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.709689 #15923] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'f80078106e7231ca9fa4991de8b94f2d' LIMIT 1[0m
D, [2015-06-07T17:45:54.709947 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.710231 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.710604 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:45:54.710982 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.711466 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.712173 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.712995 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:45:54.713394 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.713773 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.720185 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.720585 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.720888 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.721203 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:45:54.721574 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.721925 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:45:54.722178 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.722464 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.722752 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.722934 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.723217 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.723476 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.723730 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.723983 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.724280 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.724576 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:45:54.724753 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.725049 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.725293 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.725553 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.725794 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.726038 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.726275 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.726518 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.726747 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.726985 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.727224 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.727460 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.727718 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.728212 #15923] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'e92ab72c3f33aa8ac58adb37a8f5ffce' LIMIT 1
D, [2015-06-07T17:45:54.728455 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.728695 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.729008 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.729350 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.729518 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.729719 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.729952 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.730223 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.730534 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.730684 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.730840 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.731035 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.731298 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.731630 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.731781 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.731928 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.732120 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.732382 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.732680 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.732972 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.733426 #15923] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'f4134a9369c2660379c7e799766de182' LIMIT 1[0m
D, [2015-06-07T17:45:54.733694 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.734025 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.734412 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.734871 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.735301 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.735821 #15923] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '88999d35ab0cfec709c451ec5a9efac4' LIMIT 1[0m
D, [2015-06-07T17:45:54.736291 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.736656 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.737057 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.737337 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.737842 #15923] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '5226724f2bda53278eaed84ca90a64bc' LIMIT 1
D, [2015-06-07T17:45:54.738053 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.738297 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.738687 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.739017 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:45:54.739332 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:45:54.739563 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.740490 #15923] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1[0m
D, [2015-06-07T17:45:54.741394 #15923] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?  [["parent_uuid", "pqrs"], ["id", 4]]
D, [2015-06-07T17:45:54.741931 #15923] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."total_order" LIMIT 1[0m  [["uuid", "pqrs"]]
E, [2015-06-07T17:45:54.741965 #15923] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.742130 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.742425 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.742827 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.743136 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:45:54.743451 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.743664 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.744123 #15923] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1
D, [2015-06-07T17:45:54.744808 #15923] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?[0m  [["parent_uuid", "pqrs"], ["id", 4]]
D, [2015-06-07T17:45:54.746073 #15923] DEBUG -- :   [1m[35mUser Load (0.3ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."total_order" LIMIT 1  [["uuid", "pqrs"]]
E, [2015-06-07T17:45:54.746170 #15923] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.746495 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.746894 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.747329 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.747750 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:45:54.748040 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.748514 #15923] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1
D, [2015-06-07T17:45:54.748993 #15923] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?[0m  [["parent_uuid", nil], ["id", 4]]
D, [2015-06-07T17:45:54.749324 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:45:54.749522 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.749819 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.750174 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.750476 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.750973 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.751764 #15923] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '04b11db2f141672d8528b713cc38d880' LIMIT 1
D, [2015-06-07T17:45:54.751987 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.752273 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.752616 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.753005 #15923] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
E, [2015-06-07T17:45:54.753035 #15923] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.753143 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.753606 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:45:54.754672 #15923] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL[0m
D, [2015-06-07T17:45:54.755167 #15923] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order"
E, [2015-06-07T17:45:54.755199 #15923] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order"
D, [2015-06-07T17:45:54.755329 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.755719 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.756077 #15923] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1[0m
E, [2015-06-07T17:45:54.756106 #15923] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.756209 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.756533 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.756901 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.757183 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.757483 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.757819 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.758109 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.758451 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.758786 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-07T17:45:54.758947 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.759265 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:45:54.759410 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.759687 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.759974 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.760160 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.760472 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.760733 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:45:54.761385 #15923] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1[0m  [["uuid", "ijkh"]]
D, [2015-06-07T17:45:54.761747 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.761929 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.762245 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.762543 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:45:54.762907 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.763182 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.763442 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.763752 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.764045 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:45:54.764342 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.764625 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.764843 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.765159 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.765436 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.765702 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:45:54.765976 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:45:54.766383 #15923] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd'  ORDER BY "users"."total_order"
E, [2015-06-07T17:45:54.766413 #15923] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd'  ORDER BY "users"."total_order"
D, [2015-06-07T17:45:54.766524 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.766857 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:45:54.767124 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.767422 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:45:54.767694 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:45:54.768129 #15923] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."total_order"
E, [2015-06-07T17:45:54.768158 #15923] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."total_order"
D, [2015-06-07T17:45:54.768265 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.768571 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.768878 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.769178 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:45:54.769453 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:45:54.769726 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.769944 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.770402 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.770711 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.771053 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:45:54.771524 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.772186 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:45:54.772650 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.773071 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1  [["uuid", "abcd"]]
D, [2015-06-07T17:45:54.773317 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.773786 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.778259 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.778643 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.779480 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.779931 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.780286 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.781318 #15923] DEBUG -- :   [1m[35mUser Exists (0.2ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'fcc3d96a5ed7ffca27ff3d510e4b49f2' LIMIT 1
D, [2015-06-07T17:45:54.782061 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.782616 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.783210 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.783553 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.784159 #15923] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'fd37f16c69dcc6a6f5bca8ece98f541a' LIMIT 1[0m
D, [2015-06-07T17:45:54.784385 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.784658 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.785108 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.785498 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.785828 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.786468 #15923] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "pqrs"]]
D, [2015-06-07T17:45:54.786632 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.786876 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:45:54.787093 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.787278 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.787575 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.787875 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.788172 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.788806 #15923] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:45:54.789348 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:45:54.789740 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "total_order"[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:45:54.790050 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.790339 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:45:54.790497 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.790718 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.791036 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.791341 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.791638 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.792239 #15923] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:45:54.792578 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:45:54.792987 #15923] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "total_order" DESC LIMIT 1[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-07T17:45:54.793182 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.793458 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:45:54.793613 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.793819 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.794222 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.794532 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.799845 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.800299 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.800521 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.800795 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.801184 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.801555 #15923] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:45:54.801806 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.802092 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.802413 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.802665 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.803175 #15923] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'pqrs' AND "users"."id" != 5) LIMIT 1
D, [2015-06-07T17:45:54.803662 #15923] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?[0m  [["parent_uuid", nil], ["id", 5]]
D, [2015-06-07T17:45:54.804162 #15923] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.804832 #15923] DEBUG -- :   [1m[36mSQL (0.2ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'pqrs'  ORDER BY "users"."total_order")[0m
E, [2015-06-07T17:45:54.804869 #15923] ERROR -- : SQLite3::SQLException: no such column: users.total_order: UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'pqrs'  ORDER BY "users"."total_order")
D, [2015-06-07T17:45:54.805014 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.805306 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.805806 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.806278 #15923] DEBUG -- :   [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1[0m
E, [2015-06-07T17:45:54.806309 #15923] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.806421 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.806697 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.807070 #15923] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
E, [2015-06-07T17:45:54.807098 #15923] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.807201 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.807568 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.807916 #15923] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1[0m
E, [2015-06-07T17:45:54.807945 #15923] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.808048 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.808350 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.808705 #15923] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
E, [2015-06-07T17:45:54.808733 #15923] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.808836 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.809182 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.809525 #15923] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1[0m
E, [2015-06-07T17:45:54.809555 #15923] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.809670 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.809951 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.810253 #15923] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."id" DESC LIMIT 1
D, [2015-06-07T17:45:54.810431 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.810599 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.810847 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.811222 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.811619 #15923] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1[0m
E, [2015-06-07T17:45:54.811648 #15923] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.811753 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.812043 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.812306 #15923] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."id" DESC LIMIT 1
D, [2015-06-07T17:45:54.812536 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.812752 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.813062 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.813795 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:45:54.814531 #15923] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"[0m
E, [2015-06-07T17:45:54.814569 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
D, [2015-06-07T17:45:54.814706 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.815057 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.815546 #15923] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.818732 #15923] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"[0m
E, [2015-06-07T17:45:54.818781 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
D, [2015-06-07T17:45:54.818934 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.819344 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.819804 #15923] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
E, [2015-06-07T17:45:54.819839 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
D, [2015-06-07T17:45:54.819971 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.820301 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.820670 #15923] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.821037 #15923] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
E, [2015-06-07T17:45:54.821068 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
D, [2015-06-07T17:45:54.821196 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.821472 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.821825 #15923] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"[0m
E, [2015-06-07T17:45:54.821854 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
D, [2015-06-07T17:45:54.821957 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.822210 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.822556 #15923] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.822925 #15923] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"[0m
E, [2015-06-07T17:45:54.822954 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order"
D, [2015-06-07T17:45:54.823078 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.824522 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.825086 #15923] DEBUG -- :   [1m[35mFixture Delete (0.0ms)[0m  DELETE FROM "default_scoped_models"
D, [2015-06-07T17:45:54.825259 #15923] DEBUG -- :   [1m[36mFixture Insert (0.1ms)[0m  [1mINSERT INTO "default_scoped_models" ("id", "name", "lft", "rgt") VALUES (1, 'Top Level', 1, 4)[0m
D, [2015-06-07T17:45:54.825378 #15923] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "default_scoped_models" ("id", "name", "parent_id", "lft", "rgt") VALUES (2, 'Child 1', 1, 2, 3)
D, [2015-06-07T17:45:54.825488 #15923] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "default_scoped_models" ("id", "name", "lft", "rgt") VALUES (6, 'Top Level 2', 5, 6)[0m
D, [2015-06-07T17:45:54.825590 #15923] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "default_scoped_models" ("id", "name", "lft", "rgt") VALUES (7, 'Top Level 3', 7, 8)
D, [2015-06-07T17:45:54.825674 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mcommit transaction[0m
D, [2015-06-07T17:45:54.825817 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.829491 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.830373 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.831297 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.831717 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:45:54.834063 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.834452 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.835138 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.835484 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:45:54.835960 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:45:54.838016 #15923] DEBUG -- :   [1m[35mCategory Exists (0.1ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 4]]
D, [2015-06-07T17:45:54.838462 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.839224 #15923] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 3]]
D, [2015-06-07T17:45:54.839505 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.840073 #15923] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 1]]
D, [2015-06-07T17:45:54.840223 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.840553 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.840854 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.841152 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:45:54.841427 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.841712 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:45:54.841987 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:45:54.842347 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.842667 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.842953 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.843340 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.843577 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.843854 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.844217 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.844507 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.844780 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.845028 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:45:54.845328 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.845565 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.845840 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.846131 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.846743 #15923] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "total_order"  [["parent_id", 1]]
D, [2015-06-07T17:45:54.847316 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.847613 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.847960 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.848312 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.848584 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.848877 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.849163 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.849340 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.849602 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.849889 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.850170 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.850328 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.850608 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.851156 #15923] DEBUG -- :   [1m[35mScopedCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
E, [2015-06-07T17:45:54.851190 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.851301 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.851563 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.851900 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.852191 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.852364 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.852652 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.852908 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.853193 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.853349 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.853628 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.854019 #15923] DEBUG -- :   [1m[36mScopedCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1[0m
E, [2015-06-07T17:45:54.854050 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.854195 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.854650 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.855340 #15923] DEBUG -- :   [1m[35mScopedCategory Load (0.2ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
E, [2015-06-07T17:45:54.855396 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.855554 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.855943 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:45:54.856360 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.856730 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.857100 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.857413 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.857750 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.858083 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.858372 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.858700 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:45:54.859007 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.859322 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.859651 #15923] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.859949 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.860273 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.860572 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.860959 #15923] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.861492 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.861846 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.862183 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-07T17:45:54.862488 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.862767 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.863122 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.863524 #15923] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:45:54.863983 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.864751 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:45:54.865580 #15923] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:45:54.866206 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.866790 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.867246 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.867627 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.868068 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:45:54.868445 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.868821 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.869197 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.869566 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.869933 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.870136 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.870489 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.870705 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.870910 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.871342 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.871709 #15923] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.871977 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.872155 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.872388 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.872578 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.872760 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.873076 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.873373 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.873520 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.873782 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.873922 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.874087 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.874419 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.874717 #15923] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:45:54.874991 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:45:54.875166 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.875398 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:45:54.875555 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.875728 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.876033 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.876323 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.876599 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.876821 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.877158 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.877459 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.877667 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.877963 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.878256 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-07T17:45:54.878418 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.878738 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:45:54.879009 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.879170 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.879478 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.879689 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.879955 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.880238 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.880531 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.880769 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.881005 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.881233 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.881596 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.881778 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.882009 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.882250 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.882592 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.882778 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.883121 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.883345 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.883636 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.883934 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.884236 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.884461 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.884742 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.884962 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.885255 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.885469 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.885776 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.886046 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.886327 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.886721 #15923] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.887025 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.887238 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.887545 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.887847 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.888042 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.888311 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.888625 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.888870 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.889164 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.889489 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.889780 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.889980 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.890243 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.890500 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.890775 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.891023 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.891307 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.891520 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.891794 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.892021 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.892290 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.892500 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.892789 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.893023 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.893303 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.893546 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.893842 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.894450 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.894738 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.895324 #15923] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."parent_id" IS NULL  ORDER BY "notes"."total_order"
E, [2015-06-07T17:45:54.895355 #15923] ERROR -- : SQLite3::SQLException: no such column: notes.total_order: SELECT "notes".* FROM "notes" WHERE "notes"."parent_id" IS NULL  ORDER BY "notes"."total_order"
D, [2015-06-07T17:45:54.895807 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.896188 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.900564 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.901061 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.901383 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.901770 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.902037 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.902314 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.902559 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.902843 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.903406 #15923] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.903747 #15923] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:45:54.904118 #15923] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:45:54.904291 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.904590 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.904794 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.905045 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.905359 #15923] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.905693 #15923] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.905870 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.906159 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.906464 #15923] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.906733 #15923] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:45:54.906906 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.907180 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.907524 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.907690 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.907885 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.908152 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.908451 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.908765 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.908925 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.909056 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.909258 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.909536 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.909830 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.909983 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.910104 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.910305 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.910586 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.910917 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.911295 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.911920 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.912665 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.913489 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.914123 #15923] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.914481 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.914905 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.915202 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.915577 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.915827 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.916138 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.916412 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.916742 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.917156 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:45:54.917472 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.917682 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.918323 #15923] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?  [["parent_id", 5], ["id", 4]]
D, [2015-06-07T17:45:54.918828 #15923] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1[0m  [["id", 5]]
E, [2015-06-07T17:45:54.918860 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.919037 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.919324 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.919660 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.919986 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:45:54.920279 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.920485 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.921060 #15923] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?  [["parent_id", 5], ["id", 4]]
D, [2015-06-07T17:45:54.921556 #15923] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1[0m  [["id", 5]]
E, [2015-06-07T17:45:54.921587 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.921709 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.921979 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.922288 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.922614 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:45:54.922829 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.923350 #15923] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?[0m  [["parent_id", nil], ["id", 4]]
D, [2015-06-07T17:45:54.923670 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:45:54.923844 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.924122 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.924435 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.924774 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.925327 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.925993 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.926278 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.926609 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.927107 #15923] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1[0m
E, [2015-06-07T17:45:54.927139 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.927249 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.927677 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.927820 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.928122 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.928272 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.928570 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.928736 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.929032 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.929155 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.929446 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.929568 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.929865 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.929986 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.930281 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.930403 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.930683 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.930815 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.931096 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.931224 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.931508 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.934430 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.934784 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.935007 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.935332 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.935565 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.936189 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.936863 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.937573 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.937998 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.938579 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.939037 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.939612 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.940055 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.940618 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.941097 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.941617 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.942249 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.942941 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.943320 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.943804 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.944074 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.944402 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.944624 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.944967 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.945164 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.945479 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.945694 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.946006 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.946215 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.946554 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.946872 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.947663 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.948288 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.949032 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.949450 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.949955 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.950215 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.950610 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.950842 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.951207 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.951430 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.951786 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.952001 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.952354 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.952551 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.953034 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.953176 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.953604 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.954055 #15923] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."denv" = 1
E, [2015-06-07T17:45:54.954086 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT "categories".* FROM "categories" WHERE "categories"."denv" = 1
D, [2015-06-07T17:45:54.954208 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.954528 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.954973 #15923] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1[0m
E, [2015-06-07T17:45:54.955002 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.955125 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.955439 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.955830 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.956142 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.956464 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.956663 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.957019 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.957348 #15923] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."id" DESC LIMIT 1[0m
D, [2015-06-07T17:45:54.957933 #15923] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1  [["id", 6]]
E, [2015-06-07T17:45:54.957969 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:45:54.958102 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.958450 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.958778 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.959113 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-07T17:45:54.959277 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.959587 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.959874 #15923] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE (is_leaf = 1)[0m
E, [2015-06-07T17:45:54.959909 #15923] ERROR -- : SQLite3::SQLException: no such column: is_leaf: SELECT "categories".* FROM "categories" WHERE (is_leaf = 1)
D, [2015-06-07T17:45:54.960013 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.960311 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.960618 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:45:54.960820 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.961138 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.961442 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:45:54.961987 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.962302 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.962486 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.962812 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.963122 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:45:54.963387 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.963648 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.963871 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:54.964186 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:54.964469 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:45:54.964731 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.964982 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.965214 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.965525 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.965798 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.966057 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.966310 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.966692 #15923] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = 1  ORDER BY "categories"."total_order"[0m
E, [2015-06-07T17:45:54.966726 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = 1  ORDER BY "categories"."total_order"
D, [2015-06-07T17:45:54.966842 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.967148 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.967432 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.967693 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.967943 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.968358 #15923] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3)  ORDER BY "categories"."total_order"[0m
E, [2015-06-07T17:45:54.968387 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3)  ORDER BY "categories"."total_order"
D, [2015-06-07T17:45:54.968493 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.968812 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.969089 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:45:54.969355 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-07T17:45:54.969604 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.969854 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.970065 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.970487 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.970758 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:54.971046 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-07T17:45:54.971297 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.971735 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.972041 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:45:54.972363 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.972560 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.972984 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.973303 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.973593 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.974255 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.974651 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.974890 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.975158 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.975405 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.975709 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.975889 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.976118 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.976385 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.976689 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.976876 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.977107 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.977342 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.977637 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.977812 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:54.978042 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.978274 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.978658 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.979074 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:45:54.979564 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:45:54.980345 #15923] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 5]]
D, [2015-06-07T17:45:54.980508 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.980800 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:54.980993 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.981223 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.981577 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.981897 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:45:54.982210 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.982842 #15923] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 3]]
D, [2015-06-07T17:45:54.983282 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 3]]
D, [2015-06-07T17:45:54.988876 #15923] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "total_order"  [["parent_id", 3]]
D, [2015-06-07T17:45:54.989337 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.989638 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:45:54.989821 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.990038 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.990381 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.990723 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:45:54.991073 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:54.991717 #15923] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 3]]
D, [2015-06-07T17:45:54.992061 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 3]]
D, [2015-06-07T17:45:54.992448 #15923] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "total_order" DESC LIMIT 1  [["parent_id", 3]]
D, [2015-06-07T17:45:54.992642 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.992920 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-07T17:45:54.993065 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.993281 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.993589 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.993911 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:45:54.994199 #15923] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.994820 #15923] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 1]]
D, [2015-06-07T17:45:54.995319 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-07T17:45:54.996171 #15923] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "total_order"  [["parent_id", 1]]
D, [2015-06-07T17:45:54.997146 #15923] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.997688 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-07T17:45:54.997892 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:54.998141 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:54.998485 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:54.998838 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-07T17:45:54.999134 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-07T17:45:54.999773 #15923] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 1]]
D, [2015-06-07T17:45:55.000134 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-07T17:45:55.000478 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "total_order"  [["parent_id", 1]]
D, [2015-06-07T17:45:55.000786 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:55.001177 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:55.001504 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:55.001914 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:55.002168 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-07T17:45:55.002357 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:55.002552 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:55.002827 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:55.003135 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:45:55.003363 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:45:55.003618 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:55.003915 #15923] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-07T17:45:55.004114 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:55.004694 #15923] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?  [["parent_id", nil], ["id", 5]]
D, [2015-06-07T17:45:55.005198 #15923] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-07T17:45:55.005780 #15923] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 5  ORDER BY "categories"."total_order")
E, [2015-06-07T17:45:55.005812 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 5  ORDER BY "categories"."total_order")
D, [2015-06-07T17:45:55.005932 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:55.006203 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:55.006604 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:55.007126 #15923] DEBUG -- :   [1m[35mThing Load (0.1ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:55.010929 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-07T17:45:55.011118 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:55.011459 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:55.011839 #15923] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:55.012475 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-07T17:45:55.012633 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:55.013827 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:55.014021 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:55.014340 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:55.014700 #15923] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-07T17:45:55.015299 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-07T17:45:55.015717 #15923] DEBUG -- :   [1m[35mThing Load (0.1ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."parent_id" = ?  ORDER BY "total_order" DESC LIMIT 1  [["parent_id", 1]]
D, [2015-06-07T17:45:55.015905 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:55.016085 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:55.016329 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:55.016765 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:55.019391 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:55.019757 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:55.020045 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:55.020606 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:45:55.022178 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:55.022687 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:55.025916 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:55.026322 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:55.026624 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:55.027573 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:55.027829 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:55.028157 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:55.028285 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:55.028621 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:55.029121 #15923] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1[0m
E, [2015-06-07T17:45:55.029153 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:45:55.029306 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-07T17:45:55.029571 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:55.029991 #15923] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
E, [2015-06-07T17:45:55.030034 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:45:55.030221 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:55.031133 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-07T17:45:55.036855 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:55.037280 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:55.037561 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:55.038058 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:55.038544 #15923] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1[0m
E, [2015-06-07T17:45:55.038579 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:45:55.038732 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:55.039009 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:55.039504 #15923] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."id" ASC LIMIT 1
D, [2015-06-07T17:45:55.040500 #15923] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT "notes".id FROM "notes" WHERE "notes"."user_id" = ?[0m  [["user_id", 1]]
D, [2015-06-07T17:45:55.041018 #15923] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 1]]
D, [2015-06-07T17:45:55.041575 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:55.041844 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-07T17:45:55.042110 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:55.042432 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:55.042882 #15923] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1[0m
E, [2015-06-07T17:45:55.042912 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:45:55.043047 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:55.043397 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:55.043759 #15923] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
E, [2015-06-07T17:45:55.043788 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:45:55.043889 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:55.044203 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:55.044461 #15923] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."id" DESC LIMIT 1[0m
D, [2015-06-07T17:45:55.044661 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:55.044822 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:55.045064 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:55.045477 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:55.045860 #15923] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
E, [2015-06-07T17:45:55.045890 #15923] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" IS NULL  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-07T17:45:55.045993 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-07T17:45:55.046252 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-07T17:45:55.046519 #15923] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."id" DESC LIMIT 1[0m
D, [2015-06-07T17:45:55.046658 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-07T17:45:55.046793 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-07T17:45:55.047025 #15923] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-07T17:45:55.047392 #15923] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-07T17:45:55.047887 #15923] DEBUG -- :   [1m[35mDefaultScopedModel Load (0.1ms)[0m  SELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-07T17:45:55.050749 #15923] DEBUG -- :   [1m[36mDefaultScopedModel Load (0.0ms)[0m  [1mSELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-07T17:45:55.051202 #15923] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-08T21:15:38.325772 #23563] DEBUG -- :   [1m[36m (0.2ms)[0m  [1mCREATE TABLE "default_scoped_models" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-08T21:15:38.326595 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "categories" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-08T21:15:38.326928 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "departments" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar) [0m
D, [2015-06-08T21:15:38.327328 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "notes" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "notable_id" integer, "notable_type" varchar, "user_id" integer) 
D, [2015-06-08T21:15:38.327694 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "renamed_columns" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "mother_id" integer, "red" integer, "black" integer, "pitch" integer) [0m
D, [2015-06-08T21:15:38.328063 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "things" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "body" text, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "children_count" integer) 
D, [2015-06-08T21:15:38.328424 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "brokens" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) [0m
D, [2015-06-08T21:15:38.328775 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "orders" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer) 
D, [2015-06-08T21:15:38.329146 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "positions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer, "depth" integer, "position" integer) [0m
D, [2015-06-08T21:15:38.329506 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "no_depths" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) 
D, [2015-06-08T21:15:38.329874 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "single_table_inheritance" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "type" varchar, "name" varchar, "parent_id" integer, "lft" integer, "rgt" integer) [0m
D, [2015-06-08T21:15:38.330241 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  CREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "uuid" varchar, "name" varchar, "parent_uuid" varchar, "lft" integer, "rgt" integer, "depth" integer, "organization_id" integer) 
D, [2015-06-08T21:15:38.349519 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL) [0m
D, [2015-06-08T21:15:38.349710 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  select sqlite_version(*)
D, [2015-06-08T21:15:38.350042 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
D, [2015-06-08T21:15:38.350194 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT version FROM "schema_migrations"
D, [2015-06-08T21:15:38.350307 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('0')[0m
D, [2015-06-08T21:15:38.924696 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-08T21:15:38.927379 #23563] DEBUG -- :   [1m[36mFixture Delete (0.0ms)[0m  [1mDELETE FROM "categories"[0m
D, [2015-06-08T21:15:38.929545 #23563] DEBUG -- :   [1m[35mFixture Insert (0.1ms)[0m  INSERT INTO "categories" ("id", "name", "lft", "rgt") VALUES (1, 'Top Level', 1, 10)
D, [2015-06-08T21:15:38.929732 #23563] DEBUG -- :   [1m[36mFixture Insert (0.1ms)[0m  [1mINSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (2, 'Child 1', 1, 2, 3)[0m
D, [2015-06-08T21:15:38.929889 #23563] DEBUG -- :   [1m[35mFixture Insert (0.1ms)[0m  INSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (3, 'Child 2', 1, 4, 7)
D, [2015-06-08T21:15:38.930010 #23563] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (4, 'Child 2.1', 3, 5, 6)[0m
D, [2015-06-08T21:15:38.930131 #23563] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "categories" ("id", "name", "parent_id", "lft", "rgt") VALUES (5, 'Child 3', 1, 8, 9)
D, [2015-06-08T21:15:38.930243 #23563] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "categories" ("id", "name", "lft", "rgt") VALUES (6, 'Top Level 2', 11, 12)[0m
D, [2015-06-08T21:15:38.930356 #23563] DEBUG -- :   [1m[35mFixture Delete (0.0ms)[0m  DELETE FROM "departments"
D, [2015-06-08T21:15:38.930591 #23563] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "departments" ("id", "name") VALUES (1, 'Top')[0m
D, [2015-06-08T21:15:38.931314 #23563] DEBUG -- :   [1m[35mFixture Delete (0.0ms)[0m  DELETE FROM "notes"
D, [2015-06-08T21:15:38.931452 #23563] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "notes" ("id", "body", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (1, 'Top Level', 1, 10, 1, 'Category', 1)[0m
D, [2015-06-08T21:15:38.931577 #23563] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "notes" ("id", "body", "parent_id", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (2, 'Child 1', 1, 2, 3, 1, 'Category', 1)
D, [2015-06-08T21:15:38.931744 #23563] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "notes" ("id", "body", "parent_id", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (3, 'Child 2', 1, 4, 7, 1, 'Category', 1)[0m
D, [2015-06-08T21:15:38.931862 #23563] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "notes" ("id", "body", "parent_id", "lft", "rgt", "notable_id", "notable_type", "user_id") VALUES (4, 'Child 3', 1, 8, 9, 1, 'Category', 1)
D, [2015-06-08T21:15:38.931975 #23563] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "notes" ("id", "body", "lft", "rgt", "notable_id", "notable_type") VALUES (5, 'Top Level 2', 1, 2, 1, 'Departments')[0m
D, [2015-06-08T21:15:38.932460 #23563] DEBUG -- :   [1m[35mFixture Delete (0.0ms)[0m  DELETE FROM "things"
D, [2015-06-08T21:15:38.932588 #23563] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "things" ("id", "body", "lft", "rgt", "children_count") VALUES (1, 'Top Level', 1, 10, 2)[0m
D, [2015-06-08T21:15:38.932759 #23563] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "things" ("id", "body", "parent_id", "lft", "rgt", "children_count") VALUES (2, 'Child 1', 1, 2, 3, 0)
D, [2015-06-08T21:15:38.932871 #23563] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "things" ("id", "body", "parent_id", "lft", "rgt", "children_count") VALUES (3, 'Child 2', 1, 4, 7, 0)[0m
D, [2015-06-08T21:15:38.932982 #23563] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "things" ("id", "body", "parent_id", "lft", "rgt", "children_count") VALUES (4, 'Child 2.1', 3, 8, 9, 0)
D, [2015-06-08T21:15:38.933430 #23563] DEBUG -- :   [1m[36mFixture Delete (0.0ms)[0m  [1mDELETE FROM "brokens"[0m
D, [2015-06-08T21:15:38.933543 #23563] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "brokens" ("id", "name") VALUES (1, 'One')
D, [2015-06-08T21:15:38.934057 #23563] DEBUG -- :   [1m[36mFixture Delete (0.0ms)[0m  [1mDELETE FROM "users"[0m
D, [2015-06-08T21:15:38.934206 #23563] DEBUG -- :   [1m[35mFixture Insert (0.1ms)[0m  INSERT INTO "users" ("id", "uuid", "name", "lft", "rgt") VALUES (1, 'abcd', 'Top Level', 1, 10)
D, [2015-06-08T21:15:38.934321 #23563] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (2, 'efgh', 'Child 1', 'abcd', 2, 3)[0m
D, [2015-06-08T21:15:38.934435 #23563] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (3, 'ijkh', 'Child 2', 'abcd', 4, 7)
D, [2015-06-08T21:15:38.934544 #23563] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (4, 'lmno', 'Child 2.1', 'ijkh', 5, 6)[0m
D, [2015-06-08T21:15:38.934682 #23563] DEBUG -- :   [1m[35mFixture Insert (0.1ms)[0m  INSERT INTO "users" ("id", "uuid", "name", "parent_uuid", "lft", "rgt") VALUES (5, 'pqrs', 'Child 3', 'abcd', 8, 9)
D, [2015-06-08T21:15:38.934790 #23563] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "users" ("id", "uuid", "name", "lft", "rgt") VALUES (6, 'tuvw', 'Top Level 2', 11, 12)[0m
D, [2015-06-08T21:15:38.934877 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  commit transaction
D, [2015-06-08T21:15:38.935016 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:38.939365 #23563] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-08T21:15:38.965560 #23563] DEBUG -- :   [1m[36mUser Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "lmno"]]
D, [2015-06-08T21:15:38.966551 #23563] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:38.967711 #23563] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-08T21:15:38.968070 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:38.968704 #23563] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "abcd"]]
D, [2015-06-08T21:15:38.968922 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:38.969419 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:38.969851 #23563] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:38.970195 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:38.970489 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:38.970750 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-08T21:15:38.971036 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:38.971490 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:38.971849 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:38.972216 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:38.975349 #23563] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '82d42c33b766c79e043ace2ef283fc5c' LIMIT 1
D, [2015-06-08T21:15:38.975729 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:38.976077 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-08T21:15:38.976522 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:38.976942 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:38.977266 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:38.977561 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:38.977823 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-08T21:15:38.978106 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:38.978373 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:38.978738 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:38.979025 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:38.979709 #23563] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "total_order"  [["parent_uuid", "abcd"]]
D, [2015-06-08T21:15:38.983065 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:38.983519 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:38.983991 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:38.984550 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:38.984898 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:38.985282 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:38.985588 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:38.985854 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:38.986142 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:38.986457 #23563] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:38.986738 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:38.986920 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:38.987247 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:38.987823 #23563] DEBUG -- :   [1m[35mScopedUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1
E, [2015-06-08T21:15:38.987857 #23563] ERROR -- : SQLite3::SQLException: no such column: users.denv: SELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1
D, [2015-06-08T21:15:38.988001 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:38.988323 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:38.988653 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:38.988987 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:38.989182 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:38.989457 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:38.989755 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:38.990045 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:38.990224 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:38.990487 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:38.990884 #23563] DEBUG -- :   [1m[36mScopedUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1[0m
E, [2015-06-08T21:15:38.990914 #23563] ERROR -- : SQLite3::SQLException: no such column: users.denv: SELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1
D, [2015-06-08T21:15:38.991022 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:38.991294 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:38.991653 #23563] DEBUG -- :   [1m[35mScopedUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1
E, [2015-06-08T21:15:38.991682 #23563] ERROR -- : SQLite3::SQLException: no such column: users.denv: SELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1
D, [2015-06-08T21:15:38.991788 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:38.992065 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:38.992331 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:38.992666 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:38.992998 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:38.993277 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:38.993571 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:38.993864 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:38.994151 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:38.994430 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-08T21:15:38.994732 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:38.995001 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:38.995294 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:38.995599 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:38.995870 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:38.996145 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:38.996447 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:38.996740 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:38.997011 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:38.997294 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-08T21:15:38.997589 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:38.997867 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:38.998154 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:38.998425 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-08T21:15:38.998725 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:38.998994 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:38.999287 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-08T21:15:38.999607 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-08T21:15:38.999895 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.000175 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.000481 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.000744 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.001069 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.001377 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.001645 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.001936 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.002192 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.002410 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.002670 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.002899 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.003085 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.003363 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.003845 #23563] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.004459 #23563] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.004718 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.005028 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.005221 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.005444 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.005824 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.006166 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.006376 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.006659 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.006845 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.007061 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.007387 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.007727 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-08T21:15:39.008052 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-08T21:15:39.008289 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.008582 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-08T21:15:39.008774 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.009003 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.009336 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.009631 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.010200 #23563] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '074494775ff696ee4b3766cd30ce1f58' LIMIT 1
D, [2015-06-08T21:15:39.010438 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.010718 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.011032 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.011388 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.011613 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.011890 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.012153 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-08T21:15:39.012343 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.012621 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.012905 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:39.013105 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.013366 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.013615 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.014103 #23563] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '0040f1ad940c7420ed6f91d6ba67b00d' LIMIT 1
D, [2015-06-08T21:15:39.014335 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.014658 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.015123 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.015541 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.016291 #23563] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '0a229b032497adf48542dd0e7a27b0f7' LIMIT 1[0m
D, [2015-06-08T21:15:39.016598 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.016913 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.017316 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.017596 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.018181 #23563] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '46f7a41e0c3623ddaf2e7fcd908c8b30' LIMIT 1
D, [2015-06-08T21:15:39.018406 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.018666 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.019021 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.019289 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.019782 #23563] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'd55ba9f0bd6034b590f18c15c90e8cc3' LIMIT 1[0m
D, [2015-06-08T21:15:39.020010 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.020291 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.020623 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.020966 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.021270 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.021535 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.027773 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-08T21:15:39.028151 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.028527 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.028770 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.029082 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.029333 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.029613 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-08T21:15:39.029984 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.030348 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-08T21:15:39.030570 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.030842 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.031152 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:39.031347 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.031627 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.031898 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:39.032123 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.032382 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.032696 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:39.032999 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-08T21:15:39.033177 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.033435 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.033694 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.033954 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.034201 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.034453 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.034688 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.034938 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.035174 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.035420 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.035670 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.035918 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.036186 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.036717 #23563] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'fa6d6c3a889861e3b087622840a5328b' LIMIT 1
D, [2015-06-08T21:15:39.036937 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.037208 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.037502 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.037859 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.038025 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.038246 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.038469 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.038772 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.039109 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.039269 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.039419 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.039625 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.039898 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.040206 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.040366 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.040517 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.040721 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.040995 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.041314 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.041595 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.042067 #23563] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = 'd5e5b8079d99b8cc4045d5e0f6da709d' LIMIT 1[0m
D, [2015-06-08T21:15:39.042326 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.042730 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.043226 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-08T21:15:39.043701 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.044111 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.044667 #23563] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '870b2190a14d3ea1724c733d6b53d38d' LIMIT 1[0m
D, [2015-06-08T21:15:39.045054 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.045332 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.045695 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.046007 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.046537 #23563] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '4b46acc9006ad4c4975446bed8fad43d' LIMIT 1
D, [2015-06-08T21:15:39.046771 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.047062 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.047464 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.047951 #23563] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-08T21:15:39.048586 #23563] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-08T21:15:39.048944 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.050098 #23563] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1[0m
D, [2015-06-08T21:15:39.051200 #23563] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?  [["parent_uuid", "pqrs"], ["id", 4]]
D, [2015-06-08T21:15:39.051821 #23563] DEBUG -- :   [1m[36mUser Load (0.2ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."total_order" LIMIT 1[0m  [["uuid", "pqrs"]]
E, [2015-06-08T21:15:39.051856 #23563] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-08T21:15:39.052052 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.052355 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.052692 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.053054 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-08T21:15:39.053410 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.053636 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.054127 #23563] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1
D, [2015-06-08T21:15:39.054657 #23563] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?[0m  [["parent_uuid", "pqrs"], ["id", 4]]
D, [2015-06-08T21:15:39.055117 #23563] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."total_order" LIMIT 1  [["uuid", "pqrs"]]
E, [2015-06-08T21:15:39.055147 #23563] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT  "users".* FROM "users" WHERE "users"."uuid" = ?  ORDER BY "users"."total_order" LIMIT 1
D, [2015-06-08T21:15:39.055270 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.055553 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.055873 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.056229 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-08T21:15:39.056450 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.056929 #23563] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'lmno' AND "users"."id" != 4) LIMIT 1
D, [2015-06-08T21:15:39.057389 #23563] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?[0m  [["parent_uuid", nil], ["id", 4]]
D, [2015-06-08T21:15:39.057702 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-08T21:15:39.057888 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.058166 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.058476 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.058796 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.059288 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.060100 #23563] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '3d44f451bdc28f5da2719df0ee1568b1' LIMIT 1
D, [2015-06-08T21:15:39.060313 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.060608 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.060939 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.061452 #23563] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1
E, [2015-06-08T21:15:39.061484 #23563] ERROR -- : SQLite3::SQLException: no such column: users.denv: SELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1
D, [2015-06-08T21:15:39.061601 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.062013 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.063568 #23563] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" IS NULL[0m
D, [2015-06-08T21:15:39.064011 #23563] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."denv" = 1
E, [2015-06-08T21:15:39.064043 #23563] ERROR -- : SQLite3::SQLException: no such column: users.denv: SELECT "users".* FROM "users" WHERE "users"."denv" = 1
D, [2015-06-08T21:15:39.064197 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.064624 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.065025 #23563] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1[0m
E, [2015-06-08T21:15:39.065056 #23563] ERROR -- : SQLite3::SQLException: no such column: users.denv: SELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1
D, [2015-06-08T21:15:39.065171 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.065493 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.065846 #23563] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.066138 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.066470 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.066747 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.067044 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.067374 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:39.067702 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-08T21:15:39.067864 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.068160 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.068349 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.068630 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.068935 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.069121 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.069448 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.069726 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-08T21:15:39.070370 #23563] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1[0m  [["uuid", "ijkh"]]
D, [2015-06-08T21:15:39.070765 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.070945 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.071312 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.071623 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-08T21:15:39.071895 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:39.072179 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.072441 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.072755 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.073057 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-08T21:15:39.073362 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:39.073637 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.073854 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.074175 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.074448 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.074735 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-08T21:15:39.075021 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-08T21:15:39.075425 #23563] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd'  ORDER BY "users"."total_order"
E, [2015-06-08T21:15:39.075456 #23563] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd'  ORDER BY "users"."total_order"
D, [2015-06-08T21:15:39.075568 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.075893 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.076212 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.076512 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-08T21:15:39.076800 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-08T21:15:39.077270 #23563] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."total_order"
E, [2015-06-08T21:15:39.077300 #23563] ERROR -- : SQLite3::SQLException: no such column: users.total_order: SELECT "users".* FROM "users" WHERE "users"."parent_uuid" = 'abcd' AND ("users"."uuid" != 'ijkh')  ORDER BY "users"."total_order"
D, [2015-06-08T21:15:39.077413 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.077739 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.078050 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.078341 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-08T21:15:39.078623 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-08T21:15:39.078919 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:39.079137 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.079596 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.079907 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:39.080210 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-08T21:15:39.080489 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.080874 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.081184 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.081527 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."uuid" = ? LIMIT 1  [["uuid", "abcd"]]
D, [2015-06-08T21:15:39.081726 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.082182 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-08T21:15:39.086123 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.086576 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.087474 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.087998 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.088347 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.088994 #23563] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE "users"."uuid" = '06b48fb788b6ce480133ea20f8f74681' LIMIT 1
D, [2015-06-08T21:15:39.089222 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.089543 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.089862 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.090148 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.090615 #23563] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."uuid" = '410d23d89ed0f8c7b00ae5913139a2fb' LIMIT 1[0m
D, [2015-06-08T21:15:39.090817 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.091076 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.091508 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.091940 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.092538 #23563] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.093861 #23563] DEBUG -- :   [1m[36mUser Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "pqrs"]]
D, [2015-06-08T21:15:39.094098 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.094487 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-08T21:15:39.094692 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.094931 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.095356 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.095719 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.096053 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.096695 #23563] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-08T21:15:39.097268 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?  [["parent_uuid", "ijkh"]]
D, [2015-06-08T21:15:39.097634 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "total_order"[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-08T21:15:39.097969 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.098248 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-08T21:15:39.098412 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.098607 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.099002 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.099322 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.099611 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.100254 #23563] DEBUG -- :   [1m[36mUser Exists (0.0ms)[0m  [1mSELECT  1 AS one FROM "users" WHERE "users"."parent_uuid" = ? LIMIT 1[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-08T21:15:39.100590 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SELECT COUNT(*) FROM "users" WHERE "users"."parent_uuid" = ?  [["parent_uuid", "ijkh"]]
D, [2015-06-08T21:15:39.101012 #23563] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."parent_uuid" = ?  ORDER BY "total_order" DESC LIMIT 1[0m  [["parent_uuid", "ijkh"]]
D, [2015-06-08T21:15:39.101213 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.101498 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-08T21:15:39.101665 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.101853 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.102395 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.102792 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.109175 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.109648 #23563] DEBUG -- :   [1m[36mUser Load (0.0ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.109918 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.110176 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.110620 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-08T21:15:39.110980 #23563] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-08T21:15:39.111239 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.111602 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.111931 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.112176 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.112713 #23563] DEBUG -- :   [1m[35mUser Exists (0.1ms)[0m  SELECT  1 AS one FROM "users" WHERE ("users"."uuid" = 'pqrs' AND "users"."id" != 5) LIMIT 1
D, [2015-06-08T21:15:39.113213 #23563] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "users" SET "parent_uuid" = ? WHERE "users"."id" = ?[0m  [["parent_uuid", nil], ["id", 5]]
D, [2015-06-08T21:15:39.113713 #23563] DEBUG -- :   [1m[35mUser Load (0.0ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.114367 #23563] DEBUG -- :   [1m[36mSQL (0.1ms)[0m  [1mUPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'pqrs'  ORDER BY "users"."total_order")[0m
E, [2015-06-08T21:15:39.114400 #23563] ERROR -- : SQLite3::SQLException: no such column: users.total_order: UPDATE "users" SET "depth" = 0 WHERE "users"."id" IN (SELECT "users"."id" FROM "users" WHERE "users"."uuid" = 'pqrs'  ORDER BY "users"."total_order")
D, [2015-06-08T21:15:39.114526 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.114823 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.115301 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.115721 #23563] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1[0m
E, [2015-06-08T21:15:39.115753 #23563] ERROR -- : SQLite3::SQLException: no such column: users.denv: SELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1
D, [2015-06-08T21:15:39.115858 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.116213 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.116563 #23563] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1
E, [2015-06-08T21:15:39.116592 #23563] ERROR -- : SQLite3::SQLException: no such column: users.denv: SELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1
D, [2015-06-08T21:15:39.116699 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.117124 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.117483 #23563] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1[0m
E, [2015-06-08T21:15:39.117513 #23563] ERROR -- : SQLite3::SQLException: no such column: users.denv: SELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1
D, [2015-06-08T21:15:39.117618 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.117922 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.118272 #23563] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1
E, [2015-06-08T21:15:39.118317 #23563] ERROR -- : SQLite3::SQLException: no such column: users.denv: SELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1
D, [2015-06-08T21:15:39.118424 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.118820 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.119170 #23563] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1[0m
E, [2015-06-08T21:15:39.119216 #23563] ERROR -- : SQLite3::SQLException: no such column: users.denv: SELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1
D, [2015-06-08T21:15:39.119344 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.119658 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.119968 #23563] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."id" DESC LIMIT 1
D, [2015-06-08T21:15:39.120180 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.120323 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.120576 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.121000 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.121414 #23563] DEBUG -- :   [1m[36mUser Load (0.1ms)[0m  [1mSELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1[0m
E, [2015-06-08T21:15:39.121446 #23563] ERROR -- : SQLite3::SQLException: no such column: users.denv: SELECT  "users".* FROM "users" WHERE "users"."denv" = 1  ORDER BY "users"."id" ASC LIMIT 1
D, [2015-06-08T21:15:39.121552 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.121861 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.122189 #23563] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."id" DESC LIMIT 1
D, [2015-06-08T21:15:39.122373 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.122595 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.122957 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.123619 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.124254 #23563] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."denv" = 1[0m
E, [2015-06-08T21:15:39.124292 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT "categories".* FROM "categories" WHERE "categories"."denv" = 1
D, [2015-06-08T21:15:39.124428 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.124782 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.125280 #23563] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.128506 #23563] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."denv" = 1[0m
E, [2015-06-08T21:15:39.128556 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT "categories".* FROM "categories" WHERE "categories"."denv" = 1
D, [2015-06-08T21:15:39.128704 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.129061 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.129407 #23563] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."denv" = 1
E, [2015-06-08T21:15:39.129437 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT "categories".* FROM "categories" WHERE "categories"."denv" = 1
D, [2015-06-08T21:15:39.129546 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.129813 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.130179 #23563] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.130536 #23563] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."denv" = 1
E, [2015-06-08T21:15:39.130568 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT "categories".* FROM "categories" WHERE "categories"."denv" = 1
D, [2015-06-08T21:15:39.130676 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.130948 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.131265 #23563] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."denv" = 1[0m
E, [2015-06-08T21:15:39.131301 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT "categories".* FROM "categories" WHERE "categories"."denv" = 1
D, [2015-06-08T21:15:39.131487 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.131915 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.132664 #23563] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.133442 #23563] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."denv" = 1[0m
E, [2015-06-08T21:15:39.133519 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT "categories".* FROM "categories" WHERE "categories"."denv" = 1
D, [2015-06-08T21:15:39.133802 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.135556 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.136142 #23563] DEBUG -- :   [1m[35mFixture Delete (0.0ms)[0m  DELETE FROM "default_scoped_models"
D, [2015-06-08T21:15:39.136318 #23563] DEBUG -- :   [1m[36mFixture Insert (0.1ms)[0m  [1mINSERT INTO "default_scoped_models" ("id", "name", "lft", "rgt") VALUES (1, 'Top Level', 1, 4)[0m
D, [2015-06-08T21:15:39.136451 #23563] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "default_scoped_models" ("id", "name", "parent_id", "lft", "rgt") VALUES (2, 'Child 1', 1, 2, 3)
D, [2015-06-08T21:15:39.136558 #23563] DEBUG -- :   [1m[36mFixture Insert (0.0ms)[0m  [1mINSERT INTO "default_scoped_models" ("id", "name", "lft", "rgt") VALUES (6, 'Top Level 2', 5, 6)[0m
D, [2015-06-08T21:15:39.136661 #23563] DEBUG -- :   [1m[35mFixture Insert (0.0ms)[0m  INSERT INTO "default_scoped_models" ("id", "name", "lft", "rgt") VALUES (7, 'Top Level 3', 7, 8)
D, [2015-06-08T21:15:39.136742 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mcommit transaction[0m
D, [2015-06-08T21:15:39.136888 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.139940 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.140327 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.141034 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.141405 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.143555 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.143920 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.144590 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.144923 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.145349 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-08T21:15:39.147401 #23563] DEBUG -- :   [1m[35mCategory Exists (0.1ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 4]]
D, [2015-06-08T21:15:39.147824 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.148532 #23563] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 3]]
D, [2015-06-08T21:15:39.148799 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:39.149360 #23563] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 1]]
D, [2015-06-08T21:15:39.149509 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.149842 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.150166 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:39.150459 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-08T21:15:39.150728 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.150969 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-08T21:15:39.151238 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-08T21:15:39.151636 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.151922 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.152237 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.152590 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.152830 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.153104 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.153472 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:39.153753 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.154028 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.154299 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-08T21:15:39.154566 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.154778 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.155069 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.155355 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:39.155965 #23563] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "total_order"  [["parent_id", 1]]
D, [2015-06-08T21:15:39.156549 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.156868 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.157228 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.157677 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.157957 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.158287 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:39.158579 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.158752 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.159014 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.159302 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:39.159590 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.159740 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.160026 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.160570 #23563] DEBUG -- :   [1m[35mScopedCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1
E, [2015-06-08T21:15:39.160603 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1
D, [2015-06-08T21:15:39.160720 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.160993 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.161340 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.161634 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:39.161808 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.162092 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.162511 #23563] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.163063 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:39.163342 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.163733 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.164240 #23563] DEBUG -- :   [1m[36mScopedCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1[0m
E, [2015-06-08T21:15:39.164275 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1
D, [2015-06-08T21:15:39.164404 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.164709 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.165150 #23563] DEBUG -- :   [1m[35mScopedCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1
E, [2015-06-08T21:15:39.165201 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1
D, [2015-06-08T21:15:39.165327 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.165624 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.166026 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.166365 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.166732 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.167052 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.167430 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:39.167783 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.168115 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.168411 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-08T21:15:39.168716 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.169004 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.169276 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.169568 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.169833 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.170139 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.170423 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.170711 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.170973 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.171274 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-08T21:15:39.171558 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:39.171815 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.172109 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.172372 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-08T21:15:39.172678 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.172940 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.173240 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-08T21:15:39.173529 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.173791 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.174091 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.174402 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.174666 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.174959 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.175335 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.175859 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.176682 #23563] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.177327 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.177629 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.177950 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.178201 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.178412 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.178749 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.179107 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.179413 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.179559 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.179828 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.179968 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.180180 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.180455 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.180741 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.180888 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.181140 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.181274 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.181432 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.181730 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.181994 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-08T21:15:39.182285 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-08T21:15:39.182421 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.182682 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-08T21:15:39.182834 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.183026 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.183296 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.183544 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.183822 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.184039 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.184339 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.184642 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.184847 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.185107 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.185404 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-08T21:15:39.185566 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.185846 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.186138 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:39.186306 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.186621 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.186832 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.187131 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.187377 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.187648 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.187854 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.188088 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.188312 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.188621 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.188800 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.189025 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.189301 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.189560 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.189733 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.190006 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.190236 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.190498 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.190915 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.191169 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.191401 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.191650 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.191883 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.192132 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.192363 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.192632 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.192845 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.193119 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.193476 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.193776 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.193978 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.194255 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.194533 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:39.194712 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.195009 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.195311 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:39.195567 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.195828 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.196155 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:39.196443 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.196610 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.196897 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.197139 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.197402 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.197623 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.197894 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.198129 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.198372 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.198604 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.198867 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.199097 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.199374 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.199617 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.199888 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.200142 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.200404 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.201010 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.201295 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.201865 #23563] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."denv" = 1
E, [2015-06-08T21:15:39.201940 #23563] ERROR -- : SQLite3::SQLException: no such column: notes.denv: SELECT "notes".* FROM "notes" WHERE "notes"."denv" = 1
D, [2015-06-08T21:15:39.202554 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.202959 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.207152 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.207555 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.207842 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.208245 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.208554 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.209125 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.209798 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.210524 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-08T21:15:39.211177 #23563] DEBUG -- :   [1m[36mNote Load (0.1ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:39.211560 #23563] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-08T21:15:39.211960 #23563] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-08T21:15:39.212160 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.212494 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.212693 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.212946 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.213246 #23563] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:39.213566 #23563] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.213768 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.214037 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.214354 #23563] DEBUG -- :   [1m[35mNote Load (0.0ms)[0m  SELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:39.214658 #23563] DEBUG -- :   [1m[36mNote Load (0.0ms)[0m  [1mSELECT  "notes".* FROM "notes" WHERE "notes"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-08T21:15:39.214838 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.215121 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.215490 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.215655 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.215862 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.216118 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.216397 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.216732 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.216899 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.217028 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.217264 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.217549 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.217854 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.218007 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.218130 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.218355 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.218638 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.218949 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.219261 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.219541 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.219805 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.220107 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.220453 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.220741 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.221098 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.221323 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.221622 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.221843 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.222073 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.222303 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.222594 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.222944 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-08T21:15:39.223230 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.223409 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.223989 #23563] DEBUG -- :   [1m[35mSQL (0.1ms)[0m  UPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?  [["parent_id", 5], ["id", 4]]
D, [2015-06-08T21:15:39.224482 #23563] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1[0m  [["id", 5]]
E, [2015-06-08T21:15:39.224515 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-08T21:15:39.224670 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.224945 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.225280 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.225626 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-08T21:15:39.225928 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.226179 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.226730 #23563] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?  [["parent_id", 5], ["id", 4]]
D, [2015-06-08T21:15:39.227201 #23563] DEBUG -- :   [1m[36mCategory Load (0.2ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1[0m  [["id", 5]]
E, [2015-06-08T21:15:39.227231 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-08T21:15:39.227344 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.227619 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.227951 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-08T21:15:39.228262 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-08T21:15:39.228457 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.228972 #23563] DEBUG -- :   [1m[36mSQL (0.0ms)[0m  [1mUPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?[0m  [["parent_id", nil], ["id", 4]]
D, [2015-06-08T21:15:39.229288 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-08T21:15:39.229458 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.229739 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.230042 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.230347 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.230864 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.231447 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.231700 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.232035 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  begin transaction
D, [2015-06-08T21:15:39.232573 #23563] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1[0m
E, [2015-06-08T21:15:39.232605 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1
D, [2015-06-08T21:15:39.232728 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.233122 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.233275 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.233534 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.233672 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.233932 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.234049 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.234318 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.234456 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.234711 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.234845 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.235082 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.235215 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.235463 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.235594 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.235832 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.235958 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.236196 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.236324 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.236577 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.239360 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.239685 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.240027 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.240467 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.240837 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.241211 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.241447 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.241732 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.241933 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.242230 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.242464 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.242747 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.242957 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.243242 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.243518 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.243812 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.244212 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.244619 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.244868 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.245162 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.245348 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.245649 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.245874 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.246174 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.246358 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.246611 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.246788 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.247031 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.247217 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.247460 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.247658 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.248033 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.248328 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.248941 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.249525 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.250280 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.250621 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.250954 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.251164 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.251430 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.251598 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.251853 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.252027 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.252299 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.252475 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.252839 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.252969 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.253313 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.253774 #23563] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."denv" = 1
E, [2015-06-08T21:15:39.253804 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT "categories".* FROM "categories" WHERE "categories"."denv" = 1
D, [2015-06-08T21:15:39.253925 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.254193 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.254571 #23563] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1[0m
E, [2015-06-08T21:15:39.254600 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1
D, [2015-06-08T21:15:39.254714 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.254970 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.255303 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.255593 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.255875 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.256075 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.256328 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.256648 #23563] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."id" DESC LIMIT 1[0m
D, [2015-06-08T21:15:39.257172 #23563] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1  [["id", 6]]
E, [2015-06-08T21:15:39.257203 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ?  ORDER BY "categories"."total_order" LIMIT 1
D, [2015-06-08T21:15:39.257331 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.257626 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.257958 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:39.258288 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-08T21:15:39.258463 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.258745 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.259042 #23563] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE (is_leaf = 1)[0m
E, [2015-06-08T21:15:39.259071 #23563] ERROR -- : SQLite3::SQLException: no such column: is_leaf: SELECT "categories".* FROM "categories" WHERE (is_leaf = 1)
D, [2015-06-08T21:15:39.259186 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.259467 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.259775 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-08T21:15:39.259975 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.260253 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.260566 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-08T21:15:39.261146 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.261463 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.261638 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.261930 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.262228 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-08T21:15:39.262522 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:39.262803 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.263046 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.263345 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.263651 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-08T21:15:39.263948 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:39.264226 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.264462 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.264763 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.265048 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.265333 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.265612 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.266004 #23563] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = 1  ORDER BY "categories"."total_order"[0m
E, [2015-06-08T21:15:39.266033 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = 1  ORDER BY "categories"."total_order"
D, [2015-06-08T21:15:39.266157 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.266447 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.266733 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.267015 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.267281 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.267711 #23563] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3)  ORDER BY "categories"."total_order"[0m
E, [2015-06-08T21:15:39.267740 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = 1 AND ("categories"."id" != 3)  ORDER BY "categories"."total_order"
D, [2015-06-08T21:15:39.267856 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.268149 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.268433 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-08T21:15:39.268711 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 4]]
D, [2015-06-08T21:15:39.268971 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.269244 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:39.269471 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.269875 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.270167 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:39.270488 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 2]]
D, [2015-06-08T21:15:39.270743 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.271109 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.271384 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-08T21:15:39.271699 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:39.271892 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.272260 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.272595 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.272877 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.273541 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.273907 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.274156 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.274428 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.274673 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.274949 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.275126 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.275358 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.275595 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.275864 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.276039 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.276278 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.276518 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.276785 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.276958 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.277187 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.277429 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.277791 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.278161 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-08T21:15:39.278443 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-08T21:15:39.279095 #23563] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 5]]
D, [2015-06-08T21:15:39.279228 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.279468 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.279628 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.279813 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.280107 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.280403 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-08T21:15:39.280735 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.281559 #23563] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 3]]
D, [2015-06-08T21:15:39.282020 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 3]]
D, [2015-06-08T21:15:39.282444 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "total_order"  [["parent_id", 3]]
D, [2015-06-08T21:15:39.282817 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.288310 #23563] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-08T21:15:39.288539 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.288788 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.289161 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.289523 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-08T21:15:39.289813 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.290470 #23563] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 3]]
D, [2015-06-08T21:15:39.290787 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 3]]
D, [2015-06-08T21:15:39.291247 #23563] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "total_order" DESC LIMIT 1  [["parent_id", 3]]
D, [2015-06-08T21:15:39.291669 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.292533 #23563] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 4]]
D, [2015-06-08T21:15:39.292947 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.293371 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.293756 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.294204 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-08T21:15:39.294550 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:39.295276 #23563] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 1]]
D, [2015-06-08T21:15:39.295647 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-08T21:15:39.295989 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "total_order"  [["parent_id", 1]]
D, [2015-06-08T21:15:39.296305 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.296582 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 3]]
D, [2015-06-08T21:15:39.296731 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.296941 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.297265 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.297599 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 2]]
D, [2015-06-08T21:15:39.297895 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 1]]
D, [2015-06-08T21:15:39.298515 #23563] DEBUG -- :   [1m[35mCategory Exists (0.0ms)[0m  SELECT  1 AS one FROM "categories" WHERE "categories"."parent_id" = ? LIMIT 1  [["parent_id", 1]]
D, [2015-06-08T21:15:39.298845 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "categories" WHERE "categories"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-08T21:15:39.299171 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT "categories".* FROM "categories" WHERE "categories"."parent_id" = ?  ORDER BY "total_order"  [["parent_id", 1]]
D, [2015-06-08T21:15:39.299453 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.299896 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.300214 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.300616 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.300913 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 3]]
D, [2015-06-08T21:15:39.301087 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.301314 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.301614 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.301941 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-08T21:15:39.302158 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.302486 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.302824 #23563] DEBUG -- :   [1m[35mCategory Load (0.0ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1  [["id", 5]]
D, [2015-06-08T21:15:39.303082 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.303642 #23563] DEBUG -- :   [1m[35mSQL (0.0ms)[0m  UPDATE "categories" SET "parent_id" = ? WHERE "categories"."id" = ?  [["parent_id", nil], ["id", 5]]
D, [2015-06-08T21:15:39.304163 #23563] DEBUG -- :   [1m[36mCategory Load (0.0ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."id" = ? LIMIT 1[0m  [["id", 5]]
D, [2015-06-08T21:15:39.304800 #23563] DEBUG -- :   [1m[35mSQL (0.2ms)[0m  UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 5  ORDER BY "categories"."total_order")
E, [2015-06-08T21:15:39.304832 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.total_order: UPDATE "categories" SET "depth" = 0 WHERE "categories"."id" IN (SELECT "categories"."id" FROM "categories" WHERE "categories"."id" = 5  ORDER BY "categories"."total_order")
D, [2015-06-08T21:15:39.304954 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.305211 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.305661 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.306131 #23563] DEBUG -- :   [1m[35mThing Load (0.1ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:39.309927 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-08T21:15:39.310132 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.310524 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.310922 #23563] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:39.311595 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-08T21:15:39.311757 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.312972 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.313154 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.313478 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.313851 #23563] DEBUG -- :   [1m[35mThing Load (0.0ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."id" = ? LIMIT 1  [["id", 1]]
D, [2015-06-08T21:15:39.314547 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSELECT COUNT(*) FROM "things" WHERE "things"."parent_id" = ?[0m  [["parent_id", 1]]
D, [2015-06-08T21:15:39.314979 #23563] DEBUG -- :   [1m[35mThing Load (0.1ms)[0m  SELECT  "things".* FROM "things" WHERE "things"."parent_id" = ?  ORDER BY "total_order" DESC LIMIT 1  [["parent_id", 1]]
D, [2015-06-08T21:15:39.315172 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.315359 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.315634 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.316054 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.318720 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.319116 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.319384 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.319833 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.321061 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.321462 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.324564 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.325015 #23563] DEBUG -- :   [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.325333 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.326016 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.326251 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.326534 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.326732 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.327082 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.327628 #23563] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1[0m
E, [2015-06-08T21:15:39.327664 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1
D, [2015-06-08T21:15:39.327791 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.328110 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.328512 #23563] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1
E, [2015-06-08T21:15:39.328545 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1
D, [2015-06-08T21:15:39.328686 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.329162 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.335444 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.335880 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.336177 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.336678 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.337177 #23563] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1[0m
E, [2015-06-08T21:15:39.337210 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1
D, [2015-06-08T21:15:39.337329 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.337655 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.338001 #23563] DEBUG -- :   [1m[35mUser Load (0.1ms)[0m  SELECT  "users".* FROM "users"  ORDER BY "users"."id" ASC LIMIT 1
D, [2015-06-08T21:15:39.339039 #23563] DEBUG -- :   [1m[36m (0.1ms)[0m  [1mSELECT "notes".id FROM "notes" WHERE "notes"."user_id" = ?[0m  [["user_id", 1]]
D, [2015-06-08T21:15:39.339566 #23563] DEBUG -- :   [1m[35mNote Load (0.1ms)[0m  SELECT "notes".* FROM "notes" WHERE "notes"."user_id" = ?  [["user_id", 1]]
D, [2015-06-08T21:15:39.340134 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.340350 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.340656 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.340971 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.341415 #23563] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1[0m
E, [2015-06-08T21:15:39.341445 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1
D, [2015-06-08T21:15:39.341557 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.341963 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.342317 #23563] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1
E, [2015-06-08T21:15:39.342346 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1
D, [2015-06-08T21:15:39.342451 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.342723 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.343023 #23563] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."id" DESC LIMIT 1[0m
D, [2015-06-08T21:15:39.343205 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.343368 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.343637 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.344007 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.344409 #23563] DEBUG -- :   [1m[35mCategory Load (0.1ms)[0m  SELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1
E, [2015-06-08T21:15:39.344455 #23563] ERROR -- : SQLite3::SQLException: no such column: categories.denv: SELECT  "categories".* FROM "categories" WHERE "categories"."denv" = 1  ORDER BY "categories"."id" ASC LIMIT 1
D, [2015-06-08T21:15:39.344565 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
D, [2015-06-08T21:15:39.344869 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  begin transaction
D, [2015-06-08T21:15:39.345149 #23563] DEBUG -- :   [1m[36mCategory Load (0.1ms)[0m  [1mSELECT  "categories".* FROM "categories"  ORDER BY "categories"."id" DESC LIMIT 1[0m
D, [2015-06-08T21:15:39.345295 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
D, [2015-06-08T21:15:39.345435 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
D, [2015-06-08T21:15:39.345646 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
D, [2015-06-08T21:15:39.346036 #23563] DEBUG -- :   [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
D, [2015-06-08T21:15:39.346541 #23563] DEBUG -- :   [1m[35mDefaultScopedModel Load (0.1ms)[0m  SELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1  [["id", 6]]
D, [2015-06-08T21:15:39.349391 #23563] DEBUG -- :   [1m[36mDefaultScopedModel Load (0.0ms)[0m  [1mSELECT  "default_scoped_models".* FROM "default_scoped_models" WHERE "default_scoped_models"."id" = ? LIMIT 1[0m  [["id", 6]]
D, [2015-06-08T21:15:39.349867 #23563] DEBUG -- :   [1m[35m (0.0ms)[0m  rollback transaction
